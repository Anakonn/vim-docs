---
description: เรียนรู้การใช้ฟังก์ชันการพับใน Vim เพื่อซ่อนข้อความที่ไม่จำเป็น ช่วยให้การอ่านไฟล์ง่ายขึ้นและเข้าใจได้ดีขึ้น
title: Ch17. Fold
---

เมื่อคุณอ่านไฟล์ มักจะมีข้อความที่ไม่เกี่ยวข้องมากมายที่ขัดขวางไม่ให้คุณเข้าใจว่าไฟล์นั้นทำอะไร เพื่อซ่อนเสียงรบกวนที่ไม่จำเป็น ใช้ Vim fold

ในบทนี้ คุณจะได้เรียนรู้วิธีการพับไฟล์ที่แตกต่างกัน

## การพับแบบแมนนวล

จินตนาการว่าคุณกำลังพับแผ่นกระดาษเพื่อปิดข้อความบางส่วน ข้อความจริงๆ ไม่หายไป มันยังอยู่ที่นั่น Vim fold ทำงานในลักษณะเดียวกัน มันพับช่วงของข้อความซึ่งซ่อนมันจากการแสดงผลโดยไม่ลบออกจริงๆ

ตัวดำเนินการพับคือ `z` (เมื่อกระดาษถูกพับ มันมีรูปทรงเหมือนตัวอักษร z)

สมมติว่าคุณมีข้อความนี้:

```shell
Fold me
Hold me
```

เมื่อเคอร์เซอร์อยู่ในบรรทัดแรก ให้พิมพ์ `zfj` Vim จะพับทั้งสองบรรทัดเป็นหนึ่ง คุณควรเห็นอะไรบางอย่างแบบนี้:

```shell
+-- 2 lines: Fold me -----
```

นี่คือการแบ่งส่วน:
- `zf` คือ ตัวดำเนินการพับ
- `j` คือ การเคลื่อนไหวสำหรับตัวดำเนินการพับ

คุณสามารถเปิดข้อความที่พับด้วย `zo` เพื่อปิดการพับ ใช้ `zc`

การพับเป็นตัวดำเนินการ ดังนั้นมันจึงปฏิบัติตามกฎไวยากรณ์ (`กริยา + นาม`) คุณสามารถส่งตัวดำเนินการพับพร้อมกับการเคลื่อนไหวหรือวัตถุข้อความ เพื่อพับย่อหน้าภายใน ให้รัน `zfip` เพื่อพับจนถึงจุดสิ้นสุดของไฟล์ ให้รัน `zfG` เพื่อพับข้อความระหว่าง `{` และ `}` ให้รัน `zfa{`

คุณสามารถพับจากโหมดวิชวล ไฮไลต์พื้นที่ที่คุณต้องการพับ (`v`, `V`, หรือ `Ctrl-v`) จากนั้นรัน `zf`

คุณสามารถดำเนินการพับจากโหมดบรรทัดคำสั่งด้วยคำสั่ง `:fold` เพื่อพับบรรทัดปัจจุบันและบรรทัดถัดไป ให้รัน:

```shell
:,+1fold
```

`,+1` คือช่วง หากคุณไม่ส่งพารามิเตอร์ไปยังช่วง มันจะตั้งค่าเป็นบรรทัดปัจจุบัน `+1` คือ ตัวบ่งชี้ช่วงสำหรับบรรทัดถัดไป เพื่อพับบรรทัด 5 ถึง 10 ให้รัน `:5,10fold` เพื่อพับจากตำแหน่งปัจจุบันไปยังจุดสิ้นสุดของบรรทัด ให้รัน `:,$fold`

มีคำสั่งพับและคลายพับอื่นๆ อีกมากมาย ฉันพบว่ามันมากเกินไปที่จะจำเมื่อเริ่มต้น คำสั่งที่มีประโยชน์ที่สุดคือ:
- `zR` เพื่อเปิดพับทั้งหมด
- `zM` เพื่อปิดพับทั้งหมด
- `za` สลับสถานะการพับ

คุณสามารถรัน `zR` และ `zM` บนบรรทัดใดก็ได้ แต่ `za` จะทำงานเฉพาะเมื่อคุณอยู่บนบรรทัดที่พับ/คลายพับ เพื่อเรียนรู้คำสั่งพับเพิ่มเติม ให้ตรวจสอบ `:h fold-commands`

## วิธีการพับที่แตกต่างกัน

ส่วนข้างต้นครอบคลุมการพับแบบแมนนวลของ Vim มีวิธีการพับที่แตกต่างกันหกวิธีใน Vim:
1. แมนนวล
2. การเยื้อง
3. นิพจน์
4. ไวยากรณ์
5. ความแตกต่าง
6. ตัวชี้

เพื่อดูว่าวิธีการพับใดที่คุณกำลังใช้ในขณะนี้ ให้รัน `:set foldmethod?` โดยค่าเริ่มต้น Vim ใช้วิธีการ `manual`

ในส่วนที่เหลือของบทนี้ คุณจะได้เรียนรู้เกี่ยวกับวิธีการพับอีกห้าประการ มาทำความรู้จักกับการพับแบบเยื้องกันเถอะ

## การพับแบบเยื้อง

ในการใช้การพับแบบเยื้อง ให้เปลี่ยน `'foldmethod'` เป็น indent:

```shell
:set foldmethod=indent
```

สมมติว่าคุณมีข้อความ:

```shell
One
  Two
  Two again
```

หากคุณรัน `:set foldmethod=indent` คุณจะเห็น:

```shell
One
+-- 2 lines: Two -----
```

ด้วยการพับแบบเยื้อง Vim จะดูว่ามีช่องว่างกี่ช่องในแต่ละบรรทัดที่เริ่มต้นและเปรียบเทียบกับตัวเลือก `'shiftwidth'` เพื่อกำหนดความสามารถในการพับ `'shiftwidth'` จะคืนค่าจำนวนช่องว่างที่ต้องการสำหรับแต่ละขั้นตอนของการเยื้อง หากคุณรัน:

```shell
:set shiftwidth?
```

ค่าดีฟอลต์ของ `'shiftwidth'` ของ Vim คือ 2 ในข้อความด้านบน มีช่องว่างสองช่องระหว่างจุดเริ่มต้นของบรรทัดและข้อความ "Two" และ "Two again" เมื่อ Vim เห็นจำนวนช่องว่างและค่าของ `'shiftwidth'` เป็น 2 Vim จะถือว่าบรรทัดนั้นมีระดับการพับเยื้องหนึ่ง

สมมติว่าครั้งนี้คุณมีช่องว่างเพียงหนึ่งช่องระหว่างจุดเริ่มต้นของบรรทัดและข้อความ:

```shell
One
 Two
 Two again
```

ตอนนี้หากคุณรัน `:set foldmethod=indent` Vim จะไม่พับบรรทัดที่เยื้องเพราะไม่มีช่องว่างเพียงพอในแต่ละบรรทัด ช่องว่างหนึ่งช่องไม่ถือว่าเป็นการเยื้อง อย่างไรก็ตาม หากคุณเปลี่ยน `'shiftwidth'` เป็น 1:

```shell
:set shiftwidth=1
```

ข้อความตอนนี้สามารถพับได้ มันถือว่าเป็นการเยื้อง

คืนค่าการตั้งค่า `shiftwidth` กลับเป็น 2 และช่องว่างระหว่างข้อความกลับเป็นสองอีกครั้ง นอกจากนี้ เพิ่มข้อความอีกสองข้อความ:

```shell
One
  Two
  Two again
    Three
    Three again
```

รันการพับ (`zM`) คุณจะเห็น:

```shell
One
+-- 4 lines: Two -----
```

คลายพับบรรทัดที่พับ (`zR`) จากนั้นวางเคอร์เซอร์ของคุณบน "Three" และสลับสถานะการพับของข้อความ (`za`):

```shell
One
  Two
  Two again
+-- 2 lines: Three -----
```

นี่คืออะไร? การพับภายในการพับ?

การพับซ้อนกันเป็นสิ่งที่ถูกต้อง ข้อความ "Two" และ "Two again" มีระดับการพับหนึ่ง ข้อความ "Three" และ "Three again" มีระดับการพับสอง หากคุณมีข้อความที่สามารถพับได้ซึ่งมีระดับการพับสูงกว่าภายในข้อความที่สามารถพับได้ คุณจะมีหลายชั้นของการพับ

## การพับแบบนิพจน์

การพับแบบนิพจน์อนุญาตให้คุณกำหนดนิพจน์เพื่อจับคู่สำหรับการพับ หลังจากที่คุณกำหนดนิพจน์พับแล้ว Vim จะสแกนแต่ละบรรทัดเพื่อหาค่าของ `'foldexpr'` นี่คือค่าตัวแปรที่คุณต้องกำหนดเพื่อคืนค่าที่เหมาะสม หาก `'foldexpr'` คืนค่า 0 แสดงว่าบรรทัดนั้นไม่ได้ถูกพับ หากคืนค่า 1 แสดงว่าบรรทัดนั้นมีระดับการพับ 1 หากคืนค่า 2 แสดงว่าบรรทัดนั้นมีระดับการพับ 2 มีค่ามากกว่าหมายเลขจำนวนเต็ม แต่ฉันจะไม่พูดถึงมัน หากคุณสนใจให้ตรวจสอบ `:h fold-expr`

ก่อนอื่น มาลองเปลี่ยนวิธีการพับ:

```shell
:set foldmethod=expr
```

สมมติว่าคุณมีรายการอาหารเช้าและคุณต้องการพับรายการอาหารเช้าทั้งหมดที่เริ่มต้นด้วย "p":

```shell
donut
pancake
pop-tarts
protein bar
salmon
scrambled eggs
```

ถัดไป เปลี่ยน `foldexpr` เพื่อจับคู่กับนิพจน์ที่เริ่มต้นด้วย "p":

```shell
:set foldexpr=getline(v:lnum)[0]==\\"p\\"
```

นิพจน์ด้านบนดูซับซ้อน มาทำให้เข้าใจง่าย:
- `:set foldexpr` ตั้งค่าตัวเลือก `'foldexpr'` เพื่อรับนิพจน์ที่กำหนดเอง
- `getline()` เป็นฟังก์ชัน Vimscript ที่คืนค่าข้อความของบรรทัดใดๆ ที่กำหนด หากคุณรัน `:echo getline(5)` มันจะคืนค่าข้อความของบรรทัดที่ 5
- `v:lnum` เป็นตัวแปรพิเศษของ Vim สำหรับนิพจน์ `'foldexpr'` Vim จะสแกนแต่ละบรรทัดและในขณะนั้นจะเก็บหมายเลขของแต่ละบรรทัดในตัวแปร `v:lnum` ในบรรทัดที่ 5 `v:lnum` มีค่าเป็น 5 ในบรรทัดที่ 10 `v:lnum` มีค่าเป็น 10
- `[0]` ในบริบทของ `getline(v:lnum)[0]` คืออักขระตัวแรกของแต่ละบรรทัด เมื่อ Vim สแกนบรรทัด `getline(v:lnum)` จะคืนค่าข้อความของแต่ละบรรทัด `getline(v:lnum)[0]` จะคืนค่าอักขระตัวแรกของแต่ละบรรทัด ในบรรทัดแรกของรายการของเรา "donut" `getline(v:lnum)[0]` จะคืนค่า "d" ในบรรทัดที่สองของรายการของเรา "pancake" `getline(v:lnum)[0]` จะคืนค่า "p"
- `==\\"p\\"` คือครึ่งหลังของนิพจน์ความเท่าเทียม มันตรวจสอบว่านิพจน์ที่คุณเพิ่งประเมินเท่ากับ "p" หรือไม่ หากเป็นจริง มันจะคืนค่า 1 หากเป็นเท็จ มันจะคืนค่า 0 ใน Vim 1 ถือเป็นจริงและ 0 ถือเป็นเท็จ ดังนั้นในบรรทัดที่เริ่มต้นด้วย "p" มันจะคืนค่า 1 จำไว้ว่า หาก `'foldexpr'` มีค่าเป็น 1 แสดงว่ามีระดับการพับ 1

หลังจากรันนิพจน์นี้ คุณควรเห็น:

```shell
donut
+-- 3 lines: pancake -----
salmon
scrambled eggs
```

## การพับแบบไวยากรณ์

การพับแบบไวยากรณ์ถูกกำหนดโดยการเน้นไวยากรณ์ของภาษา หากคุณใช้ปลั๊กอินไวยากรณ์ภาษาเช่น [vim-polyglot](https://github.com/sheerun/vim-polyglot) การพับแบบไวยากรณ์จะทำงานได้ทันที เพียงเปลี่ยนวิธีการพับเป็นไวยากรณ์:

```shell
:set foldmethod=syntax
```

สมมติว่าคุณกำลังแก้ไขไฟล์ JavaScript และคุณติดตั้ง vim-polyglot หากคุณมีอาร์เรย์เช่นต่อไปนี้:

```shell
const nums = [
  one,
  two,
  three,
  four
]
```

มันจะถูกพับด้วยการพับแบบไวยากรณ์ เมื่อคุณกำหนดการเน้นไวยากรณ์สำหรับภาษาเฉพาะ (โดยปกติจะอยู่ภายในไดเรกทอรี `syntax/`) คุณสามารถเพิ่มคุณสมบัติ `fold` เพื่อทำให้มันสามารถพับได้ ด้านล่างนี้คือสแนปช็อตจากไฟล์ไวยากรณ์ JavaScript ของ vim-polyglot สังเกตคำว่า `fold` ที่ส่วนท้าย

```shell
syntax region  jsBracket                      matchgroup=jsBrackets            start=/\[/ end=/\]/ contains=@jsExpression,jsSpreadExpression extend fold
```

คู่มือนี้จะไม่ครอบคลุมฟีเจอร์ `syntax` หากคุณสนใจให้ตรวจสอบ `:h syntax.txt`

## การพับแบบความแตกต่าง

Vim สามารถทำขั้นตอนการเปรียบเทียบเพื่อเปรียบเทียบไฟล์สองไฟล์หรือมากกว่า

หากคุณมี `file1.txt`:

```shell
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
```

และ `file2.txt`:

```shell
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
emacs is ok
```

รัน `vimdiff file1.txt file2.txt`:

```shell
+-- 3 lines: vim is awesome -----
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
[vim is awesome] / [emacs is ok]
```

Vim จะพับบางบรรทัดที่เหมือนกันโดยอัตโนมัติ เมื่อคุณรันคำสั่ง `vimdiff` Vim จะใช้ `foldmethod=diff` โดยอัตโนมัติ หากคุณรัน `:set foldmethod?` มันจะคืนค่า `diff`

## การพับแบบตัวชี้

ในการใช้การพับแบบตัวชี้ ให้รัน:

```shell
:set foldmethod=marker
```

สมมติว่าคุณมีข้อความ:

```shell
Hello

{{{
world
vim
}}}
```

รัน `zM` คุณจะเห็น:

```shell
hello

+-- 4 lines: -----
```

Vim มองเห็น `{{{` และ `}}}` เป็นตัวชี้การพับและพับข้อความระหว่างพวกเขา ด้วยการพับแบบตัวชี้ Vim จะค้นหาตัวชี้พิเศษที่กำหนดโดยตัวเลือก `'foldmarker'` เพื่อทำเครื่องหมายพื้นที่การพับ เพื่อดูว่าตัวชี้ใดที่ Vim ใช้ ให้รัน:

```shell
:set foldmarker?
```

โดยค่าเริ่มต้น Vim ใช้ `{{{` และ `}}}` เป็นตัวชี้ หากคุณต้องการเปลี่ยนตัวชี้เป็นข้อความอื่น เช่น "coffee1" และ "coffee2":

```shell
:set foldmarker=coffee1,coffee2
```

หากคุณมีข้อความ:

```shell
hello

coffee1
world
vim
coffee2
```

ตอนนี้ Vim ใช้ `coffee1` และ `coffee2` เป็นตัวชี้การพับใหม่ ข้อสังเกต ตัวชี้จะต้องเป็นสตริงที่แท้จริงและไม่สามารถเป็น regex ได้

## การรักษาการพับ

คุณจะสูญเสียข้อมูลการพับทั้งหมดเมื่อคุณปิดเซสชัน Vim หากคุณมีไฟล์นี้ `count.txt`:

```shell
one
two
three
four
five
```

จากนั้นทำการพับแบบแมนนวลจากบรรทัด "three" ลงไป (`:3,$fold`):

```shell
one
two
+-- 3 lines: three ---
```

เมื่อคุณออกจาก Vim และเปิด `count.txt` อีกครั้ง การพับจะไม่อยู่ที่นั่นอีกต่อไป!

เพื่อรักษาการพับ หลังจากพับแล้ว ให้รัน:

```shell
:mkview
```

จากนั้นเมื่อคุณเปิด `count.txt` ให้รัน:

```shell
:loadview
```

การพับของคุณจะถูกคืนค่า อย่างไรก็ตาม คุณต้องรัน `mkview` และ `loadview` ด้วยตนเอง ฉันรู้ว่าสักวันหนึ่ง ฉันจะลืมรัน `mkview` ก่อนปิดไฟล์และจะสูญเสียการพับทั้งหมด ฉันจะทำให้กระบวนการนี้อัตโนมัติได้อย่างไร?

เพื่อให้รัน `mkview` โดยอัตโนมัติเมื่อคุณปิดไฟล์ `.txt` และรัน `loadview` เมื่อคุณเปิดไฟล์ `.txt` ให้เพิ่มสิ่งนี้ใน vimrc ของคุณ:

```shell
autocmd BufWinLeave *.txt mkview
autocmd BufWinEnter *.txt silent loadview
```

จำไว้ว่า `autocmd` ใช้เพื่อดำเนินการคำสั่งเมื่อมีการกระตุ้นเหตุการณ์ สองเหตุการณ์ที่นี่คือ:
- `BufWinLeave` สำหรับเมื่อคุณลบบัฟเฟอร์จากหน้าต่าง
- `BufWinEnter` สำหรับเมื่อคุณโหลดบัฟเฟอร์ในหน้าต่าง

ตอนนี้หลังจากที่คุณพับภายในไฟล์ `.txt` และออกจาก Vim ครั้งถัดไปที่คุณเปิดไฟล์นั้น ข้อมูลการพับของคุณจะถูกคืนค่า

โดยค่าเริ่มต้น Vim จะบันทึกข้อมูลการพับเมื่อรัน `mkview` ภายใน `~/.vim/view` สำหรับระบบ Unix สำหรับข้อมูลเพิ่มเติม ให้ตรวจสอบ `:h 'viewdir'`
## เรียนรู้การพับอย่างชาญฉลาด

เมื่อฉันเริ่มใช้ Vim ครั้งแรก ฉันละเลยที่จะเรียนรู้การพับเพราะฉันไม่คิดว่ามันมีประโยชน์ อย่างไรก็ตาม ยิ่งฉันเขียนโค้ดนานเท่าไหร่ ฉันก็ยิ่งพบว่าการพับมีประโยชน์มากขึ้นเท่านั้น การพับที่วางอย่างมีกลยุทธ์สามารถให้ภาพรวมที่ดีกว่าเกี่ยวกับโครงสร้างของข้อความ เช่นเดียวกับสารบัญของหนังสือ

เมื่อคุณเรียนรู้การพับ ให้เริ่มจากการพับแบบแมนนวลเพราะสามารถใช้ได้ในระหว่างเดินทาง จากนั้นค่อยๆ เรียนรู้เคล็ดลับต่างๆ ในการทำการเยื้องและการพับเครื่องหมาย สุดท้าย เรียนรู้วิธีการทำการพับไวยากรณ์และการแสดงผล คุณยังสามารถใช้สองอย่างหลังนี้เพื่อเขียนปลั๊กอิน Vim ของคุณเองได้