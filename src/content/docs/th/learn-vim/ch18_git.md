---
description: เอกสารนี้สอนวิธีการรวม Vim และ Git เข้าด้วยกัน โดยเน้นการเปรียบเทียบไฟล์และการใช้คำสั่ง
  diff เพื่อจัดการความแตกต่าง.
title: Ch18. Git
---

Vim และ git เป็นเครื่องมือที่ยอดเยี่ยมสองอย่างสำหรับสองสิ่งที่แตกต่างกัน Git เป็นเครื่องมือควบคุมเวอร์ชัน Vim เป็นโปรแกรมแก้ไขข้อความ

ในบทนี้ คุณจะได้เรียนรู้วิธีการต่างๆ ในการรวม Vim และ git เข้าด้วยกัน

## การเปรียบเทียบ

จำได้ในบทก่อนหน้านี้ คุณสามารถรันคำสั่ง `vimdiff` เพื่อแสดงความแตกต่างระหว่างไฟล์หลายไฟล์

สมมติว่าคุณมีไฟล์สองไฟล์ `file1.txt` และ `file2.txt`

ภายใน `file1.txt`:

```shell
pancakes
waffles
apples

milk
apple juice

yogurt
```

ภายใน `file2.txt`:

```shell
pancakes
waffles
oranges

milk
orange juice

yogurt
```

เพื่อดูความแตกต่างระหว่างทั้งสองไฟล์ ให้รัน:

```shell
vimdiff file1.txt file2.txt
```

หรือคุณสามารถรัน:

```shell
vim -d file1.txt file2.txt
```

`vimdiff` จะแสดงสองบัฟเฟอร์เคียงข้างกัน ทางซ้ายคือ `file1.txt` และทางขวาคือ `file2.txt` ความแตกต่างแรก (apples และ oranges) จะถูกเน้นในทั้งสองบรรทัด

สมมติว่าคุณต้องการให้บัฟเฟอร์ที่สองมี apples ไม่ใช่ oranges เพื่อโอนย้ายเนื้อหาจากตำแหน่งปัจจุบันของคุณ (คุณอยู่ใน `file1.txt` ในขณะนี้) ไปยัง `file2.txt` ให้ไปที่ความแตกต่างถัดไปด้วย `]c` (เพื่อกระโดดไปยังหน้าต่างความแตกต่างก่อนหน้า ใช้ `[c`) ตอนนี้เคอร์เซอร์ควรอยู่ที่ apples รัน `:diffput` ทั้งสองไฟล์ควรมี apples ตอนนี้

หากคุณต้องการโอนย้ายข้อความจากบัฟเฟอร์อื่น (orange juice, `file2.txt`) เพื่อแทนที่ข้อความในบัฟเฟอร์ปัจจุบัน (apple juice, `file1.txt`) โดยที่เคอร์เซอร์ของคุณยังอยู่ในหน้าต่าง `file1.txt` ให้ไปที่ความแตกต่างถัดไปด้วย `]c` ตอนนี้เคอร์เซอร์ของคุณควรอยู่ที่ apple juice รัน `:diffget` เพื่อรับ orange juice จากบัฟเฟอร์อื่นมาแทนที่ apple juice ในบัฟเฟอร์ของเรา

`:diffput` *ส่งออก* ข้อความจากบัฟเฟอร์ปัจจุบันไปยังบัฟเฟอร์อื่น `:diffget` *รับ* ข้อความจากบัฟเฟอร์อื่นไปยังบัฟเฟอร์ปัจจุบัน

หากคุณมีบัฟเฟอร์หลายบัฟเฟอร์ คุณสามารถรัน `:diffput fileN.txt` และ `:diffget fileN.txt` เพื่อเป้าหมายบัฟเฟอร์ fileN

## Vim เป็นเครื่องมือรวม

> "ฉันชอบการแก้ไขความขัดแย้งในการรวม!" - ไม่มีใคร

ฉันไม่รู้จักใครที่ชอบการแก้ไขความขัดแย้งในการรวม อย่างไรก็ตาม มันเป็นสิ่งที่หลีกเลี่ยงไม่ได้ ในส่วนนี้ คุณจะได้เรียนรู้วิธีการใช้ Vim เป็นเครื่องมือในการแก้ไขความขัดแย้งในการรวม

ก่อนอื่น เปลี่ยนเครื่องมือรวมเริ่มต้นให้ใช้ `vimdiff` โดยการรัน:

```shell
git config merge.tool vimdiff
git config merge.conflictstyle diff3
git config mergetool.prompt false
```

หรือคุณสามารถแก้ไข `~/.gitconfig` โดยตรง (ตามค่าเริ่มต้นควรอยู่ใน root แต่ของคุณอาจอยู่ในที่ที่แตกต่างกัน) คำสั่งด้านบนควรแก้ไข gitconfig ของคุณให้ดูเหมือนการตั้งค่าด้านล่าง หากคุณยังไม่ได้รัน คุณยังสามารถแก้ไข gitconfig ของคุณด้วยตนเอง

```shell
[core]
  editor = vim
[merge]
  tool = vimdiff
  conflictstyle = diff3
[difftool]
  prompt = false
```

มาสร้างความขัดแย้งในการรวมปลอมเพื่อทดสอบกัน สร้างไดเรกทอรี `/food` และทำให้มันเป็น git repository:

```shell
git init
```

เพิ่มไฟล์ `breakfast.txt` ภายใน:

```shell
pancakes
waffles
oranges
```

เพิ่มไฟล์และทำการ commit:

```shell
git add .
git commit -m "Initial breakfast commit"
```

ถัดไป สร้างสาขาใหม่และเรียกมันว่าสาขา apples:

```shell
git checkout -b apples
```

เปลี่ยน `breakfast.txt`:

```shell
pancakes
waffles
apples
```

บันทึกไฟล์ จากนั้นเพิ่มและทำการ commit การเปลี่ยนแปลง:

```shell
git add .
git commit -m "Apples not oranges"
```

ยอดเยี่ยม ตอนนี้คุณมี oranges ในสาขาหลักและ apples ในสาขา apples มาคืนสู่สาขาหลักกัน:

```shell
git checkout master
```

ภายใน `breakfast.txt` คุณควรเห็นข้อความพื้นฐาน oranges มาลองเปลี่ยนเป็น grapes เพราะมันอยู่ในฤดูกาลตอนนี้:

```shell
pancakes
waffles
grapes
```

บันทึก เพิ่ม และทำการ commit:

```shell
git add .
git commit -m "Grapes not oranges"
```

ตอนนี้คุณพร้อมที่จะรวมสาขา apples เข้ากับสาขาหลัก:

```shell
git merge apples
```

คุณควรเห็นข้อผิดพลาด:

```shell
Auto-merging breakfast.txt
CONFLICT (content): Merge conflict in breakfast.txt
Automatic merge failed; fix conflicts and then commit the result.
```

ความขัดแย้ง ยอดเยี่ยม! มาจัดการความขัดแย้งโดยใช้ `mergetool` ที่เราเพิ่งตั้งค่า รัน:

```shell
git mergetool
```

Vim แสดงสี่หน้าต่าง ให้สังเกตสามหน้าต่างด้านบน:

- `LOCAL` มี `grapes` นี่คือการเปลี่ยนแปลงใน "local" ที่คุณกำลังรวมเข้าไป
- `BASE` มี `oranges` นี่คือบรรพบุรุษร่วมระหว่าง `LOCAL` และ `REMOTE` เพื่อเปรียบเทียบว่ามันแตกต่างกันอย่างไร
- `REMOTE` มี `apples` นี่คือสิ่งที่กำลังถูกรวมเข้าไป

ที่ด้านล่าง (หน้าต่างที่สี่) คุณจะเห็น:

```shell
pancakes
waffles
<<<<<<< HEAD
grapes
||||||| db63958
oranges
=======
apples
>>>>>>> apples
```

หน้าต่างที่สี่มีข้อความความขัดแย้งในการรวม ด้วยการตั้งค่านี้ มันง่ายที่จะเห็นการเปลี่ยนแปลงที่แต่ละสภาพแวดล้อมมี คุณสามารถเห็นเนื้อหาจาก `LOCAL`, `BASE`, และ `REMOTE` ในเวลาเดียวกัน

เคอร์เซอร์ของคุณควรอยู่ที่หน้าต่างที่สี่ในพื้นที่ที่เน้น หากต้องการรับการเปลี่ยนแปลงจาก `LOCAL` (grapes) รัน `:diffget LOCAL` หากต้องการรับการเปลี่ยนแปลงจาก `BASE` (oranges) รัน `:diffget BASE` และหากต้องการรับการเปลี่ยนแปลงจาก `REMOTE` (apples) รัน `:diffget REMOTE`

ในกรณีนี้ มารับการเปลี่ยนแปลงจาก `LOCAL` รัน `:diffget LOCAL` หน้าต่างที่สี่จะมี grapes ตอนนี้ บันทึกและออกจากไฟล์ทั้งหมด (`:wqall`) เมื่อคุณทำเสร็จ นั่นไม่เลวใช่ไหม?

หากคุณสังเกต คุณยังมีไฟล์ `breakfast.txt.orig` ตอนนี้ Git สร้างไฟล์สำรองในกรณีที่ทุกอย่างไม่เป็นไปด้วยดี หากคุณไม่ต้องการให้ git สร้างสำรองระหว่างการรวม ให้รัน:

```shell
git config --global mergetool.keepBackup false
```

## Git ภายใน Vim

Vim ไม่มีฟีเจอร์ git ที่สร้างขึ้นในตัวเอง หนึ่งในวิธีการรันคำสั่ง git จาก Vim คือการใช้ bang operator, `!`, ในโหมดบรรทัดคำสั่ง

คำสั่ง git ใดๆ สามารถรันด้วย `!`:

```shell
:!git status
:!git commit
:!git diff
:!git push origin master
```

คุณยังสามารถใช้ `%` (บัฟเฟอร์ปัจจุบัน) หรือ `#` (บัฟเฟอร์อื่น) ของ Vim:

```shell
:!git add %         " git add ไฟล์ปัจจุบัน
:!git checkout #    " git checkout ไฟล์อื่น
```

หนึ่งในเคล็ดลับ Vim ที่คุณสามารถใช้เพื่อเพิ่มไฟล์หลายไฟล์ในหน้าต่าง Vim ที่แตกต่างกันคือการรัน:

```shell
:windo !git add %
```

จากนั้นทำการ commit:

```shell
:!git commit "Just git-added everything in my Vim window, cool"
```

คำสั่ง `windo` เป็นหนึ่งในคำสั่ง "do" ของ Vim คล้ายกับ `argdo` ที่คุณเห็นก่อนหน้านี้ `windo` จะทำการรันคำสั่งในแต่ละหน้าต่าง

นอกจากนี้ คุณยังสามารถใช้ `bufdo !git add %` เพื่อ git add บัฟเฟอร์ทั้งหมดหรือ `argdo !git add %` เพื่อ git add ทุกอาร์กิวเมนต์ไฟล์ ขึ้นอยู่กับเวิร์กโฟลว์ของคุณ

## ปลั๊กอิน

มีปลั๊กอิน Vim มากมายสำหรับการสนับสนุน git ด้านล่างนี้คือรายการของปลั๊กอินที่เกี่ยวข้องกับ git ที่เป็นที่นิยมบางส่วนสำหรับ Vim (อาจมีมากกว่านี้ในขณะที่คุณอ่าน):

- [vim-gitgutter](https://github.com/airblade/vim-gitgutter)
- [vim-signify](https://github.com/mhinz/vim-signify)
- [vim-fugitive](https://github.com/tpope/vim-fugitive)
- [gv.vim](https://github.com/junegunn/gv.vim)
- [vimagit](https://github.com/jreybert/vimagit)
- [vim-twiggy](https://github.com/sodapopcan/vim-twiggy)
- [rhubarb](https://github.com/tpope/vim-rhubarb)

หนึ่งในปลั๊กอินที่เป็นที่นิยมที่สุดคือ vim-fugitive ในส่วนที่เหลือของบทนี้ ฉันจะพูดถึงเวิร์กโฟลว์ git หลายอย่างโดยใช้ปลั๊กอินนี้

## Vim-fugitive

ปลั๊กอิน vim-fugitive ช่วยให้คุณรัน git CLI โดยไม่ต้องออกจากโปรแกรมแก้ไข Vim คุณจะพบว่าบางคำสั่งทำได้ดีกว่าเมื่อรันจากภายใน Vim

เพื่อเริ่มต้น ติดตั้ง vim-fugitive ด้วยผู้จัดการปลั๊กอิน Vim ([vim-plug](https://github.com/junegunn/vim-plug), [vundle](https://github.com/VundleVim/Vundle.vim), [dein.vim](https://github.com/Shougo/dein.vim) เป็นต้น)

## สถานะ Git

เมื่อคุณรันคำสั่ง `:Git` โดยไม่มีพารามิเตอร์ใดๆ vim-fugitive จะแสดงหน้าต่างสรุป git มันจะแสดงไฟล์ที่ไม่ถูกติดตาม ไฟล์ที่ยังไม่ได้จัดระเบียบ และไฟล์ที่ถูกจัดระเบียบ ขณะอยู่ในโหมด "`git status`" คุณสามารถทำหลายสิ่งหลายอย่าง:
- `Ctrl-N` / `Ctrl-P` เพื่อเลื่อนขึ้นหรือลงในรายการไฟล์
- `-` เพื่อจัดระเบียบหรือยกเลิกการจัดระเบียบชื่อไฟล์ที่อยู่ใต้เคอร์เซอร์
- `s` เพื่อจัดระเบียบชื่อไฟล์ที่อยู่ใต้เคอร์เซอร์
- `u` เพื่อยกเลิกการจัดระเบียบชื่อไฟล์ที่อยู่ใต้เคอร์เซอร์
- `>` / `<` เพื่อแสดงหรือซ่อนความแตกต่างในบรรทัดของชื่อไฟล์ที่อยู่ใต้เคอร์เซอร์

สำหรับข้อมูลเพิ่มเติม ดูที่ `:h fugitive-staging-maps`

## Git Blame

เมื่อคุณรันคำสั่ง `:Git blame` จากไฟล์ปัจจุบัน vim-fugitive จะแสดงหน้าต่าง blame แยก นี่อาจมีประโยชน์ในการหาคนที่รับผิดชอบในการเขียนบรรทัดของโค้ดที่มีข้อผิดพลาดเพื่อที่คุณจะได้ดุเขา/เธอ (ล้อเล่น)

สิ่งที่คุณสามารถทำได้ขณะอยู่ในโหมด `"git blame"`:
- `q` เพื่อปิดหน้าต่าง blame
- `A` เพื่อปรับขนาดคอลัมน์ผู้เขียน
- `C` เพื่อปรับขนาดคอลัมน์ commit
- `D` เพื่อปรับขนาดคอลัมน์วันที่/เวลา

สำหรับข้อมูลเพิ่มเติม ดูที่ `:h :Git_blame`

## Gdiffsplit

เมื่อคุณรันคำสั่ง `:Gdiffsplit` vim-fugitive จะรัน `vimdiff` ของการเปลี่ยนแปลงล่าสุดของไฟล์ปัจจุบันกับดัชนีหรือเวิร์กทรี หากคุณรัน `:Gdiffsplit <commit>` vim-fugitive จะรัน `vimdiff` กับไฟล์นั้นภายใน `<commit>`

เนื่องจากคุณอยู่ในโหมด `vimdiff` คุณสามารถ *รับ* หรือ *ส่ง* ความแตกต่างด้วย `:diffput` และ `:diffget`

## Gwrite และ Gread

เมื่อคุณรันคำสั่ง `:Gwrite` ในไฟล์หลังจากที่คุณทำการเปลี่ยนแปลง vim-fugitive จะจัดระเบียบการเปลี่ยนแปลง นี่เหมือนกับการรัน `git add <current-file>`

เมื่อคุณรันคำสั่ง `:Gread` ในไฟล์หลังจากที่คุณทำการเปลี่ยนแปลง vim-fugitive จะคืนค่าไฟล์กลับไปยังสถานะก่อนการเปลี่ยนแปลง นี่เหมือนกับการรัน `git checkout <current-file>` หนึ่งในข้อดีของการรัน `:Gread` คือการกระทำนี้สามารถยกเลิกได้ หากหลังจากที่คุณรัน `:Gread` คุณเปลี่ยนใจและต้องการเก็บการเปลี่ยนแปลงเก่า คุณสามารถเพียงแค่รัน undo (`u`) และ Vim จะยกเลิกการกระทำ `:Gread` นี่จะไม่เป็นไปได้หากคุณรัน `git checkout <current-file>` จาก CLI

## Gclog

เมื่อคุณรันคำสั่ง `:Gclog` vim-fugitive จะแสดงประวัติการ commit นี่เหมือนกับการรันคำสั่ง `git log` vim-fugitive ใช้ quickfix ของ Vim เพื่อทำสิ่งนี้ ดังนั้นคุณสามารถใช้ `:cnext` และ `:cprevious` เพื่อเลื่อนไปยังข้อมูล log ถัดไปหรือก่อนหน้า คุณสามารถเปิดและปิดรายการ log ด้วย `:copen` และ `:cclose`

ขณะอยู่ในโหมด `"git log"` คุณสามารถทำได้สองสิ่ง:
- ดูต้นไม้
- เยี่ยมชมผู้ปกครอง (commit ก่อนหน้า)

คุณสามารถส่งพารามิเตอร์ไปยัง `:Gclog` ได้เช่นเดียวกับคำสั่ง `git log` หากโปรเจกต์ของคุณมีประวัติการ commit ยาวและคุณต้องการดูเพียงสาม commit ล่าสุด คุณสามารถรัน `:Gclog -3` หากคุณต้องการกรองตามวันที่ของผู้ทำการ commit คุณสามารถรันอะไรบางอย่างเช่น `:Gclog --after="January 1" --before="March 14"`

## เพิ่มเติมเกี่ยวกับ Vim-fugitive

นี่เป็นเพียงตัวอย่างเล็กน้อยของสิ่งที่ vim-fugitive สามารถทำได้ เพื่อเรียนรู้เพิ่มเติมเกี่ยวกับ vim-fugitive ดูที่ `:h fugitive.txt` คำสั่ง git ที่เป็นที่นิยมส่วนใหญ่จะถูกปรับให้เหมาะสมด้วย vim-fugitive คุณเพียงแค่ต้องค้นหาพวกเขาในเอกสาร

หากคุณอยู่ในหนึ่งใน "โหมดพิเศษ" ของ vim-fugitive (เช่น ในโหมด `:Git` หรือ `:Git blame`) และคุณต้องการเรียนรู้เกี่ยวกับทางลัดที่มีอยู่ ให้กด `g?` vim-fugitive จะแสดงหน้าต่าง `:help` ที่เหมาะสมสำหรับโหมดที่คุณอยู่ น่าทึ่ง!
## เรียนรู้ Vim และ Git อย่างชาญฉลาด

คุณอาจพบว่า vim-fugitive เป็นสิ่งที่ดีในการเสริมการทำงานของคุณ (หรือไม่ก็ได้) อย่างไรก็ตาม ฉันขอแนะนำให้คุณตรวจสอบปลั๊กอินทั้งหมดที่ระบุไว้ข้างต้น มีปลั๊กอินอื่น ๆ ที่ฉันไม่ได้ระบุไว้แน่นอน ลองใช้ดู

วิธีที่ชัดเจนในการพัฒนาทักษะการใช้งาน Vim-git คือการอ่านเกี่ยวกับ git ให้มากขึ้น Git เป็นหัวข้อที่กว้างใหญ่ และฉันแสดงให้เห็นเพียงส่วนหนึ่งของมัน ด้วยเหตุนี้ มาลอง *git going* (ขอโทษที่เล่นคำ) และพูดคุยเกี่ยวกับวิธีการใช้ Vim เพื่อคอมไพล์โค้ดของคุณ!