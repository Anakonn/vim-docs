---
description: เรียนรู้เคล็ดลับและเทคนิคต่างๆ ในโหมดคำสั่งของ Vim รวมถึงวิธีการเข้าสู่และออกจากโหมดนี้อย่างมีประสิทธิภาพ
title: Ch15. Command-line Mode
---

ในสามบทสุดท้าย คุณได้เรียนรู้วิธีการใช้คำสั่งค้นหา (`/`, `?`), คำสั่งแทนที่ (`:s`), คำสั่งทั่วโลก (`:g`), และคำสั่งภายนอก (`!`). นี่คือตัวอย่างของคำสั่งในโหมดบรรทัดคำสั่ง

ในบทนี้ คุณจะได้เรียนรู้เคล็ดลับและกลเม็ดต่างๆ สำหรับโหมดบรรทัดคำสั่ง

## การเข้าสู่และออกจากโหมดบรรทัดคำสั่ง

โหมดบรรทัดคำสั่งเป็นโหมดหนึ่ง เช่นเดียวกับโหมดปกติ, โหมดแทรก, และโหมดวิชวล เมื่อคุณอยู่ในโหมดนี้ เคอร์เซอร์จะไปที่ด้านล่างของหน้าจอซึ่งคุณสามารถพิมพ์คำสั่งต่างๆ ได้

มีคำสั่ง 4 คำสั่งที่คุณสามารถใช้เพื่อเข้าสู่โหมดบรรทัดคำสั่ง:
- รูปแบบการค้นหา (`/`, `?`)
- คำสั่งบรรทัดคำสั่ง (`:`)
- คำสั่งภายนอก (`!`)

คุณสามารถเข้าสู่โหมดบรรทัดคำสั่งจากโหมดปกติหรือโหมดวิชวล

ในการออกจากโหมดบรรทัดคำสั่ง คุณสามารถใช้ `<Esc>`, `Ctrl-C`, หรือ `Ctrl-[`

*วรรณกรรมอื่นอาจเรียก "คำสั่งบรรทัดคำสั่ง" ว่า "คำสั่ง Ex" และ "คำสั่งภายนอก" ว่า "คำสั่งกรอง" หรือ "ตัวดำเนินการ bang".*

## การทำซ้ำคำสั่งก่อนหน้า

คุณสามารถทำซ้ำคำสั่งบรรทัดคำสั่งหรือคำสั่งภายนอกก่อนหน้าด้วย `@:` 

ถ้าคุณเพิ่งรัน `:s/foo/bar/g`, การรัน `@:` จะทำซ้ำการแทนที่นั้น หากคุณเพิ่งรัน `:.!tr '[a-z]' '[A-Z]'`, การรัน `@:` จะทำซ้ำการกรองคำสั่งภายนอกล่าสุด

## คีย์ลัดในโหมดบรรทัดคำสั่ง

ในขณะที่อยู่ในโหมดบรรทัดคำสั่ง คุณสามารถเคลื่อนที่ไปทางซ้ายหรือขวา ตัวละครละตัวด้วย `Left` หรือ `Right` arrow

หากคุณต้องการเคลื่อนที่ตามคำ ให้ใช้ `Shift-Left` หรือ `Shift-Right` (ในบางระบบปฏิบัติการ คุณอาจต้องใช้ `Ctrl` แทน `Shift`)

เพื่อไปยังจุดเริ่มต้นของบรรทัด ให้ใช้ `Ctrl-B` เพื่อไปยังจุดสิ้นสุดของบรรทัด ให้ใช้ `Ctrl-E`

คล้ายกับโหมดแทรก ในโหมดบรรทัดคำสั่ง คุณมีสามวิธีในการลบตัวอักษร:

```shell
Ctrl-H    ลบหนึ่งตัวอักษร
Ctrl-W    ลบหนึ่งคำ
Ctrl-U    ลบทั้งบรรทัด
```
สุดท้าย หากคุณต้องการแก้ไขคำสั่งเหมือนกับที่คุณทำในไฟล์ข้อความปกติ ให้ใช้ `Ctrl-F`

นี่ยังช่วยให้คุณค้นหาคำสั่งก่อนหน้า แก้ไขพวกมันและรันอีกครั้งโดยการกด `<Enter>` ใน "โหมดแก้ไขบรรทัดคำสั่งปกติ"

## รีจิสเตอร์และการเติมอัตโนมัติ

ในขณะที่อยู่ในโหมดบรรทัดคำสั่ง คุณสามารถแทรกข้อความจากรีจิสเตอร์ของ Vim ด้วย `Ctrl-R` เช่นเดียวกับโหมดแทรก หากคุณมีสตริง "foo" ที่บันทึกในรีจิสเตอร์ a คุณสามารถแทรกมันได้โดยการรัน `Ctrl-R a` ทุกอย่างที่คุณสามารถดึงจากรีจิสเตอร์ในโหมดแทรก คุณสามารถทำเช่นเดียวกันในโหมดบรรทัดคำสั่ง

นอกจากนี้ คุณยังสามารถดึงคำที่อยู่ใต้เคอร์เซอร์ด้วย `Ctrl-R Ctrl-W` (`Ctrl-R Ctrl-A` สำหรับ WORD ใต้เคอร์เซอร์) เพื่อดึงบรรทัดใต้เคอร์เซอร์ ให้ใช้ `Ctrl-R Ctrl-L` เพื่อดึงชื่อไฟล์ใต้เคอร์เซอร์ ให้ใช้ `Ctrl-R Ctrl-F`

คุณยังสามารถเติมอัตโนมัติคำสั่งที่มีอยู่ได้ เพื่อเติมอัตโนมัติคำสั่ง `echo` ในขณะที่อยู่ในโหมดบรรทัดคำสั่ง ให้พิมพ์ "ec" แล้วกด `<Tab>` คุณควรเห็นคำสั่ง Vim ที่เริ่มต้นด้วย "ec" ที่มุมล่างซ้าย (ตัวอย่าง: `echo echoerr echohl echomsg econ`) เพื่อไปยังตัวเลือกถัดไป กด `<Tab>` หรือ `Ctrl-N` เพื่อไปยังตัวเลือกก่อนหน้า กด `<Shift-Tab>` หรือ `Ctrl-P`

บางคำสั่งในบรรทัดคำสั่งรับชื่อไฟล์เป็นอาร์กิวเมนต์ ตัวอย่างหนึ่งคือ `edit` คุณสามารถเติมอัตโนมัติที่นี่ได้เช่นกัน หลังจากพิมพ์คำสั่ง `:e ` (อย่าลืมเว้นวรรค) กด `<Tab>` Vim จะรายชื่อชื่อไฟล์ที่เกี่ยวข้องทั้งหมดที่คุณสามารถเลือกได้เพื่อไม่ให้คุณต้องพิมพ์ใหม่จากศูนย์

## หน้าต่างประวัติและหน้าต่างบรรทัดคำสั่ง

คุณสามารถดูประวัติของคำสั่งบรรทัดคำสั่งและคำค้นหา (นี่ต้องการฟีเจอร์ `+cmdline_hist`)

เพื่อเปิดประวัติคำสั่งบรรทัดคำสั่ง ให้รัน `:his :` คุณควรเห็นอะไรบางอย่างเช่นต่อไปนี้:

```shell
## Cmd history
2  e file1.txt
3  g/foo/d
4  s/foo/bar/g
```

Vim จะแสดงประวัติของคำสั่ง `:` ทั้งหมดที่คุณรัน โดยค่าเริ่มต้น Vim จะเก็บคำสั่งล่าสุด 50 คำสั่ง หากต้องการเปลี่ยนจำนวนรายการที่ Vim จำให้เป็น 100 คุณรัน `set history=100`

การใช้ประโยชน์จากประวัติคำสั่งบรรทัดคำสั่งที่มีประโยชน์มากขึ้นคือผ่านหน้าต่างบรรทัดคำสั่ง `q:` นี่จะเปิดหน้าต่างประวัติที่สามารถค้นหาและแก้ไขได้ สมมติว่าคุณมีนิพจน์เหล่านี้ในประวัติเมื่อคุณกด `q:`:

```shell
51  s/verylongsubstitutionpattern/pancake/g
52  his :
53  wq
```

หากงานปัจจุบันของคุณคือการทำ `s/verylongsubstitutionpattern/donut/g` แทนที่จะพิมพ์คำสั่งจากศูนย์ ทำไมคุณไม่ใช้ `s/verylongsubstitutionpattern/pancake/g` อีกล่ะ? หลังจากทั้งหมด สิ่งเดียวที่แตกต่างคือคำแทนที่ "donut" กับ "pancake" ทุกอย่างอื่นเหมือนกัน

หลังจากที่คุณรัน `q:` ให้ค้นหา `s/verylongsubstitutionpattern/pancake/g` ในประวัติ (คุณสามารถใช้การนำทางของ Vim ในสภาพแวดล้อมนี้) และแก้ไขมันโดยตรง! เปลี่ยน "pancake" เป็น "donut" ในหน้าต่างประวัติ จากนั้นกด `<Enter>` โบม! Vim จะรัน `s/verylongsubstitutionpattern/donut/g` ให้คุณ สะดวกมาก!

ในทำนองเดียวกัน เพื่อดูประวัติการค้นหา ให้รัน `:his /` หรือ `:his ?` เพื่อเปิดหน้าต่างประวัติการค้นหาที่คุณสามารถค้นหาและแก้ไขประวัติที่ผ่านมา ให้รัน `q/` หรือ `q?`

เพื่อออกจากหน้าต่างนี้ ให้กด `Ctrl-C`, `Ctrl-W C`, หรือพิมพ์ `:quit`

## คำสั่งบรรทัดคำสั่งเพิ่มเติม

Vim มีคำสั่งในตัวหลายร้อยคำสั่ง เพื่อดูคำสั่งทั้งหมดที่ Vim มี ให้ตรวจสอบ `:h ex-cmd-index` หรือ `:h :index`

## เรียนรู้โหมดบรรทัดคำสั่งอย่างชาญฉลาด

เมื่อเปรียบเทียบกับโหมดอื่นๆ อีกสามโหมด โหมดบรรทัดคำสั่งเหมือนกับมีดพกสวิสสำหรับการแก้ไขข้อความ คุณสามารถแก้ไขข้อความ แก้ไขไฟล์ และรันคำสั่ง เพียงแค่พูดถึงไม่กี่อย่าง บทนี้เป็นการรวบรวมสิ่งต่างๆ ของโหมดบรรทัดคำสั่ง นอกจากนี้ยังทำให้โหมด Vim สมบูรณ์ ตอนนี้ที่คุณรู้วิธีใช้โหมดปกติ, โหมดแทรก, โหมดวิชวล และโหมดบรรทัดคำสั่ง คุณสามารถแก้ไขข้อความด้วย Vim ได้เร็วกว่าเคย

ถึงเวลาที่จะเลิกใช้โหมด Vim และเรียนรู้วิธีการนำทางที่เร็วขึ้นด้วยแท็ก Vim