---
description: บทนี้แนะนำวิธีการค้นหาอย่างรวดเร็วใน Vim โดยแบ่งเป็นการค้นหาโดยไม่ใช้ปลั๊กอินและการใช้ปลั๊กอิน
  fzf.vim เพื่อเพิ่มประสิทธิภาพการทำงาน
title: Ch03. Searching Files
---

บทที่นี้มีเป้าหมายเพื่อให้คุณได้รู้จักกับวิธีการค้นหาอย่างรวดเร็วใน Vim การค้นหาอย่างรวดเร็วเป็นวิธีที่ดีในการเริ่มต้นเพิ่มประสิทธิภาพการทำงานใน Vim ของคุณ เมื่อฉันค้นพบวิธีการค้นหาไฟล์อย่างรวดเร็ว ฉันก็เปลี่ยนมาใช้ Vim เต็มเวลา

บทนี้แบ่งออกเป็นสองส่วน: วิธีการค้นหาโดยไม่ใช้ปลั๊กอินและวิธีการค้นหาด้วยปลั๊กอิน [fzf.vim](https://github.com/junegunn/fzf.vim) มาเริ่มกันเลย!

## การเปิดและแก้ไขไฟล์

ในการเปิดไฟล์ใน Vim คุณสามารถใช้ `:edit`.

```shell
:edit file.txt
```

ถ้า `file.txt` มีอยู่ มันจะเปิดบัฟเฟอร์ `file.txt` ถ้า `file.txt` ไม่มีอยู่ มันจะสร้างบัฟเฟอร์ใหม่สำหรับ `file.txt`

การเติมอัตโนมัติด้วย `<Tab>` ใช้งานได้กับ `:edit` ตัวอย่างเช่น ถ้าไฟล์ของคุณอยู่ในไดเรกทอรี *a*pp *c*ontroller *u*sers controller ของ [Rails](https://rubyonrails.org/) `./app/controllers/users_controllers.rb` คุณสามารถใช้ `<Tab>` เพื่อขยายคำได้อย่างรวดเร็ว:

```shell
:edit a<Tab>c<Tab>u<Tab>
```

`:edit` ยอมรับอาร์กิวเมนต์แบบไวลด์การ์ด `*` จะจับคู่กับไฟล์ใด ๆ ในไดเรกทอรีปัจจุบัน ถ้าคุณกำลังมองหาไฟล์ที่มีนามสกุล `.yml` ในไดเรกทอรีปัจจุบัน:

```shell
:edit *.yml<Tab>
```

Vim จะให้รายชื่อไฟล์ `.yml` ทั้งหมดในไดเรกทอรีปัจจุบันให้คุณเลือก

คุณสามารถใช้ `**` เพื่อค้นหาแบบเรียกซ้ำ ถ้าคุณต้องการค้นหาไฟล์ `*.md` ทั้งหมดในโปรเจกต์ของคุณ แต่คุณไม่แน่ใจว่าอยู่ในไดเรกทอรีไหน คุณสามารถทำได้แบบนี้:

```shell
:edit **/*.md<Tab>
```

`:edit` สามารถใช้เพื่อเรียกใช้ `netrw` ซึ่งเป็นไฟล์สำรวจในตัวของ Vim เพื่อทำเช่นนั้น ให้ส่งอาร์กิวเมนต์ไดเรกทอรีแทนไฟล์:

```shell
:edit .
:edit test/unit/
```

## การค้นหาไฟล์ด้วย Find

คุณสามารถค้นหาไฟล์ด้วย `:find` ตัวอย่างเช่น:

```shell
:find package.json
:find app/controllers/users_controller.rb
```

การเติมอัตโนมัติก็ทำงานได้กับ `:find`:

```shell
:find p<Tab>                " เพื่อค้นหา package.json
:find a<Tab>c<Tab>u<Tab>    " เพื่อค้นหา app/controllers/users_controller.rb
```

คุณอาจสังเกตว่า `:find` ดูเหมือน `:edit` ความแตกต่างคืออะไร?

## Find และ Path

ความแตกต่างคือ `:find` ค้นหาไฟล์ใน `path` แต่ `:edit` ไม่ทำ มาศึกษาเกี่ยวกับ `path` กันสักหน่อย เมื่อคุณเรียนรู้วิธีการปรับเปลี่ยน paths ของคุณ `:find` จะกลายเป็นเครื่องมือค้นหาที่ทรงพลัง เพื่อดูว่า paths ของคุณคืออะไร ให้ทำ:

```shell
:set path?
```

โดยค่าเริ่มต้น มันอาจดูเหมือนนี้:

```shell
path=.,/usr/include,,
```

- `.` หมายถึงการค้นหาในไดเรกทอรีของไฟล์ที่เปิดอยู่ในขณะนี้
- `,` หมายถึงการค้นหาในไดเรกทอรีปัจจุบัน
- `/usr/include` เป็นไดเรกทอรีทั่วไปสำหรับไฟล์หัวของไลบรารี C

สองรายการแรกมีความสำคัญในบริบทของเรา และรายการที่สามสามารถละเว้นได้ในตอนนี้ สิ่งที่ควรทราบคือคุณสามารถปรับเปลี่ยน paths ของคุณเองได้ ซึ่ง Vim จะมองหาไฟล์ ในที่นี้สมมติว่านี่คือโครงสร้างโปรเจกต์ของคุณ:

```shell
app/
  assets/
  controllers/
    application_controller.rb
    comments_controller.rb
    users_controller.rb
    ...
```

ถ้าคุณต้องการไปที่ `users_controller.rb` จากไดเรกทอรีราก คุณต้องผ่านหลายไดเรกทอรี (และกดปุ่มแท็บจำนวนมาก) บ่อยครั้งเมื่อทำงานกับเฟรมเวิร์ก คุณใช้เวลา 90% ในไดเรกทอรีเฉพาะ ในสถานการณ์นี้ คุณสนใจเพียงแค่ไปที่ไดเรกทอรี `controllers/` ด้วยการกดปุ่มน้อยที่สุด การตั้งค่า `path` สามารถทำให้การเดินทางนั้นสั้นลง

คุณต้องเพิ่ม `app/controllers/` ลงใน `path` ปัจจุบัน นี่คือวิธีที่คุณสามารถทำได้:

```shell
:set path+=app/controllers/
```

ตอนนี้ที่ path ของคุณได้รับการอัปเดต เมื่อคุณพิมพ์ `:find u<Tab>` Vim จะค้นหาในไดเรกทอรี `app/controllers/` สำหรับไฟล์ที่เริ่มต้นด้วย "u"

ถ้าคุณมีไดเรกทอรี `controllers/` ที่ซ้อนกัน เช่น `app/controllers/account/users_controller.rb` Vim จะไม่พบ `users_controllers` แทนที่คุณต้องเพิ่ม `:set path+=app/controllers/**` เพื่อให้การเติมอัตโนมัติสามารถค้นหา `users_controller.rb` ได้ นี่เยี่ยมมาก! ตอนนี้คุณสามารถค้นหา users controller ได้ด้วยการกดแท็บ 1 ครั้งแทนที่จะเป็น 3 ครั้ง

คุณอาจคิดที่จะเพิ่มไดเรกทอรีโปรเจกต์ทั้งหมดเพื่อให้เมื่อคุณกด `tab` Vim จะค้นหาทุกที่สำหรับไฟล์นั้น เช่นนี้:

```shell
:set path+=$PWD/**
```

`$PWD` คือไดเรกทอรีการทำงานปัจจุบัน ถ้าคุณพยายามเพิ่มโปรเจกต์ทั้งหมดลงใน `path` หวังว่าจะทำให้ไฟล์ทั้งหมดสามารถเข้าถึงได้เมื่อกด `tab` แม้ว่านี่อาจทำงานได้สำหรับโปรเจกต์ขนาดเล็ก แต่การทำเช่นนี้จะทำให้การค้นหาของคุณช้าลงอย่างมากหากคุณมีไฟล์จำนวนมากในโปรเจกต์ของคุณ ฉันแนะนำให้เพิ่มเฉพาะ `path` ของไฟล์ / ไดเรกทอรีที่คุณเข้าชมบ่อยที่สุด

คุณสามารถเพิ่ม `set path+={your-path-here}` ใน vimrc ของคุณ การอัปเดต `path` ใช้เวลาเพียงไม่กี่วินาทีและการทำเช่นนี้สามารถประหยัดเวลาได้มาก

## การค้นหาในไฟล์ด้วย Grep

ถ้าคุณต้องการค้นหาในไฟล์ (ค้นหาวลีในไฟล์) คุณสามารถใช้ grep Vim มีสองวิธีในการทำเช่นนั้น:

- grep ภายใน (`:vim`. ใช่ มันสะกดว่า `:vim`. มันย่อมาจาก `:vimgrep`).
- grep ภายนอก (`:grep`).

มาทำความรู้จักกับ grep ภายในก่อน `:vim` มีไวยากรณ์ดังนี้:

```shell
:vim /pattern/ file
```

- `/pattern/` คือรูปแบบ regex ของคำค้นหาของคุณ
- `file` คืออาร์กิวเมนต์ไฟล์ คุณสามารถส่งอาร์กิวเมนต์หลาย ๆ อาร์กิวเมนต์ Vim จะค้นหารูปแบบภายในอาร์กิวเมนต์ไฟล์ คล้ายกับ `:find` คุณสามารถส่ง `*` และ `**` ไวลด์การ์ดได้

ตัวอย่างเช่น เพื่อค้นหาทุกครั้งที่มีสตริง "breakfast" อยู่ในไฟล์ ruby (`.rb`) ทั้งหมดในไดเรกทอรี `app/controllers/`:

```shell
:vim /breakfast/ app/controllers/**/*.rb
```

หลังจากรันคำสั่งนั้น คุณจะถูกเปลี่ยนเส้นทางไปยังผลลัพธ์แรก คำสั่งค้นหาของ Vim ใช้การดำเนินการ `quickfix` เพื่อดูผลลัพธ์การค้นหาทั้งหมด ให้รัน `:copen` นี่จะเปิดหน้าต่าง `quickfix` นี่คือคำสั่ง `quickfix` ที่มีประโยชน์บางประการเพื่อทำให้คุณมีประสิทธิภาพทันที:

```shell
:copen        เปิดหน้าต่าง quickfix
:cclose       ปิดหน้าต่าง quickfix
:cnext        ไปที่ข้อผิดพลาดถัดไป
:cprevious    ไปที่ข้อผิดพลาดก่อนหน้า
:colder       ไปที่รายการข้อผิดพลาดเก่า
:cnewer       ไปที่รายการข้อผิดพลาดใหม่
```

เพื่อเรียนรู้เพิ่มเติมเกี่ยวกับ quickfix ให้ตรวจสอบ `:h quickfix`

คุณอาจสังเกตว่าการรัน grep ภายใน (`:vim`) อาจช้าได้หากคุณมีจำนวนการจับคู่มาก นี่เป็นเพราะ Vim โหลดไฟล์ที่ตรงกันแต่ละไฟล์เข้าสู่หน่วยความจำ ราวกับว่ามันกำลังถูกแก้ไข หาก Vim พบไฟล์จำนวนมากที่ตรงกับการค้นหาของคุณ มันจะโหลดทั้งหมดและดังนั้นจะใช้หน่วยความจำจำนวนมาก

มาพูดคุยเกี่ยวกับ grep ภายนอก โดยค่าเริ่มต้น มันใช้คำสั่ง `grep` ในเทอร์มินัล เพื่อค้นหา "lunch" ภายในไฟล์ ruby ในไดเรกทอรี `app/controllers/` คุณสามารถทำได้แบบนี้:

```shell
:grep -R "lunch" app/controllers/
```

โปรดทราบว่าแทนที่จะใช้ `/pattern/` มันจะตามด้วยไวยากรณ์ grep ในเทอร์มินัล `"pattern"` มันยังแสดงการจับคู่ทั้งหมดโดยใช้ `quickfix`

Vim กำหนดตัวแปร `grepprg` เพื่อกำหนดโปรแกรมภายนอกที่จะรันเมื่อรันคำสั่ง `:grep` ของ Vim เพื่อที่คุณจะไม่ต้องปิด Vim และเรียกใช้คำสั่ง grep ในเทอร์มินัล ในภายหลัง ฉันจะแสดงให้คุณเห็นวิธีการเปลี่ยนโปรแกรมเริ่มต้นที่เรียกใช้เมื่อใช้คำสั่ง `:grep` ของ Vim

## การเรียกดูไฟล์ด้วย Netrw

`netrw` เป็นไฟล์สำรวจในตัวของ Vim มันมีประโยชน์ในการดูลำดับชั้นของโปรเจกต์ เพื่อเรียกใช้ `netrw` คุณต้องตั้งค่าทั้งสองนี้ใน `.vimrc` ของคุณ:

```shell
set nocp
filetype plugin on
```

เนื่องจาก `netrw` เป็นหัวข้อที่กว้าง ฉันจะครอบคลุมเพียงการใช้งานพื้นฐาน แต่ควรเพียงพอที่จะทำให้คุณเริ่มต้นได้ คุณสามารถเริ่ม `netrw` เมื่อคุณเปิด Vim โดยการส่งไดเรกทอรีเป็นพารามิเตอร์แทนไฟล์ ตัวอย่างเช่น:

```shell
vim .
vim src/client/
vim app/controllers/
```

เพื่อเรียกใช้ `netrw` จากภายใน Vim คุณสามารถใช้คำสั่ง `:edit` และส่งพารามิเตอร์ไดเรกทอรีแทนชื่อไฟล์:

```shell
:edit .
:edit src/client/
:edit app/controllers/
```

มีวิธีอื่นในการเปิดหน้าต่าง `netrw` โดยไม่ต้องส่งไดเรกทอรี:

```shell
:Explore     เริ่ม netrw บนไฟล์ปัจจุบัน
:Sexplore    ไม่ได้พูดเล่น เริ่ม netrw บนครึ่งบนของหน้าจอ
:Vexplore    เริ่ม netrw บนครึ่งซ้ายของหน้าจอ
```

คุณสามารถนำทาง `netrw` ด้วยการเคลื่อนไหวของ Vim (การเคลื่อนไหวจะถูกครอบคลุมอย่างละเอียดในบทถัดไป) ถ้าคุณต้องการสร้าง ลบ หรือเปลี่ยนชื่อไฟล์หรือไดเรกทอรี นี่คือรายการคำสั่ง `netrw` ที่มีประโยชน์:

```shell
%    สร้างไฟล์ใหม่
d    สร้างไดเรกทอรีใหม่
R    เปลี่ยนชื่อไฟล์หรือไดเรกทอรี
D    ลบไฟล์หรือไดเรกทอรี
```

`:h netrw` มีข้อมูลที่ครอบคลุมมาก ตรวจสอบดูถ้าคุณมีเวลา

ถ้าคุณพบว่า `netrw` น่าเบื่อเกินไปและต้องการอะไรที่มีรสชาติมากขึ้น [vim-vinegar](https://github.com/tpope/vim-vinegar) เป็นปลั๊กอินที่ดีในการปรับปรุง `netrw` หากคุณกำลังมองหาผู้สำรวจไฟล์ที่แตกต่างออกไป [NERDTree](https://github.com/preservim/nerdtree) เป็นทางเลือกที่ดี ลองดูพวกเขา!

## Fzf

ตอนนี้ที่คุณได้เรียนรู้วิธีการค้นหาไฟล์ใน Vim ด้วยเครื่องมือในตัวแล้ว มาศึกษาวิธีการทำเช่นนี้ด้วยปลั๊กอินกันเถอะ

สิ่งหนึ่งที่โปรแกรมแก้ไขข้อความสมัยใหม่ทำได้ดีและ Vim ไม่ทำคือความง่ายในการค้นหาไฟล์ โดยเฉพาะผ่านการค้นหาแบบ fuzzy ในครึ่งหลังของบทนี้ ฉันจะแสดงให้คุณเห็นวิธีการใช้ [fzf.vim](https://github.com/junegunn/fzf.vim) เพื่อทำให้การค้นหาใน Vim ง่ายและทรงพลัง

## การตั้งค่า

ก่อนอื่นให้แน่ใจว่าคุณได้ดาวน์โหลด [fzf](https://github.com/junegunn/fzf) และ [ripgrep](https://github.com/BurntSushi/ripgrep) เรียบร้อยแล้ว ทำตามคำแนะนำใน repo ของพวกเขา คำสั่ง `fzf` และ `rg` ควรพร้อมใช้งานหลังจากการติดตั้งสำเร็จ

Ripgrep เป็นเครื่องมือค้นหาที่คล้ายกับ grep (จึงเป็นชื่อ) โดยทั่วไปจะเร็วกว่า grep และมีฟีเจอร์ที่มีประโยชน์มากมาย Fzf เป็นตัวค้นหา fuzzy แบบ command-line ที่ใช้ได้กับคำสั่งใด ๆ รวมถึง ripgrep ด้วยกัน พวกเขาทำให้เป็นการรวมกันของเครื่องมือค้นหาที่ทรงพลัง

Fzf ไม่ใช้ ripgrep โดยค่าเริ่มต้น ดังนั้นเราจึงต้องบอก fzf ให้ใช้ ripgrep โดยการกำหนดตัวแปร `FZF_DEFAULT_COMMAND` ใน `.zshrc` ของฉัน (`.bashrc` ถ้าคุณใช้ bash) ฉันมีสิ่งเหล่านี้:

```shell
if type rg &> /dev/null; then
  export FZF_DEFAULT_COMMAND='rg --files'
  export FZF_DEFAULT_OPTS='-m'
fi
```

ให้ใส่ใจที่ `-m` ใน `FZF_DEFAULT_OPTS` ตัวเลือกนี้ช่วยให้เราสามารถเลือกหลายรายการด้วย `<Tab>` หรือ `<Shift-Tab>` คุณไม่จำเป็นต้องมีบรรทัดนี้เพื่อให้ fzf ทำงานกับ Vim แต่ฉันคิดว่ามันเป็นตัวเลือกที่มีประโยชน์ที่จะมี มันจะมีประโยชน์เมื่อคุณต้องการทำการค้นหาและแทนที่ในหลายไฟล์ซึ่งฉันจะครอบคลุมในไม่ช้า คำสั่ง fzf ยอมรับตัวเลือกมากมาย แต่ฉันจะไม่ครอบคลุมที่นี่ หากต้องการเรียนรู้เพิ่มเติมให้ตรวจสอบ [fzf's repo](https://github.com/junegunn/fzf#usage) หรือ `man fzf` อย่างน้อยคุณควรมี `export FZF_DEFAULT_COMMAND='rg'`.

หลังจากติดตั้ง fzf และ ripgrep แล้ว มาตั้งค่าปลั๊กอิน fzf กัน ฉันใช้ [vim-plug](https://github.com/junegunn/vim-plug) ในตัวอย่างนี้ แต่คุณสามารถใช้ผู้จัดการปลั๊กอินใด ๆ ก็ได้

เพิ่มสิ่งเหล่านี้ในปลั๊กอิน `.vimrc` ของคุณ คุณต้องใช้ปลั๊กอิน [fzf.vim](https://github.com/junegunn/fzf.vim) (สร้างโดยผู้เขียน fzf คนเดียวกัน)

```shell
call plug#begin()
Plug 'junegunn/fzf.vim'
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
call plug#end()
```

หลังจากเพิ่มบรรทัดเหล่านี้ คุณจะต้องเปิด `vim` และรัน `:PlugInstall` มันจะติดตั้งปลั๊กอินทั้งหมดที่กำหนดไว้ในไฟล์ `vimrc` ของคุณและยังไม่ได้ติดตั้ง ในกรณีของเรา มันจะติดตั้ง `fzf.vim` และ `fzf`.

สำหรับข้อมูลเพิ่มเติมเกี่ยวกับปลั๊กอินนี้ คุณสามารถตรวจสอบ [fzf.vim repo](https://github.com/junegunn/fzf/blob/master/README-VIM.md).
## Fzf Syntax

ในการใช้ fzf อย่างมีประสิทธิภาพ คุณควรเรียนรู้ไวยากรณ์พื้นฐานของ fzf โชคดีที่รายการนั้นสั้น:

- `^` คือการจับคู่ที่ตรงตามพรีฟิก เพื่อค้นหาวลีที่เริ่มต้นด้วย "welcome": `^welcome`.
- `$` คือการจับคู่ที่ตรงตามซัฟฟิก เพื่อค้นหาวลีที่สิ้นสุดด้วย "my friends": `friends$`.
- `'` คือการจับคู่ที่ตรงตามแบบเป๊ะ เพื่อค้นหาวลี "welcome my friends": `'welcome my friends`.
- `|` คือการจับคู่แบบ "หรือ" เพื่อค้นหาทั้ง "friends" หรือ "foes": `friends | foes`.
- `!` คือการจับคู่แบบตรงข้าม เพื่อค้นหาวลีที่มี "welcome" และไม่มี "friends": `welcome !friends`

คุณสามารถผสมผสานตัวเลือกเหล่านี้ได้ ตัวอย่างเช่น `^hello | ^welcome friends$` จะค้นหาวลีที่เริ่มต้นด้วย "welcome" หรือ "hello" และสิ้นสุดด้วย "friends".

## Finding Files

ในการค้นหาไฟล์ภายใน Vim โดยใช้ปลั๊กอิน fzf.vim คุณสามารถใช้วิธี `:Files` รัน `:Files` จาก Vim และคุณจะได้รับคำสั่งค้นหา fzf.

เนื่องจากคุณจะใช้คำสั่งนี้บ่อยครั้ง จึงดีที่จะมีการแมพไปยังปุ่มลัด ฉันแมพของฉันไปที่ `Ctrl-f` ใน vimrc ของฉัน ฉันมีดังนี้:

```shell
nnoremap <silent> <C-f> :Files<CR>
```

## Finding in Files

ในการค้นหาภายในไฟล์ คุณสามารถใช้คำสั่ง `:Rg`.

อีกครั้ง เนื่องจากคุณอาจจะใช้คำสั่งนี้บ่อยครั้ง เรามาแมพมันไปยังปุ่มลัด ฉันแมพของฉันไปที่ `<Leader>f` ปุ่ม `<Leader>` ถูกแมพไปที่ `\` โดยค่าเริ่มต้น.

```shell
nnoremap <silent> <Leader>f :Rg<CR>
```

## Other Searches

Fzf.vim มีคำสั่งค้นหาอื่น ๆ อีกมากมาย ฉันจะไม่พูดถึงแต่ละคำสั่งที่นี่ แต่คุณสามารถตรวจสอบได้ [ที่นี่](https://github.com/junegunn/fzf.vim#commands).

นี่คือสิ่งที่แมพ fzf ของฉันดูเหมือน:

```shell
nnoremap <silent> <Leader>b :Buffers<CR>
nnoremap <silent> <C-f> :Files<CR>
nnoremap <silent> <Leader>f :Rg<CR>
nnoremap <silent> <Leader>/ :BLines<CR>
nnoremap <silent> <Leader>' :Marks<CR>
nnoremap <silent> <Leader>g :Commits<CR>
nnoremap <silent> <Leader>H :Helptags<CR>
nnoremap <silent> <Leader>hh :History<CR>
nnoremap <silent> <Leader>h: :History:<CR>
nnoremap <silent> <Leader>h/ :History/<CR>
```

## Replacing Grep With Rg

ตามที่กล่าวไว้ก่อนหน้านี้ Vim มีสองวิธีในการค้นหาในไฟล์: `:vim` และ `:grep` คำสั่ง `:grep` ใช้เครื่องมือค้นหาภายนอกที่คุณสามารถกำหนดใหม่ได้โดยใช้คีย์เวิร์ด `grepprg` ฉันจะแสดงให้คุณเห็นวิธีการกำหนดค่า Vim เพื่อใช้ ripgrep แทนการใช้ grep ในเทอร์มินัลเมื่อรันคำสั่ง `:grep`.

ตอนนี้เรามาตั้งค่า `grepprg` เพื่อให้คำสั่ง `:grep` ของ Vim ใช้ ripgrep เพิ่มสิ่งนี้ใน vimrc ของคุณ:

```shell
set grepprg=rg\ --vimgrep\ --smart-case\ --follow
```

คุณสามารถปรับเปลี่ยนตัวเลือกบางอย่างข้างต้นได้! สำหรับข้อมูลเพิ่มเติมเกี่ยวกับความหมายของตัวเลือกข้างต้น ให้ตรวจสอบ `man rg`.

หลังจากที่คุณอัปเดต `grepprg` ตอนนี้เมื่อคุณรัน `:grep` มันจะรัน `rg --vimgrep --smart-case --follow` แทนที่จะเป็น `grep`. หากคุณต้องการค้นหา "donut" โดยใช้ ripgrep คุณสามารถรันคำสั่งที่กระชับกว่า `:grep "donut"` แทนที่จะเป็น `:grep "donut" . -R` 

เหมือนกับ `:grep` เก่าที่ผ่านมา คำสั่ง `:grep` ใหม่ก็ใช้ quickfix เพื่อแสดงผลลัพธ์เช่นกัน.

คุณอาจสงสัยว่า "อืม นี่ดี แต่ฉันไม่เคยใช้ `:grep` ใน Vim เลย แล้วฉันไม่สามารถใช้ `:Rg` เพื่อค้นหาวลีในไฟล์ได้หรือ? เมื่อไหร่ที่ฉันจะต้องใช้ `:grep`?"

นั่นเป็นคำถามที่ดีมาก คุณอาจจำเป็นต้องใช้ `:grep` ใน Vim เพื่อทำการค้นหาและแทนที่ในหลายไฟล์ ซึ่งฉันจะพูดถึงในหัวข้อต่อไป.

## Search and Replace in Multiple Files

โปรแกรมแก้ไขข้อความสมัยใหม่เช่น VSCode ทำให้การค้นหาและแทนที่สตริงในหลายไฟล์เป็นเรื่องง่ายมาก ในส่วนนี้ ฉันจะแสดงให้คุณเห็นสองวิธีที่แตกต่างกันในการทำเช่นนั้นใน Vim.

วิธีแรกคือการแทนที่ *ทั้งหมด* ของวลีที่ตรงกันในโปรเจกต์ของคุณ คุณจะต้องใช้ `:grep`. หากคุณต้องการแทนที่ทุกกรณีของ "pizza" ด้วย "donut" นี่คือสิ่งที่คุณทำ:

```shell
:grep "pizza"
:cfdo %s/pizza/donut/g | update
```

มาวิเคราะห์คำสั่งกัน:

1. `:grep pizza` ใช้ ripgrep เพื่อค้นหาทุกกรณีของ "pizza" (โดยที่บอกว่านี่จะยังทำงานได้แม้ว่าคุณจะไม่ได้กำหนด `grepprg` ให้ใช้ ripgrep คุณจะต้องทำ `:grep "pizza" . -R` แทน `:grep "pizza"`).
2. `:cfdo` จะดำเนินการคำสั่งใด ๆ ที่คุณส่งไปยังไฟล์ทั้งหมดในรายการ quickfix ของคุณ ในกรณีนี้ คำสั่งของคุณคือคำสั่งแทนที่ `%s/pizza/donut/g`. เครื่องหมายท่อ (`|`) เป็นตัวดำเนินการเชื่อมโยง คำสั่ง `update` จะบันทึกแต่ละไฟล์หลังจากการแทนที่ ฉันจะพูดถึงคำสั่งแทนที่ในเชิงลึกในบทถัดไป.

วิธีที่สองคือการค้นหาและแทนที่ในไฟล์ที่เลือก ด้วยวิธีนี้ คุณสามารถเลือกไฟล์ที่คุณต้องการทำการเลือกและแทนที่ได้ด้วยตนเอง นี่คือสิ่งที่คุณทำ:

1. ลบบัฟเฟอร์ของคุณก่อน มันสำคัญมากที่รายการบัฟเฟอร์ของคุณมีเฉพาะไฟล์ที่คุณต้องการทำการแทนที่ คุณสามารถเริ่ม Vim ใหม่หรือลงคำสั่ง `:%bd | e#` (`%bd` ลบทุกบัฟเฟอร์และ `e#` เปิดไฟล์ที่คุณเพิ่งอยู่).
2. รัน `:Files`.
3. เลือกไฟล์ทั้งหมดที่คุณต้องการทำการค้นหาและแทนที่ เพื่อเลือกไฟล์หลายไฟล์ ใช้ `<Tab>` / `<Shift-Tab>`. สิ่งนี้เป็นไปได้เฉพาะถ้าคุณมีธงหลายตัว (`-m`) ใน `FZF_DEFAULT_OPTS`.
4. รัน `:bufdo %s/pizza/donut/g | update`. คำสั่ง `:bufdo %s/pizza/donut/g | update` ดูคล้ายกับคำสั่งก่อนหน้า `:cfdo %s/pizza/donut/g | update`. ความแตกต่างคือแทนที่จะทำการแทนที่ทุกรายการใน quickfix (`:cfdo`) คุณกำลังแทนที่ทุกรายการในบัฟเฟอร์ (`:bufdo`).

## Learn Search the Smart Way

การค้นหาเป็นสิ่งสำคัญในการแก้ไขข้อความ การเรียนรู้วิธีการค้นหาอย่างมีประสิทธิภาพใน Vim จะช่วยปรับปรุงการทำงานของคุณในการแก้ไขข้อความอย่างมาก.

Fzf.vim เป็นการเปลี่ยนเกม ฉันไม่สามารถจินตนาการถึงการใช้ Vim โดยไม่มีมัน ฉันคิดว่ามันสำคัญมากที่จะมีเครื่องมือค้นหาที่ดีเมื่อเริ่มใช้ Vim ฉันเห็นผู้คนดิ้นรนในการเปลี่ยนไปใช้ Vim เพราะดูเหมือนว่าจะขาดฟีเจอร์ที่สำคัญที่โปรแกรมแก้ไขข้อความสมัยใหม่มี เช่น ฟีเจอร์ค้นหาที่ง่ายและทรงพลัง ฉันหวังว่าบทนี้จะช่วยให้คุณทำการเปลี่ยนไปใช้ Vim ได้ง่ายขึ้น.

คุณยังได้เห็นความสามารถในการขยายของ Vim ในการทำงาน - ความสามารถในการขยายฟังก์ชันการค้นหาด้วยปลั๊กอินและโปรแกรมภายนอก ในอนาคต โปรดจำไว้ว่าคุณต้องการขยาย Vim ด้วยฟีเจอร์อะไร โอกาสที่มันจะมีอยู่ใน Vim แล้ว มีคนสร้างปลั๊กอินหรือมีโปรแกรมสำหรับมันแล้ว ในครั้งถัดไป คุณจะได้เรียนรู้เกี่ยวกับหัวข้อที่สำคัญมากใน Vim: ไวยากรณ์ของ Vim.