---
description: เอกสารนี้อธิบายเกี่ยวกับตัวแปรใน Vim รวมถึงตัวแปรที่สามารถเปลี่ยนแปลงได้และไม่สามารถเปลี่ยนแปลงได้
  พร้อมตัวอย่างการใช้งาน.
title: Ch27. Vimscript Variable Scopes
---

ก่อนที่จะดำดิ่งเข้าสู่ฟังก์ชัน Vimscript ให้เราเรียนรู้เกี่ยวกับแหล่งที่มาที่แตกต่างกันและขอบเขตของตัวแปรใน Vim

## ตัวแปรที่เปลี่ยนแปลงได้และไม่เปลี่ยนแปลง

คุณสามารถกำหนดค่าให้กับตัวแปรใน Vim ด้วย `let`:

```shell
let pancake = "pancake"
```

ต่อมา คุณสามารถเรียกใช้ตัวแปรนั้นได้ทุกเมื่อ

```shell
echo pancake
" คืนค่า "pancake"
```

`let` เป็นตัวแปรที่เปลี่ยนแปลงได้ หมายความว่าคุณสามารถเปลี่ยนค่าได้ทุกเมื่อในอนาคต

```shell
let pancake = "pancake"
let pancake = "not waffles"

echo pancake
" คืนค่า "not waffles"
```

สังเกตว่าเมื่อคุณต้องการเปลี่ยนค่าของตัวแปรที่ตั้งค่าแล้ว คุณยังต้องใช้ `let`

```shell
let beverage = "milk"

beverage = "orange juice"
" ทำให้เกิดข้อผิดพลาด
```

คุณสามารถกำหนดตัวแปรที่ไม่เปลี่ยนแปลงได้ด้วย `const` เมื่อเป็นตัวแปรที่ไม่เปลี่ยนแปลงแล้ว เมื่อค่าของตัวแปรถูกกำหนดแล้ว คุณไม่สามารถกำหนดค่าใหม่ด้วยค่าที่แตกต่างได้

```shell
const waffle = "waffle"
const waffle = "pancake"
" ทำให้เกิดข้อผิดพลาด
```

## แหล่งที่มาของตัวแปร

มีแหล่งที่มาสำหรับตัวแปรสามประเภท: ตัวแปรสภาพแวดล้อม, ตัวแปรตัวเลือก, และตัวแปรรีจิสเตอร์

### ตัวแปรสภาพแวดล้อม

Vim สามารถเข้าถึงตัวแปรสภาพแวดล้อมในเทอร์มินัลของคุณได้ ตัวอย่างเช่น หากคุณมีตัวแปรสภาพแวดล้อม `SHELL` ที่มีอยู่ในเทอร์มินัลของคุณ คุณสามารถเข้าถึงมันจาก Vim ได้ด้วย:

```shell
echo $SHELL
" คืนค่า $SHELL value ในกรณีของฉัน มันคืนค่า /bin/bash
```

### ตัวแปรตัวเลือก

คุณสามารถเข้าถึงตัวเลือกของ Vim ด้วย `&` (นี่คือการตั้งค่าที่คุณเข้าถึงด้วย `set`)

ตัวอย่างเช่น เพื่อดูว่า Vim ใช้พื้นหลังอะไร คุณสามารถรัน:

```shell
echo &background
" คืนค่า "light" หรือ "dark"
```

นอกจากนี้ คุณยังสามารถรัน `set background?` เพื่อดูค่าของตัวเลือก `background` ได้เสมอ

### ตัวแปรรีจิสเตอร์

คุณสามารถเข้าถึงรีจิสเตอร์ของ Vim (บทที่ 08) ด้วย `@`

สมมติว่าค่าที่ "chocolate" ถูกบันทึกไว้ในรีจิสเตอร์ a แล้ว เพื่อเข้าถึงมัน คุณสามารถใช้ `@a` คุณยังสามารถอัปเดตมันด้วย `let`

```shell
echo @a
" คืนค่า chocolate

let @a .= " donut"

echo @a
" คืนค่า "chocolate donut"
```

ตอนนี้เมื่อคุณวางจากรีจิสเตอร์ `a` (`"ap`), มันจะคืนค่า "chocolate donut" ตัวดำเนินการ `.=` จะเชื่อมต่อสองสตริง นิพจน์ `let @a .= " donut"` เป็นสิ่งเดียวกับ `let @a = @a . " donut"`

## ขอบเขตของตัวแปร

มีขอบเขตตัวแปรที่แตกต่างกัน 9 ประเภทใน Vim คุณสามารถจำแนกได้จากตัวอักษรที่นำหน้า:

```shell
g:           ตัวแปรทั่วโลก
{nothing}    ตัวแปรทั่วโลก
b:           ตัวแปรเฉพาะบัฟเฟอร์
w:           ตัวแปรเฉพาะหน้าต่าง
t:           ตัวแปรเฉพาะแท็บ
s:           ตัวแปร Vimscript ที่ถูกนำเข้า
l:           ตัวแปรเฉพาะฟังก์ชัน
a:           ตัวแปรพารามิเตอร์ฟังก์ชัน
v:           ตัวแปรในตัวของ Vim
```

### ตัวแปรทั่วโลก

เมื่อคุณประกาศตัวแปร "ปกติ":

```shell
let pancake = "pancake"
```

`pancake` เป็นตัวแปรทั่วโลก เมื่อคุณกำหนดตัวแปรทั่วโลก คุณสามารถเรียกใช้มันจากที่ใดก็ได้

การนำหน้า `g:` กับตัวแปรยังสร้างตัวแปรทั่วโลก

```shell
let g:waffle = "waffle"
```

ในกรณีนี้ทั้ง `pancake` และ `g:waffle` มีขอบเขตเดียวกัน คุณสามารถเรียกใช้แต่ละตัวได้ทั้งที่มีหรือไม่มี `g:`

```shell
echo pancake
" คืนค่า "pancake"

echo g:pancake
" คืนค่า "pancake"

echo waffle
" คืนค่า "waffle"

echo g:waffle
" คืนค่า "waffle"
```

### ตัวแปรบัฟเฟอร์

ตัวแปรที่นำหน้าด้วย `b:` เป็นตัวแปรบัฟเฟอร์ ตัวแปรบัฟเฟอร์เป็นตัวแปรที่เป็นท้องถิ่นสำหรับบัฟเฟอร์ปัจจุบัน (บทที่ 02) หากคุณมีบัฟเฟอร์หลายตัวเปิดอยู่ แต่ละบัฟเฟอร์จะมีรายการตัวแปรบัฟเฟอร์ของตนเอง

ในบัฟเฟอร์ 1:

```shell
const b:donut = "chocolate donut"
```

ในบัฟเฟอร์ 2:

```shell
const b:donut = "blueberry donut"
```

หากคุณรัน `echo b:donut` จากบัฟเฟอร์ 1 มันจะคืนค่า "chocolate donut" หากคุณรันจากบัฟเฟอร์ 2 มันจะคืนค่า "blueberry donut"

ในทางกลับกัน Vim มีตัวแปรบัฟเฟอร์ *พิเศษ* `b:changedtick` ที่ติดตามการเปลี่ยนแปลงทั้งหมดที่เกิดขึ้นกับบัฟเฟอร์ปัจจุบัน

1. รัน `echo b:changedtick` และจดบันทึกหมายเลขที่มันคืนค่า
2. ทำการเปลี่ยนแปลงใน Vim
3. รัน `echo b:changedtick` อีกครั้งและจดบันทึกหมายเลขที่มันคืนค่าในตอนนี้

### ตัวแปรหน้าต่าง

ตัวแปรที่นำหน้าด้วย `w:` เป็นตัวแปรหน้าต่าง มันมีอยู่เฉพาะในหน้าต่างนั้น

ในหน้าต่าง 1:

```shell
const w:donut = "chocolate donut"
```

ในหน้าต่าง 2:

```shell
const w:donut = "raspberry donut"
```

ในแต่ละหน้าต่าง คุณสามารถเรียกใช้ `echo w:donut` เพื่อรับค่าที่ไม่ซ้ำกัน

### ตัวแปรแท็บ

ตัวแปรที่นำหน้าด้วย `t:` เป็นตัวแปรแท็บ มันมีอยู่เฉพาะในแท็บนั้น

ในแท็บ 1:

```shell
const t:donut = "chocolate donut"
```

ในแท็บ 2:

```shell
const t:donut = "blackberry donut"
```

ในแต่ละแท็บ คุณสามารถเรียกใช้ `echo t:donut` เพื่อรับค่าที่ไม่ซ้ำกัน

### ตัวแปรสคริปต์

ตัวแปรที่นำหน้าด้วย `s:` เป็นตัวแปรสคริปต์ ตัวแปรเหล่านี้สามารถเข้าถึงได้เฉพาะจากภายในสคริปต์นั้น

หากคุณมีไฟล์ที่ไม่ระบุชื่อ `dozen.vim` และภายในมันคุณมี:

```shell
let s:dozen = 12

function Consume()
  let s:dozen -= 1
  echo s:dozen " คงเหลือ"
endfunction
```

นำเข้าไฟล์ด้วย `:source dozen.vim` ตอนนี้เรียกใช้ฟังก์ชัน `Consume`:

```shell
:call Consume()
" คืนค่า "11 คงเหลือ"

:call Consume()
" คืนค่า "10 คงเหลือ"

:echo s:dozen
" ข้อผิดพลาดตัวแปรที่ไม่ได้กำหนด
```

เมื่อคุณเรียกใช้ `Consume` คุณจะเห็นว่ามันลดค่าของ `s:dozen` ตามที่คาดไว้ เมื่อคุณพยายามที่จะรับค่าของ `s:dozen` โดยตรง Vim จะไม่พบมันเพราะคุณอยู่นอกขอบเขต `s:dozen` สามารถเข้าถึงได้เฉพาะจากภายใน `dozen.vim`

ทุกครั้งที่คุณนำเข้าไฟล์ `dozen.vim` มันจะรีเซ็ตตัวนับ `s:dozen` หากคุณอยู่ในระหว่างการลดค่าของ `s:dozen` และคุณรัน `:source dozen.vim` ตัวนับจะรีเซ็ตกลับไปที่ 12 นี่อาจเป็นปัญหาสำหรับผู้ใช้ที่ไม่ระวัง เพื่อแก้ไขปัญหานี้ให้ปรับโค้ด:

```shell
if !exists("s:dozen")
  let s:dozen = 12
endif

function Consume()
  let s:dozen -= 1
  echo s:dozen
endfunction
```

ตอนนี้เมื่อคุณนำเข้า `dozen.vim` ในขณะที่อยู่ในระหว่างการลดค่า Vim จะอ่าน `!exists("s:dozen")`, พบว่ามันเป็นจริง และจะไม่รีเซ็ตค่าให้กลับไปที่ 12

### ตัวแปรเฉพาะฟังก์ชันและตัวแปรพารามิเตอร์ฟังก์ชัน

ทั้งตัวแปรเฉพาะฟังก์ชัน (`l:`) และตัวแปรพารามิเตอร์ฟังก์ชัน (`a:`) จะถูกครอบคลุมในบทถัดไป

### ตัวแปรในตัวของ Vim

ตัวแปรที่นำหน้าด้วย `v:` เป็นตัวแปรในตัวของ Vim ที่พิเศษ คุณไม่สามารถกำหนดตัวแปรเหล่านี้ได้ คุณได้เห็นบางตัวแปรเหล่านี้แล้ว
- `v:version` บอกคุณว่าคุณกำลังใช้เวอร์ชัน Vim อะไร
- `v:key` ประกอบด้วยค่าของรายการปัจจุบันเมื่อวนซ้ำผ่านพจนานุกรม
- `v:val` ประกอบด้วยค่าของรายการปัจจุบันเมื่อรันการดำเนินการ `map()` หรือ `filter()`
- `v:true`, `v:false`, `v:null`, และ `v:none` เป็นประเภทข้อมูลพิเศษ

ยังมีตัวแปรอื่น ๆ สำหรับรายการตัวแปรในตัวของ Vim ให้ตรวจสอบที่ `:h vim-variable` หรือ `:h v:`

## การใช้ขอบเขตตัวแปรใน Vim อย่างชาญฉลาด

การสามารถเข้าถึงตัวแปรสภาพแวดล้อม, ตัวแปรตัวเลือก, และตัวแปรรีจิสเตอร์ได้อย่างรวดเร็วช่วยให้คุณมีความยืดหยุ่นในการปรับแต่งโปรแกรมแก้ไขและสภาพแวดล้อมของเทอร์มินัลของคุณ คุณยังได้เรียนรู้ว่า Vim มีขอบเขตตัวแปรที่แตกต่างกัน 9 ประเภท ซึ่งแต่ละประเภทมีอยู่ภายใต้ข้อจำกัดที่เฉพาะเจาะจง คุณสามารถใช้ประโยชน์จากประเภทตัวแปรที่ไม่ซ้ำกันเหล่านี้เพื่อแยกโปรแกรมของคุณออกจากกัน

คุณได้เรียนรู้เกี่ยวกับประเภทข้อมูล วิธีการรวมกัน และขอบเขตตัวแปรแล้ว เพียงสิ่งเดียวที่เหลืออยู่: ฟังก์ชัน