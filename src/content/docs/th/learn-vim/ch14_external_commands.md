---
description: เอกสารนี้สอนการใช้คำสั่งภายนอกใน Vim โดยใช้คำสั่ง Bang เพื่ออ่าน เขียน
  และดำเนินการคำสั่งจากภายใน Vim อย่างมีประสิทธิภาพ
title: Ch14. External Commands
---

ภายในระบบ Unix คุณจะพบกับคำสั่งขนาดเล็กที่มีความเชี่ยวชาญสูงมากมายที่ทำสิ่งหนึ่ง (และทำได้ดี) คุณสามารถเชื่อมโยงคำสั่งเหล่านี้เพื่อทำงานร่วมกันในการแก้ปัญหาที่ซับซ้อน จะไม่ดีเหรอถ้าคุณสามารถใช้คำสั่งเหล่านี้จากภายใน Vim?

แน่นอน ในบทนี้คุณจะได้เรียนรู้วิธีขยาย Vim เพื่อทำงานร่วมกับคำสั่งภายนอกได้อย่างราบรื่น

## คำสั่ง Bang

Vim มีคำสั่ง bang (`!`) ที่สามารถทำได้สามอย่าง:

1. อ่าน STDOUT ของคำสั่งภายนอกเข้าสู่บัฟเฟอร์ปัจจุบัน
2. เขียนเนื้อหาของบัฟเฟอร์ของคุณเป็น STDIN ให้กับคำสั่งภายนอก
3. รันคำสั่งภายนอกจากภายใน Vim

มาดูแต่ละอย่างกัน

## การอ่าน STDOUT ของคำสั่งเข้าสู่ Vim

ไวยากรณ์ในการอ่าน STDOUT ของคำสั่งภายนอกเข้าสู่บัฟเฟอร์ปัจจุบันคือ:

```shell
:r !cmd
```

`:r` คือคำสั่งอ่านของ Vim หากคุณใช้มันโดยไม่มี `!` คุณสามารถใช้มันเพื่อดึงเนื้อหาของไฟล์ หากคุณมีไฟล์ `file1.txt` ในไดเรกทอรีปัจจุบันและคุณรัน:

```shell
:r file1.txt
```

Vim จะนำเนื้อหาของ `file1.txt` เข้าสู่บัฟเฟอร์ปัจจุบัน

หากคุณรันคำสั่ง `:r` ตามด้วย `!` และคำสั่งภายนอก ผลลัพธ์ของคำสั่งนั้นจะถูกแทรกเข้าสู่บัฟเฟอร์ปัจจุบัน เพื่อให้ได้ผลลัพธ์ของคำสั่ง `ls` ให้รัน:

```shell
:r !ls
```

มันจะคืนค่าบางอย่างเช่น:

```shell
file1.txt
file2.txt
file3.txt
```

คุณสามารถอ่านข้อมูลจากคำสั่ง `curl` ได้:

```shell
:r !curl -s 'https://jsonplaceholder.typicode.com/todos/1'
```

คำสั่ง `r` ยังรับที่อยู่ได้:

```shell
:10r !cat file1.txt
```

ตอนนี้ STDOUT จากการรัน `cat file1.txt` จะถูกแทรกหลังบรรทัดที่ 10

## การเขียนเนื้อหาบัฟเฟอร์เข้าสู่คำสั่งภายนอก

คำสั่ง `:w` นอกจากจะใช้ในการบันทึกไฟล์แล้ว ยังสามารถใช้ในการส่งข้อความในบัฟเฟอร์ปัจจุบันเป็น STDIN ให้กับคำสั่งภายนอกได้ ไวยากรณ์คือ:

```shell
:w !cmd
```

หากคุณมีข้อความเหล่านี้:

```shell
console.log("Hello Vim");
console.log("Vim is awesome");
```

ตรวจสอบให้แน่ใจว่าคุณได้ติดตั้ง [node](https://nodejs.org/en/) ในเครื่องของคุณแล้ว จากนั้นรัน:

```shell
:w !node
```

Vim จะใช้ `node` เพื่อรันคำสั่ง JavaScript เพื่อพิมพ์ "Hello Vim" และ "Vim is awesome"

เมื่อใช้คำสั่ง `:w` Vim จะใช้ข้อความทั้งหมดในบัฟเฟอร์ปัจจุบัน คล้ายกับคำสั่งทั่วไประดับโลก (คำสั่งในบรรทัดคำสั่งส่วนใหญ่ หากคุณไม่ส่งช่วง มันจะรันคำสั่งเฉพาะกับบรรทัดปัจจุบัน) หากคุณส่ง `:w` ที่อยู่เฉพาะ:

```shell
:2w !node
```

Vim จะใช้เฉพาะข้อความจากบรรทัดที่สองเข้าสู่ตัวแปล `node`

มีความแตกต่างที่ละเอียดแต่สำคัญระหว่าง `:w !node` และ `:w! node` ด้วย `:w !node` คุณกำลัง "เขียน" ข้อความในบัฟเฟอร์ปัจจุบันเข้าสู่คำสั่งภายนอก `node` ด้วย `:w! node` คุณกำลังบังคับบันทึกไฟล์และตั้งชื่อไฟล์ว่า "node"

## การรันคำสั่งภายนอก

คุณสามารถรันคำสั่งภายนอกจากภายใน Vim ด้วยคำสั่ง bang ไวยากรณ์คือ:

```shell
:!cmd
```

เพื่อดูเนื้อหาของไดเรกทอรีปัจจุบันในรูปแบบยาว ให้รัน:

```shell
:!ls -ls
```

เพื่อฆ่ากระบวนการที่กำลังทำงานบน PID 3456 คุณสามารถรัน:

```shell
:!kill -9 3456
```

คุณสามารถรันคำสั่งภายนอกใด ๆ โดยไม่ต้องออกจาก Vim เพื่อให้คุณสามารถมุ่งเน้นไปที่งานของคุณ

## การกรองข้อความ

หากคุณให้ `!` ช่วง มันสามารถใช้ในการกรองข้อความ สมมติว่าคุณมีข้อความดังต่อไปนี้:

```shell
hello vim
hello vim
```

มาทำให้บรรทัดปัจจุบันเป็นตัวพิมพ์ใหญ่โดยใช้คำสั่ง `tr` (translate) รัน:

```shell
:.!tr '[:lower:]' '[:upper:]'
```

ผลลัพธ์:

```shell
HELLO VIM
hello vim
```

การวิเคราะห์:
- `.!` รันคำสั่งกรองบนบรรทัดปัจจุบัน
- `tr '[:lower:]' '[:upper:]'` เรียกคำสั่ง `tr` เพื่อแทนที่ตัวอักษรพิมพ์เล็กทั้งหมดด้วยตัวอักษรพิมพ์ใหญ่

เป็นสิ่งสำคัญที่จะต้องส่งช่วงเพื่อรันคำสั่งภายนอกเป็นตัวกรอง หากคุณพยายามรันคำสั่งข้างต้นโดยไม่มี `.` (`:!tr '[:lower:]' '[:upper:]'`) คุณจะเห็นข้อผิดพลาด

สมมติว่าคุณต้องการลบคอลัมน์ที่สองในทั้งสองบรรทัดด้วยคำสั่ง `awk`:

```shell
:%!awk "{print $1}"
```

ผลลัพธ์:

```shell
hello
hello
```

การวิเคราะห์:
- `:%!` รันคำสั่งกรองบนทุกบรรทัด (`%`)
- `awk "{print $1}"` พิมพ์เฉพาะคอลัมน์แรกของการจับคู่

คุณสามารถเชื่อมโยงคำสั่งหลาย ๆ คำสั่งด้วยตัวดำเนินการเชื่อมโยง (`|`) เช่นเดียวกับในเทอร์มินัล สมมติว่าคุณมีไฟล์ที่มีรายการอาหารเช้าที่อร่อยเหล่านี้:

```shell
name price
chocolate pancake 10
buttermilk pancake 9
blueberry pancake 12
```

หากคุณต้องการจัดเรียงตามราคาและแสดงเฉพาะเมนูที่มีการเว้นวรรคอย่างสม่ำเสมอ คุณสามารถรัน:

```shell
:%!awk 'NR > 1' | sort -nk 3 | column -t
```

ผลลัพธ์:
```shell
buttermilk pancake 9
chocolate pancake 10
blueberry pancake 12
```

การวิเคราะห์:
- `:%!` ใช้ตัวกรองกับทุกบรรทัด (`%`)
- `awk 'NR > 1'` แสดงข้อความเฉพาะจากหมายเลขแถวที่สองขึ้นไป
- `|` เชื่อมโยงคำสั่งถัดไป
- `sort -nk 3` จัดเรียงตามตัวเลข (`n`) โดยใช้ค่าจากคอลัมน์ที่ 3 (`k 3`)
- `column -t` จัดระเบียบข้อความด้วยการเว้นวรรคอย่างสม่ำเสมอ

## คำสั่งโหมดปกติ

Vim มีตัวดำเนินการกรอง (`!`) ในโหมดปกติ หากคุณมีคำทักทายดังต่อไปนี้:

```shell
hello vim
hola vim
bonjour vim
salve vim
```

เพื่อทำให้บรรทัดปัจจุบันและบรรทัดถัดไปเป็นตัวพิมพ์ใหญ่ คุณสามารถรัน:
```shell
!jtr '[a-z]' '[A-Z]'
```

การวิเคราะห์:
- `!j` รันตัวดำเนินการกรองคำสั่งปกติ (`!`) ที่กำหนดเป้าหมายไปยังบรรทัดปัจจุบันและบรรทัดถัดไป จำไว้ว่าด้วยเหตุผลที่มันเป็นตัวดำเนินการโหมดปกติ กฎไวยากรณ์ `verb + noun` จะใช้ได้ `!` คือกริยาและ `j` คือคำนาม
- `tr '[a-z]' '[A-Z]'` แทนที่ตัวอักษรพิมพ์เล็กด้วยตัวอักษรพิมพ์ใหญ่

คำสั่งกรองปกติจะทำงานเฉพาะกับการเคลื่อนไหว / วัตถุข้อความที่มีความยาวอย่างน้อยหนึ่งบรรทัด หากคุณพยายามรัน `!iwtr '[a-z]' '[A-Z]'` (รัน `tr` บนคำภายใน) คุณจะพบว่ามันใช้คำสั่ง `tr` กับทั้งบรรทัด ไม่ใช่คำที่เคอร์เซอร์ของคุณอยู่

## เรียนรู้คำสั่งภายนอกอย่างชาญฉลาด

Vim ไม่ใช่ IDE มันเป็นโปรแกรมแก้ไขแบบโมดัลที่มีน้ำหนักเบาซึ่งสามารถขยายได้สูงตามการออกแบบ ด้วยความสามารถในการขยายนี้ คุณจึงเข้าถึงคำสั่งภายนอกใด ๆ ในระบบของคุณได้อย่างง่ายดาย ด้วยคำสั่งภายนอกเหล่านี้ Vim ก้าวใกล้จะกลายเป็น IDE มากขึ้น มีคนกล่าวว่าระบบ Unix เป็น IDE แรกในประวัติศาสตร์

คำสั่ง bang มีประโยชน์เท่ากับจำนวนคำสั่งภายนอกที่คุณรู้จัก อย่ากังวลหากความรู้เกี่ยวกับคำสั่งภายนอกของคุณมีจำกัด ฉันยังมีอะไรให้เรียนรู้อีกมาก นี่ถือเป็นแรงจูงใจในการเรียนรู้ต่อเนื่อง ทุกครั้งที่คุณต้องการแก้ไขข้อความ ให้มองหาคำสั่งภายนอกที่สามารถแก้ปัญหาของคุณได้ อย่ากังวลเกี่ยวกับการเชี่ยวชาญทุกอย่าง เพียงแค่เรียนรู้สิ่งที่คุณต้องการเพื่อทำงานในปัจจุบันให้สำเร็จ