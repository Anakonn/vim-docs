---
description: เรียนรู้การใช้ View, Session และ Viminfo เพื่อเก็บรักษาการตั้งค่าและการเปลี่ยนแปลงในโปรเจกต์ของคุณใน
  Vim อย่างมีประสิทธิภาพ
title: Ch20. Views, Sessions, and Viminfo
---

หลังจากที่คุณทำงานในโปรเจกต์สักระยะหนึ่ง คุณอาจพบว่าโปรเจกต์เริ่มมีรูปแบบที่ชัดเจนขึ้นด้วยการตั้งค่า โฟลด์ บัฟเฟอร์ เลย์เอาต์ ฯลฯ มันเหมือนกับการตกแต่งอพาร์ตเมนต์ของคุณหลังจากที่คุณอยู่ในนั้นมาสักระยะหนึ่ง ปัญหาคือเมื่อคุณปิด Vim คุณจะสูญเสียการเปลี่ยนแปลงเหล่านั้น จะไม่ดีเหรอถ้าคุณสามารถเก็บการเปลี่ยนแปลงเหล่านั้นไว้ได้ เพื่อที่เมื่อคุณเปิด Vim อีกครั้ง มันจะดูเหมือนกับว่าคุณไม่เคยออกไปไหน?

ในบทนี้ คุณจะได้เรียนรู้วิธีการใช้ View, Session และ Viminfo เพื่อรักษา "ภาพถ่าย" ของโปรเจกต์ของคุณ

## View

View คือชุดย่อยที่เล็กที่สุดของสามชุด (View, Session, Viminfo) มันคือการรวบรวมการตั้งค่าสำหรับหน้าต่างหนึ่ง หากคุณใช้เวลานานในการทำงานในหน้าต่างและต้องการรักษาแผนที่และโฟลด์ คุณสามารถใช้ View ได้

มาสร้างไฟล์ชื่อ `foo.txt` กันเถอะ:

```shell
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

ในไฟล์นี้ ให้สร้างการเปลี่ยนแปลงสามอย่าง:
1. ในบรรทัดที่ 1 สร้างโฟลด์ด้วยมือ `zf4j` (พับบรรทัดถัดไป 4 บรรทัด)
2. เปลี่ยนการตั้งค่า `number`: `setlocal nonumber norelativenumber` ซึ่งจะลบตัวชี้วัดหมายเลขที่ด้านซ้ายของหน้าต่าง
3. สร้างการแมพปิ้งท้องถิ่นเพื่อเลื่อนลงสองบรรทัดทุกครั้งที่คุณกด `j` แทนที่จะเป็นหนึ่ง: `:nnoremap <buffer> j jj`

ไฟล์ของคุณควรมีลักษณะดังนี้:

```shell
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

### การกำหนดค่าคุณสมบัติ View

รัน:

```shell
:set viewoptions?
```

ตามค่าเริ่มต้นมันควรจะแสดงว่า (ของคุณอาจดูแตกต่างกันขึ้นอยู่กับ vimrc ของคุณ):

```shell
viewoptions=folds,cursor,curdir
```

มาคอนฟิก `viewoptions` กัน สามารถรักษาคุณสมบัติสามอย่างที่คุณต้องการได้แก่ โฟลด์ แผนที่ และตัวเลือกที่ตั้งไว้ท้องถิ่น หากการตั้งค่าของคุณดูเหมือนของฉัน คุณมีตัวเลือก `folds` อยู่แล้ว คุณต้องบอก View ให้จำ `localoptions` รัน:

```shell
:set viewoptions+=localoptions
```

เพื่อเรียนรู้ว่ามีตัวเลือกอื่นใดบ้างที่มีให้สำหรับ `viewoptions` ให้ตรวจสอบ `:h viewoptions` ตอนนี้หากคุณรัน `:set viewoptions?` คุณควรเห็น:

```shell
viewoptions=folds,cursor,curdir,localoptions
```

### การบันทึก View

เมื่อหน้าต่าง `foo.txt` ถูกพับอย่างถูกต้องและมีตัวเลือก `nonumber norelativenumber` มาลองบันทึก View กัน รัน:

```shell
:mkview
```

Vim จะสร้างไฟล์ View

### ไฟล์ View

คุณอาจสงสัยว่า "Vim บันทึกไฟล์ View นี้ไว้ที่ไหน?" เพื่อดูว่า Vim บันทึกไว้ที่ไหน รัน:

```shell
:set viewdir?
```

ในระบบปฏิบัติการที่ใช้ Unix ค่าดีฟอลต์ควรแสดงว่า `~/.vim/view` (ถ้าคุณใช้ระบบปฏิบัติการที่แตกต่างกัน อาจแสดงเส้นทางที่แตกต่างกัน ตรวจสอบ `:h viewdir` สำหรับข้อมูลเพิ่มเติม) หากคุณกำลังใช้ระบบปฏิบัติการที่ใช้ Unix และต้องการเปลี่ยนไปยังเส้นทางอื่น ให้เพิ่มสิ่งนี้ลงใน vimrc ของคุณ:

```shell
set viewdir=$HOME/else/where
```

### การโหลดไฟล์ View

ปิด `foo.txt` หากคุณยังไม่ได้ทำ จากนั้นเปิด `foo.txt` อีกครั้ง **คุณควรเห็นข้อความต้นฉบับโดยไม่มีการเปลี่ยนแปลง** นั่นคือสิ่งที่คาดหวัง

เพื่อคืนสถานะ คุณต้องโหลดไฟล์ View รัน:

```shell
:loadview
```

ตอนนี้คุณควรเห็น:

```shell
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

โฟลด์ การตั้งค่าท้องถิ่น และการแมพปิ้งท้องถิ่นจะถูกคืนค่า หากคุณสังเกตเห็น เคอร์เซอร์ของคุณควรอยู่ที่บรรทัดที่คุณทิ้งไว้เมื่อคุณรัน `:mkview` ตราบใดที่คุณมีตัวเลือก `cursor` View ก็จะจำตำแหน่งของเคอร์เซอร์ของคุณด้วย

### หลาย View

Vim อนุญาตให้คุณบันทึก View ที่มีหมายเลข 9 (1-9)

สมมติว่าคุณต้องการสร้างโฟลด์เพิ่มเติม (เช่นคุณต้องการพับสองบรรทัดสุดท้าย) ด้วย `:9,10 fold` มาลองบันทึกเป็น View 1 รัน:

```shell
:mkview 1
```

หากคุณต้องการสร้างโฟลด์อีกหนึ่งด้วย `:6,7 fold` และบันทึกเป็น View ที่แตกต่างกัน รัน:

```shell
:mkview 2
```

ปิดไฟล์ เมื่อคุณเปิด `foo.txt` และคุณต้องการโหลด View 1 รัน:

```shell
:loadview 1
```

เพื่อโหลด View 2 รัน:

```shell
:loadview 2
```

เพื่อโหลด View ต้นฉบับ รัน:

```shell
:loadview
```

### การสร้าง View โดยอัตโนมัติ

หนึ่งในสิ่งที่เลวร้ายที่สุดที่อาจเกิดขึ้นคือ หลังจากใช้เวลาหลายชั่วโมงในการจัดระเบียบไฟล์ขนาดใหญ่ด้วยโฟลด์ คุณปิดหน้าต่างโดยไม่ตั้งใจและสูญเสียข้อมูลโฟลด์ทั้งหมด เพื่อป้องกันไม่ให้เกิดเหตุการณ์นี้ คุณอาจต้องการสร้าง View โดยอัตโนมัติทุกครั้งที่คุณปิดบัฟเฟอร์ เพิ่มสิ่งนี้ใน vimrc ของคุณ:

```shell
autocmd BufWinLeave *.txt mkview
```

นอกจากนี้ อาจจะดีถ้าจะโหลด View เมื่อคุณเปิดบัฟเฟอร์:

```shell
autocmd BufWinEnter *.txt silent loadview
```

ตอนนี้คุณไม่ต้องกังวลเกี่ยวกับการสร้างและโหลด View อีกต่อไปเมื่อคุณทำงานกับไฟล์ `txt` ควรทราบว่าเมื่อเวลาผ่านไป `~/.vim/view` ของคุณอาจเริ่มสะสมไฟล์ View ได้ เป็นการดีที่จะทำความสะอาดมันทุกๆ สองสามเดือน

## Sessions

หาก View บันทึกการตั้งค่าของหน้าต่าง Session จะบันทึกข้อมูลของหน้าต่างทั้งหมด (รวมถึงเลย์เอาต์)

### การสร้าง Session ใหม่

สมมติว่าคุณกำลังทำงานกับไฟล์ 3 ไฟล์ในโปรเจกต์ `foobarbaz`:

ภายใน `foo.txt`:

```shell
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

ภายใน `bar.txt`:

```shell
bar1
bar2
bar3
bar4
bar5
bar6
bar7
bar8
bar9
bar10
```

ภายใน `baz.txt`:

```shell
baz1
baz2
baz3
baz4
baz5
baz6
baz7
baz8
baz9
baz10
```

ตอนนี้สมมติว่าคุณแบ่งหน้าต่างด้วย `:split` และ `:vsplit` เพื่อรักษารูปลักษณ์นี้ คุณต้องบันทึก Session รัน:

```shell
:mksession
```

แตกต่างจาก `mkview` ที่บันทึกไปยัง `~/.vim/view` โดยค่าเริ่มต้น `mksession` จะบันทึกไฟล์ Session (`Session.vim`) ในไดเรกทอรีปัจจุบัน ตรวจสอบไฟล์หากคุณสงสัยว่ามีอะไรอยู่ข้างใน

หากคุณต้องการบันทึกไฟล์ Session ไว้ที่อื่น คุณสามารถส่งอาร์กิวเมนต์ไปยัง `mksession`:

```shell
:mksession ~/some/where/else.vim
```

หากคุณต้องการเขียนทับไฟล์ Session ที่มีอยู่แล้ว ให้เรียกคำสั่งด้วย `!` (`:mksession! ~/some/where/else.vim`)

### การโหลด Session

เพื่อโหลด Session รัน:

```shell
:source Session.vim
```

ตอนนี้ Vim จะดูเหมือนกับที่คุณทิ้งไว้ รวมถึงหน้าต่างที่แบ่ง! นอกจากนี้คุณยังสามารถโหลดไฟล์ Session จากเทอร์มินัลได้ด้วย:

```shell
vim -S Session.vim
```

### การกำหนดค่าคุณสมบัติ Session

คุณสามารถกำหนดค่าคุณสมบัติที่ Session บันทึกได้ เพื่อดูว่าสิ่งใดกำลังถูกบันทึกอยู่ รัน:

```shell
:set sessionoptions?
```

ของฉันแสดงว่า:

```shell
blank,buffers,curdir,folds,help,tabpages,winsize,terminal
```

หากคุณไม่ต้องการบันทึก `terminal` เมื่อคุณบันทึก Session ให้ลบออกจากตัวเลือกเซสชัน รัน:

```shell
:set sessionoptions-=terminal
```

หากคุณต้องการเพิ่ม `options` เมื่อคุณบันทึก Session รัน:

```shell
:set sessionoptions+=options
```

นี่คือคุณสมบัติบางอย่างที่ `sessionoptions` สามารถเก็บได้:
- `blank` เก็บหน้าต่างว่าง
- `buffers` เก็บบัฟเฟอร์
- `folds` เก็บโฟลด์
- `globals` เก็บตัวแปรทั่วไประดับโลก (ต้องเริ่มต้นด้วยตัวอักษรตัวใหญ่และมีตัวอักษรตัวเล็กอย่างน้อยหนึ่งตัว)
- `options` เก็บตัวเลือกและการแมพปิ้ง
- `resize` เก็บบรรทัดและคอลัมน์ของหน้าต่าง
- `winpos` เก็บตำแหน่งหน้าต่าง
- `winsize` เก็บขนาดหน้าต่าง
- `tabpages` เก็บแท็บ
- `unix` เก็บไฟล์ในรูปแบบ Unix

สำหรับรายการทั้งหมดให้ตรวจสอบ `:h 'sessionoptions'`

Session เป็นเครื่องมือที่มีประโยชน์ในการรักษาคุณสมบัติภายนอกของโปรเจกต์ของคุณ อย่างไรก็ตาม คุณสมบัติภายในบางอย่างจะไม่ได้รับการบันทึกโดย Session เช่น มาร์คท้องถิ่น รีจิสเตอร์ ประวัติ ฯลฯ เพื่อบันทึกพวกเขา คุณต้องใช้ Viminfo!

## Viminfo

หากคุณสังเกตเห็น หลังจากที่คุณทำการคัดลอกคำลงในรีจิสเตอร์ a และออกจาก Vim ครั้งถัดไปที่คุณเปิด Vim คุณยังคงมีข้อความนั้นเก็บอยู่ในรีจิสเตอร์ a นี่คือผลงานของ Viminfo โดยไม่มีมัน Vim จะไม่จำรีจิสเตอร์หลังจากที่คุณปิด Vim

หากคุณใช้ Vim 8 หรือสูงกว่า Vim จะเปิดใช้งาน Viminfo โดยค่าเริ่มต้น ดังนั้นคุณอาจใช้ Viminfo มาตลอดโดยไม่รู้ตัว!

คุณอาจถามว่า: "Viminfo บันทึกอะไร? มันแตกต่างจาก Session อย่างไร?"

ในการใช้ Viminfo คุณต้องมีฟีเจอร์ `+viminfo` ที่มีอยู่ (`:version`) Viminfo จะบันทึก:
- ประวัติคำสั่ง
- ประวัติสตริงการค้นหา
- ประวัติแถวการป้อนข้อมูล
- เนื้อหาของรีจิสเตอร์ที่ไม่ว่าง
- มาร์คสำหรับหลายไฟล์
- มาร์คไฟล์ที่ชี้ไปยังตำแหน่งในไฟล์
- รูปแบบการค้นหาหรือแทนที่ล่าสุด (สำหรับ 'n' และ '&')
- รายการบัฟเฟอร์
- ตัวแปรทั่วไประดับโลก

โดยทั่วไป Session จะเก็บคุณสมบัติ "ภายนอก" และ Viminfo จะเก็บคุณสมบัติ "ภายใน"

แตกต่างจาก Session ที่คุณสามารถมีไฟล์ Session หนึ่งไฟล์ต่อโปรเจกต์ คุณจะใช้ไฟล์ Viminfo หนึ่งไฟล์ต่อคอมพิวเตอร์ โดยทั่วไป Viminfo จะไม่เกี่ยวข้องกับโปรเจกต์

ตำแหน่ง Viminfo ค่าเริ่มต้นสำหรับ Unix คือ `$HOME/.viminfo` (`~/.viminfo`) หากคุณใช้ระบบปฏิบัติการที่แตกต่างกัน ตำแหน่ง Viminfo ของคุณอาจแตกต่างกัน ตรวจสอบ `:h viminfo-file-name` ทุกครั้งที่คุณทำการเปลี่ยนแปลง "ภายใน" เช่น การคัดลอกข้อความลงในรีจิสเตอร์ Vim จะอัปเดตไฟล์ Viminfo โดยอัตโนมัติ

*ให้แน่ใจว่าคุณตั้งค่าตัวเลือก `nocompatible` (`set nocompatible`) มิฉะนั้น Viminfo ของคุณจะไม่ทำงาน*

### การเขียนและอ่าน Viminfo

แม้ว่าคุณจะใช้เพียงไฟล์ Viminfo ไฟล์เดียว แต่คุณสามารถสร้างไฟล์ Viminfo หลายไฟล์ได้ เพื่อเขียนไฟล์ Viminfo ใช้คำสั่ง `:wviminfo` (`:wv` สำหรับสั้น)

```shell
:wv ~/.viminfo_extra
```

เพื่อเขียนทับไฟล์ Viminfo ที่มีอยู่แล้ว ให้เพิ่ม bang ลงในคำสั่ง `wv`:

```shell
:wv! ~/.viminfo_extra
```

ตามค่าเริ่มต้น Vim จะอ่านจากไฟล์ `~/.viminfo` เพื่ออ่านจากไฟล์ Viminfo ที่แตกต่างกัน รัน `:rviminfo` หรือ `:rv` สำหรับสั้น:

```shell
:rv ~/.viminfo_extra
```

เพื่อเริ่ม Vim ด้วยไฟล์ Viminfo ที่แตกต่างจากเทอร์มินัล ใช้ธง `i`:

```shell
vim -i viminfo_extra
```

หากคุณใช้ Vim สำหรับงานที่แตกต่างกัน เช่น การเขียนโค้ดและการเขียน คุณสามารถสร้าง Viminfo ที่เหมาะสำหรับการเขียนและอีกไฟล์สำหรับการเขียนโค้ด

```shell
vim -i viminfo_writing

vim -i viminfo_coding
```

### การเริ่ม Vim โดยไม่มี Viminfo

เพื่อเริ่ม Vim โดยไม่มี Viminfo คุณสามารถรันจากเทอร์มินัล:

```shell
vim -i NONE
```

เพื่อทำให้มันถาวร คุณสามารถเพิ่มสิ่งนี้ในไฟล์ vimrc ของคุณ:

```shell
set viminfo="NONE"
```

### การกำหนดค่าคุณสมบัติ Viminfo

คล้ายกับ `viewoptions` และ `sessionoptions` คุณสามารถกำหนดว่าคุณสมบัติใดที่จะบันทึกด้วยตัวเลือก `viminfo` รัน:

```shell
:set viminfo?
```

คุณจะได้รับ:

```shell
!,'100,<50,s10,h
```

นี่ดูเหมือนจะเข้าใจยาก มาทำให้มันเข้าใจง่ายขึ้น:
- `!` บันทึกตัวแปรทั่วไประดับโลกที่เริ่มต้นด้วยตัวอักษรตัวใหญ่และไม่ประกอบด้วยตัวอักษรตัวเล็ก จำไว้ว่าตัวแปรทั่วไประดับโลกจะถูกระบุด้วย `g:` ตัวอย่างเช่น หากในบางจุดคุณเขียนการกำหนดค่า `let g:FOO = "foo"` Viminfo จะบันทึกตัวแปรทั่วไประดับโลก `FOO` อย่างไรก็ตามหากคุณทำ `let g:Foo = "foo"` Viminfo จะไม่บันทึกตัวแปรทั่วไระดับโลกนี้เพราะมันมีตัวอักษรตัวเล็ก หากไม่มี `!` Vim จะไม่บันทึกตัวแปรทั่วไระดับโลกเหล่านั้น
- `'100` แทนมาร์ค ในกรณีนี้ Viminfo จะบันทึกมาร์คท้องถิ่น (a-z) ของไฟล์ล่าสุด 100 ไฟล์ โปรดทราบว่าหากคุณบอก Viminfo ให้บันทึกไฟล์มากเกินไป Vim อาจเริ่มช้าลง 1000 เป็นจำนวนที่ดีในการมี
- `<50` บอก Viminfo ว่าจะบันทึกจำนวนบรรทัดสูงสุดสำหรับแต่ละรีจิสเตอร์ (50 ในกรณีนี้) หากฉันคัดลอก 100 บรรทัดของข้อความลงในรีจิสเตอร์ a (`"ay99j`) และปิด Vim ครั้งถัดไปที่ฉันเปิด Vim และวางจากรีจิสเตอร์ a (`"ap`) Vim จะวางได้สูงสุดเพียง 50 บรรทัด หากคุณไม่ให้หมายเลขบรรทัดสูงสุด *ทุก* บรรทัดจะถูกบันทึก หากคุณให้ 0 จะไม่มีอะไรถูกบันทึก
- `s10` ตั้งขีดจำกัดขนาด (เป็น kb) สำหรับรีจิสเตอร์ ในกรณีนี้ รีจิสเตอร์ใดๆ ที่มีขนาดมากกว่า 10kb จะถูกละเว้น
- `h` ปิดการเน้น (จาก `hlsearch`) เมื่อ Vim เริ่มต้น

มีตัวเลือกอื่นๆ ที่คุณสามารถส่งได้ เพื่อเรียนรู้เพิ่มเติมให้ตรวจสอบ `:h 'viminfo'`
## การใช้ Views, Sessions, และ Viminfo อย่างชาญฉลาด

Vim มี View, Session, และ Viminfo เพื่อถ่ายภาพสภาพแวดล้อมของ Vim ในระดับต่างๆ สำหรับโปรเจกต์ขนาดเล็ก ให้ใช้ Views สำหรับโปรเจกต์ขนาดใหญ่ ให้ใช้ Sessions คุณควรใช้เวลาในการตรวจสอบตัวเลือกทั้งหมดที่ View, Session, และ Viminfo มีให้

สร้าง View, Session, และ Viminfo ของคุณเองตามสไตล์การแก้ไขของคุณ หากคุณต้องการใช้ Vim นอกคอมพิวเตอร์ของคุณ คุณสามารถโหลดการตั้งค่าของคุณและคุณจะรู้สึกเหมือนอยู่บ้านทันที!