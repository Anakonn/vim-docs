---
description: هذا الفصل يغطي مفهومي البحث والاستبدال باستخدام التعبيرات العادية، مما
  يسهل العثور على النصوص بسرعة ودقة في Vim.
title: Ch12. Search and Substitute
---

هذا الفصل يغطي مفهومين منفصلين ولكنهما مرتبطان: البحث والاستبدال. غالبًا عند التحرير، تحتاج إلى البحث عن نصوص متعددة بناءً على أنماطها الأقل شيوعًا. من خلال تعلم كيفية استخدام التعبيرات العادية في البحث والاستبدال بدلاً من السلاسل الحرفية، ستتمكن من استهداف أي نص بسرعة.

كملاحظة جانبية، في هذا الفصل، سأستخدم `/` عند الحديث عن البحث. كل ما يمكنك القيام به مع `/` يمكن أيضًا القيام به مع `?`.

## حساسية الحالة الذكية

يمكن أن يكون من الصعب محاولة مطابقة حالة مصطلح البحث. إذا كنت تبحث عن النص "تعلم فيم"، يمكنك بسهولة أن تكتب حالة حرف واحدة بشكل خاطئ وتحصل على نتيجة بحث خاطئة. ألن يكون من الأسهل والأكثر أمانًا إذا كان بإمكانك مطابقة أي حالة؟ هنا تتألق خيار `ignorecase`. فقط أضف `set ignorecase` في ملف vimrc الخاص بك وستصبح جميع مصطلحات البحث لديك غير حساسة للحالة. الآن لا تحتاج إلى كتابة `/تعلم فيم` بعد الآن، بل `/تعلم فيم` ستعمل.

ومع ذلك، هناك أوقات تحتاج فيها إلى البحث عن عبارة محددة من حيث الحالة. إحدى الطرق للقيام بذلك هي إيقاف خيار `ignorecase` عن طريق تشغيل `set noignorecase`، لكن ذلك يتطلب الكثير من العمل لتشغيله وإيقافه في كل مرة تحتاج فيها للبحث عن عبارة حساسة للحالة.

لتجنب التبديل بين `ignorecase`، يحتوي فيم على خيار `smartcase` للبحث عن سلسلة غير حساسة للحالة إذا كان نمط البحث *يحتوي على حرف كبير واحد على الأقل*. يمكنك دمج كل من `ignorecase` و `smartcase` لإجراء بحث غير حساس للحالة عندما تدخل جميع الأحرف الصغيرة وبحث حساس للحالة عندما تدخل حرفًا أو أكثر من الأحرف الكبيرة.

داخل ملف vimrc الخاص بك، أضف:

```shell
set ignorecase smartcase
```

إذا كان لديك هذه النصوص:

```shell
hello
HELLO
Hello
```

- `/hello` تطابق "hello" و "HELLO" و "Hello".
- `/HELLO` تطابق فقط "HELLO".
- `/Hello` تطابق فقط "Hello".

هناك عيب واحد. ماذا لو كنت بحاجة إلى البحث عن سلسلة صغيرة فقط؟ عندما تقوم بكتابة `/hello`، يقوم فيم الآن بإجراء بحث غير حساس للحالة. يمكنك استخدام نمط `\C` في أي مكان في مصطلح البحث الخاص بك لإخبار فيم بأن مصطلح البحث التالي سيكون حساسًا للحالة. إذا قمت بكتابة `/\Chello`، فسوف يتطابق بدقة مع "hello"، وليس "HELLO" أو "Hello".

## الحرف الأول والأخير في السطر

يمكنك استخدام `^` لمطابقة الحرف الأول في السطر و `$` لمطابقة الحرف الأخير في السطر.

إذا كان لديك هذا النص:

```shell
hello hello
```

يمكنك استهداف "hello" الأولى باستخدام `/^hello`. يجب أن يكون الحرف الذي يلي `^` هو الحرف الأول في السطر. لاستهداف "hello" الأخيرة، قم بتشغيل `/hello$`. يجب أن يكون الحرف الذي يسبق `$` هو الحرف الأخير في السطر.

إذا كان لديك هذا النص:

```shell
hello hello friend
```

تشغيل `/hello$` لن يطابق أي شيء لأن "friend" هو المصطلح الأخير في ذلك السطر، وليس "hello".

## تكرار البحث

يمكنك تكرار البحث السابق باستخدام `//`. إذا كنت قد بحثت للتو عن `/hello`، فإن تشغيل `//` يعادل تشغيل `/hello`. يمكن أن توفر لك هذه الاختصار بعض الضغطات على المفاتيح خاصة إذا كنت قد بحثت للتو عن سلسلة طويلة. تذكر أيضًا أنه يمكنك استخدام `n` و `N` لتكرار آخر بحث بنفس الاتجاه والاتجاه المعاكس، على التوالي.

ماذا لو كنت تريد استرجاع *n* من مصطلحات البحث الأخيرة بسرعة؟ يمكنك التنقل بسرعة عبر تاريخ البحث عن طريق الضغط أولاً على `/`، ثم الضغط على مفاتيح السهم لأعلى/أسفل (أو `Ctrl-N`/`Ctrl-P`) حتى تجد مصطلح البحث الذي تحتاجه. لرؤية كل تاريخ بحثك، يمكنك تشغيل `:history /`.

عندما تصل إلى نهاية ملف أثناء البحث، يقوم فيم بإلقاء خطأ: `"Search hit the BOTTOM without match for: {your-search}"`. أحيانًا يمكن أن يكون هذا حماية جيدة من البحث المفرط، ولكن في أوقات أخرى تريد إعادة البحث إلى الأعلى مرة أخرى. يمكنك استخدام خيار `set wrapscan` لجعل فيم يبحث مرة أخرى في أعلى الملف عندما تصل إلى نهاية الملف. لإيقاف تشغيل هذه الميزة، قم بتشغيل `set nowrapscan`.

## البحث عن كلمات بديلة

من الشائع البحث عن كلمات متعددة في وقت واحد. إذا كنت بحاجة إلى البحث عن *إما* "hello vim" أو "hola vim"، ولكن ليس "salve vim" أو "bonjour vim"، يمكنك استخدام نمط `|`.

مع النص التالي:

```shell
hello vim
hola vim
salve vim
bonjour vim
```

لمطابقة كل من "hello" و "hola"، يمكنك كتابة `/hello\|hola`. يجب عليك الهروب (`\`) من عامل التشغيل أو (`|`)، وإلا سيبحث فيم حرفيًا عن السلسلة "|".

إذا كنت لا تريد كتابة `\|` في كل مرة، يمكنك استخدام بناء الجملة `magic` (`\v`) في بداية البحث: `/\vhello|hola`. لن أغطي `magic` في هذا الدليل، ولكن مع `\v`، لا تحتاج إلى الهروب من الأحرف الخاصة بعد الآن. لمعرفة المزيد عن `\v`، لا تتردد في الاطلاع على `:h \v`.

## تعيين بداية ونهاية المطابقة

ربما تحتاج إلى البحث عن نص هو جزء من كلمة مركبة. إذا كان لديك هذه النصوص:

```shell
11vim22
vim22
11vim
vim
```

إذا كنت بحاجة إلى اختيار "vim" ولكن فقط عندما يبدأ بـ "11" وينتهي بـ "22"، يمكنك استخدام عوامل التشغيل `\zs` (بداية المطابقة) و `\ze` (نهاية المطابقة). قم بتشغيل:

```shell
/11\zsvim\ze22
```

لا يزال يتعين على فيم مطابقة النمط الكامل "11vim22"، ولكن يسلط الضوء فقط على النمط المحصور بين `\zs` و `\ze`. مثال آخر:

```shell
foobar
foobaz
```

إذا كنت بحاجة لمطابقة "foo" في "foobaz" ولكن ليس في "foobar"، قم بتشغيل:

```shell
/foo\zebaz
```

## البحث عن نطاقات الأحرف

كانت جميع مصطلحات البحث الخاصة بك حتى هذه النقطة بحثًا عن كلمات حرفية. في الحياة الواقعية، قد تضطر إلى استخدام نمط عام للعثور على نصك. أبسط نمط هو نطاق الأحرف، `[ ]`.

إذا كنت بحاجة إلى البحث عن أي رقم، فمن المحتمل أنك لا تريد كتابة `/0\|1\|2\|3\|4\|5\|6\|7\|8\|9\|0` في كل مرة. بدلاً من ذلك، استخدم `/[0-9]` لمطابقة رقم واحد. تعبر تعبير `0-9` عن نطاق الأرقام من 0 إلى 9 التي سيحاول فيم مطابقتها، لذا إذا كنت تبحث عن أرقام بين 1 إلى 5 بدلاً من ذلك، استخدم `/[1-5]`.

الأرقام ليست النوع الوحيد من البيانات التي يمكن أن يبحث عنها فيم. يمكنك أيضًا استخدام `/[a-z]` للبحث عن أحرف صغيرة و `/[A-Z]` للبحث عن أحرف كبيرة.

يمكنك دمج هذه النطاقات معًا. إذا كنت بحاجة إلى البحث عن الأرقام من 0-9 وكلا الأحرف الصغيرة والكبيرة من "a" إلى "f" (مثل الهكس)، يمكنك كتابة `/[0-9a-fA-F]`.

لإجراء بحث سلبي، يمكنك إضافة `^` داخل أقواس نطاق الأحرف. للبحث عن غير رقم، قم بتشغيل `/[^0-9]`. سيطابق فيم أي حرف طالما أنه ليس رقمًا. احذر أن الرمز `^` داخل أقواس النطاق يختلف عن الرمز `^` في بداية السطر (مثل: `/^hello`). إذا كان الرمز `^` خارج زوج من الأقواس وكان أول حرف في مصطلح البحث، فإنه يعني "الحرف الأول في السطر". إذا كان الرمز `^` داخل زوج من الأقواس وكان أول حرف داخل الأقواس، فإنه يعني عامل البحث السلبي. `/^abc` تطابق أول "abc" في السطر و `/[^abc]` تطابق أي حرف باستثناء "a" أو "b" أو "c".

## البحث عن أحرف متكررة

إذا كنت بحاجة إلى البحث عن أرقام مزدوجة في هذا النص:

```shell
1aa
11a
111
```

يمكنك استخدام `/[0-9][0-9]` لمطابقة حرف ذو رقمين، لكن هذه الطريقة غير قابلة للتوسع. ماذا لو كنت بحاجة لمطابقة عشرين رقمًا؟ كتابة `[0-9]` عشرين مرة ليست تجربة ممتعة. لهذا السبب تحتاج إلى حجة `count`.

يمكنك تمرير `count` إلى بحثك. له البنية التالية:

```shell
{n,m}
```

بالمناسبة، تحتاج هذه الأقواس `count` إلى الهروب عند استخدامها في فيم. يتم وضع عامل `count` بعد حرف واحد تريد زيادته.

إليك أربعة تنويعات مختلفة لبنية `count`:
- `{n}` هو تطابق دقيق. `/[0-9]\{2\}` تطابق الأرقام ذات الرقمين: "11" و "11" في "111".
- `{n,m}` هو تطابق نطاق. `/[0-9]\{2,3\}` تطابق الأرقام بين 2 و 3 أرقام: "11" و "111".
- `{,m}` هو تطابق حتى. `/[0-9]\{,3\}` تطابق حتى 3 أرقام: "1" و "11" و "111".
- `{n,}` هو تطابق على الأقل. `/[0-9]\{2,\}` تطابق على الأقل رقمين أو أكثر: "11" و "111".

تعتبر حجج `count` `\{0,\}` (صفر أو أكثر) و `\{1,\}` (واحد أو أكثر) أنماط بحث شائعة ولدى فيم عوامل تشغيل خاصة بها: `*` و `+` (يحتاج `+` إلى الهروب بينما يعمل `*` بشكل جيد بدون الهروب). إذا قمت بكتابة `/[0-9]*`، فإنه يعادل `/[0-9]\{0,\}`. يبحث عن صفر أو أكثر من الأرقام. سيتطابق مع "", "1"، "123". بالمناسبة، سيتطابق أيضًا مع غير الأرقام مثل "a"، لأنه تقنيًا يوجد صفر رقم في الحرف "a". فكر جيدًا قبل استخدام `*`. إذا قمت بكتابة `/[0-9]\+`، فإنه يعادل `/[0-9]\{1,\}`. يبحث عن واحد أو أكثر من الأرقام. سيتطابق مع "1" و "12".

## نطاقات الأحرف المعرفة مسبقًا

يمتلك فيم نطاقات معرفة مسبقًا لأحرف شائعة مثل الأرقام والأحرف. لن أستعرض كل واحدة هنا، ولكن يمكنك العثور على القائمة الكاملة داخل `:h /character-classes`. إليك بعضها المفيدة:

```shell
\d    رقم [0-9]
\D    غير رقم [^0-9]
\s    حرف فراغ (مسافة و علامة تبويب)
\S    غير حرف فراغ (كل شيء باستثناء المسافة وعلامة التبويب)
\w    حرف كلمة [0-9A-Za-z_]
\l    أحرف صغيرة [a-z]
\u    حرف كبير [A-Z]
```

يمكنك استخدامها كما تستخدم نطاقات الأحرف. للبحث عن أي رقم فردي، بدلاً من استخدام `/[0-9]`، يمكنك استخدام `/\d` لبنية أكثر اختصارًا.

## مثال بحث: التقاط نص بين زوج من الأحرف المماثلة

إذا كنت تريد البحث عن عبارة محاطة بزوج من علامات الاقتباس المزدوجة:

```shell
"Vim رائع!"
```

قم بتشغيل هذا:

```shell
/"[^"]\+"
```

دعنا نفصلها:
- `"` هو علامة اقتباس مزدوجة حرفية. تطابق أول علامة اقتباس مزدوجة.
- `[^"]` تعني أي حرف باستثناء علامة الاقتباس المزدوجة. تطابق أي حرف أبجدي رقمي وحرف فراغ طالما أنه ليس علامة اقتباس مزدوجة.
- `\+` تعني واحد أو أكثر. نظرًا لأنها مسبوقة بـ `[^"]`، يبحث فيم عن حرف واحد أو أكثر ليس علامة اقتباس مزدوجة.
- `"` هو علامة اقتباس مزدوجة حرفية. تطابق علامة الاقتباس المزدوجة الختامية.

عندما يرى فيم أول `"`, يبدأ في التقاط النمط. في اللحظة التي يرى فيها علامة الاقتباس المزدوجة الثانية في السطر، يطابق نمط `"` الثاني ويتوقف عن التقاط النمط. في هذه الأثناء، يتم التقاط جميع الأحرف غير علامات الاقتباس المزدوجة في المنتصف بواسطة نمط `[^"]\+`، في هذه الحالة، العبارة `Vim رائع!`. هذا نمط شائع لالتقاط عبارة محاطة بزوج من المحددات المماثلة.

- لالتقاط عبارة محاطة بعلامات اقتباس فردية، يمكنك استخدام `/'[^']\+'`.
- لالتقاط عبارة محاطة بالأصفار، يمكنك استخدام `/0[^0]\+0`.

## مثال بحث: التقاط رقم هاتف

إذا كنت تريد مطابقة رقم هاتف أمريكي مفصول بشرطة (`-`)، مثل `123-456-7890`، يمكنك استخدام:

```shell
/\d\{3\}-\d\{3\}-\d\{4\}
```

يتكون رقم الهاتف الأمريكي من مجموعة من الأرقام الثلاثة، تليها ثلاث أرقام أخرى، وأخيرًا أربع أرقام. دعنا نفصلها:
- `\d\{3\}` تطابق رقمًا مكررًا بالضبط ثلاث مرات
- `-` هو شرطة حرفية

يمكنك تجنب كتابة الهروب باستخدام `\v`:

```shell
/\v\d{3}-\d{3}-\d{4}
```

هذا النمط مفيد أيضًا لالتقاط أي أرقام متكررة، مثل عناوين IP والرموز البريدية.

هذا يغطي جزء البحث من هذا الفصل. الآن دعنا ننتقل إلى الاستبدال.

## الاستبدال الأساسي

أمر الاستبدال في فيم هو أمر مفيد للعثور بسرعة واستبدال أي نمط. بناء جملة الاستبدال هو:

```shell
:s/{old-pattern}/{new-pattern}/
```

لنبدأ باستخدام أساسي. إذا كان لديك هذا النص:

```shell
vim جيد
```

دعنا نستبدل "جيد" بـ "رائع" لأن فيم رائع. قم بتشغيل `:s/good/awesome/`. يجب أن ترى:

```shell
vim رائع
```
## تكرار آخر استبدال

يمكنك تكرار آخر أمر استبدال باستخدام الأمر العادي `&` أو عن طريق تشغيل `:s`. إذا كنت قد قمت للتو بتشغيل `:s/good/awesome/`، فإن تشغيل أي من `&` أو `:s` سيعيد تكراره.

أيضًا، ذكرت سابقًا في هذا الفصل أنه يمكنك استخدام `//` لتكرار نمط البحث السابق. تعمل هذه الحيلة مع أمر الاستبدال. إذا تم تنفيذ `/good` مؤخرًا وتركت أول حجة نمط الاستبدال فارغة، مثل `:s//awesome/`، فإنها تعمل بنفس طريقة تشغيل `:s/good/awesome/`.

## نطاق الاستبدال

تمامًا مثل العديد من أوامر Ex، يمكنك تمرير حجة نطاق إلى أمر الاستبدال. الصيغة هي:

```shell
:[range]s/old/new/
```

إذا كان لديك هذه التعبيرات:

```shell
let one = 1;
let two = 2;
let three = 3;
let four = 4;
let five = 5;
```

لاستبدال "let" بـ "const" في الأسطر من ثلاثة إلى خمسة، يمكنك القيام بذلك:

```shell
:3,5s/let/const/
```

إليك بعض تنويعات النطاق التي يمكنك تمريرها:

- `:,3s/let/const/` - إذا لم يتم إعطاء شيء قبل الفاصلة، فإنه يمثل السطر الحالي. استبدل من السطر الحالي إلى السطر 3.
- `:1,s/let/const/` - إذا لم يتم إعطاء شيء بعد الفاصلة، فإنه يمثل أيضًا السطر الحالي. استبدل من السطر 1 إلى السطر الحالي.
- `:3s/let/const/` - إذا تم إعطاء قيمة واحدة فقط كنطاق (بدون فاصلة)، فإنه يقوم بالاستبدال في ذلك السطر فقط.

في Vim، `%` عادةً ما يعني الملف بالكامل. إذا قمت بتشغيل `:%s/let/const/`، فسيقوم بالاستبدال في جميع الأسطر. تذكر هذه الصيغة النطاقية. العديد من أوامر سطر الأوامر التي ستتعلمها في الفصول القادمة ستتبع هذه الصيغة.

## مطابقة الأنماط

ستتناول الأقسام القليلة التالية التعبيرات العادية الأساسية. معرفة قوية بالأنماط ضرورية لإتقان أمر الاستبدال.

إذا كان لديك التعبيرات التالية:

```shell
let one = 1;
let two = 2;
let three = 3;
let four = 4;
let five = 5;
```

لإضافة زوج من علامات الاقتباس المزدوجة حول الأرقام:

```shell
:%s/\d/"\0"/
```

النتيجة:

```shell
let one = "1";
let two = "2";
let three = "3";
let four = "4";
let five = "5";
```

دعنا نفصل الأمر:
- `:%s` يستهدف الملف بالكامل لأداء الاستبدال.
- `\d` هو النطاق المحدد مسبقًا للأرقام في Vim (مماثل لاستخدام `[0-9]`).
- `"\0"` هنا علامات الاقتباس المزدوجة هي علامات اقتباس مزدوجة حرفية. `\0` هو حرف خاص يمثل "النمط المطابق بالكامل". النمط المطابق هنا هو رقم مفرد، `\d`.

بدلاً من ذلك، يمثل `&` أيضًا النمط المطابق بالكامل مثل `\0`. كان يمكن أن يعمل `:s/\d/"&"/` أيضًا.

دعنا نفكر في مثال آخر. بالنظر إلى هذه التعبيرات وتحتاج إلى تبديل جميع "let" مع أسماء المتغيرات.

```shell
one let = "1";
two let = "2";
three let = "3";
four let = "4";
five let = "5";
```

للقيام بذلك، قم بتشغيل:

```shell
:%s/\(\w\+\) \(\w\+\)/\2 \1/
```

يحتوي الأمر أعلاه على الكثير من الشرطات العكسية ومن الصعب قراءته. في هذه الحالة، من الأكثر ملاءمة استخدام عامل `\v`:

```shell
:%s/\v(\w+) (\w+)/\2 \1/
```

النتيجة:

```shell
let one = "1";
let two = "2";
let three = "3";
let four = "4";
let five = "5";
```

رائع! دعنا نفصل ذلك الأمر:
- `:%s` يستهدف جميع الأسطر في الملف لأداء الاستبدال.
- `(\w+) (\w+)` هو تطابق جماعي. `\w` هو أحد النطاقات المحددة مسبقًا في Vim لحرف الكلمة (`[0-9A-Za-z_]`). تحيطه `( )` لالتقاط تطابق حرف الكلمة في مجموعة. لاحظ الفراغ بين المجموعتين. `(\w+) (\w+)` يلتقط مجموعتين. المجموعة الأولى تلتقط "one" والمجموعة الثانية تلتقط "two".
- `\2 \1` تعيد المجموعة الملتقطة بترتيب مقلوب. `\2` تحتوي على السلسلة الملتقطة "let" و `\1` السلسلة "one". وجود `\2 \1` يعيد السلسلة "let one".

تذكر أن `\0` يمثل النمط المطابق بالكامل. يمكنك تقسيم السلسلة المطابقة إلى مجموعات أصغر باستخدام `( )`. يتم تمثيل كل مجموعة بواسطة `\1`، `\2`، `\3`، إلخ.

دعنا نقوم بمثال آخر لتثبيت مفهوم تطابق المجموعة. إذا كان لديك هذه الأرقام:

```shell
123
456
789
```

لعكس الترتيب، قم بتشغيل:

```shell
:%s/\v(\d)(\d)(\d)/\3\2\1/
```

النتيجة هي:

```shell
321
654
987
```

كل `(\d)` يطابق كل رقم وينشئ مجموعة. في السطر الأول، تحتوي أول `(\d)` على قيمة 1، والثانية `(\d)` تحتوي على قيمة 2، والثالثة `(\d)` تحتوي على قيمة 3. يتم تخزينها في المتغيرات `\1`، `\2`، و `\3`. في النصف الثاني من الاستبدال، النمط الجديد `\3\2\1` ينتج القيمة "321" في السطر الأول.

إذا كنت قد قمت بتشغيل هذا بدلاً من ذلك:

```shell
:%s/\v(\d\d)(\d)/\2\1/
```
لكنت قد حصلت على نتيجة مختلفة:

```shell
312
645
978
```

هذا لأن لديك الآن مجموعتين فقط. المجموعة الأولى، الملتقطة بواسطة `(\d\d)`, مخزنة داخل `\1` ولها قيمة 12. المجموعة الثانية، الملتقطة بواسطة `(\d)`, مخزنة داخل `\2` ولها قيمة 3. ثم، `\2\1` تعيد 312.

## علامات الاستبدال

إذا كان لديك الجملة:

```shell
chocolate pancake, strawberry pancake, blueberry pancake
```

لاستبدال جميع الفطائر إلى دونات، لا يمكنك فقط تشغيل:

```shell
:s/pancake/donut
```

سيقوم الأمر أعلاه فقط باستبدال المطابقة الأولى، مما يعطيك:

```shell
chocolate donut, strawberry pancake, blueberry pancake
```

هناك طريقتان لحل هذا. يمكنك إما تشغيل أمر الاستبدال مرتين أخريين أو يمكنك تمرير علامة عالمية (`g`) لاستبدال جميع المطابقات في السطر.

دعنا نتحدث عن علامة العالمية. قم بتشغيل:

```shell
:s/pancake/donut/g
```

يستبدل Vim جميع الفطائر بالدونات في أمر واحد سريع. الأمر العالمي هو أحد العديد من العلامات التي يقبلها أمر الاستبدال. تمرر العلامات في نهاية أمر الاستبدال. إليك قائمة بالعلامات المفيدة:

```shell
&    إعادة استخدام العلامات من أمر الاستبدال السابق.
g    استبدال جميع المطابقات في السطر.
c    طلب تأكيد الاستبدال.
e    منع ظهور رسالة خطأ عند فشل الاستبدال.
i    إجراء استبدال غير حساس لحالة الأحرف.
I    إجراء استبدال حساس لحالة الأحرف.
```

هناك المزيد من العلامات التي لم أذكرها أعلاه. لقراءة المزيد عن جميع العلامات، تحقق من `:h s_flags`.

بالمناسبة، أوامر تكرار الاستبدال (`&` و `:s`) لا تحتفظ بالعلامات. تشغيل `&` سيعيد فقط `:s/pancake/donut/` بدون `g`. لتكرار آخر أمر استبدال بسرعة مع جميع العلامات، قم بتشغيل `:&&`.

## تغيير الفاصل

إذا كنت بحاجة إلى استبدال عنوان URL بمسار طويل:

```shell
https://mysite.com/a/b/c/d/e
```

لاستبداله بكلمة "hello"، قم بتشغيل:

```shell
:s/https:\/\/mysite.com\/a\/b\/c\/d\/e/hello/
```

ومع ذلك، من الصعب معرفة أي من الشرطات المائلة (`/`) هي جزء من نمط الاستبدال وأيها هي الفواصل. يمكنك تغيير الفاصل باستخدام أي حرف ذو بايت واحد (باستثناء الأبجدية، الأرقام، أو `"`, `|`, و `\`). دعنا نستبدلها بـ `+`. يمكن إعادة كتابة أمر الاستبدال أعلاه كالتالي:

```shell
:s+https:\/\/mysite.com\/a\/b\/c\/d\/e+hello+
```

الآن من الأسهل رؤية مكان الفواصل.

## استبدال خاص

يمكنك أيضًا تعديل حالة النص الذي تقوم باستبداله. بالنظر إلى التعبيرات التالية ومهمتك هي تحويل المتغيرات "one"، "two"، "three"، إلخ إلى أحرف كبيرة.

```shell
let one = "1";
let two = "2";
let three = "3";
let four = "4";
let five = "5";
```

قم بتشغيل:

```shell
:%s/\v(\w+) (\w+)/\1 \U\2/
```

ستحصل على:

```shell
let ONE = "1";
let TWO = "2";
let THREE = "3";
let FOUR = "4";
let FIVE = "5";
```

التفصيل:
- `(\w+) (\w+)` تلتقط أول مجموعتين متطابقتين، مثل "let" و "one".
- `\1` تعيد قيمة المجموعة الأولى، "let".
- `\U\2` تجعل المجموعة الثانية (`\2`) بأحرف كبيرة.

حيلة هذا الأمر هي التعبير `\U\2`. `\U` instructs the following character to be uppercased.

دعنا نقوم بمثال آخر. افترض أنك تكتب دليل Vim وتحتاج إلى تكبير الحرف الأول من كل كلمة في سطر.

```shell
vim is the greatest text editor in the whole galaxy
```

يمكنك تشغيل:

```shell
:s/\<./\U&/g
```

النتيجة:

```shell
Vim Is The Greatest Text Editor In The Whole Galaxy
```

إليك التفصيل:
- `:s` يستبدل السطر الحالي.
- `\<.` يتكون من جزئين: `\<` لمطابقة بداية كلمة و `.` لمطابقة أي حرف. تجعل `\<` الحرف التالي هو أول حرف في الكلمة. نظرًا لأن `.` هو الحرف التالي، فإنه سيطابق أول حرف من أي كلمة.
- `\U&` يجعل الرمز اللاحق، `&`. تذكر أن `&` (أو `\0`) يمثل المطابقة الكاملة. إنه يطابق أول حرف من أي كلمة.
- `g` علامة عالمية. بدونها، سيقوم هذا الأمر فقط باستبدال المطابقة الأولى. تحتاج إلى استبدال كل مطابقة في هذا السطر.

لتعلم المزيد عن رموز الاستبدال الخاصة في الاستبدال مثل `\U`، تحقق من `:h sub-replace-special`.

## أنماط بديلة

أحيانًا تحتاج إلى مطابقة أنماط متعددة في وقت واحد. إذا كان لديك التحيات التالية:

```shell
hello vim
hola vim
salve vim
bonjour vim
```

تحتاج إلى استبدال كلمة "vim" بـ "friend" ولكن فقط في الأسطر التي تحتوي على كلمة "hello" أو "hola". تذكر من وقت سابق في هذا الفصل، يمكنك استخدام `|` للأنماط البديلة المتعددة.

```shell
:%s/\v(hello|hola) vim/\1 friend/g
```

النتيجة:

```shell
hello friend
hola friend
salve vim
bonjour vim
```

إليك التفصيل:
- `%s` يشغل أمر الاستبدال على كل سطر في الملف.
- `(hello|hola)` يطابق *إما* "hello" أو "hola" ويعتبرها مجموعة.
- `vim` هي الكلمة الحرفية "vim".
- `\1` هي المجموعة الأولى، والتي هي إما النص "hello" أو "hola".
- `friend` هي الكلمة الحرفية "friend".

## استبدال بداية ونهاية نمط

تذكر أنه يمكنك استخدام `\zs` و `\ze` لتحديد بداية ونهاية المطابقة. تعمل هذه التقنية في الاستبدال أيضًا. إذا كان لديك:

```shell
chocolate pancake
strawberry sweetcake
blueberry hotcake
```

لاستبدال "cake" في "hotcake" بـ "dog" للحصول على "hotdog":

```shell
:%s/hot\zscake/dog/g
```

النتيجة:

```shell
chocolate pancake
strawberry sweetcake
blueberry hotdog
```
## الجشع وغير الجشع

يمكنك استبدال المطابقة n في سطر باستخدام هذه الحيلة:

```shell
One Mississippi, two Mississippi, three Mississippi, four Mississippi, five Mississippi.
```

لاستبدال "Mississippi" الثالثة بـ "Arkansas"، نفذ:

```shell
:s/\v(.{-}\zsMississippi){3}/Arkansas/g
```

التفصيل:
- `:s/` أمر الاستبدال.
- `\v` هي الكلمة السحرية حتى لا تضطر إلى الهروب من الكلمات الرئيسية الخاصة.
- `.` تطابق أي حرف واحد.
- `{-}` يقوم بمطابقة غير جشعة لـ 0 أو أكثر من الذرة السابقة.
- `\zsMississippi` تجعل "Mississippi" بداية المطابقة.
- `(...){3}` تبحث عن المطابقة الثالثة.

لقد رأيت بناء الجملة `{3}` في وقت سابق في هذا الفصل. في هذه الحالة، ستطابق `{3}` بالضبط المطابقة الثالثة. الحيلة الجديدة هنا هي `{-}`. إنها مطابقة غير جشعة. تجد أقصر مطابقة للنمط المعطى. في هذه الحالة، `(.{-}Mississippi)` تطابق أقل كمية من "Mississippi" التي تسبقها أي حرف. قارن هذا مع `(.*Mississippi)` حيث تجد أطول مطابقة للنمط المعطى.

إذا استخدمت `(.{-}Mississippi)`، ستحصل على خمس مطابقت: "One Mississippi"، "Two Mississippi"، إلخ. إذا استخدمت `(.*Mississippi)`، ستحصل على مطابقة واحدة: آخر "Mississippi". `*` هو مطابق جشع و `{-}` هو مطابق غير جشع. لمعرفة المزيد، تحقق من `:h /\{-` و `:h non-greedy`.

لنقم بمثال أبسط. إذا كان لديك السلسلة:

```shell
abc1de1
```

يمكنك مطابقة "abc1de1" (جشع) مع:

```shell
/a.*1
```

يمكنك مطابقة "abc1" (غير جشع) مع:

```shell
/a.\{-}1
```

لذا إذا كنت بحاجة إلى تحويل المطابقة الأطول إلى أحرف كبيرة (جشع)، نفذ:

```shell
:s/a.*1/\U&/g
```

للحصول على:

```shell
ABC1DEFG1
```

إذا كنت بحاجة إلى تحويل المطابقة الأقصر إلى أحرف كبيرة (غير جشع)، نفذ:

```shell
:s/a.\{-}1/\U&/g
```

للحصول على:

```shell
ABC1defg1
```

إذا كنت جديدًا على مفهوم الجشع مقابل غير الجشع، قد يكون من الصعب فهمه. جرب مع تركيبات مختلفة حتى تفهمه.

## الاستبدال عبر ملفات متعددة

أخيرًا، دعنا نتعلم كيفية استبدال العبارات عبر ملفات متعددة. في هذا القسم، افترض أن لديك ملفين: `food.txt` و `animal.txt`.

داخل `food.txt`:

```shell
corndog
hotdog
chilidog
```

داخل `animal.txt`:

```shell
large dog
medium dog
small dog
```

افترض أن هيكل الدليل الخاص بك يبدو كالتالي:

```shell
- food.txt
- animal.txt
```

أولاً، قم بالتقاط كل من `food.txt` و `animal.txt` داخل `:args`. تذكر من الفصول السابقة أن `:args` يمكن استخدامها لإنشاء قائمة بأسماء الملفات. هناك عدة طرق للقيام بذلك من داخل Vim، واحدة منها هي تشغيل هذا من داخل Vim:

```shell
:args *.txt                  يلتقط جميع ملفات txt في الموقع الحالي
```

لاختبار ذلك، عندما تقوم بتشغيل `:args`، يجب أن ترى:

```shell
[food.txt] animal.txt
```

الآن بعد أن تم تخزين جميع الملفات ذات الصلة داخل قائمة المعاملات، يمكنك إجراء استبدال متعدد الملفات باستخدام أمر `:argdo`. نفذ:

```shell
:argdo %s/dog/chicken/
```

هذا ينفذ الاستبدال ضد جميع الملفات داخل قائمة `:args`. أخيرًا، احفظ الملفات التي تم تغييرها باستخدام:

```shell
:argdo update
```

`:args` و `:argdo` هما أدوات مفيدة لتطبيق أوامر سطر الأوامر عبر ملفات متعددة. جربها مع أوامر أخرى!

## الاستبدال عبر ملفات متعددة باستخدام الماكرو

بدلاً من ذلك، يمكنك أيضًا تشغيل أمر الاستبدال عبر ملفات متعددة باستخدام الماكرو. نفذ:

```shell
:args *.txt
qq
:%s/dog/chicken/g
:wnext
q
99@q
```

التفصيل:
- `:args *.txt` يضيف جميع ملفات النص إلى قائمة `:args`.
- `qq` يبدأ الماكرو في سجل "q".
- `:%s/dog/chicken/g` يستبدل "dog" بـ "chicken" في جميع الأسطر في الملف الحالي.
- `:wnext` يحفظ الملف ثم ينتقل إلى الملف التالي في قائمة `args`.
- `q` يوقف تسجيل الماكرو.
- `99@q` ينفذ الماكرو تسع وتسعين مرة. سيتوقف Vim عن تنفيذ الماكرو بعد أن يواجه الخطأ الأول، لذا لن ينفذ Vim الماكرو تسع وتسعين مرة فعليًا.

## تعلم البحث والاستبدال بطريقة ذكية

القدرة على البحث بشكل جيد هي مهارة ضرورية في التحرير. إتقان البحث يتيح لك استخدام مرونة التعبيرات العادية للبحث عن أي نمط في ملف. خذ وقتك لتعلم هذه الأمور. لتحسين مهاراتك في التعبيرات العادية، تحتاج إلى استخدام التعبيرات العادية بنشاط. لقد قرأت ذات مرة كتابًا عن التعبيرات العادية دون القيام بذلك فعليًا ونسيت تقريبًا كل ما قرأته بعد ذلك. البرمجة النشطة هي أفضل طريقة لإتقان أي مهارة.

طريقة جيدة لتحسين مهارات مطابقة الأنماط هي كلما احتجت إلى البحث عن نمط (مثل "hello 123")، بدلاً من الاستعلام عن مصطلح البحث الحرفي (`/hello 123`)، حاول أن تأتي بنمط لذلك (شيء مثل `/\v(\l+) (\d+)`). العديد من هذه المفاهيم في التعبيرات العادية قابلة للتطبيق أيضًا في البرمجة العامة، وليس فقط عند استخدام Vim.

الآن بعد أن تعلمت عن البحث المتقدم والاستبدال في Vim، دعنا نتعلم واحدة من أكثر الأوامر تنوعًا، الأمر العالمي.