---
description: تتعلم في هذا الفصل كيفية استخدام View وSession وViminfo للحفاظ على إعدادات
  مشروعك في Vim، مما يتيح لك استئناف العمل بسهولة.
title: Ch20. Views, Sessions, and Viminfo
---

بعد أن تعمل على مشروع لفترة من الوقت، قد تجد أن المشروع يبدأ في التكون تدريجياً مع إعداداته الخاصة، والطيات، والمخازن، والتخطيطات، وما إلى ذلك. إنه مثل تزيين شقتك بعد العيش فيها لفترة. المشكلة هي، عندما تغلق Vim، تفقد تلك التغييرات. ألن يكون من الجيد إذا كان بإمكانك الاحتفاظ بتلك التغييرات بحيث في المرة القادمة التي تفتح فيها Vim، يبدو كما لو أنك لم تغادر أبداً؟

في هذا الفصل، ستتعلم كيفية استخدام View وSession وViminfo للحفاظ على "لقطة" من مشاريعك.

## View

View هو أصغر مجموعة من الثلاثة (View، Session، Viminfo). إنه مجموعة من الإعدادات لنافذة واحدة. إذا قضيت وقتًا طويلاً في العمل على نافذة وتريد الحفاظ على الخرائط والطيات، يمكنك استخدام View.

لنقم بإنشاء ملف يسمى `foo.txt`:

```shell
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

في هذا الملف، قم بإنشاء ثلاث تغييرات:
1. على السطر 1، أنشئ طية يدوية `zf4j` (اطوِ السطور الأربعة التالية).
2. غيّر إعداد `number`: `setlocal nonumber norelativenumber`. سيؤدي ذلك إلى إزالة مؤشرات الأرقام على الجانب الأيسر من النافذة.
3. أنشئ تخطيطًا محليًا للانتقال لأسفل سطرين في كل مرة تضغط فيها على `j` بدلاً من واحد: `:nnoremap <buffer> j jj`.

يجب أن يبدو ملفك كالتالي:

```shell
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

### تكوين خصائص View

قم بتشغيل:

```shell
:set viewoptions?
```

بشكل افتراضي يجب أن يقول (قد يبدو مختلفًا حسب vimrc الخاص بك):

```shell
viewoptions=folds,cursor,curdir
```

لنقم بتكوين `viewoptions`. الخصائص الثلاث التي تريد الحفاظ عليها هي الطيات، والخرائط، وخيارات الإعداد المحلية. إذا كانت إعداداتك تبدو مثل إعدادي، لديك بالفعل خيار `folds`. تحتاج إلى إخبار View بتذكر `localoptions`. قم بتشغيل:

```shell
:set viewoptions+=localoptions
```

لتتعلم ما هي الخيارات الأخرى المتاحة لـ `viewoptions`، تحقق من `:h viewoptions`. الآن إذا قمت بتشغيل `:set viewoptions؟`، يجب أن ترى:

```shell
viewoptions=folds,cursor,curdir,localoptions
```

### حفظ View

مع نافذة `foo.txt` مطوية بشكل صحيح ولديها خيارات `nonumber norelativenumber`، دعنا نحفظ View. قم بتشغيل:

```shell
:mkview
```

تقوم Vim بإنشاء ملف View.

### ملفات View

قد تتساءل، "أين حفظت Vim ملف View هذا؟" لرؤية أين تحفظ Vim، قم بتشغيل:

```shell
:set viewdir?
```

في أنظمة التشغيل المستندة إلى Unix، يجب أن يقول الافتراضي `~/.vim/view` (إذا كان لديك نظام تشغيل مختلف، قد يظهر مسارًا مختلفًا. تحقق من `:h viewdir` لمزيد من المعلومات). إذا كنت تعمل على نظام تشغيل مستند إلى Unix وترغب في تغييره إلى مسار مختلف، أضف هذا إلى vimrc الخاص بك:

```shell
set viewdir=$HOME/else/where
```

### تحميل ملف View

اغلق `foo.txt` إذا لم تكن قد فعلت ذلك، ثم افتح `foo.txt` مرة أخرى. **يجب أن ترى النص الأصلي بدون التغييرات.** هذا متوقع.

لاستعادة الحالة، تحتاج إلى تحميل ملف View. قم بتشغيل:

```shell
:loadview
```

الآن يجب أن ترى:

```shell
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

تمت استعادة الطيات، والإعدادات المحلية، والتخطيطات المحلية. إذا لاحظت، يجب أن يكون المؤشر الخاص بك أيضًا على السطر الذي تركته عندما قمت بتشغيل `:mkview`. طالما لديك خيار `cursor`، فإن View يتذكر أيضًا موضع المؤشر الخاص بك.

### عدة Views

تتيح لك Vim حفظ 9 Views مرقمة (1-9).

افترض أنك تريد إنشاء طية إضافية (لنفترض أنك تريد طي السطرين الأخيرين) باستخدام `:9,10 fold`. دعنا نحفظ هذا كـ View 1. قم بتشغيل:

```shell
:mkview 1
```

إذا كنت تريد إنشاء طية أخرى باستخدام `:6,7 fold` وحفظها كـ View مختلف، قم بتشغيل:

```shell
:mkview 2
```

اغلق الملف. عندما تفتح `foo.txt` وتريد تحميل View 1، قم بتشغيل:

```shell
:loadview 1
```

لتحميل View 2، قم بتشغيل:

```shell
:loadview 2
```

لتحميل View الأصلي، قم بتشغيل:

```shell
:loadview
```

### أتمتة إنشاء View

واحدة من أسوأ الأشياء التي يمكن أن تحدث هي، بعد قضاء ساعات لا تحصى في تنظيم ملف كبير مع الطيات، تغلق النافذة عن طريق الخطأ وتفقد جميع معلومات الطي. لمنع ذلك، قد ترغب في إنشاء View تلقائيًا في كل مرة تغلق فيها مخزن. أضف هذا في vimrc الخاص بك:

```shell
autocmd BufWinLeave *.txt mkview
```

بالإضافة إلى ذلك، قد يكون من الجيد تحميل View عند فتح مخزن:

```shell
autocmd BufWinEnter *.txt silent loadview
```

الآن لا داعي للقلق بشأن إنشاء وتحميل View بعد الآن عند العمل مع ملفات `txt`. تذكر أنه بمرور الوقت، قد يبدأ `~/.vim/view` في تراكم ملفات View. من الجيد تنظيفه مرة كل بضعة أشهر.

## Sessions

إذا كان View يحفظ إعدادات نافذة، فإن Session يحفظ معلومات جميع النوافذ (بما في ذلك التخطيط).

### إنشاء Session جديد

افترض أنك تعمل مع هذه الملفات الثلاثة في مشروع `foobarbaz`:

داخل `foo.txt`:

```shell
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

داخل `bar.txt`:

```shell
bar1
bar2
bar3
bar4
bar5
bar6
bar7
bar8
bar9
bar10
```

داخل `baz.txt`:

```shell
baz1
baz2
baz3
baz4
baz5
baz6
baz7
baz8
baz9
baz10
```

الآن لنفترض أنك قمت بتقسيم نوافذك باستخدام `:split` و`:vsplit`. للحفاظ على هذا المظهر، تحتاج إلى حفظ Session. قم بتشغيل:

```shell
:mksession
```

على عكس `mkview` حيث يتم حفظه في `~/.vim/view` بشكل افتراضي، يقوم `mksession` بحفظ ملف Session (`Session.vim`) في الدليل الحالي. تحقق من الملف إذا كنت فضولياً لمعرفة ما بداخله.

إذا كنت ترغب في حفظ ملف Session في مكان آخر، يمكنك تمرير وسيط إلى `mksession`:

```shell
:mksession ~/some/where/else.vim
```

إذا كنت ترغب في الكتابة فوق ملف Session الموجود، قم باستدعاء الأمر مع `!` (`:mksession! ~/some/where/else.vim`).

### تحميل Session

لتحميل Session، قم بتشغيل:

```shell
:source Session.vim
```

الآن تبدو Vim تمامًا كما تركتها، بما في ذلك النوافذ المنقسمة! بدلاً من ذلك، يمكنك أيضًا تحميل ملف Session من الطرفية:

```shell
vim -S Session.vim
```

### تكوين خصائص Session

يمكنك تكوين الخصائص التي يحفظها Session. لرؤية ما يتم حفظه حاليًا، قم بتشغيل:

```shell
:set sessionoptions?
```

يقول لي:

```shell
blank,buffers,curdir,folds,help,tabpages,winsize,terminal
```

إذا كنت لا تريد حفظ `terminal` عند حفظ Session، قم بإزالته من خيارات الجلسة. قم بتشغيل:

```shell
:set sessionoptions-=terminal
```

إذا كنت ترغب في إضافة `options` عند حفظ Session، قم بتشغيل:

```shell
:set sessionoptions+=options
```

إليك بعض الخصائص التي يمكن أن يخزنها `sessionoptions`:
- `blank` يخزن النوافذ الفارغة
- `buffers` يخزن المخازن
- `folds` يخزن الطيات
- `globals` يخزن المتغيرات العالمية (يجب أن تبدأ بحرف كبير وتحتوي على حرف صغير واحد على الأقل)
- `options` يخزن الخيارات والتخطيطات
- `resize` يخزن خطوط وأعمدة النافذة
- `winpos` يخزن موضع النافذة
- `winsize` يخزن أحجام النوافذ
- `tabpages` يخزن علامات التبويب
- `unix` يخزن الملفات بتنسيق Unix

للحصول على القائمة الكاملة، تحقق من `:h 'sessionoptions'`.

Session هي أداة مفيدة للحفاظ على الخصائص الخارجية لمشروعك. ومع ذلك، فإن بعض الخصائص الداخلية لا يتم حفظها بواسطة Session، مثل العلامات المحلية، والسجلات، والتواريخ، وما إلى ذلك. لحفظها، تحتاج إلى استخدام Viminfo!

## Viminfo

إذا لاحظت، بعد نسخ كلمة إلى السجل a وترك Vim، في المرة التالية التي تفتح فيها Vim لا يزال لديك ذلك النص مخزنًا في السجل a. هذه في الواقع نتيجة عمل Viminfo. بدونها، لن تتذكر Vim السجل بعد إغلاق Vim.

إذا كنت تستخدم Vim 8 أو أعلى، فإن Vim يمكّن Viminfo بشكل افتراضي، لذا قد تكون قد استخدمت Viminfo طوال الوقت دون أن تعرف ذلك!

قد تسأل: "ماذا يحفظ Viminfo؟ كيف يختلف عن Session؟"

لاستخدام Viminfo، تحتاج أولاً إلى أن تكون لديك ميزة `+viminfo` متاحة (`:version`). يقوم Viminfo بتخزين:
- تاريخ سطر الأوامر.
- تاريخ سلسلة البحث.
- تاريخ سطر الإدخال.
- محتويات السجلات غير الفارغة.
- العلامات لعدة ملفات.
- علامات الملفات، تشير إلى المواقع في الملفات.
- آخر نمط بحث / استبدال (لـ 'n' و '&').
- قائمة المخازن.
- المتغيرات العالمية.

بشكل عام، يقوم Session بتخزين الخصائص "الخارجية" وViminfo الخصائص "الداخلية".

على عكس Session حيث يمكنك أن يكون لديك ملف Session واحد لكل مشروع، عادةً ما ستستخدم ملف Viminfo واحد لكل جهاز كمبيوتر. Viminfo غير مرتبط بمشروع معين.

الموقع الافتراضي لـ Viminfo في Unix هو `$HOME/.viminfo` (`~/.viminfo`). إذا كنت تستخدم نظام تشغيل مختلف، قد يكون موقع Viminfo الخاص بك مختلفًا. تحقق من `:h viminfo-file-name`. في كل مرة تقوم بإجراء تغييرات "داخلية"، مثل نسخ نص إلى سجل، يقوم Vim تلقائيًا بتحديث ملف Viminfo.

*تأكد من أنك قد قمت بتعيين خيار `nocompatible` (`set nocompatible`)، وإلا فلن يعمل Viminfo الخاص بك.*

### كتابة وقراءة Viminfo

على الرغم من أنك ستستخدم ملف Viminfo واحد فقط، يمكنك إنشاء ملفات Viminfo متعددة. لكتابة ملف Viminfo، استخدم الأمر `:wviminfo` (`:wv` للاختصار).

```shell
:wv ~/.viminfo_extra
```

للكتابة فوق ملف Viminfo موجود، أضف علامة تعجب إلى أمر `wv`:

```shell
:wv! ~/.viminfo_extra
```

بشكل افتراضي، ستقرأ Vim من ملف `~/.viminfo`. لقراءة من ملف Viminfo مختلف، قم بتشغيل `:rviminfo`، أو `:rv` للاختصار:

```shell
:rv ~/.viminfo_extra
```

لإطلاق Vim مع ملف Viminfo مختلف من الطرفية، استخدم علامة `i`:

```shell
vim -i viminfo_extra
```

إذا كنت تستخدم Vim لمهام مختلفة، مثل البرمجة والكتابة، يمكنك إنشاء Viminfo مخصص للكتابة وآخر للبرمجة.

```shell
vim -i viminfo_writing

vim -i viminfo_coding
```

### بدء Vim بدون Viminfo

للبدء في Vim بدون Viminfo، يمكنك تشغيل من الطرفية:

```shell
vim -i NONE
```

لجعلها دائمة، يمكنك إضافة هذا في ملف vimrc الخاص بك:

```shell
set viminfo="NONE"
```

### تكوين خصائص Viminfo

مماثل لـ `viewoptions` و`sessionoptions`، يمكنك إرشاد ما هي الخصائص التي يجب حفظها مع خيار `viminfo`. قم بتشغيل:

```shell
:set viminfo?
```

ستحصل على:

```shell
!,'100,<50,s10,h
```

هذا يبدو غامضًا. دعنا نفككها:
- `!` يحفظ المتغيرات العالمية التي تبدأ بحرف كبير ولا تحتوي على أحرف صغيرة. تذكر أن `g:` تشير إلى متغير عالمي. على سبيل المثال، إذا كتبت في مرحلة ما التعيين `let g:FOO = "foo"`، سيقوم Viminfo بحفظ المتغير العالمي `FOO`. ومع ذلك، إذا قمت بـ `let g:Foo = "foo"`، فلن يقوم Viminfo بحفظ هذا المتغير العالمي لأنه يحتوي على أحرف صغيرة. بدون `!`، لن يحفظ Vim تلك المتغيرات العالمية.
- `'100` تمثل العلامات. في هذه الحالة، سيقوم Viminfo بحفظ العلامات المحلية (a-z) لأحدث 100 ملف. كن واعيًا أنه إذا أخبرت Viminfo بحفظ الكثير من الملفات، قد يبدأ Vim في التباطؤ. 1000 هو عدد جيد للاحتفاظ به.
- `<50` يخبر Viminfo بعدد الحد الأقصى من السطور التي يتم حفظها لكل سجل (50 في هذه الحالة). إذا قمت بنسخ 100 سطر من النص إلى السجل a (`"ay99j`) وأغلقت Vim، في المرة التالية التي تفتح فيها Vim وتلصق من السجل a (`"ap`)، سيقوم Vim بلصق 50 سطرًا كحد أقصى. إذا لم تعطي عدد السطور الأقصى، *سيتم حفظ* جميع السطور. إذا أعطيته 0، فلن يتم حفظ أي شيء.
- `s10` يحدد حد الحجم (بالكيلوبايت) لسجل. في هذه الحالة، سيتم استبعاد أي سجل يزيد عن 10 كيلوبايت.
- `h` يعطل تمييز (من `hlsearch`) عند بدء Vim.

هناك خيارات أخرى يمكنك تمريرها. لمعرفة المزيد، تحقق من `:h 'viminfo'`.
## استخدام العروض، الجلسات، و Viminfo بطريقة ذكية

يحتوي Vim على العروض، الجلسات، و Viminfo لالتقاط لقطات مختلفة من بيئة Vim الخاصة بك. للمشاريع الصغيرة، استخدم العروض. للمشاريع الأكبر، استخدم الجلسات. يجب أن تأخذ وقتك لاستكشاف جميع الخيارات التي تقدمها العروض، الجلسات، و Viminfo.

أنشئ عرضك الخاص، وجلسة، و Viminfo وفقًا لأسلوب تحريرك الخاص. إذا كنت بحاجة إلى استخدام Vim خارج جهاز الكمبيوتر الخاص بك، يمكنك فقط تحميل إعداداتك وستشعر على الفور وكأنك في منزلك!