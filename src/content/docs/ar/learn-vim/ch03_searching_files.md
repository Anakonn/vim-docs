---
description: هذا الفصل يقدم مقدمة حول كيفية البحث بسرعة في Vim، مما يعزز إنتاجيتك.
  يتناول البحث بدون إضافات ومع إضافة fzf.vim.
title: Ch03. Searching Files
---

هدف هذا الفصل هو إعطائك مقدمة حول كيفية البحث بسرعة في Vim. القدرة على البحث بسرعة هي وسيلة رائعة لبدء إنتاجيتك في Vim. عندما اكتشفت كيفية البحث عن الملفات بسرعة، قمت بالتبديل لاستخدام Vim بدوام كامل.

هذا الفصل مقسم إلى جزئين: كيفية البحث بدون إضافات وكيفية البحث باستخدام إضافة [fzf.vim](https://github.com/junegunn/fzf.vim). لنبدأ!

## فتح وتحرير الملفات

لفتح ملف في Vim، يمكنك استخدام `:edit`.

```shell
:edit file.txt
```

إذا كان `file.txt` موجودًا، فسيتم فتح مخزن `file.txt`. إذا لم يكن `file.txt` موجودًا، فسيتم إنشاء مخزن جديد لـ `file.txt`.

تعمل الإكمال التلقائي مع `<Tab>` مع `:edit`. على سبيل المثال، إذا كان ملفك داخل دليل *مراقب* المستخدمين في [Rails](https://rubyonrails.org/) `./app/controllers/users_controllers.rb`، يمكنك استخدام `<Tab>` لتوسيع المصطلحات بسرعة:

```shell
:edit a<Tab>c<Tab>u<Tab>
```

`:edit` يقبل وسائط wildcards. `*` تطابق أي ملف في الدليل الحالي. إذا كنت تبحث فقط عن الملفات ذات امتداد `.yml` في الدليل الحالي:

```shell
:edit *.yml<Tab>
```

سيعطيك Vim قائمة بجميع ملفات `.yml` في الدليل الحالي للاختيار من بينها.

يمكنك استخدام `**` للبحث بشكل متكرر. إذا كنت تريد البحث عن جميع ملفات `*.md` في مشروعك، لكنك لست متأكدًا في أي الأدلة، يمكنك القيام بذلك:

```shell
:edit **/*.md<Tab>
```

يمكن استخدام `:edit` لتشغيل `netrw`، مستكشف الملفات المدمج في Vim. للقيام بذلك، أعطِ `:edit` وسيط دليل بدلاً من ملف:

```shell
:edit .
:edit test/unit/
```

## البحث عن الملفات باستخدام Find

يمكنك العثور على الملفات باستخدام `:find`. على سبيل المثال:

```shell
:find package.json
:find app/controllers/users_controller.rb
```

تعمل الإكمال التلقائي أيضًا مع `:find`:

```shell
:find p<Tab>                " للعثور على package.json
:find a<Tab>c<Tab>u<Tab>    " للعثور على app/controllers/users_controller.rb
```

قد تلاحظ أن `:find` يبدو مثل `:edit`. ما الفرق؟

## Find و Path

الفرق هو أن `:find` يبحث عن الملفات في `path`، بينما `:edit` لا يفعل ذلك. دعنا نتعلم قليلاً عن `path`. بمجرد أن تتعلم كيفية تعديل مساراتك، يمكن أن تصبح `:find` أداة بحث قوية. للتحقق من مساراتك، قم بتنفيذ:

```shell
:set path?
```

بشكل افتراضي، قد تبدو مساراتك كالتالي:

```shell
path=.,/usr/include,,
```

- `.` تعني البحث في دليل الملف المفتوح حاليًا.
- `,` تعني البحث في الدليل الحالي.
- `/usr/include` هو الدليل النموذجي لملفات رأس مكتبات C.

الأولين مهمين في سياقنا والثالث يمكن تجاهله في الوقت الحالي. النقطة هنا هي أنه يمكنك تعديل مساراتك الخاصة، حيث سيبحث Vim عن الملفات. دعنا نفترض أن هيكل مشروعك هو:

```shell
app/
  assets/
  controllers/
    application_controller.rb
    comments_controller.rb
    users_controller.rb
    ...
```

إذا كنت تريد الانتقال إلى `users_controller.rb` من الدليل الجذري، يجب عليك المرور عبر عدة أدلة (والضغط على عدد كبير من الأزرار). غالبًا عند العمل مع إطار عمل، تقضي 90% من وقتك في دليل معين. في هذه الحالة، أنت تهتم فقط بالانتقال إلى دليل `controllers/` بأقل عدد من ضغطات المفاتيح. يمكن أن يختصر إعداد `path` تلك الرحلة.

تحتاج إلى إضافة `app/controllers/` إلى `path` الحالي. إليك كيفية القيام بذلك:

```shell
:set path+=app/controllers/
```

الآن بعد أن تم تحديث مسارك، عندما تكتب `:find u<Tab>`، سيبحث Vim الآن داخل دليل `app/controllers/` عن الملفات التي تبدأ بـ "u".

إذا كان لديك دليل `controllers/` متداخل، مثل `app/controllers/account/users_controller.rb`، فلن يجد Vim `users_controllers`. بدلاً من ذلك، تحتاج إلى إضافة `:set path+=app/controllers/**` لكي تجد الإكمال التلقائي `users_controller.rb`. هذا رائع! الآن يمكنك العثور على مراقب المستخدمين بضغط زر واحد بدلاً من 3.

قد تفكر في إضافة جميع أدلة المشروع حتى عندما تضغط على `tab`، سيبحث Vim في كل مكان عن ذلك الملف، مثل هذا:

```shell
:set path+=$PWD/**
```

`$PWD` هو الدليل الحالي. إذا حاولت إضافة مشروعك بالكامل إلى `path` على أمل جعل جميع الملفات قابلة للوصول عند الضغط على `tab`، على الرغم من أن هذا قد يعمل لمشروع صغير، فإن القيام بذلك سيبطئ بحثك بشكل كبير إذا كان لديك عدد كبير من الملفات في مشروعك. أوصي بإضافة فقط `path` لأكثر الملفات / الأدلة زيارة.

يمكنك إضافة `set path+={your-path-here}` في ملف vimrc الخاص بك. يستغرق تحديث `path` بضع ثوانٍ فقط، ويمكن أن يوفر لك الكثير من الوقت.

## البحث في الملفات باستخدام Grep

إذا كنت بحاجة إلى البحث في الملفات (العثور على عبارات في الملفات)، يمكنك استخدام grep. يحتوي Vim على طريقتين للقيام بذلك:

- grep الداخلي (`:vim`. نعم، يتم تهجئته `:vim`. إنه اختصار لـ `:vimgrep`).
- grep الخارجي (`:grep`).

دعنا نتحدث عن grep الداخلي أولاً. يحتوي `:vim` على الصيغة التالية:

```shell
:vim /pattern/ file
```

- `/pattern/` هو نمط regex لمصطلح البحث الخاص بك.
- `file` هو وسيط الملف. يمكنك تمرير وسائط متعددة. سيبحث Vim عن النمط داخل وسيط الملف. مشابه لـ `:find`، يمكنك تمرير `*` و `**` wildcards.

على سبيل المثال، للبحث عن جميع تكرارات سلسلة "breakfast" داخل جميع ملفات روبي (`.rb`) داخل دليل `app/controllers/`:

```shell
:vim /breakfast/ app/controllers/**/*.rb
```

بعد تشغيل ذلك، سيتم توجيهك إلى النتيجة الأولى. يستخدم أمر البحث `vim` في Vim عملية `quickfix`. لرؤية جميع نتائج البحث، قم بتشغيل `:copen`. هذا يفتح نافذة `quickfix`. إليك بعض أوامر quickfix المفيدة لجعلك منتجًا على الفور:

```shell
:copen        فتح نافذة quickfix
:cclose       إغلاق نافذة quickfix
:cnext        الانتقال إلى الخطأ التالي
:cprevious    الانتقال إلى الخطأ السابق
:colder       الانتقال إلى قائمة الأخطاء القديمة
:cnewer       الانتقال إلى قائمة الأخطاء الأحدث
```

لتعلم المزيد عن quickfix، تحقق من `:h quickfix`.

قد تلاحظ أن تشغيل grep الداخلي (`:vim`) يمكن أن يصبح بطيئًا إذا كان لديك عدد كبير من المطابقات. وذلك لأن Vim يقوم بتحميل كل ملف مطابق في الذاكرة، كما لو كان يتم تحريره. إذا وجد Vim عددًا كبيرًا من الملفات التي تطابق بحثك، فسيقوم بتحميلها جميعًا وبالتالي يستهلك كمية كبيرة من الذاكرة.

دعنا نتحدث عن grep الخارجي. بشكل افتراضي، يستخدم أمر `grep` في الطرفية. للبحث عن "lunch" داخل ملف روبي داخل دليل `app/controllers/`، يمكنك القيام بذلك:

```shell
:grep -R "lunch" app/controllers/
```

لاحظ أنه بدلاً من استخدام `/pattern/`، يتبع بناء جملة grep في الطرفية `"pattern"`. كما يعرض جميع المطابقات باستخدام `quickfix`.

يحدد Vim المتغير `grepprg` لتحديد البرنامج الخارجي الذي سيتم تشغيله عند تنفيذ أمر `:grep` في Vim حتى لا تضطر إلى إغلاق Vim واستدعاء أمر grep في الطرفية. لاحقًا، سأظهر لك كيفية تغيير البرنامج الافتراضي الذي يتم استدعاؤه عند استخدام أمر `:grep` في Vim.

## تصفح الملفات باستخدام Netrw

`netrw` هو مستكشف الملفات المدمج في Vim. إنه مفيد لرؤية هيكل المشروع. لتشغيل `netrw`، تحتاج إلى هذين الإعدادين في ملف `.vimrc` الخاص بك:

```shell
set nocp
filetype plugin on
```

نظرًا لأن `netrw` موضوع واسع، سأغطي فقط الاستخدام الأساسي، لكن يجب أن يكون كافيًا لبدء استخدامك. يمكنك بدء `netrw` عند إطلاق Vim عن طريق تمرير دليل كمعامل بدلاً من ملف. على سبيل المثال:

```shell
vim .
vim src/client/
vim app/controllers/
```

لإطلاق `netrw` من داخل Vim، يمكنك استخدام أمر `:edit` وتمريره معامل دليل بدلاً من اسم ملف:

```shell
:edit .
:edit src/client/
:edit app/controllers/
```

هناك طرق أخرى لإطلاق نافذة `netrw` دون تمرير دليل:

```shell
:Explore     بدء netrw على الملف الحالي
:Sexplore    لا أمزح. بدء netrw على النصف العلوي المنقسم من الشاشة
:Vexplore    بدء netrw على النصف الأيسر المنقسم من الشاشة
```

يمكنك التنقل في `netrw` باستخدام حركات Vim (ستتم تغطية الحركات بعمق في فصل لاحق). إذا كنت بحاجة إلى إنشاء أو حذف أو إعادة تسمية ملف أو دليل، إليك قائمة بأوامر `netrw` المفيدة:

```shell
%    إنشاء ملف جديد
d    إنشاء دليل جديد
R    إعادة تسمية ملف أو دليل
D    حذف ملف أو دليل
```

`:h netrw` شامل جدًا. تحقق منه إذا كان لديك وقت.

إذا وجدت `netrw` مملًا جدًا وتحتاج إلى المزيد من النكهة، فإن [vim-vinegar](https://github.com/tpope/vim-vinegar) هو إضافة جيدة لتحسين `netrw`. إذا كنت تبحث عن مستكشف ملفات مختلف، فإن [NERDTree](https://github.com/preservim/nerdtree) هو بديل جيد. تحقق منها!

## Fzf

الآن بعد أن تعلمت كيفية البحث عن الملفات في Vim باستخدام الأدوات المدمجة، دعنا نتعلم كيفية القيام بذلك باستخدام الإضافات.

أحد الأشياء التي تفعلها محررات النصوص الحديثة بشكل صحيح والتي لم تفعلها Vim هو مدى سهولة العثور على الملفات، خاصة عبر البحث الضبابي. في النصف الثاني من الفصل، سأظهر لك كيفية استخدام [fzf.vim](https://github.com/junegunn/fzf.vim) لجعل البحث في Vim سهلًا وقويًا.

## الإعداد

أولاً، تأكد من أنك قمت بتنزيل [fzf](https://github.com/junegunn/fzf) و[ripgrep](https://github.com/BurntSushi/ripgrep). اتبع التعليمات الموجودة في مستودع GitHub الخاص بهم. يجب أن تكون الأوامر `fzf` و`rg` متاحة الآن بعد التثبيت الناجح.

Ripgrep هو أداة بحث مشابهة لـ grep (ومن هنا جاء الاسم). إنه عمومًا أسرع من grep وله العديد من الميزات المفيدة. Fzf هو أداة بحث ضبابية عامة للأوامر. يمكنك استخدامه مع أي أوامر، بما في ذلك ripgrep. معًا، يشكلان مجموعة أدوات بحث قوية.

لا يستخدم Fzf ripgrep بشكل افتراضي، لذا نحتاج إلى إخبار fzf باستخدام ripgrep عن طريق تعريف متغير `FZF_DEFAULT_COMMAND`. في ملف `.zshrc` الخاص بي (`.bashrc` إذا كنت تستخدم bash)، لدي هذه:

```shell
if type rg &> /dev/null; then
  export FZF_DEFAULT_COMMAND='rg --files'
  export FZF_DEFAULT_OPTS='-m'
fi
```

انتبه إلى `-m` في `FZF_DEFAULT_OPTS`. تتيح لنا هذه الخيار إجراء تحديدات متعددة باستخدام `<Tab>` أو `<Shift-Tab>`. لا تحتاج إلى هذا السطر لجعل fzf يعمل مع Vim، لكنني أعتقد أنه خيار مفيد. سيكون مفيدًا عندما تريد إجراء بحث واستبدال في ملفات متعددة، وهو ما سأغطيه بعد قليل. تقبل أوامر fzf العديد من الخيارات الأخرى، لكنني لن أغطيها هنا. لمعرفة المزيد، تحقق من [مستودع fzf](https://github.com/junegunn/fzf#usage) أو `man fzf`. على الأقل يجب أن يكون لديك `export FZF_DEFAULT_COMMAND='rg'`.

بعد تثبيت fzf وripgrep، دعنا نقوم بإعداد إضافة fzf. أستخدم مدير الإضافات [vim-plug](https://github.com/junegunn/vim-plug) في هذا المثال، لكن يمكنك استخدام أي مديري إضافات.

أضف هذه داخل إضافات `.vimrc` الخاصة بك. تحتاج إلى استخدام إضافة [fzf.vim](https://github.com/junegunn/fzf.vim) (التي أنشأها نفس مؤلف fzf).

```shell
call plug#begin()
Plug 'junegunn/fzf.vim'
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
call plug#end()
```

بعد إضافة هذه الأسطر، ستحتاج إلى فتح `vim` وتشغيل `:PlugInstall`. سيقوم بتثبيت جميع الإضافات التي تم تعريفها في ملف `vimrc` الخاص بك والتي لم يتم تثبيتها. في حالتنا، سيقوم بتثبيت `fzf.vim` و`fzf`.

لمزيد من المعلومات حول هذه الإضافة، يمكنك التحقق من [مستودع fzf.vim](https://github.com/junegunn/fzf/blob/master/README-VIM.md).
## صيغة Fzf

لاستخدام fzf بكفاءة، يجب عليك تعلم بعض الصيغ الأساسية لـ fzf. لحسن الحظ، القائمة قصيرة:

- `^` هو تطابق دقيق مسبق. للبحث عن عبارة تبدأ بـ "مرحبًا": `^مرحبًا`.
- `$` هو تطابق دقيق لاحق. للبحث عن عبارة تنتهي بـ "أصدقائي": `أصدقائي$`.
- `'` هو تطابق دقيق. للبحث عن العبارة "مرحبًا أصدقائي": `'مرحبًا أصدقائي`.
- `|` هو تطابق "أو". للبحث عن "أصدقاء" أو "أعداء": `أصدقاء | أعداء`.
- `!` هو تطابق عكسي. للبحث عن عبارة تحتوي على "مرحبًا" وليس "أصدقائي": `مرحبًا !أصدقائي`

يمكنك مزج هذه الخيارات. على سبيل المثال، `^مرحبًا | ^مرحبًا أصدقائي$` سيبحث عن العبارة التي تبدأ بـ "مرحبًا" أو "مرحبًا" وتنتهي بـ "أصدقائي".

## البحث عن الملفات

للبحث عن الملفات داخل Vim باستخدام ملحق fzf.vim، يمكنك استخدام طريقة `:Files`. قم بتشغيل `:Files` من Vim وسيتم مطالبتك بواجهة بحث fzf.

نظرًا لأنك ستستخدم هذا الأمر بشكل متكرر، من الجيد أن يكون لديك اختصار لوحة مفاتيح له. أنا أخصصه لـ `Ctrl-f`. في ملف vimrc الخاص بي، لدي هذا:

```shell
nnoremap <silent> <C-f> :Files<CR>
```

## البحث داخل الملفات

للبحث داخل الملفات، يمكنك استخدام الأمر `:Rg`.

مرة أخرى، نظرًا لأنك ستستخدم هذا بشكل متكرر، دعنا نخصصه لاختصار لوحة مفاتيح. أنا أخصصه لـ `<Leader>f`. مفتاح `<Leader>` مخصص لـ `\` بشكل افتراضي.

```shell
nnoremap <silent> <Leader>f :Rg<CR>
```

## عمليات البحث الأخرى

يوفر fzf.vim العديد من أوامر البحث الأخرى. لن أستعرض كل واحدة منها هنا، لكن يمكنك الاطلاع عليها [هنا](https://github.com/junegunn/fzf.vim#commands).

إليك كيف تبدو خرائط fzf الخاصة بي:

```shell
nnoremap <silent> <Leader>b :Buffers<CR>
nnoremap <silent> <C-f> :Files<CR>
nnoremap <silent> <Leader>f :Rg<CR>
nnoremap <silent> <Leader>/ :BLines<CR>
nnoremap <silent> <Leader>' :Marks<CR>
nnoremap <silent> <Leader>g :Commits<CR>
nnoremap <silent> <Leader>H :Helptags<CR>
nnoremap <silent> <Leader>hh :History<CR>
nnoremap <silent> <Leader>h: :History:<CR>
nnoremap <silent> <Leader>h/ :History/<CR>
```

## استبدال Grep بـ Rg

كما ذُكر سابقًا، يحتوي Vim على طريقتين للبحث في الملفات: `:vim` و `:grep`. يستخدم `:grep` أداة بحث خارجية يمكنك إعادة تعيينها باستخدام الكلمة الرئيسية `grepprg`. سأوضح لك كيفية تكوين Vim لاستخدام ripgrep بدلاً من grep في الطرفية عند تشغيل الأمر `:grep`.

الآن دعنا نعد `grepprg` بحيث يستخدم الأمر `:grep` في Vim ripgrep. أضف هذا في ملف vimrc الخاص بك:

```shell
set grepprg=rg\ --vimgrep\ --smart-case\ --follow
```

لا تتردد في تعديل بعض الخيارات أعلاه! لمزيد من المعلومات حول ما تعنيه الخيارات أعلاه، تحقق من `man rg`.

بعد تحديثك لـ `grepprg`، الآن عندما تقوم بتشغيل `:grep`، فإنه يقوم بتشغيل `rg --vimgrep --smart-case --follow` بدلاً من `grep`. إذا كنت ترغب في البحث عن "دونات" باستخدام ripgrep، يمكنك الآن تشغيل أمر أكثر إيجازًا `:grep "دونات"` بدلاً من `:grep "دونات" . -R`

تمامًا مثل `:grep` القديمة، يستخدم هذا الأمر الجديد `:grep` أيضًا quickfix لعرض النتائج.

قد تتساءل، "حسنًا، هذا جميل لكنني لم أستخدم `:grep` في Vim، بالإضافة إلى أنه لا يمكنني استخدام `:Rg` للعثور على العبارات في الملفات؟ متى سأحتاج إلى استخدام `:grep`؟

هذا سؤال جيد جدًا. قد تحتاج إلى استخدام `:grep` في Vim للقيام بعمليات البحث والاستبدال في ملفات متعددة، والتي سأغطيها لاحقًا.

## البحث والاستبدال في ملفات متعددة

تجعل محررات النصوص الحديثة مثل VSCode من السهل جدًا البحث واستبدال سلسلة عبر ملفات متعددة. في هذا القسم، سأوضح لك طريقتين مختلفتين للقيام بذلك بسهولة في Vim.

الطريقة الأولى هي استبدال *جميع* العبارات المطابقة في مشروعك. ستحتاج إلى استخدام `:grep`. إذا كنت ترغب في استبدال جميع حالات "بيتزا" بـ "دونات"، إليك ما يجب عليك فعله:

```shell
:grep "بيتزا"
:cfdo %s/بيتزا/دونات/g | update
```

دعنا نفصل الأوامر:

1. `:grep بيتزا` يستخدم ripgrep للبحث عن جميع حالات "بيتزا" (بالمناسبة، سيظل هذا يعمل حتى لو لم تقم بإعادة تعيين `grepprg` لاستخدام ripgrep. كان عليك أن تفعل `:grep "بيتزا" . -R` بدلاً من `:grep "بيتزا"`).
2. `:cfdo` ينفذ أي أمر تمرره لجميع الملفات في قائمة quickfix الخاصة بك. في هذه الحالة، الأمر الخاص بك هو أمر الاستبدال `%s/بيتزا/دونات/g`. الأنبوب (`|`) هو عامل سلسلة. أمر `update` يحفظ كل ملف بعد الاستبدال. سأغطي أمر الاستبدال بمزيد من العمق في فصل لاحق.

الطريقة الثانية هي البحث والاستبدال في الملفات المحددة. باستخدام هذه الطريقة، يمكنك اختيار الملفات التي تريد إجراء البحث والاستبدال عليها يدويًا. إليك ما يجب عليك فعله:

1. قم بتفريغ المخازن أولاً. من الضروري أن تحتوي قائمة المخازن الخاصة بك على الملفات التي تريد تطبيق الاستبدال عليها فقط. يمكنك إما إعادة تشغيل Vim أو تشغيل الأمر `:%bd | e#` (حيث يقوم `%bd` بحذف جميع المخازن و `e#` يفتح الملف الذي كنت عليه للتو).
2. قم بتشغيل `:Files`.
3. حدد جميع الملفات التي تريد إجراء البحث والاستبدال عليها. لتحديد ملفات متعددة، استخدم `<Tab>` / `<Shift-Tab>`. هذا ممكن فقط إذا كان لديك علامة متعددة (`-m`) في `FZF_DEFAULT_OPTS`.
4. قم بتشغيل `:bufdo %s/بيتزا/دونات/g | update`. يبدو الأمر `:bufdo %s/بيتزا/دونات/g | update` مشابهًا للأمر السابق `:cfdo %s/بيتزا/دونات/g | update`. الفرق هو أنه بدلاً من استبدال جميع إدخالات quickfix (`:cfdo`)، تقوم باستبدال جميع إدخالات المخزن (`:bufdo`).

## تعلم البحث بالطريقة الذكية

البحث هو الخبز والزبدة في تحرير النصوص. سيساعدك تعلم كيفية البحث بشكل جيد في Vim على تحسين سير عمل تحرير النصوص لديك بشكل كبير.

Fzf.vim هو تغيير لقواعد اللعبة. لا أستطيع تخيل استخدام Vim بدونه. أعتقد أنه من المهم جدًا أن يكون لديك أداة بحث جيدة عند بدء استخدام Vim. لقد رأيت أشخاصًا يكافحون للانتقال إلى Vim لأنه يبدو أنه يفتقر إلى ميزات حيوية تمتلكها محررات النصوص الحديثة، مثل ميزة البحث السهلة والقوية. آمل أن يساعدك هذا الفصل في جعل الانتقال إلى Vim أسهل.

لقد رأيت أيضًا قابلية توسيع Vim في العمل - القدرة على توسيع وظيفة البحث باستخدام ملحق وبرنامج خارجي. في المستقبل، تذكر ما الميزات الأخرى التي ترغب في توسيع Vim بها. من المحتمل أن تكون موجودة بالفعل في Vim، أو أن شخصًا ما قد أنشأ ملحقًا لها، أو أن هناك برنامجًا لها بالفعل. في المرة القادمة، ستتعلم عن موضوع مهم جدًا في Vim: قواعد Vim.