---
description: يستعرض هذا المستند أنواع المتغيرات في Vim، بما في ذلك المتغيرات القابلة
  للتغيير والثابتة، بالإضافة إلى مصادر المتغيرات ونطاقاتها.
title: Ch27. Vimscript Variable Scopes
---

قبل الغوص في دوال Vimscript، دعنا نتعلم عن المصادر والنطاقات المختلفة لمتغيرات Vim.

## المتغيرات القابلة للتغيير وغير القابلة للتغيير

يمكنك تعيين قيمة لمتغير في Vim باستخدام `let`:

```shell
let pancake = "pancake"
```

لاحقًا يمكنك استدعاء ذلك المتغير في أي وقت.

```shell
echo pancake
" يعيد "pancake"
```

`let` قابل للتغيير، مما يعني أنه يمكنك تغيير القيمة في أي وقت في المستقبل.

```shell
let pancake = "pancake"
let pancake = "not waffles"

echo pancake
" يعيد "not waffles"
```

لاحظ أنه عندما تريد تغيير قيمة متغير تم تعيينه، لا يزال يتعين عليك استخدام `let`.

```shell
let beverage = "milk"

beverage = "orange juice"
" يثير خطأ
```

يمكنك تعريف متغير غير قابل للتغيير باستخدام `const`. كونه غير قابل للتغيير، بمجرد تعيين قيمة لمتغير، لا يمكنك إعادة تعيينه بقيمة مختلفة.

```shell
const waffle = "waffle"
const waffle = "pancake"
" يثير خطأ
```

## مصادر المتغيرات

هناك ثلاثة مصادر للمتغيرات: متغير البيئة، متغير الخيار، ومتغير السجل.

### متغير البيئة

يمكن لـ Vim الوصول إلى متغير البيئة في الطرفية الخاصة بك. على سبيل المثال، إذا كان لديك متغير البيئة `SHELL` متاح في الطرفية الخاصة بك، يمكنك الوصول إليه من Vim باستخدام:

```shell
echo $SHELL
" يعيد قيمة $SHELL. في حالتي، يعيد /bin/bash
```

### متغير الخيار

يمكنك الوصول إلى خيارات Vim باستخدام `&` (هذه هي الإعدادات التي تصل إليها باستخدام `set`).

على سبيل المثال، لرؤية ما هو الخلفية التي يستخدمها Vim، يمكنك تشغيل:

```shell
echo &background
" يعيد إما "light" أو "dark"
```

بدلاً من ذلك، يمكنك دائمًا تشغيل `set background?` لرؤية قيمة خيار `background`.

### متغير السجل

يمكنك الوصول إلى سجلات Vim (الفصل 08) باستخدام `@`.

افترض أن القيمة "chocolate" محفوظة بالفعل في السجل a. للوصول إليها، يمكنك استخدام `@a`. يمكنك أيضًا تحديثها باستخدام `let`.

```shell
echo @a
" يعيد chocolate

let @a .= " donut"

echo @a
" يعيد "chocolate donut"
```

الآن عندما تلصق من السجل `a` (`"ap`)، سيعيد "chocolate donut". العامل `.=` يدمج سلسلتين. التعبير `let @a .= " donut"` هو نفس `let @a = @a . " donut"`

## نطاقات المتغيرات

هناك 9 نطاقات مختلفة للمتغيرات في Vim. يمكنك التعرف عليها من خلال حرفها المسبق:

```shell
g:           متغير عالمي
{nothing}    متغير عالمي
b:           متغير محلي في المخزن المؤقت
w:           متغير محلي في النافذة
t:           متغير محلي في التبويب
s:           متغير Vimscript المصدر
l:           متغير محلي في الدالة
a:           متغير معلمة رسمية في الدالة
v:           متغير مدمج في Vim
```

### المتغير العالمي

عند إعلان متغير "عادي":

```shell
let pancake = "pancake"
```

`pancake` هو في الواقع متغير عالمي. عندما تعرف متغيرًا عالميًا، يمكنك استدعاؤه من أي مكان.

إضافة `g:` إلى متغير أيضًا ينشئ متغيرًا عالميًا.

```shell
let g:waffle = "waffle"
```

في هذه الحالة، كل من `pancake` و `g:waffle` لهما نفس النطاق. يمكنك استدعاء كل منهما مع أو بدون `g:`.

```shell
echo pancake
" يعيد "pancake"

echo g:pancake
" يعيد "pancake"

echo waffle
" يعيد "waffle"

echo g:waffle
" يعيد "waffle"
```

### متغير المخزن المؤقت

متغير يسبقه `b:` هو متغير مخزن مؤقت. متغير المخزن المؤقت هو متغير محلي للمخزن المؤقت الحالي (الفصل 02). إذا كان لديك عدة مخازن مؤقتة مفتوحة، سيكون لكل مخزن مؤقت قائمته الخاصة من المتغيرات.

في المخزن المؤقت 1:

```shell
const b:donut = "chocolate donut"
```

في المخزن المؤقت 2:

```shell
const b:donut = "blueberry donut"
```

إذا قمت بتشغيل `echo b:donut` من المخزن المؤقت 1، سيعيد "chocolate donut". إذا قمت بتشغيله من المخزن المؤقت 2، سيعيد "blueberry donut".

على هامش، يحتوي Vim على متغير مخزن مؤقت *خاص* `b:changedtick` الذي يتتبع جميع التغييرات التي تم إجراؤها على المخزن المؤقت الحالي.

1. قم بتشغيل `echo b:changedtick` ولاحظ الرقم الذي يعيده.
2. قم بإجراء تغييرات في Vim.
3. قم بتشغيل `echo b:changedtick` مرة أخرى ولاحظ الرقم الذي يعيده الآن.

### متغير النافذة

متغير يسبقه `w:` هو متغير نافذة. يوجد فقط في تلك النافذة.

في النافذة 1:

```shell
const w:donut = "chocolate donut"
```

في النافذة 2:

```shell
const w:donut = "raspberry donut"
```

في كل نافذة، يمكنك استدعاء `echo w:donut` للحصول على قيم فريدة.

### متغير التبويب

متغير يسبقه `t:` هو متغير تبويب. يوجد فقط في ذلك التبويب.

في التبويب 1:

```shell
const t:donut = "chocolate donut"
```

في التبويب 2:

```shell
const t:donut = "blackberry donut"
```

في كل تبويب، يمكنك استدعاء `echo t:donut` للحصول على قيم فريدة.

### متغير السكربت

متغير يسبقه `s:` هو متغير سكربت. يمكن الوصول إلى هذه المتغيرات فقط من داخل ذلك السكربت.

إذا كان لديك ملف عشوائي `dozen.vim` وداخلها لديك:

```shell
let s:dozen = 12

function Consume()
  let s:dozen -= 1
  echo s:dozen " متبقي"
endfunction
```

قم بمصدر الملف باستخدام `:source dozen.vim`. الآن استدعِ دالة `Consume`:

```shell
:call Consume()
" يعيد "11 متبقي"

:call Consume()
" يعيد "10 متبقي"

:echo s:dozen
" خطأ في المتغير غير معرف
```

عندما تستدعي `Consume`، ترى أنها تنقص قيمة `s:dozen` كما هو متوقع. عندما تحاول الحصول على قيمة `s:dozen` مباشرة، لن يجدها Vim لأنك خارج النطاق. `s:dozen` يمكن الوصول إليها فقط من داخل `dozen.vim`.

في كل مرة تقوم فيها بمصدر ملف `dozen.vim`، يتم إعادة تعيين عداد `s:dozen`. إذا كنت في منتصف تقليل قيمة `s:dozen` وقمت بتشغيل `:source dozen.vim`، يتم إعادة تعيين العداد إلى 12. يمكن أن تكون هذه مشكلة للمستخدمين غير المدركين. لإصلاح هذه المشكلة، قم بإعادة هيكلة الكود:

```shell
if !exists("s:dozen")
  let s:dozen = 12
endif

function Consume()
  let s:dozen -= 1
  echo s:dozen
endfunction
```

الآن عندما تقوم بمصدر `dozen.vim` أثناء تقليل، يقرأ Vim `!exists("s:dozen")`، ويجد أنها صحيحة، ولا يعيد تعيين القيمة إلى 12.

### المتغير المحلي في الدالة ومتغير المعلمة الرسمية في الدالة

سيتم تغطية كل من المتغير المحلي في الدالة (`l:`) والمتغير الرسمي في الدالة (`a:`) في الفصل التالي.

### المتغيرات المدمجة في Vim

متغير يسبقه `v:` هو متغير مدمج خاص في Vim. لا يمكنك تعريف هذه المتغيرات. لقد رأيت بعضها بالفعل.
- `v:version` يخبرك بإصدار Vim الذي تستخدمه.
- `v:key` يحتوي على قيمة العنصر الحالي عند التكرار عبر قاموس.
- `v:val` يحتوي على قيمة العنصر الحالي عند تشغيل عملية `map()` أو `filter()`.
- `v:true`، `v:false`، `v:null`، و `v:none` هي أنواع بيانات خاصة.

هناك متغيرات أخرى. للحصول على قائمة بالمتغيرات المدمجة في Vim، تحقق من `:h vim-variable` أو `:h v:`.

## استخدام نطاقات متغيرات Vim بطريقة ذكية

يمكن أن يمنحك الوصول السريع إلى متغيرات البيئة، ومتغيرات الخيار، ومتغيرات السجل مرونة واسعة لتخصيص محررك وبيئة الطرفية الخاصة بك. لقد تعلمت أيضًا أن Vim يحتوي على 9 نطاقات مختلفة للمتغيرات، كل منها موجود تحت قيود معينة. يمكنك الاستفادة من هذه الأنواع الفريدة من المتغيرات لفصل برنامجك.

لقد وصلت إلى هذه النقطة. لقد تعلمت عن أنواع البيانات، ووسائل الجمع، ونطاقات المتغيرات. تبقى شيء واحد فقط: الدوال.