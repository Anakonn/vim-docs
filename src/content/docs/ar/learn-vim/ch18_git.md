---
description: هذا المستند يشرح كيفية دمج أدوات Vim و Git، مع التركيز على استخدام الأمر
  vimdiff لمقارنة الملفات واكتشاف الاختلافات بينها.
title: Ch18. Git
---

Vim و git هما أداتان رائعتان لشيئين مختلفين. Git هو أداة للتحكم في الإصدارات. Vim هو محرر نصوص.

في هذا الفصل، ستتعلم طرقًا مختلفة لدمج Vim و git معًا.

## المقارنة

تذكر في الفصل السابق، يمكنك تشغيل أمر `vimdiff` لعرض الفروقات بين عدة ملفات.

افترض أن لديك ملفين، `file1.txt` و `file2.txt`.

داخل `file1.txt`:

```shell
pancakes
waffles
apples

milk
apple juice

yogurt
```

داخل `file2.txt`:

```shell
pancakes
waffles
oranges

milk
orange juice

yogurt
```

لرؤية الفروقات بين كلا الملفين، قم بتشغيل:

```shell
vimdiff file1.txt file2.txt
```

بدلاً من ذلك يمكنك تشغيل:

```shell
vim -d file1.txt file2.txt
```

يعرض `vimdiff` نافذتين جنبًا إلى جنب. على اليسار هو `file1.txt` وعلى اليمين هو `file2.txt`. يتم تمييز أول الفروقات (التفاح والبرتقال) على كلا السطرين.

افترض أنك تريد جعل النافذة الثانية تحتوي على التفاح، وليس البرتقال. لنقل المحتوى من موقعك الحالي (أنت حاليًا على `file1.txt`) إلى `file2.txt`، أولاً انتقل إلى الفرق التالي باستخدام `]c` (للانتقال إلى نافذة الفرق السابقة، استخدم `[c`). يجب أن يكون المؤشر على التفاح الآن. قم بتشغيل `:diffput`. يجب أن تحتوي كلا الملفين الآن على التفاح.

إذا كنت بحاجة إلى نقل النص من النافذة الأخرى (عصير البرتقال، `file2.txt`) لاستبدال النص في النافذة الحالية (عصير التفاح، `file1.txt`)، مع بقاء المؤشر على نافذة `file1.txt`، انتقل أولاً إلى الفرق التالي باستخدام `]c`. يجب أن يكون المؤشر الآن على عصير التفاح. قم بتشغيل `:diffget` للحصول على عصير البرتقال من نافذة أخرى لاستبدال عصير التفاح في نافذتنا.

`:diffput` *يضع* النص من النافذة الحالية في نافذة أخرى. `:diffget` *يحصل* على النص من نافذة أخرى إلى النافذة الحالية.

إذا كان لديك عدة نوافذ، يمكنك تشغيل `:diffput fileN.txt` و `:diffget fileN.txt` لاستهداف نافذة fileN.

## Vim كأداة دمج

> "أحب حل تعارضات الدمج!" - لا أحد

لا أعرف أي شخص يحب حل تعارضات الدمج. ومع ذلك، فهي حتمية. في هذا القسم، ستتعلم كيفية استخدام Vim كأداة لحل تعارضات الدمج.

أولاً، قم بتغيير أداة الدمج الافتراضية لاستخدام `vimdiff` عن طريق تشغيل:

```shell
git config merge.tool vimdiff
git config merge.conflictstyle diff3
git config mergetool.prompt false
```

بدلاً من ذلك، يمكنك تعديل `~/.gitconfig` مباشرة (بشكل افتراضي يجب أن تكون في الجذر، ولكن قد تكون في مكان مختلف). يجب أن تعدل الأوامر أعلاه gitconfig الخاص بك ليبدو مثل الإعداد أدناه، إذا لم تقم بتشغيلها بالفعل، يمكنك أيضًا تحرير gitconfig يدويًا.

```shell
[core]
  editor = vim
[merge]
  tool = vimdiff
  conflictstyle = diff3
[difftool]
  prompt = false
```

لنقم بإنشاء تعارض دمج وهمي لاختبار ذلك. أنشئ دليلًا `/food` واجعله مستودع git:

```shell
git init
```

أضف ملفًا، `breakfast.txt`. داخل:

```shell
pancakes
waffles
oranges
```

أضف الملف وارتكب التغيير:

```shell
git add .
git commit -m "Initial breakfast commit"
```

بعد ذلك، أنشئ فرعًا جديدًا وسمه فرع التفاح:

```shell
git checkout -b apples
```

قم بتغيير `breakfast.txt`:

```shell
pancakes
waffles
apples
```

احفظ الملف، ثم أضف وارتكب التغيير:

```shell
git add .
git commit -m "Apples not oranges"
```

رائع. الآن لديك البرتقال في الفرع الرئيسي والتفاح في فرع التفاح. دعنا نعود إلى الفرع الرئيسي:

```shell
git checkout master
```

داخل `breakfast.txt`، يجب أن ترى النص الأساسي، البرتقال. دعنا نغيره إلى العنب لأنه في الموسم الآن:

```shell
pancakes
waffles
grapes
```

احفظ، أضف، وارتكب:

```shell
git add .
git commit -m "Grapes not oranges"
```

الآن أنت جاهز لدمج فرع التفاح في الفرع الرئيسي:

```shell
git merge apples
```

يجب أن ترى خطأ:

```shell
Auto-merging breakfast.txt
CONFLICT (content): Merge conflict in breakfast.txt
Automatic merge failed; fix conflicts and then commit the result.
```

تعارض، رائع! دعنا نحل التعارض باستخدام أداة الدمج التي قمنا بتكوينها حديثًا. قم بتشغيل:

```shell
git mergetool
```

يعرض Vim أربع نوافذ. انتبه إلى الثلاثة العليا:

- `LOCAL` تحتوي على `grapes`. هذا هو التغيير في "المحلي"، ما تقوم بالدمج فيه.
- `BASE` تحتوي على `oranges`. هذا هو السلف المشترك بين `LOCAL` و `REMOTE` لمقارنة كيفية انقسامهما.
- `REMOTE` تحتوي على `apples`. هذا هو ما يتم دمجه.

في الأسفل (النافذة الرابعة) ترى:

```shell
pancakes
waffles
<<<<<<< HEAD
grapes
||||||| db63958
oranges
=======
apples
>>>>>>> apples
```

تحتوي النافذة الرابعة على نصوص تعارض الدمج. مع هذا الإعداد، من الأسهل رؤية ما التغيير الذي يمتلكه كل بيئة. يمكنك رؤية المحتوى من `LOCAL` و `BASE` و `REMOTE` في نفس الوقت.

يجب أن يكون المؤشر على النافذة الرابعة، في المنطقة المميزة. للحصول على التغيير من `LOCAL` (العنب)، قم بتشغيل `:diffget LOCAL`. للحصول على التغيير من `BASE` (البرتقال)، قم بتشغيل `:diffget BASE` وللحصول على التغيير من `REMOTE` (التفاح)، قم بتشغيل `:diffget REMOTE`.

في هذه الحالة، دعنا نحصل على التغيير من `LOCAL`. قم بتشغيل `:diffget LOCAL`. ستحتوي النافذة الرابعة الآن على العنب. احفظ واخرج من جميع الملفات (`:wqall`) عندما تنتهي. لم يكن ذلك سيئًا، أليس كذلك؟

إذا لاحظت، لديك أيضًا ملف `breakfast.txt.orig` الآن. يقوم Git بإنشاء ملف نسخ احتياطي في حالة عدم سير الأمور على ما يرام. إذا كنت لا تريد أن يقوم git بإنشاء نسخة احتياطية أثناء الدمج، قم بتشغيل:

```shell
git config --global mergetool.keepBackup false
```

## Git داخل Vim

لا يحتوي Vim على ميزة git مدمجة. إحدى الطرق لتشغيل أوامر git من Vim هي استخدام عامل bang، `!`، في وضع سطر الأوامر.

يمكن تشغيل أي أمر git باستخدام `!`:

```shell
:!git status
:!git commit
:!git diff
:!git push origin master
```

يمكنك أيضًا استخدام `%` (الملف الحالي) أو `#` (الملف الآخر) في Vim:

```shell
:!git add %         " git add الملف الحالي
:!git checkout #    " git checkout الملف الآخر
```

يمكنك استخدام خدعة Vim لإضافة ملفات متعددة في نوافذ Vim مختلفة عن طريق تشغيل:

```shell
:windo !git add %
```

ثم قم بارتكاب التغيير:

```shell
:!git commit "Just git-added everything in my Vim window, cool"
```

أمر `windo` هو أحد أوامر "افعل" في Vim، مشابه لـ `argdo` الذي رأيته سابقًا. يقوم `windo` بتنفيذ الأمر على كل نافذة.

بدلاً من ذلك، يمكنك أيضًا استخدام `bufdo !git add %` لإضافة جميع النوافذ أو `argdo !git add %` لإضافة جميع ملفات الحجج، اعتمادًا على سير عملك.

## الإضافات

هناك العديد من إضافات Vim لدعم git. أدناه قائمة ببعض الإضافات الشائعة المتعلقة بـ git لـ Vim (ربما يوجد المزيد في الوقت الذي تقرأ فيه هذا):

- [vim-gitgutter](https://github.com/airblade/vim-gitgutter)
- [vim-signify](https://github.com/mhinz/vim-signify)
- [vim-fugitive](https://github.com/tpope/vim-fugitive)
- [gv.vim](https://github.com/junegunn/gv.vim)
- [vimagit](https://github.com/jreybert/vimagit)
- [vim-twiggy](https://github.com/sodapopcan/vim-twiggy)
- [rhubarb](https://github.com/tpope/vim-rhubarb)

واحدة من الأكثر شعبية هي vim-fugitive. لبقية الفصل، سأستعرض عدة سير عمل git باستخدام هذه الإضافة.

## Vim-fugitive

تسمح لك إضافة vim-fugitive بتشغيل واجهة سطر أوامر git دون مغادرة محرر Vim. ستجد أن بعض الأوامر أفضل عند تنفيذها من داخل Vim.

للبدء، قم بتثبيت vim-fugitive باستخدام مدير إضافات Vim ([vim-plug](https://github.com/junegunn/vim-plug)، [vundle](https://github.com/VundleVim/Vundle.vim)، [dein.vim](https://github.com/Shougo/dein.vim)، إلخ).

## حالة Git

عند تشغيل الأمر `:Git` بدون أي معلمات، يعرض vim-fugitive نافذة ملخص git. تظهر الملفات غير المتعقبة، وغير المهيأة، والمهيأة. أثناء وجودك في وضع "`git status`"، يمكنك القيام بعدة أشياء:
- `Ctrl-N` / `Ctrl-P` للانتقال لأعلى أو لأسفل قائمة الملفات.
- `-` لتهيئة أو إزالة تهيئة اسم الملف تحت المؤشر.
- `s` لتهيئة اسم الملف تحت المؤشر.
- `u` لإزالة تهيئة اسم الملف تحت المؤشر.
- `>` / `<` لعرض أو إخفاء فرق داخلي لاسم الملف تحت المؤشر.

للمزيد، تحقق من `:h fugitive-staging-maps`.

## Git Blame

عند تشغيل الأمر `:Git blame` من الملف الحالي، يعرض vim-fugitive نافذة بلوم مقسمة. يمكن أن يكون هذا مفيدًا للعثور على الشخص المسؤول عن كتابة ذلك السطر المليء بالأخطاء حتى تتمكن من الصراخ عليه / عليها (أمزح فقط).

بعض الأشياء التي يمكنك القيام بها أثناء وجودك في وضع `"git blame"`:
- `q` لإغلاق نافذة البلوم.
- `A` لتغيير حجم عمود المؤلف.
- `C` لتغيير حجم عمود الالتزام.
- `D` لتغيير حجم عمود التاريخ / الوقت.

للمزيد، تحقق من `:h :Git_blame`.

## Gdiffsplit

عند تشغيل الأمر `:Gdiffsplit`، يقوم vim-fugitive بتشغيل `vimdiff` لأحدث تغييرات الملف الحالي مقابل الفهرس أو شجرة العمل. إذا قمت بتشغيل `:Gdiffsplit <commit>`، يقوم vim-fugitive بتشغيل `vimdiff` ضد ذلك الملف داخل `<commit>`.

نظرًا لأنك في وضع `vimdiff`، يمكنك *الحصول* أو *وضع* الفرق باستخدام `:diffput` و `:diffget`.

## Gwrite و Gread

عند تشغيل الأمر `:Gwrite` في ملف بعد إجراء تغييرات، يقوم vim-fugitive بتهيئة التغييرات. إنه مثل تشغيل `git add <current-file>`.

عند تشغيل الأمر `:Gread` في ملف بعد إجراء تغييرات، يقوم vim-fugitive باستعادة الملف إلى الحالة السابقة للتغييرات. إنه مثل تشغيل `git checkout <current-file>`. إحدى مزايا تشغيل `:Gread` هي أن الإجراء يمكن التراجع عنه. إذا، بعد تشغيل `:Gread`، غيرت رأيك وتريد الاحتفاظ بالتغيير القديم، يمكنك فقط تشغيل التراجع (`u`) وسيتراجع Vim عن إجراء `:Gread`. لن يكون ذلك ممكنًا إذا كنت قد قمت بتشغيل `git checkout <current-file>` من واجهة سطر الأوامر.

## Gclog

عند تشغيل الأمر `:Gclog`، يعرض vim-fugitive تاريخ الالتزام. إنه مثل تشغيل الأمر `git log`. يستخدم vim-fugitive ميزة quickfix في Vim لتحقيق ذلك، لذا يمكنك استخدام `:cnext` و `:cprevious` للتنقل إلى معلومات السجل التالية أو السابقة. يمكنك فتح وإغلاق قائمة السجل باستخدام `:copen` و `:cclose`.

أثناء وجودك في وضع `"git log"`، يمكنك القيام بشيئين:
- عرض الشجرة.
- زيارة الأصل (الالتزام السابق).

يمكنك تمرير معلمات إلى `:Gclog` تمامًا مثل أمر `git log`. إذا كان مشروعك يحتوي على تاريخ التزام طويل وتحتاج فقط إلى عرض آخر ثلاثة التزامات، يمكنك تشغيل `:Gclog -3`. إذا كنت بحاجة إلى تصفيته بناءً على تاريخ الملتزم، يمكنك تشغيل شيء مثل `:Gclog --after="January 1" --before="March 14"`.

## المزيد عن Vim-fugitive

هذه ليست سوى بعض الأمثلة على ما يمكن أن تفعله vim-fugitive. لمعرفة المزيد عن vim-fugitive، تحقق من `:h fugitive.txt`. من المحتمل أن تكون معظم أوامر git الشائعة محسّنة باستخدام vim-fugitive. عليك فقط البحث عنها في الوثائق.

إذا كنت داخل أحد "الأوضاع الخاصة" لـ vim-fugitive (على سبيل المثال، داخل وضع `:Git` أو `:Git blame`) وترغب في معرفة الاختصارات المتاحة، اضغط على `g؟`. سيعرض vim-fugitive نافذة `:help` المناسبة للوضع الذي أنت فيه. رائع!
## تعلم فيم وجيت بالطريقة الذكية

قد تجد vim-fugitive مكملًا جيدًا لأسلوب عملك (أو لا). على أي حال، أود أن أشجعك بشدة على الاطلاع على جميع الإضافات المذكورة أعلاه. من المحتمل أن تكون هناك إضافات أخرى لم أذكرها. جربها.

إحدى الطرق الواضحة لتحسين تكامل فيم مع جيت هي قراءة المزيد عن جيت. جيت، في حد ذاته، موضوع شاسع وأنا أظهر فقط جزءًا منه. مع ذلك، دعنا نبدأ *الجيت* (عذرًا على التلاعب بالألفاظ) ونتحدث عن كيفية استخدام فيم لتجميع كودك!