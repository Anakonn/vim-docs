---
description: تعلم كيفية استخدام خاصية الطي في فيم لإخفاء النصوص غير الضرورية، مما
  يسهل فهم محتوى الملفات بشكل أفضل.
title: Ch17. Fold
---

عندما تقرأ ملفًا، غالبًا ما توجد نصوص غير ذات صلة تعيق فهمك لما يفعله ذلك الملف. لإخفاء الضوضاء غير الضرورية، استخدم طي Vim.

في هذا الفصل، ستتعلم طرقًا مختلفة لطي ملف.

## الطي اليدوي

تخيل أنك تطوي ورقة لتغطية بعض النصوص. النص الفعلي لا يختفي، بل لا يزال موجودًا. يعمل طي Vim بنفس الطريقة. إنه يطوي نطاقًا من النص، مخفيًا إياه عن العرض دون حذفه فعليًا.

عامل الطي هو `z` (عندما تكون الورقة مطوية، تأخذ شكل الحرف z).

افترض أن لديك هذا النص:

```shell
Fold me
Hold me
```

مع المؤشر في السطر الأول، اكتب `zfj`. يقوم Vim بطي كلا السطرين في واحد. يجب أن ترى شيئًا مثل هذا:

```shell
+-- 2 lines: Fold me -----
```

إليك التفصيل:
- `zf` هو عامل الطي.
- `j` هو الحركة لعامل الطي.

يمكنك فتح نص مطوي باستخدام `zo`. لإغلاق الطي، استخدم `zc`.

الطي هو عامل، لذا فإنه يتبع قاعدة القواعد (`فعل + اسم`). يمكنك تمرير عامل الطي مع حركة أو كائن نصي. لطي فقرة داخلية، قم بتشغيل `zfip`. لطي حتى نهاية الملف، قم بتشغيل `zfG`. لطي النصوص بين `{` و `}`، قم بتشغيل `zfa{`.

يمكنك الطي من وضع العرض. قم بتسليط الضوء على المنطقة التي تريد طيها (`v`، `V`، أو `Ctrl-v`)، ثم قم بتشغيل `zf`.

يمكنك تنفيذ الطي من وضع سطر الأوامر باستخدام الأمر `:fold`. لطي السطر الحالي والسطر الذي يليه، قم بتشغيل:

```shell
:,+1fold
```

`,+1` هو النطاق. إذا لم تمرر معلمات للنطاق، فإنه يتجه افتراضيًا إلى السطر الحالي. `+1` هو مؤشر النطاق للسطر التالي. لطي السطور من 5 إلى 10، قم بتشغيل `:5,10fold`. لطي من الموضع الحالي إلى نهاية السطر، قم بتشغيل `:,$fold`.

هناك العديد من أوامر الطي والفك الأخرى. أجدها كثيرة جدًا لتذكرها عند البدء. الأكثر فائدة هي:
- `zR` لفتح جميع الطيات.
- `zM` لإغلاق جميع الطيات.
- `za` لتبديل حالة الطي.

يمكنك تشغيل `zR` و `zM` على أي سطر، لكن `za` يعمل فقط عندما تكون على سطر مطوي / مفكوك. لمعرفة المزيد من أوامر الطي، تحقق من `:h fold-commands`.

## طرق الطي المختلفة

تغطي القسم أعلاه طي Vim اليدوي. هناك ست طرق مختلفة للطي في Vim:
1. يدوي
2. مسافة بادئة
3. تعبير
4. بناء جملة
5. فرق
6. علامة

لرؤية أي طريقة طي تستخدمها حاليًا، قم بتشغيل `:set foldmethod?`. بشكل افتراضي، يستخدم Vim طريقة `manual`.

في بقية الفصل، ستتعلم الطرق الخمس الأخرى للطي. لنبدأ مع الطي بالمسافة البادئة.

## الطي بالمسافة البادئة

لاستخدام الطي بالمسافة البادئة، قم بتغيير `'foldmethod'` إلى المسافة البادئة:

```shell
:set foldmethod=indent
```

افترض أن لديك النص:

```shell
One
  Two
  Two again
```

إذا قمت بتشغيل `:set foldmethod=indent`، سترى:

```shell
One
+-- 2 lines: Two -----
```

مع الطي بالمسافة البادئة، ينظر Vim إلى عدد المسافات التي يحتوي عليها كل سطر في البداية ويقارنها مع خيار `'shiftwidth'` لتحديد قابليته للطي. تعيد `'shiftwidth'` عدد المسافات المطلوبة لكل خطوة من المسافة البادئة. إذا قمت بتشغيل:

```shell
:set shiftwidth?
```

تكون القيمة الافتراضية لـ `'shiftwidth'` في Vim هي 2. في النص أعلاه، هناك مسافتان بين بداية السطر والنص "Two" و "Two again". عندما يرى Vim عدد المسافات وأن قيمة `'shiftwidth'` هي 2، يعتبر أن هذا السطر له مستوى طي مسافة بادئة واحد.

افترض هذه المرة أن لديك مسافة واحدة فقط بين بداية السطر والنص:

```shell
One
 Two
 Two again
```

الآن إذا قمت بتشغيل `:set foldmethod=indent`، لا يقوم Vim بطي السطر المائل لأن هناك مساحة غير كافية على كل سطر. لا تعتبر المسافة الواحدة مسافة بادئة. ومع ذلك، إذا قمت بتغيير `'shiftwidth'` إلى 1:

```shell
:set shiftwidth=1
```

أصبح النص الآن قابلاً للطي. الآن يعتبر مسافة بادئة.

استعد `shiftwidth` مرة أخرى إلى 2 وأعد المسافات بين النصوص إلى اثنتين مرة أخرى. بالإضافة إلى ذلك، أضف نصين إضافيين:

```shell
One
  Two
  Two again
    Three
    Three again
```

قم بتشغيل الطي (`zM`)، سترى:

```shell
One
+-- 4 lines: Two -----
```

افك الطيات المطوية (`zR`)، ثم ضع المؤشر على "Three" وقم بتبديل حالة طي النص (`za`):

```shell
One
  Two
  Two again
+-- 2 lines: Three -----
```

ما هذا؟ طي داخل طي؟

الطي المتداخل صالح. النص "Two" و "Two again" لهما مستوى طي واحد. النص "Three" و "Three again" لهما مستوى طي اثنين. إذا كان لديك نص قابل للطي بمستوى طي أعلى داخل نص قابل للطي، سيكون لديك عدة طبقات من الطي.

## الطي بالتعبير

يسمح لك الطي بالتعبير بتعريف تعبير لمطابقة الطي. بعد تعريف تعبيرات الطي، يقوم Vim بفحص كل سطر لقيمة `'foldexpr'`. هذه هي المتغير الذي يجب عليك تكوينه لإرجاع القيمة المناسبة. إذا أعادت `'foldexpr'` 0، فلن يتم طي السطر. إذا أعادت 1، فإن ذلك السطر له مستوى طي واحد. إذا أعادت 2، فإن ذلك السطر له مستوى طي اثنين. هناك المزيد من القيم بخلاف الأعداد الصحيحة، لكنني لن أتناولها. إذا كنت فضولياً، تحقق من `:h fold-expr`.

أولاً، دعنا نغير طريقة الطي:

```shell
:set foldmethod=expr
```

افترض أن لديك قائمة من أطعمة الإفطار وتريد طي جميع العناصر التي تبدأ بحرف "p":

```shell
donut
pancake
pop-tarts
protein bar
salmon
scrambled eggs
```

بعد ذلك، قم بتغيير `foldexpr` لالتقاط التعبيرات التي تبدأ بحرف "p":

```shell
:set foldexpr=getline(v:lnum)[0]==\\"p\\"
```

يبدو أن التعبير أعلاه معقد. دعنا نفككه:
- `:set foldexpr` يقوم بإعداد خيار `'foldexpr'` لقبول تعبير مخصص.
- `getline()` هي دالة Vimscript التي تعيد محتوى أي سطر معين. إذا قمت بتشغيل `:echo getline(5)`، ستعيد محتوى السطر 5.
- `v:lnum` هو متغير خاص في Vim لتعبير `'foldexpr'`. يقوم Vim بفحص كل سطر وفي تلك اللحظة يخزن رقم كل سطر في متغير `v:lnum`. في السطر 5، يحتوي `v:lnum` على قيمة 5. في السطر 10، يحتوي `v:lnum` على قيمة 10.
- `[0]` في سياق `getline(v:lnum)[0]` هو أول حرف من كل سطر. عندما يقوم Vim بفحص سطر، فإن `getline(v:lnum)` تعيد محتوى كل سطر. `getline(v:lnum)[0]` تعيد أول حرف من كل سطر. في السطر الأول من قائمتنا، "donut"، تعيد `getline(v:lnum)[0]` "d". في السطر الثاني من قائمتنا، "pancake"، تعيد `getline(v:lnum)[0]` "p".
- `==\\"p\\"` هو النصف الثاني من تعبير المساواة. يتحقق مما إذا كان التعبير الذي قمت بتقييمه يساوي "p". إذا كان صحيحًا، فإنه يعيد 1. إذا كان خاطئًا، فإنه يعيد 0. في Vim، 1 هو صحيح و0 هو خاطئ. لذا على الأسطر التي تبدأ بحرف "p"، فإنه يعيد 1. تذكر أنه إذا كانت `'foldexpr'` لها قيمة 1، فإنها لها مستوى طي واحد.

بعد تشغيل هذا التعبير، يجب أن ترى:

```shell
donut
+-- 3 lines: pancake -----
salmon
scrambled eggs
```

## الطي بناءً على بناء الجملة

يتم تحديد الطي بناءً على تمييز بناء الجملة. إذا كنت تستخدم مكون إضافي لتمييز بناء الجملة مثل [vim-polyglot](https://github.com/sheerun/vim-polyglot)، فإن الطي بناءً على بناء الجملة سيعمل مباشرة. فقط قم بتغيير طريقة الطي إلى بناء الجملة:

```shell
:set foldmethod=syntax
```

لنفترض أنك تقوم بتحرير ملف JavaScript ولديك مصفوفة مثل التالية:

```shell
const nums = [
  one,
  two,
  three,
  four
]
```

سيتم طيها باستخدام الطي بناءً على بناء الجملة. عندما تقوم بتعريف تمييز بناء الجملة للغة معينة (عادة داخل دليل `syntax/`)، يمكنك إضافة خاصية `fold` لجعلها قابلة للطي. أدناه هو مقتطف من ملف بناء جملة JavaScript الخاص بـ vim-polyglot. لاحظ كلمة `fold` في النهاية.

```shell
syntax region  jsBracket                      matchgroup=jsBrackets            start=/\[/ end=/\]/ contains=@jsExpression,jsSpreadExpression extend fold
```

لن تغطي هذه الدليل ميزة `syntax`. إذا كنت فضولياً، تحقق من `:h syntax.txt`.

## الطي بناءً على الفرق

يمكن لـ Vim إجراء إجراء فرق لمقارنة ملفين أو أكثر.

إذا كان لديك `file1.txt`:

```shell
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
```

و `file2.txt`:

```shell
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
emacs is ok
```

قم بتشغيل `vimdiff file1.txt file2.txt`:

```shell
+-- 3 lines: vim is awesome -----
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
vim is awesome
[vim is awesome] / [emacs is ok]
```

يقوم Vim تلقائيًا بطي بعض الأسطر المتطابقة. عند تشغيل أمر `vimdiff`، يستخدم Vim تلقائيًا `foldmethod=diff`. إذا قمت بتشغيل `:set foldmethod?`، ستعيد `diff`.

## الطي بناءً على العلامة

لاستخدام الطي بناءً على العلامة، قم بتشغيل:

```shell
:set foldmethod=marker
```

افترض أن لديك النص:

```shell
Hello

{{{
world
vim
}}}
```

قم بتشغيل `zM`، سترى:

```shell
hello

+-- 4 lines: -----
```

يرى Vim `{{{` و `}}}` كمؤشرات طي ويطوي النصوص بينهما. مع الطي بناءً على العلامة، يبحث Vim عن علامات خاصة، يتم تعريفها بواسطة خيار `'foldmarker'`، لتحديد مناطق الطي. لرؤية ما هي العلامات التي يستخدمها Vim، قم بتشغيل:

```shell
:set foldmarker?
```

بشكل افتراضي، يستخدم Vim `{{{` و `}}}` كمؤشرات. إذا كنت تريد تغيير المؤشر إلى نصوص أخرى، مثل "coffee1" و "coffee2":

```shell
:set foldmarker=coffee1,coffee2
```

إذا كان لديك النص:

```shell
hello

coffee1
world
vim
coffee2
```

الآن يستخدم Vim `coffee1` و `coffee2` كمؤشرات طي جديدة. كملاحظة جانبية، يجب أن تكون المؤشر سلسلة حرفية ولا يمكن أن تكون تعبيرًا عاديًا.

## الحفاظ على الطي

تفقد جميع معلومات الطي عند إغلاق جلسة Vim. إذا كان لديك هذا الملف، `count.txt`:

```shell
one
two
three
four
five
```

ثم قم بطي يدوي من السطر "three" إلى الأسفل (`:3,$fold`):

```shell
one
two
+-- 3 lines: three ---
```

عند الخروج من Vim وإعادة فتح `count.txt`، لم تعد الطيات موجودة!

للحفاظ على الطيات، بعد الطي، قم بتشغيل:

```shell
:mkview
```

ثم عندما تفتح `count.txt`، قم بتشغيل:

```shell
:loadview
```

تتم استعادة الطيات الخاصة بك. ومع ذلك، عليك تشغيل `mkview` و `loadview` يدويًا. أعلم أنه في أحد هذه الأيام، سأنسى تشغيل `mkview` قبل إغلاق الملف وسأفقد جميع الطيات. كيف يمكننا أتمتة هذه العملية؟

لتشغيل `mkview` تلقائيًا عند إغلاق ملف `.txt` وتشغيل `loadview` عند فتح ملف `.txt`، أضف هذا في ملف vimrc الخاص بك:

```shell
autocmd BufWinLeave *.txt mkview
autocmd BufWinEnter *.txt silent loadview
```

تذكر أن `autocmd` يستخدم لتنفيذ أمر عند حدوث حدث. الحدثان هنا هما:
- `BufWinLeave` عندما تزيل مخزنًا من نافذة.
- `BufWinEnter` عندما تقوم بتحميل مخزن في نافذة.

الآن بعد أن تطوي داخل ملف `.txt` وتخرج من Vim، في المرة القادمة التي تفتح فيها ذلك الملف، ستتم استعادة معلومات الطي الخاصة بك.

بشكل افتراضي، يحفظ Vim معلومات الطي عند تشغيل `mkview` داخل `~/.vim/view` لنظام Unix. لمزيد من المعلومات، تحقق من `:h 'viewdir'`.
## تعلم الطي بطريقة ذكية

عندما بدأت استخدام فيم لأول مرة، تجاهلت تعلم الطي لأنني لم أعتقد أنه مفيد. ومع ذلك، كلما طالت مدة برمجتي، كلما وجدت أن الطي أكثر فائدة. يمكن أن توفر الطيات الموضوعة بشكل استراتيجي نظرة أفضل على هيكل النص، مثل جدول محتويات الكتاب.

عندما تتعلم الطي، ابدأ بالطيات اليدوية لأنها يمكن استخدامها أثناء التنقل. ثم تعلم تدريجياً حيل مختلفة لعمل الطيات المتداخلة وطيات العلامات. أخيرًا، تعلم كيفية عمل طيات الصياغة والتعبير. يمكنك حتى استخدام الأخيرتين لكتابة إضافات فيم الخاصة بك.