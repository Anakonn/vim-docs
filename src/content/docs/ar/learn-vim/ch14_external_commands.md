---
description: هذا المستند يشرح كيفية استخدام أوامر Unix داخل Vim، بما في ذلك كيفية
  قراءة مخرجات الأوامر وتنفيذها من داخل محرر النصوص.
title: Ch14. External Commands
---

داخل نظام Unix، ستجد العديد من الأوامر الصغيرة المتخصصة للغاية التي تقوم بشيء واحد (وتقوم به بشكل جيد). يمكنك ربط هذه الأوامر للعمل معًا لحل مشكلة معقدة. ألن يكون رائعًا إذا كان بإمكانك استخدام هذه الأوامر من داخل Vim؟

بالتأكيد. في هذا الفصل، ستتعلم كيفية توسيع Vim للعمل بسلاسة مع الأوامر الخارجية.

## أمر Bang

يمتلك Vim أمر bang (`!`) الذي يمكن أن يقوم بثلاثة أشياء:

1. قراءة STDOUT من أمر خارجي إلى المخزن الحالي.
2. كتابة محتوى المخزن الخاص بك كـ STDIN إلى أمر خارجي.
3. تنفيذ أمر خارجي من داخل Vim.

دعنا نمر بكل منها.

## قراءة STDOUT من أمر إلى Vim

الصيغة لقراءة STDOUT من أمر خارجي إلى المخزن الحالي هي:

```shell
:r !cmd
```

`:r` هو أمر القراءة في Vim. إذا استخدمته بدون `!`، يمكنك استخدامه للحصول على محتوى ملف. إذا كان لديك ملف `file1.txt` في الدليل الحالي وقمت بتشغيل:

```shell
:r file1.txt
```

سيقوم Vim بوضع محتوى `file1.txt` في المخزن الحالي.

إذا قمت بتشغيل أمر `:r` متبوعًا بـ `!` وأمر خارجي، فسيتم إدراج ناتج ذلك الأمر في المخزن الحالي. للحصول على نتيجة أمر `ls`، قم بتشغيل:

```shell
:r !ls
```

سيعيد شيئًا مثل:

```shell
file1.txt
file2.txt
file3.txt
```

يمكنك قراءة البيانات من أمر `curl`:

```shell
:r !curl -s 'https://jsonplaceholder.typicode.com/todos/1'
```

يقبل أمر `r` أيضًا عنوانًا:

```shell
:10r !cat file1.txt
```

الآن سيتم إدراج STDOUT من تشغيل `cat file1.txt` بعد السطر 10.

## كتابة محتوى المخزن إلى أمر خارجي

يمكن استخدام الأمر `:w`، بالإضافة إلى حفظ ملف، لتمرير النص في المخزن الحالي كـ STDIN لأمر خارجي. الصيغة هي:

```shell
:w !cmd
```

إذا كان لديك هذه التعبيرات:

```shell
console.log("Hello Vim");
console.log("Vim is awesome");
```

تأكد من أنك قد قمت بتثبيت [node](https://nodejs.org/en/) على جهازك، ثم قم بتشغيل:

```shell
:w !node
```

سيستخدم Vim `node` لتنفيذ تعبيرات JavaScript لطباعة "Hello Vim" و "Vim is awesome".

عند استخدام أمر `:w`، يستخدم Vim جميع النصوص في المخزن الحالي، مشابهًا للأمر العالمي (معظم أوامر سطر الأوامر، إذا لم تقم بتمرير نطاق، تقوم فقط بتنفيذ الأمر ضد السطر الحالي). إذا قمت بتمرير `:w` عنوانًا محددًا:

```shell
:2w !node
```

سيستخدم Vim النص من السطر الثاني فقط إلى مفسر `node`.

هناك فرق دقيق ولكنه مهم بين `:w !node` و `:w! node`. مع `:w !node`، أنت "تكتب" النص في المخزن الحالي إلى الأمر الخارجي `node`. مع `:w! node`، أنت تقوم بحفظ ملف بالقوة وتسميته "node".

## تنفيذ أمر خارجي

يمكنك تنفيذ أمر خارجي من داخل Vim باستخدام أمر bang. الصيغة هي:

```shell
:!cmd
```

لرؤية محتوى الدليل الحالي بالتنسيق الطويل، قم بتشغيل:

```shell
:!ls -ls
```

لقتل عملية تعمل على PID 3456، يمكنك تشغيل:

```shell
:!kill -9 3456
```

يمكنك تشغيل أي أمر خارجي دون مغادرة Vim حتى تتمكن من البقاء مركزًا على مهمتك.

## تصفية النصوص

إذا أعطيت `!` نطاقًا، يمكن استخدامها لتصفية النصوص. افترض أن لديك النصوص التالية:

```shell
hello vim
hello vim
```

دعنا نجعل السطر الحالي بحروف كبيرة باستخدام أمر `tr` (ترجمة). قم بتشغيل:

```shell
:.!tr '[:lower:]' '[:upper:]'
```

النتيجة:

```shell
HELLO VIM
hello vim
```

التفصيل:
- `.!` ينفذ أمر التصفية على السطر الحالي.
- `tr '[:lower:]' '[:upper:]'` يستدعي أمر `tr` لاستبدال جميع الأحرف الصغيرة بأحرف كبيرة.

من الضروري تمرير نطاق لتشغيل الأمر الخارجي كمرشح. إذا حاولت تشغيل الأمر أعلاه بدون `.` (`:!tr '[:lower:]' '[:upper:]'`)، سترى خطأ.

دعنا نفترض أنك بحاجة إلى إزالة العمود الثاني من كلا السطرين باستخدام أمر `awk`:

```shell
:%!awk "{print $1}"
```

النتيجة:

```shell
hello
hello
```

التفصيل:
- `:%!` ينفذ أمر التصفية على جميع الأسطر (`%`).
- `awk "{print $1}"` يطبع فقط العمود الأول من المطابقة.

يمكنك ربط أوامر متعددة باستخدام عامل الربط (`|`) تمامًا كما في الطرفية. لنفترض أن لديك ملفًا يحتوي على هذه العناصر اللذيذة للإفطار:

```shell
name price
chocolate pancake 10
buttermilk pancake 9
blueberry pancake 12
```

إذا كنت بحاجة إلى فرزها بناءً على السعر وعرض القائمة فقط بمسافات متساوية، يمكنك تشغيل:

```shell
:%!awk 'NR > 1' | sort -nk 3 | column -t
```

النتيجة:
```shell
buttermilk pancake 9
chocolate pancake 10
blueberry pancake 12
```

التفصيل:
- `:%!` يطبق التصفية على جميع الأسطر (`%`).
- `awk 'NR > 1'` يعرض النصوص بدءًا من رقم الصف الثاني.
- `|` يربط الأمر التالي.
- `sort -nk 3` يرتب بشكل عددي (`n`) باستخدام القيم من العمود 3 (`k 3`).
- `column -t` ينظم النص بمسافات متساوية.

## أمر وضع العادي

يمتلك Vim عامل تصفية (`!`) في وضع العادي. إذا كان لديك التحيات التالية:

```shell
hello vim
hola vim
bonjour vim
salve vim
```

لجعل السطر الحالي والسطر أدناه بحروف كبيرة، يمكنك تشغيل:
```shell
!jtr '[a-z]' '[A-Z]'
```

التفصيل:
- `!j` يشغل عامل تصفية الأمر العادي (`!`) مستهدفًا السطر الحالي والسطر أدناه. تذكر أنه لأنه عامل تشغيل في وضع العادي، فإن قاعدة القواعد `فعل + اسم` تنطبق. `!` هو الفعل و `j` هو الاسم.
- `tr '[a-z]' '[A-Z]'` يستبدل الأحرف الصغيرة بالأحرف الكبيرة.

يعمل أمر تصفية العادي فقط على الحركات / كائنات النص التي تكون على الأقل سطرًا واحدًا أو أطول. إذا كنت قد حاولت تشغيل `!iwtr '[a-z]' '[A-Z]'` (تنفيذ `tr` على الكلمة الداخلية)، ستجد أنه يطبق أمر `tr` على السطر بالكامل، وليس الكلمة التي يتواجد فيها المؤشر.

## تعلم الأوامر الخارجية بطريقة ذكية

Vim ليس IDE. إنه محرر خفيف الوزن مصمم ليكون قابلاً للتوسيع للغاية. بسبب هذه القابلية للتوسيع، لديك وصول سهل إلى أي أمر خارجي في نظامك. مسلحًا بهذه الأوامر الخارجية، أصبح Vim خطوة أقرب إلى أن يصبح IDE. قال شخص ما إن نظام Unix هو أول IDE على الإطلاق.

أمر bang مفيد بقدر عدد الأوامر الخارجية التي تعرفها. لا تقلق إذا كانت معرفتك بالأوامر الخارجية محدودة. لا يزال لدي الكثير لأتعلمه أيضًا. اعتبر هذا كتحفيز للتعلم المستمر. كلما احتجت إلى تعديل نص، تحقق مما إذا كان هناك أمر خارجي يمكنه حل مشكلتك. لا تقلق بشأن إتقان كل شيء، فقط تعلم ما تحتاجه لإكمال المهمة الحالية.