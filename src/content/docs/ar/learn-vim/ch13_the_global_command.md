---
description: هذا المستند يشرح كيفية استخدام الأمر العالمي في فيم لتكرار أوامر سطر
  الأوامر على عدة أسطر، مع تقديم أمثلة وتفاصيل حول الأوامر.
title: Ch13. the Global Command
---

حتى الآن، لقد تعلمت كيفية تكرار آخر تغيير باستخدام أمر النقطة (`.`)، لإعادة تشغيل الإجراءات باستخدام الماكرو (`q`)، ولتخزين النصوص في السجلات (`"`).

في هذا الفصل، ستتعلم كيفية تكرار أمر سطر الأوامر باستخدام الأمر العالمي.

## نظرة عامة على الأمر العالمي

يستخدم الأمر العالمي في Vim لتنفيذ أمر سطر الأوامر على عدة أسطر في وقت واحد.

بالمناسبة، قد تكون قد سمعت بمصطلح "أوامر Ex" من قبل. في هذا الدليل، أشير إليها كأوامر سطر الأوامر. كلا من أوامر Ex وأوامر سطر الأوامر هي نفسها. هي الأوامر التي تبدأ بنقطتين (`:`). كان أمر الاستبدال في الفصل الأخير مثالًا على أمر Ex. تُسمى Ex لأنها جاءت في الأصل من محرر النصوص Ex. سأستمر في الإشارة إليها كأوامر سطر الأوامر في هذا الدليل. للحصول على قائمة كاملة من أوامر Ex، تحقق من `:h ex-cmd-index`.

لدى الأمر العالمي الصيغة التالية:

```shell
:g/pattern/command
```

يتطابق `pattern` مع جميع الأسطر التي تحتوي على هذا النمط، مشابهًا للنمط في أمر الاستبدال. يمكن أن يكون `command` أي أمر سطر أوامر. يعمل الأمر العالمي عن طريق تنفيذ `command` ضد كل سطر يتطابق مع `pattern`.

إذا كان لديك التعبيرات التالية:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

لإزالة جميع الأسطر التي تحتوي على "console"، يمكنك تشغيل:

```shell
:g/console/d
```

النتيجة:

```shell
const one = 1;

const two = 2;

const three = 3;
```

ينفذ الأمر العالمي أمر الحذف (`d`) على جميع الأسطر التي تتطابق مع نمط "console".

عند تشغيل أمر `g`، يقوم Vim بعمل مسحتين عبر الملف. في التشغيل الأول، يقوم بمسح كل سطر ويعلم السطر الذي يتطابق مع نمط `/console/`. بمجرد تعليم جميع الأسطر المطابقة، يعود مرة أخرى وينفذ أمر `d` على الأسطر المعلمة.

إذا كنت تريد حذف جميع الأسطر التي تحتوي على "const" بدلاً من ذلك، قم بتشغيل:

```shell
:g/const/d
```

النتيجة:

```shell
console.log("one: ", one);

console.log("two: ", two);

console.log("three: ", three);
```

## المطابقة العكسية

لتشغيل الأمر العالمي على الأسطر غير المطابقة، يمكنك تشغيل:

```shell
:g!/pattern/command
```

أو

```shell
:v/pattern/command
```

إذا قمت بتشغيل `:v/console/d`، فسيقوم بحذف جميع الأسطر *التي لا* تحتوي على "console".

## النمط

يستخدم الأمر العالمي نفس نظام الأنماط مثل أمر الاستبدال، لذا ستعمل هذه القسم كمنعش. لا تتردد في الانتقال إلى القسم التالي أو القراءة معًا!

إذا كان لديك هذه التعبيرات:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

لحذف الأسطر التي تحتوي على "one" أو "two"، قم بتشغيل:

```shell
:g/one\|two/d
```

لحذف الأسطر التي تحتوي على أي رقم فردي، قم بتشغيل إما:

```shell
:g/[0-9]/d
```

أو

```shell
:g/\d/d
```

إذا كان لديك التعبير:

```shell
const oneMillion = 1000000;
const oneThousand = 1000;
const one = 1;
```

للمطابقة مع الأسطر التي تحتوي على ثلاثة إلى ستة أصفار، قم بتشغيل:

```shell
:g/0\{3,6\}/d
```

## تمرير نطاق

يمكنك تمرير نطاق قبل أمر `g`. إليك بعض الطرق التي يمكنك القيام بها:
- `:1,5g/console/d` تطابق سلسلة "console" بين الأسطر 1 و 5 وتحذفها.
- `:,5g/console/d` إذا لم يكن هناك عنوان قبل الفاصلة، فسيبدأ من السطر الحالي. يبحث عن سلسلة "console" بين السطر الحالي والسطر 5 ويحذفها.
- `:3,g/console/d` إذا لم يكن هناك عنوان بعد الفاصلة، فسينتهي عند السطر الحالي. يبحث عن سلسلة "console" بين السطر 3 والسطر الحالي ويحذفها.
- `:3g/console/d` إذا قمت بتمرير عنوان واحد فقط بدون فاصلة، فإنه ينفذ الأمر فقط على السطر 3. يبحث في السطر 3 ويحذفه إذا كان يحتوي على سلسلة "console".

بالإضافة إلى الأرقام، يمكنك أيضًا استخدام هذه الرموز كنطاق:
- `.` تعني السطر الحالي. نطاق `.,3` يعني بين السطر الحالي والسطر 3.
- `$` تعني السطر الأخير في الملف. نطاق `3,$` يعني بين السطر 3 وآخر سطر.
- `+n` تعني n أسطر بعد السطر الحالي. يمكنك استخدامه مع `.` أو بدونه. `3,+1` أو `3,.+1` يعني بين السطر 3 والسطر الذي يلي السطر الحالي.

إذا لم تعطيه أي نطاق، بشكل افتراضي يؤثر على الملف بأكمله. هذا في الواقع ليس القاعدة. معظم أوامر سطر الأوامر في Vim تعمل فقط على السطر الحالي إذا لم تقم بتمرير أي نطاق. الاستثناءان الملحوظان هما الأمر العالمي (`:g`) وأمر الحفظ (`:w`).

## الأمر العادي

يمكنك تشغيل أمر عادي مع الأمر العالمي باستخدام أمر سطر الأوامر `:normal`.

إذا كان لديك هذا النص:
```shell
const one = 1
console.log("one: ", one)

const two = 2
console.log("two: ", two)

const three = 3
console.log("three: ", three)
```

لإضافة ";" في نهاية كل سطر، قم بتشغيل:

```shell
:g/./normal A;
```

دعنا نفصل ذلك:
- `:g` هو الأمر العالمي.
- `/./` هو نمط لـ "الأسطر غير الفارغة". يتطابق مع الأسطر التي تحتوي على حرف واحد على الأقل، لذا يتطابق مع الأسطر التي تحتوي على "const" و "console" ولا يتطابق مع الأسطر الفارغة.
- `normal A;` ينفذ أمر `:normal`. `A;` هو أمر وضع العادي لإدراج ";" في نهاية السطر.

## تنفيذ ماكرو

يمكنك أيضًا تنفيذ ماكرو مع الأمر العالمي. يمكن تنفيذ ماكرو باستخدام أمر `normal`. إذا كان لديك التعبيرات:

```shell
const one = 1
console.log("one: ", one);

const two = 2
console.log("two: ", two);

const three = 3
console.log("three: ", three);
```

لاحظ أن الأسطر التي تحتوي على "const" لا تحتوي على فواصل. دعنا ننشئ ماكرو لإضافة فاصلة في نهاية تلك الأسطر في السجل a:

```shell
qaA;<Esc>q
```

إذا كنت بحاجة إلى منعش، تحقق من الفصل عن الماكرو. الآن قم بتشغيل:

```shell
:g/const/normal @a
```

الآن جميع الأسطر التي تحتوي على "const" سيكون لها ";" في النهاية.

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

إذا اتبعت هذه الخطوة خطوة بخطوة، سيكون لديك فاصلتين في السطر الأول. لتجنب ذلك، قم بتشغيل الأمر العالمي من السطر الثاني فصاعدًا، `:2,$g/const/normal @a`.

## الأمر العالمي التكراري

الأمر العالمي في حد ذاته هو نوع من أوامر سطر الأوامر، لذا يمكنك تقنيًا تشغيل الأمر العالمي داخل أمر عالمي.

بالنظر إلى التعبيرات التالية، إذا كنت تريد حذف عبارة `console.log` الثانية:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

إذا قمت بتشغيل:

```shell
:g/console/g/two/d
```

أولاً، سيبحث `g` عن الأسطر التي تحتوي على النمط "console" وسيجد 3 تطابقات. ثم سيبحث `g` الثاني عن السطر الذي يحتوي على النمط "two" من تلك التطابقات الثلاثة. أخيرًا، سيحذف ذلك التطابق.

يمكنك أيضًا دمج `g` مع `v` للبحث عن الأنماط الإيجابية والسلبية. على سبيل المثال:

```shell
:g/console/v/two/d
```

بدلاً من البحث عن السطر الذي يحتوي على النمط "two"، سيبحث عن الأسطر *التي لا* تحتوي على النمط "two".

## تغيير الفاصل

يمكنك تغيير فاصل الأمر العالمي مثل أمر الاستبدال. القواعد هي نفسها: يمكنك استخدام أي حرف بايت مفرد باستثناء الأبجدية، الأرقام، `"`, `|`، و `\`.

لحذف الأسطر التي تحتوي على "console":

```shell
:g@console@d
```

إذا كنت تستخدم أمر الاستبدال مع الأمر العالمي، يمكنك أن يكون لديك فاصلين مختلفين:

```shell
g@one@s+const+let+g
```

هنا سيبحث الأمر العالمي عن جميع الأسطر التي تحتوي على "one". سيقوم أمر الاستبدال باستبدال، من تلك التطابقات، السلسلة "const" بـ "let".

## الأمر الافتراضي

ماذا يحدث إذا لم تحدد أي أمر سطر أوامر في الأمر العالمي؟

سيستخدم الأمر العالمي أمر الطباعة (`:p`) لطباعة نص السطر الحالي. إذا قمت بتشغيل:

```shell
:g/console
```

سيقوم بطباعة جميع الأسطر التي تحتوي على "console" في أسفل الشاشة.

بالمناسبة، إليك حقيقة مثيرة للاهتمام. لأن الأمر الافتراضي المستخدم من قبل الأمر العالمي هو `p`، فإن هذا يجعل صيغة `g` تكون:

```shell
:g/re/p
```

- `g` = الأمر العالمي
- `re` = نمط regex
- `p` = أمر الطباعة

إنه يتهجى *"grep"*, نفس `grep` من سطر الأوامر. هذا **ليس** مصادفة. جاء أمر `g/re/p` في الأصل من محرر Ed، أحد محررات النصوص الأصلية. حصل أمر `grep` على اسمه من Ed.

من المحتمل أن يكون جهاز الكمبيوتر الخاص بك لا يزال يحتوي على محرر Ed. قم بتشغيل `ed` من الطرفية (تلميح: للخروج، اكتب `q`).

## عكس المخزن المؤقت بالكامل

لعكس الملف بالكامل، قم بتشغيل:

```shell
:g/^/m 0
```

`^` هو نمط لبداية السطر. استخدم `^` لمطابقة جميع الأسطر، بما في ذلك الأسطر الفارغة.

إذا كنت بحاجة إلى عكس عدد قليل من الأسطر فقط، قم بتمرير نطاق. لعكس الأسطر بين السطر الخامس إلى السطر العاشر، قم بتشغيل:

```shell
:5,10g/^/m 0
```

لتعلم المزيد عن أمر التحريك، تحقق من `:h :move`.

## تجميع جميع TODOs

عند البرمجة، أحيانًا أكتب TODOs في الملف الذي أحرره:

```shell
const one = 1;
console.log("one: ", one);
// TODO: feed the puppy

const two = 2;
// TODO: feed the puppy automatically
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
// TODO: create a startup selling an automatic puppy feeder
```

قد يكون من الصعب تتبع جميع TODOs التي تم إنشاؤها. يحتوي Vim على طريقة `:t` (نسخ) لنسخ جميع التطابقات إلى عنوان. لتعلم المزيد عن طريقة النسخ، تحقق من `:h :copy`.

لنسخ جميع TODOs إلى نهاية الملف لسهولة المراجعة، قم بتشغيل:

```shell
:g/TODO/t $
```

النتيجة:

```shell
const one = 1;
console.log("one: ", one);
// TODO: feed the puppy

const two = 2;
// TODO: feed the puppy automatically
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
// TODO: create a startup selling an automatic puppy feeder

// TODO: feed the puppy
// TODO: feed the puppy automatically
// TODO: create a startup selling an automatic puppy feeder
```

الآن يمكنني مراجعة جميع TODOs التي أنشأتها، إيجاد وقت للقيام بها أو تفويضها لشخص آخر، ومتابعة العمل على مهمتي التالية.

إذا كنت تريد بدلاً من نسخها نقل جميع TODOs إلى النهاية، استخدم أمر النقل، `:m`:

```shell
:g/TODO/m $
```

النتيجة:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);

// TODO: feed the puppy
// TODO: feed the puppy automatically
// TODO: create a startup selling an automatic puppy feeder
```

## حذف الثقب الأسود

تذكر من فصل السجلات أن النصوص المحذوفة تُخزن داخل السجلات المرقمة (طالما كانت كبيرة بما فيه الكفاية). كلما قمت بتشغيل `:g/console/d`، يقوم Vim بتخزين الأسطر المحذوفة في السجلات المرقمة. إذا قمت بحذف العديد من الأسطر، يمكنك بسرعة ملء جميع السجلات المرقمة. لتجنب ذلك، يمكنك دائمًا استخدام سجل الثقب الأسود (`"_`) *لعدم* تخزين الأسطر المحذوفة في السجلات. قم بتشغيل:

```shell
:g/console/d_
```

من خلال تمرير `_` بعد `d`، لن يستخدم Vim سجلاتك الاحتياطية.
## تقليل عدة أسطر فارغة إلى سطر فارغ واحد

إذا كان لديك نص يحتوي على عدة أسطر فارغة:

```shell
const one = 1;
console.log("one: ", one);


const two = 2;
console.log("two: ", two);





const three = 3;
console.log("three: ", three);
```

يمكنك تقليل الأسطر الفارغة إلى سطر فارغ واحد بسرعة باستخدام:

```shell
:g/^$/,/./-1j
```

النتيجة:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

عادةً ما يقبل الأمر العالمي الشكل التالي: `:g/pattern/command`. ومع ذلك، يمكنك أيضًا تشغيل الأمر العالمي بالشكل التالي: `:g/pattern1/,/pattern2/command`. مع ذلك، سيطبق Vim الأمر `command` ضمن `pattern1` و `pattern2`.

مع وضع ذلك في الاعتبار، دعنا نفصل الأمر `:g/^$/,/./-1j` وفقًا لـ `:g/pattern1/,/pattern2/command`:
- `/pattern1/` هو `/^$/`. يمثل سطرًا فارغًا (سطر بدون أحرف).
- `/pattern2/` هو `/./` مع معدل السطر `-1`. `/./` يمثل سطرًا غير فارغ (سطر يحتوي على حرف واحد على الأقل). يعني `-1` السطر الذي يعلوه.
- `command` هو `j`، أمر الدمج (`:j`). في هذا السياق، يقوم هذا الأمر العالمي بدمج جميع الأسطر المعطاة.

بالمناسبة، إذا كنت ترغب في تقليل عدة أسطر فارغة إلى عدم وجود أسطر، قم بتشغيل هذا بدلاً من ذلك:

```shell
:g/^$/,/./j
```

بديل أبسط:

```shell
:g/^$/-j
```

نصك الآن تم تقليله إلى:

```shell
const one = 1;
console.log("one: ", one);
const two = 2;
console.log("two: ", two);
const three = 3;
console.log("three: ", three);
```

## فرز متقدم

يمتلك Vim أمر `:sort` لفرز الأسطر ضمن نطاق. على سبيل المثال:

```shell
d
b
a
e
c
```

يمكنك فرزها عن طريق تشغيل `:sort`. إذا أعطيته نطاقًا، فسيقوم بفرز الأسطر فقط ضمن هذا النطاق. على سبيل المثال، `:3,5sort` يقوم بفرز الأسطر الثلاثة والخمسة فقط.

إذا كان لديك التعبيرات التالية:

```shell
const arrayB = [
  "i",
  "g",
  "h",
  "b",
  "f",
  "d",
  "e",
  "c",
  "a",
]

const arrayA = [
  "h",
  "b",
  "f",
  "d",
  "e",
  "a",
  "c",
]
```

إذا كنت بحاجة إلى فرز العناصر داخل المصفوفات، ولكن ليس المصفوفات نفسها، يمكنك تشغيل هذا:

```shell
:g/\[/+1,/\]/-1sort
```

النتيجة:

```shell
const arrayB = [
  "a",
  "b",
  "c",
  "d",
  "e",
  "f",
  "g",
  "h",
  "i",
]

const arrayA = [
  "a"
  "b",
  "c",
  "d",
  "e",
  "f",
  "h",
]
```

هذا رائع! لكن الأمر يبدو معقدًا. دعنا نفصل ذلك. هذا الأمر يتبع أيضًا الشكل `:g/pattern1/,/pattern2/command`.

- `:g` هو نمط الأمر العالمي.
- `/\[/+1` هو النمط الأول. يتطابق مع قوس مربع أيسر حرفي "[". يشير `+1` إلى السطر الذي تحته.
- `/\]/-1` هو النمط الثاني. يتطابق مع قوس مربع أيمن حرفي "]". يشير `-1` إلى السطر الذي يعلوه.
- `/\[/+1,/\]/-1` تشير بعد ذلك إلى أي أسطر بين "[" و "]".
- `sort` هو أمر سطر الأوامر للفرز.

## تعلم الأمر العالمي بطريقة ذكية

ينفذ الأمر العالمي أمر سطر الأوامر ضد جميع الأسطر المتطابقة. مع ذلك، تحتاج فقط إلى تشغيل أمر واحد مرة واحدة وسيتولى Vim الباقي. لتصبح بارعًا في الأمر العالمي، هناك شيئان مطلوبان: مفردات جيدة من أوامر سطر الأوامر ومعرفة بالتعبيرات العادية. مع مرور الوقت في استخدام Vim، ستتعلم بشكل طبيعي المزيد من أوامر سطر الأوامر. ستتطلب معرفة التعبيرات العادية نهجًا أكثر نشاطًا. ولكن بمجرد أن تصبح مرتاحًا مع التعبيرات العادية، ستكون متقدمًا على الكثيرين.

بعض الأمثلة هنا معقدة. لا تشعر بالخوف. حقًا خذ وقتك لفهمها. تعلم قراءة الأنماط. لا تستسلم.

كلما احتجت إلى تشغيل أوامر متعددة، توقف وانظر إذا كان يمكنك استخدام أمر `g`. حدد أفضل أمر للوظيفة واكتب نمطًا لاستهداف أكبر عدد ممكن من الأشياء في وقت واحد.

الآن بعد أن عرفت مدى قوة الأمر العالمي، دعنا نتعلم كيفية استخدام الأوامر الخارجية لزيادة ترسانة أدواتك.