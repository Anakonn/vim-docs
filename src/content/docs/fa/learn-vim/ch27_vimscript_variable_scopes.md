---
description: این سند به بررسی متغیرهای قابل تغییر و غیرقابل تغییر در Vim و منابع و
  دامنه‌های مختلف متغیرها می‌پردازد.
title: Ch27. Vimscript Variable Scopes
---

قبل از اینکه به توابع Vimscript بپردازیم، بیایید درباره منابع و دامنه‌های مختلف متغیرهای Vim یاد بگیریم.

## متغیرهای قابل تغییر و غیرقابل تغییر

شما می‌توانید با استفاده از `let` یک مقدار به یک متغیر در Vim اختصاص دهید:

```shell
let pancake = "pancake"
```

بعداً می‌توانید هر زمان که خواستید آن متغیر را فراخوانی کنید.

```shell
echo pancake
" returns "pancake"
```

`let` قابل تغییر است، به این معنی که می‌توانید هر زمان در آینده مقدار آن را تغییر دهید.

```shell
let pancake = "pancake"
let pancake = "not waffles"

echo pancake
" returns "not waffles"
```

توجه داشته باشید که وقتی می‌خواهید مقدار یک متغیر تنظیم شده را تغییر دهید، هنوز هم باید از `let` استفاده کنید.

```shell
let beverage = "milk"

beverage = "orange juice"
" throws an error
```

شما می‌توانید یک متغیر غیرقابل تغییر با `const` تعریف کنید. به دلیل غیرقابل تغییر بودن، هنگامی که یک مقدار به یک متغیر اختصاص داده می‌شود، نمی‌توانید آن را با یک مقدار متفاوت دوباره اختصاص دهید.

```shell
const waffle = "waffle"
const waffle = "pancake"
" throws an error
```

## منابع متغیر

سه منبع برای متغیرها وجود دارد: متغیر محیطی، متغیر گزینه و متغیر ثبت.

### متغیر محیطی

Vim می‌تواند به متغیر محیطی ترمینال شما دسترسی پیدا کند. به عنوان مثال، اگر متغیر محیطی `SHELL` در ترمینال شما موجود باشد، می‌توانید از Vim به آن دسترسی پیدا کنید:

```shell
echo $SHELL
" returns $SHELL value. In my case, it returns /bin/bash
```

### متغیر گزینه

شما می‌توانید به گزینه‌های Vim با `&` دسترسی پیدا کنید (این‌ها تنظیماتی هستند که با `set` به آن‌ها دسترسی پیدا می‌کنید).

به عنوان مثال، برای دیدن اینکه Vim از چه پس‌زمینه‌ای استفاده می‌کند، می‌توانید اجرا کنید:

```shell
echo &background
" returns either "light" or "dark"
```

به طور جایگزین، می‌توانید همیشه `set background?` را اجرا کنید تا مقدار گزینه `background` را ببینید.

### متغیر ثبت

شما می‌توانید به ثبت‌های Vim (فصل 08) با `@` دسترسی پیدا کنید.

فرض کنید مقدار "chocolate" قبلاً در ثبت a ذخیره شده است. برای دسترسی به آن، می‌توانید از `@a` استفاده کنید. همچنین می‌توانید آن را با `let` به‌روزرسانی کنید.

```shell
echo @a
" returns chocolate

let @a .= " donut"

echo @a
" returns "chocolate donut"
```

حالا وقتی از ثبت `a` چسباندن می‌کنید (`"ap`)، "chocolate donut" برمی‌گردد. عملگر `.=` دو رشته را به هم متصل می‌کند. عبارت `let @a .= " donut"` معادل `let @a = @a . " donut"` است.

## دامنه‌های متغیر

در Vim 9 دامنه متغیر مختلف وجود دارد. شما می‌توانید آن‌ها را از حرف پیشوند آن‌ها شناسایی کنید:

```shell
g:           متغیر جهانی
{nothing}    متغیر جهانی
b:           متغیر محلی بافر
w:           متغیر محلی پنجره
t:           متغیر محلی تب
s:           متغیر Vimscript منبع‌گذاری شده
l:           متغیر محلی تابع
a:           متغیر پارامتر رسمی تابع
v:           متغیر داخلی Vim
```

### متغیر جهانی

زمانی که شما یک متغیر "عادی" را اعلام می‌کنید:

```shell
let pancake = "pancake"
```

`pancake` در واقع یک متغیر جهانی است. وقتی شما یک متغیر جهانی تعریف می‌کنید، می‌توانید از هر جایی به آن دسترسی پیدا کنید.

پیشوند `g:` به یک متغیر نیز یک متغیر جهانی ایجاد می‌کند.

```shell
let g:waffle = "waffle"
```

در این حالت، هر دو `pancake` و `g:waffle` دامنه یکسانی دارند. شما می‌توانید هر یک از آن‌ها را با یا بدون `g:` فراخوانی کنید.

```shell
echo pancake
" returns "pancake"

echo g:pancake
" returns "pancake"

echo waffle
" returns "waffle"

echo g:waffle
" returns "waffle"
```

### متغیر بافر

یک متغیر که با `b:` پیشوند دارد، یک متغیر بافر است. یک متغیر بافر متغیری است که محلی به بافر فعلی است (فصل 02). اگر چندین بافر باز داشته باشید، هر بافر لیست جداگانه‌ای از متغیرهای بافر خود خواهد داشت.

در بافر 1:

```shell
const b:donut = "chocolate donut"
```

در بافر 2:

```shell
const b:donut = "blueberry donut"
```

اگر از بافر 1 `echo b:donut` را اجرا کنید، "chocolate donut" برمی‌گردد. اگر از بافر 2 آن را اجرا کنید، "blueberry donut" برمی‌گردد.

به عنوان نکته جانبی، Vim یک متغیر بافر *خاص* به نام `b:changedtick` دارد که تمام تغییرات انجام شده در بافر فعلی را پیگیری می‌کند.

1. `echo b:changedtick` را اجرا کنید و شماره‌ای که برمی‌گرداند را یادداشت کنید..
2. تغییراتی در Vim ایجاد کنید.
3. دوباره `echo b:changedtick` را اجرا کنید و شماره‌ای که اکنون برمی‌گرداند را یادداشت کنید.

### متغیر پنجره

یک متغیر که با `w:` پیشوند دارد، یک متغیر پنجره است. این متغیر فقط در آن پنجره وجود دارد.

در پنجره 1:

```shell
const w:donut = "chocolate donut"
```

در پنجره 2:

```shell
const w:donut = "raspberry donut"
```

در هر پنجره، می‌توانید `echo w:donut` را فراخوانی کنید تا مقادیر منحصر به فردی بگیرید.

### متغیر تب

یک متغیر که با `t:` پیشوند دارد، یک متغیر تب است. این متغیر فقط در آن تب وجود دارد.

در تب 1:

```shell
const t:donut = "chocolate donut"
```

در تب 2:

```shell
const t:donut = "blackberry donut"
```

در هر تب، می‌توانید `echo t:donut` را فراخوانی کنید تا مقادیر منحصر به فردی بگیرید.

### متغیر اسکریپت

یک متغیر که با `s:` پیشوند دارد، یک متغیر اسکریپت است. این متغیرها فقط می‌توانند از داخل آن اسکریپت دسترسی پیدا کنند.

اگر شما یک فایل دلخواه به نام `dozen.vim` داشته باشید و درون آن داشته باشید:

```shell
let s:dozen = 12

function Consume()
  let s:dozen -= 1
  echo s:dozen " is left"
endfunction
```

فایل را با `:source dozen.vim` منبع‌گذاری کنید. حالا تابع `Consume` را فراخوانی کنید:

```shell
:call Consume()
" returns "11 is left"

:call Consume()
" returns "10 is left"

:echo s:dozen
" Undefined variable error
```

زمانی که شما `Consume` را فراخوانی می‌کنید، می‌بینید که مقدار `s:dozen` به درستی کاهش می‌یابد. وقتی سعی می‌کنید مقدار `s:dozen` را مستقیماً بگیرید، Vim آن را پیدا نمی‌کند زیرا شما خارج از دامنه هستید. `s:dozen` فقط از داخل `dozen.vim` قابل دسترسی است.

هر بار که فایل `dozen.vim` را منبع‌گذاری می‌کنید، شمارنده `s:dozen` بازنشانی می‌شود. اگر شما در حال کاهش مقدار `s:dozen` باشید و `:source dozen.vim` را اجرا کنید، شمارنده به 12 بازنشانی می‌شود. این می‌تواند برای کاربران غیرمنتظره یک مشکل باشد. برای رفع این مشکل، کد را بازنویسی کنید:

```shell
if !exists("s:dozen")
  let s:dozen = 12
endif

function Consume()
  let s:dozen -= 1
  echo s:dozen
endfunction
```

حالا وقتی شما `dozen.vim` را در حین کاهش مقدار فراخوانی می‌کنید، Vim `!exists("s:dozen")` را می‌خواند، می‌یابد که درست است و مقدار را به 12 بازنشانی نمی‌کند.

### متغیر محلی تابع و متغیر پارامتر رسمی تابع

هر دو متغیر محلی تابع (`l:`) و متغیر رسمی تابع (`a:`) در فصل بعد پوشش داده خواهند شد.

### متغیرهای داخلی Vim

یک متغیر که با `v:` پیشوند دارد، یک متغیر داخلی خاص Vim است. شما نمی‌توانید این متغیرها را تعریف کنید. شما برخی از آن‌ها را قبلاً دیده‌اید.
- `v:version` به شما می‌گوید که از چه نسخه‌ای از Vim استفاده می‌کنید.
- `v:key` حاوی مقدار آیتم فعلی هنگام تکرار در یک دیکشنری است.
- `v:val` حاوی مقدار آیتم فعلی هنگام اجرای عملیات `map()` یا `filter()` است.
- `v:true`، `v:false`، `v:null` و `v:none` انواع داده خاص هستند.

متغیرهای دیگری نیز وجود دارند. برای لیست متغیرهای داخلی Vim، به `:h vim-variable` یا `:h v:` مراجعه کنید.

## استفاده هوشمندانه از دامنه‌های متغیر Vim

توانایی دسترسی سریع به متغیرهای محیطی، گزینه و ثبت به شما انعطاف‌پذیری گسترده‌ای برای سفارشی‌سازی ویرایشگر و محیط ترمینال شما می‌دهد. همچنین یاد گرفتید که Vim 9 دامنه متغیر مختلف دارد که هر کدام تحت محدودیت‌های خاصی وجود دارند. شما می‌توانید از این نوع متغیرهای منحصر به فرد برای جدا کردن برنامه خود استفاده کنید.

شما تا اینجا پیش رفتید. درباره انواع داده، روش‌های ترکیب و دامنه‌های متغیر یاد گرفتید. تنها یک چیز باقی مانده است: توابع.