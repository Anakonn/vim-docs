---
description: این سند به بررسی روش‌های مختلف و کارآمد ویرایش چندین فایل در ویم می‌پردازد
  و ابزارهای مفیدی را برای انجام این کار معرفی می‌کند.
title: Ch21. Multiple File Operations
---

توانایی به‌روزرسانی در چندین فایل، ابزار ویرایش مفیدی است که باید داشته باشید. قبلاً یاد گرفتید که چگونه می‌توانید چندین متن را با استفاده از `cfdo` به‌روزرسانی کنید. در این فصل، روش‌های مختلف ویرایش چندین فایل در Vim را یاد خواهید گرفت.

## روش‌های مختلف برای اجرای یک فرمان در چندین فایل

Vim دارای هشت روش برای اجرای دستورات در چندین فایل است:
- لیست آرگومان (`argdo`)
- لیست بافر (`bufdo`)
- لیست پنجره (`windo`)
- لیست تب (`tabdo`)
- لیست کیویک‌فیکس (`cdo`)
- لیست کیویک‌فیکس به‌صورت فایل‌محور (`cfdo`)
- لیست مکان (`ldo`)
- لیست مکان به‌صورت فایل‌محور (`lfdo`)

از نظر عملی، احتمالاً شما فقط یک یا دو تا از آن‌ها را بیشتر استفاده خواهید کرد (شخصاً من بیشتر از `cdo` و `argdo` استفاده می‌کنم)، اما خوب است که با تمام گزینه‌های موجود آشنا شوید و از آن‌هایی که با سبک ویرایش شما مطابقت دارد استفاده کنید.

یادگیری هشت دستور ممکن است دلهره‌آور به نظر برسد. اما در واقع، این دستورات به‌طور مشابه عمل می‌کنند. پس از یادگیری یکی، یادگیری بقیه آسان‌تر خواهد شد. آن‌ها همه یک ایده بزرگ مشترک دارند: یک لیست از دسته‌های مربوطه خود بسازید و سپس فرمانی که می‌خواهید اجرا کنید را به آن‌ها بدهید.

## لیست آرگومان

لیست آرگومان ساده‌ترین لیست است. این لیست فایل‌ها را ایجاد می‌کند. برای ایجاد یک لیست از file1، file2 و file3، می‌توانید اجرا کنید:

```shell
:args file1 file2 file3
```

شما همچنین می‌توانید یک wildcard (`*`) به آن بدهید، بنابراین اگر می‌خواهید لیستی از تمام فایل‌های `.js` در دایرکتوری فعلی بسازید، اجرا کنید:

```shell
:args *.js
```

اگر می‌خواهید لیستی از تمام فایل‌های Javascript که با "a" شروع می‌شوند در دایرکتوری فعلی بسازید، اجرا کنید:

```shell
:args a*.js
```

Wildcard یک یا چند کاراکتر نام فایل را در دایرکتوری فعلی مطابقت می‌دهد، اما اگر نیاز دارید در هر دایرکتوری به‌صورت بازگشتی جستجو کنید چه؟ می‌توانید از wildcard دوگانه (`**`) استفاده کنید. برای به‌دست آوردن تمام فایل‌های Javascript درون دایرکتوری‌ها در مکان فعلی خود، اجرا کنید:

```shell
:args **/*.js
```

پس از اجرای فرمان `args`، بافر فعلی شما به اولین مورد در لیست تغییر خواهد کرد. برای مشاهده لیست فایل‌هایی که تازه ایجاد کرده‌اید، اجرا کنید `:args`. پس از ایجاد لیست، می‌توانید در آن‌ها جستجو کنید. `:first` شما را به اولین مورد در لیست می‌برد. `:last` شما را به آخرین مورد در لیست می‌برد. برای حرکت به جلو در لیست یک فایل در هر بار، اجرا کنید `:next`. برای حرکت به عقب در لیست یک فایل در هر بار، اجرا کنید `:prev`. برای حرکت به جلو / عقب یک فایل در هر بار و ذخیره تغییرات، اجرا کنید `:wnext` و `:wprev`. دستورات ناوبری بیشتری وجود دارد. برای اطلاعات بیشتر به `:h arglist` مراجعه کنید.

لیست آرگومان مفید است اگر نیاز دارید نوع خاصی از فایل یا چند فایل را هدف قرار دهید. شاید نیاز داشته باشید تمام "donut" را به "pancake" در تمام فایل‌های `yml` به‌روزرسانی کنید، می‌توانید انجام دهید:

```shell
:args **/*.yml
:argdo %s/donut/pancake/g | update
```

اگر دوباره فرمان `args` را اجرا کنید، لیست قبلی جایگزین خواهد شد. به عنوان مثال، اگر قبلاً اجرا کرده‌اید:

```shell
:args file1 file2 file3
```

با فرض اینکه این فایل‌ها وجود دارند، اکنون یک لیست از `file1`، `file2` و `file3` دارید. سپس این را اجرا می‌کنید:

```shell
:args file4 file5
```

لیست اولیه شما از `file1`، `file2` و `file3` با `file4` و `file5` جایگزین می‌شود. اگر شما `file1`، `file2` و `file3` را در لیست آرگومان خود دارید و می‌خواهید `file4` و `file5` را به لیست اولیه فایل‌های خود اضافه کنید، از فرمان `:arga` استفاده کنید. اجرا کنید:

```shell
:arga file4 file5
```

اکنون شما `file1`، `file2`، `file3`، `file4` و `file5` را در لیست آرگومان خود دارید.

اگر بدون هیچ آرگومانی `:arga` را اجرا کنید، Vim بافر فعلی شما را به لیست آرگومان فعلی اضافه خواهد کرد. اگر قبلاً `file1`، `file2` و `file3` را در لیست آرگومان خود دارید و بافر فعلی شما روی `file5` است، اجرای `:arga` `file5` را به لیست اضافه می‌کند.

پس از اینکه لیست را دارید، می‌توانید آن را با هر فرمان خط فرمانی که انتخاب می‌کنید، بگذرانید. شما دیده‌اید که این کار با جایگزینی (`:argdo %s/donut/pancake/g`) انجام شده است. چند مثال دیگر:
- برای حذف تمام خطوطی که شامل "dessert" در لیست آرگومان هستند، اجرا کنید `:argdo g/dessert/d`.
- برای اجرای ماکرو a (با فرض اینکه چیزی را در ماکرو a ضبط کرده‌اید) در لیست آرگومان، اجرا کنید `:argdo norm @a`.
- برای نوشتن "hello " به‌دنبال نام فایل در خط اول، اجرا کنید `:argdo 0put='hello ' .. @:`.

پس از اتمام، فراموش نکنید که آن‌ها را با `:update` ذخیره کنید.

گاهی اوقات نیاز دارید که دستورات را فقط بر روی n مورد اول از لیست آرگومان اجرا کنید. اگر اینطور باشد، فقط یک آدرس به فرمان `argdo` بدهید. به عنوان مثال، برای اجرای فرمان جایگزینی فقط بر روی سه مورد اول از لیست، اجرا کنید `:1,3argdo %s/donut/pancake/g`.

## لیست بافر

لیست بافر به‌طور ارگانیک زمانی که شما فایل‌های جدید را ویرایش می‌کنید ایجاد می‌شود، زیرا هر بار که یک فایل جدید ایجاد می‌کنید / یک فایل را باز می‌کنید، Vim آن را در یک بافر ذخیره می‌کند (مگر اینکه به‌طور صریح آن را حذف کنید). بنابراین اگر قبلاً ۳ فایل را باز کرده‌اید: `file1.rb file2.rb file3.rb`، شما در حال حاضر ۳ مورد در لیست بافر خود دارید. برای نمایش لیست بافر، اجرا کنید `:buffers` (به‌طور جایگزین: `:ls` یا `:files`). برای جستجوی جلو و عقب، از `:bnext` و `:bprev` استفاده کنید. برای رفتن به اولین و آخرین بافر از لیست، از `:bfirst` و `:blast` استفاده کنید (هنوز هم خوش می‌گذرد؟ :D).

به‌هر حال، اینجا یک ترفند جالب بافر غیر مرتبط با این فصل است: اگر شما تعدادی مورد در لیست بافر خود دارید، می‌توانید همه آن‌ها را با `:ball` (همه بافرها) نمایش دهید. فرمان `ball` همه بافرها را به‌صورت افقی نمایش می‌دهد. برای نمایش آن‌ها به‌صورت عمودی، اجرا کنید `:vertical ball`.

برگردیم به موضوع، مکانیزم اجرای عملیات در تمام بافرها مشابه لیست آرگومان است. پس از ایجاد لیست بافر خود، فقط کافی است که فرمان(ها)یی که می‌خواهید اجرا کنید را با `:bufdo` به‌جای `:argdo` پیشوند بزنید. بنابراین اگر می‌خواهید تمام "donut" را با "pancake" در تمام بافرها جایگزین کنید و سپس تغییرات را ذخیره کنید، اجرا کنید `:bufdo %s/donut/pancake/g | update`.

## لیست پنجره و تب

لیست پنجره‌ها و تب‌ها نیز مشابه لیست آرگومان و بافر است. تنها تفاوت‌ها در زمینه و نحو آن‌هاست.

عملیات پنجره‌ها بر روی هر پنجره باز انجام می‌شود و با `:windo` انجام می‌شود. عملیات تب‌ها بر روی هر تب که باز کرده‌اید انجام می‌شود و با `:tabdo` انجام می‌شود. برای اطلاعات بیشتر، به `:h list-repeat`، `:h :windo` و `:h :tabdo` مراجعه کنید.

به عنوان مثال، اگر شما سه پنجره باز دارید (می‌توانید پنجره‌های جدید را با `Ctrl-W v` برای یک پنجره عمودی و `Ctrl-W s` برای یک پنجره افقی باز کنید) و شما `:windo 0put ='hello' . @%` را اجرا کنید، Vim "hello" + نام فایل را به تمام پنجره‌های باز خروجی می‌دهد.

## لیست کیویک‌فیکس

در فصل‌های قبلی (فصل 3 و 19)، من درباره کیویک‌فیکس‌ها صحبت کرده‌ام. کیویک‌فیکس کاربردهای زیادی دارد. بسیاری از پلاگین‌های محبوب از کیویک‌فیکس‌ها استفاده می‌کنند، بنابراین خوب است که زمان بیشتری را برای درک آن‌ها صرف کنید.

اگر شما تازه‌کار در Vim هستید، کیویک‌فیکس ممکن است یک مفهوم جدید باشد. در روزهای قدیم که واقعاً باید کد خود را به‌طور صریح کامپایل می‌کردید، در مرحله کامپایل با خطاهایی مواجه می‌شدید. برای نمایش این خطاها، به یک پنجره خاص نیاز داشتید. اینجاست که کیویک‌فیکس وارد می‌شود. وقتی کد خود را کامپایل می‌کنید، Vim پیام‌های خطا را در پنجره کیویک‌فیکس نمایش می‌دهد تا بتوانید بعداً آن‌ها را اصلاح کنید. بسیاری از زبان‌های مدرن دیگر نیازی به کامپایل صریح ندارند، اما این به معنای منسوخ شدن کیویک‌فیکس نیست. امروزه، مردم از کیویک‌فیکس برای انواع مختلف کارها استفاده می‌کنند، مانند نمایش خروجی یک ترمینال مجازی و ذخیره نتایج جستجو. بیایید بر روی دومی، یعنی ذخیره نتایج جستجو تمرکز کنیم.

علاوه بر دستورات کامپایل، برخی از دستورات Vim به رابط‌های کیویک‌فیکس وابسته هستند. یکی از انواع دستورات که به‌طور گسترده از کیویک‌فیکس‌ها استفاده می‌کند، دستورات جستجو هستند. هر دو `:vimgrep` و `:grep` به‌طور پیش‌فرض از کیویک‌فیکس‌ها استفاده می‌کنند.

به عنوان مثال، اگر نیاز دارید "donut" را در تمام فایل‌های Javascript به‌صورت بازگشتی جستجو کنید، می‌توانید اجرا کنید:

```shell
:vimgrep /donut/ **/*.js
```

نتیجه جستجوی "donut" در پنجره کیویک‌فیکس ذخیره می‌شود. برای دیدن نتایج مطابقت در پنجره کیویک‌فیکس، اجرا کنید:

```shell
:copen
```

برای بستن آن، اجرا کنید:

```shell
:cclose
```

برای جستجوی لیست کیویک‌فیکس به جلو و عقب، اجرا کنید:

```shell
:cnext
:cprev
```

برای رفتن به اولین و آخرین مورد در مطابقت، اجرا کنید:

```shell
:cfirst
:clast
```

قبلاً اشاره کردم که دو فرمان کیویک‌فیکس وجود دارد: `cdo` و `cfdo`. تفاوت آن‌ها چیست؟ `cdo` فرمان را برای هر مورد در لیست کیویک‌فیکس اجرا می‌کند در حالی که `cfdo` فرمان را برای هر *فایل* در لیست کیویک‌فیکس اجرا می‌کند.

بگذارید روشن کنم. فرض کنید که پس از اجرای فرمان `vimgrep` بالا، شما پیدا کردید:
- 1 نتیجه در `file1.js`
- 10 نتیجه در `file2.js`

اگر شما `:cfdo %s/donut/pancake/g` را اجرا کنید، این به‌طور مؤثر `%s/donut/pancake/g` را یک بار در `file1.js` و یک بار در `file2.js` اجرا می‌کند. این به تعداد فایل‌های موجود در مطابقت اجرا می‌شود. از آنجا که دو فایل در نتایج وجود دارد، Vim فرمان جایگزینی را یک بار در `file1.js` و یک بار دیگر در `file2.js` اجرا می‌کند، با وجود اینکه در فایل دوم 10 مطابقت وجود دارد. `cfdo` فقط به تعداد کل فایل‌های موجود در لیست کیویک‌فیکس اهمیت می‌دهد.

اگر شما `:cdo %s/donut/pancake/g` را اجرا کنید، این به‌طور مؤثر `%s/donut/pancake/g` را یک بار در `file1.js` و *ده بار* در `file2.js` اجرا می‌کند. این به تعداد موارد واقعی در لیست کیویک‌فیکس اجرا می‌شود. از آنجا که فقط یک مطابقت در `file1.js` و 10 مطابقت در `file2.js` پیدا شده است، در مجموع 11 بار اجرا می‌شود.

از آنجا که شما `%s/donut/pancake/g` را اجرا کردید، منطقی است که از `cfdo` استفاده کنید. استفاده از `cdo` منطقی نیست زیرا `%s/donut/pancake/g` را ده بار در `file2.js` اجرا می‌کند ( `%s` یک جایگزینی فایل‌محور است). اجرای `%s` یک بار در هر فایل کافی است. اگر شما از `cdo` استفاده کنید، منطقی‌تر است که آن را با `s/donut/pancake/g` بگذرانید.

هنگام تصمیم‌گیری برای استفاده از `cfdo` یا `cdo`، به دامنه دستوری که به آن می‌پردازید فکر کنید. آیا این یک فرمان فایل‌محور است (مانند `:%s` یا `:g`) یا یک فرمان خط‌محور است (مانند `:s` یا `:!`)؟

## لیست مکان

لیست مکان مشابه لیست کیویک‌فیکس است به این معنا که Vim همچنین از یک پنجره خاص برای نمایش پیام‌ها استفاده می‌کند. تفاوت بین لیست کیویک‌فیکس و لیست مکان این است که در هر زمان، شما ممکن است فقط یک لیست کیویک‌فیکس داشته باشید، در حالی که می‌توانید به تعداد دلخواه لیست مکان داشته باشید.

فرض کنید که شما دو پنجره باز دارید، یک پنجره که `food.txt` را نمایش می‌دهد و دیگری که `drinks.txt` را نمایش می‌دهد. از داخل `food.txt`، شما یک فرمان جستجوی لیست مکان `:lvimgrep` را اجرا می‌کنید (نوع مکان برای فرمان `:vimgrep`):

```shell
:lvim /bagel/ **/*.md
```

Vim یک لیست مکان از تمام مطابقت‌های جستجوی bagel برای آن *پنجره food.txt* ایجاد می‌کند. شما می‌توانید لیست مکان را با `:lopen` مشاهده کنید. اکنون به پنجره دیگر `drinks.txt` بروید و اجرا کنید:

```shell
:lvimgrep /milk/ **/*.md
```

Vim یک لیست مکان *مجزا* با تمام نتایج جستجوی شیر برای آن *پنجره drinks.txt* ایجاد می‌کند.

برای هر فرمان مکان که در هر پنجره اجرا می‌کنید، Vim یک لیست مکان متمایز ایجاد می‌کند. اگر شما 10 پنجره مختلف داشته باشید، می‌توانید حداکثر 10 لیست مکان مختلف داشته باشید. این را با لیست کیویک‌فیکس مقایسه کنید که در هر زمان فقط می‌توانید یک مورد از آن داشته باشید. اگر شما 10 پنجره مختلف داشته باشید، هنوز هم فقط یک لیست کیویک‌فیکس خواهید داشت.

بیشتر دستورات لیست مکان مشابه دستورات کیویک‌فیکس هستند، به جز اینکه با `l-` پیشوند زده شده‌اند. به عنوان مثال: `:lvimgrep`، `:lgrep` و `:lmake` در مقابل `:vimgrep`، `:grep` و `:make`. برای دستکاری پنجره لیست مکان، دوباره، دستورات مشابه دستورات کیویک‌فیکس هستند: `:lopen`، `:lclose`، `:lfirst`، `:llast`، `:lnext` و `:lprev` در مقابل `:copen`، `:cclose`، `:cfirst`، `:clast`، `:cnext` و `:cprev`.

دو فرمان چندفایلی لیست مکان نیز مشابه دستورات چندفایلی کیویک‌فیکس هستند: `:ldo` و `:lfdo`. `:ldo` فرمان مکان را در هر لیست مکان اجرا می‌کند در حالی که `:lfdo` فرمان لیست مکان را برای هر فایل در لیست مکان اجرا می‌کند. برای اطلاعات بیشتر، به `:h location-list` مراجعه کنید.
## انجام عملیات چندفایلی در Vim

دانستن چگونگی انجام یک عملیات چندفایلی مهارت مفیدی در ویرایش است. هرگاه نیاز به تغییر نام یک متغیر در چندین فایل داشته باشید، می‌خواهید آن‌ها را در یک مرحله اجرا کنید. Vim هشت روش مختلف برای انجام این کار دارد.

از نظر عملی، احتمالاً همه هشت روش را به یک اندازه استفاده نخواهید کرد. شما به یکی یا دو تا از آن‌ها تمایل خواهید داشت. وقتی که تازه شروع می‌کنید، یکی را انتخاب کنید (شخصاً پیشنهاد می‌کنم با لیست آرگ `:argdo` شروع کنید) و آن را به خوبی یاد بگیرید. وقتی با یکی راحت شدید، سپس دومی را یاد بگیرید. متوجه خواهید شد که یادگیری دومی، سومی و چهارمی آسان‌تر می‌شود. خلاق باشید. از آن با ترکیب‌های مختلف استفاده کنید. به تمرین ادامه دهید تا بتوانید این کار را بدون زحمت و بدون فکر کردن انجام دهید. آن را بخشی از حافظه عضلانی خود کنید.

با این اوصاف، شما ویرایش در Vim را به خوبی یاد گرفته‌اید. تبریک می‌گویم!