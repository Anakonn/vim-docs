---
description: این سند به شما آموزش می‌دهد که چگونه با استفاده از View، Session و Viminfo
  تغییرات پروژه‌های خود را در ویم حفظ کنید.
title: Ch20. Views, Sessions, and Viminfo
---

بعد از اینکه مدتی روی یک پروژه کار کردید، ممکن است متوجه شوید که پروژه به تدریج شکل می‌گیرد و تنظیمات، تاخوردگی‌ها، بافرها، چیدمان‌ها و غیره خاص خود را پیدا می‌کند. این مانند تزئین آپارتمان شما پس از زندگی در آن برای مدتی است. مشکل این است که وقتی Vim را می‌بندید، این تغییرات را از دست می‌دهید. آیا خوب نیست اگر بتوانید این تغییرات را حفظ کنید تا دفعه بعد که Vim را باز می‌کنید، درست به همان شکل باشد که انگار هرگز آن را ترک نکرده‌اید؟

در این فصل، شما یاد خواهید گرفت که چگونه از View، Session و Viminfo برای حفظ یک "عکس فوری" از پروژه‌های خود استفاده کنید.

## View

یک View کوچک‌ترین زیرمجموعه از سه (View، Session، Viminfo) است. این یک مجموعه از تنظیمات برای یک پنجره است. اگر مدت طولانی روی یک پنجره کار کنید و بخواهید نقشه‌ها و تاخوردگی‌ها را حفظ کنید، می‌توانید از یک View استفاده کنید.

بیایید یک فایل به نام `foo.txt` ایجاد کنیم:

```shell
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

در این فایل، سه تغییر ایجاد کنید:
1. در خط 1، یک تاخوردگی دستی `zf4j` ایجاد کنید (۴ خط بعدی را تا کنید).
2. تنظیم `number` را تغییر دهید: `setlocal nonumber norelativenumber`. این شماره‌های نشان‌دهنده را در سمت چپ پنجره حذف می‌کند.
3. یک نقشه محلی ایجاد کنید تا هر بار که `j` را فشار می‌دهید، به جای یک خط، دو خط پایین بروید: `:nnoremap <buffer> j jj`.

فایل شما باید به این شکل باشد:

```shell
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

### پیکربندی ویژگی‌های View

اجرا کنید:

```shell
:set viewoptions?
```

به طور پیش‌فرض باید بگوید (ممکن است ظاهر شما متفاوت باشد بسته به vimrc شما):

```shell
viewoptions=folds,cursor,curdir
```

بیایید `viewoptions` را پیکربندی کنیم. سه ویژگی که می‌خواهید حفظ کنید، تاخوردگی‌ها، نقشه‌ها و گزینه‌های محلی تنظیم شده هستند. اگر تنظیم شما مانند من است، شما قبلاً گزینه `folds` را دارید. باید به View بگویید که `localoptions` را به خاطر بسپارد. اجرا کنید:

```shell
:set viewoptions+=localoptions
```

برای یادگیری اینکه چه گزینه‌های دیگری برای `viewoptions` در دسترس هستند، به `:h viewoptions` مراجعه کنید. حالا اگر `:set viewoptions?` را اجرا کنید، باید ببینید:

```shell
viewoptions=folds,cursor,curdir,localoptions
```

### ذخیره View

با پنجره `foo.txt` که به درستی تا شده و گزینه‌های `nonumber norelativenumber` را دارد، بیایید View را ذخیره کنیم. اجرا کنید:

```shell
:mkview
```

Vim یک فایل View ایجاد می‌کند.

### فایل‌های View

شاید بپرسید، "Vim این فایل View را کجا ذخیره کرد؟" برای دیدن اینکه Vim کجا آن را ذخیره می‌کند، اجرا کنید:

```shell
:set viewdir?
```

در سیستم‌عامل‌های مبتنی بر یونیکس به طور پیش‌فرض باید بگوید `~/.vim/view` (اگر سیستم‌عامل شما متفاوت است، ممکن است مسیر متفاوتی نشان دهد. برای اطلاعات بیشتر به `:h viewdir` مراجعه کنید). اگر شما در حال اجرای یک سیستم‌عامل مبتنی بر یونیکس هستید و می‌خواهید آن را به مسیر دیگری تغییر دهید، این را به vimrc خود اضافه کنید:

```shell
set viewdir=$HOME/else/where
```

### بارگذاری فایل View

اگر هنوز `foo.txt` را نبسته‌اید، آن را دوباره باز کنید. **شما باید متن اصلی را بدون تغییرات ببینید.** این انتظار می‌رود.

برای بازگرداندن حالت، باید فایل View را بارگذاری کنید. اجرا کنید:

```shell
:loadview
```

حالا باید ببینید:

```shell
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

تاخوردگی‌ها، تنظیمات محلی و نقشه‌های محلی بازگردانی شده‌اند. اگر متوجه شوید، نشانگر شما نیز باید در خطی باشد که شما آن را ترک کرده‌اید وقتی که `:mkview` را اجرا کردید. تا زمانی که گزینه `cursor` را دارید، View همچنین موقعیت نشانگر شما را به خاطر می‌سپارد.

### چندین View

Vim به شما اجازه می‌دهد 9 View شماره‌گذاری شده (1-9) را ذخیره کنید.

فرض کنید می‌خواهید یک تاخوردگی اضافی ایجاد کنید (مثلاً می‌خواهید دو خط آخر را تا کنید) با `:9,10 fold`. بیایید این را به عنوان View 1 ذخیره کنیم. اجرا کنید:

```shell
:mkview 1
```

اگر می‌خواهید یک تاخوردگی دیگر با `:6,7 fold` ایجاد کنید و آن را به عنوان یک View متفاوت ذخیره کنید، اجرا کنید:

```shell
:mkview 2
```

فایل را ببندید. وقتی `foo.txt` را باز می‌کنید و می‌خواهید View 1 را بارگذاری کنید، اجرا کنید:

```shell
:loadview 1
```

برای بارگذاری View 2، اجرا کنید:

```shell
:loadview 2
```

برای بارگذاری View اصلی، اجرا کنید:

```shell
:loadview
```

### خودکار کردن ایجاد View

یکی از بدترین چیزهایی که می‌تواند اتفاق بیفتد این است که بعد از صرف ساعت‌ها برای سازماندهی یک فایل بزرگ با تاخوردگی‌ها، به طور تصادفی پنجره را ببندید و تمام اطلاعات تاخوردگی را از دست بدهید. برای جلوگیری از این، ممکن است بخواهید هر بار که یک بافر را می‌بندید، به طور خودکار یک View ایجاد کنید. این را به vimrc خود اضافه کنید:

```shell
autocmd BufWinLeave *.txt mkview
```

علاوه بر این، ممکن است خوب باشد که View را هنگام باز کردن یک بافر بارگذاری کنید:

```shell
autocmd BufWinEnter *.txt silent loadview
```

حالا دیگر نیازی به نگرانی درباره ایجاد و بارگذاری View ندارید وقتی که با فایل‌های `txt` کار می‌کنید. به یاد داشته باشید که با گذشت زمان، `~/.vim/view` شما ممکن است شروع به انباشتن فایل‌های View کند. خوب است هر چند ماه یک بار آن را تمیز کنید.

## Sessions

اگر یک View تنظیمات یک پنجره را ذخیره کند، یک Session اطلاعات تمام پنجره‌ها (شامل چیدمان) را ذخیره می‌کند.

### ایجاد یک Session جدید

فرض کنید شما با این 3 فایل در یک پروژه `foobarbaz` کار می‌کنید:

درون `foo.txt`:

```shell
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

درون `bar.txt`:

```shell
bar1
bar2
bar3
bar4
bar5
bar6
bar7
bar8
bar9
bar10
```

درون `baz.txt`:

```shell
baz1
baz2
baz3
baz4
baz5
baz6
baz7
baz8
baz9
baz10
```

حالا فرض کنید که شما پنجره‌های خود را با `:split` و `:vsplit` تقسیم کرده‌اید. برای حفظ این ظاهر، باید Session را ذخیره کنید. اجرا کنید:

```shell
:mksession
```

برخلاف `mkview` که به طور پیش‌فرض در `~/.vim/view` ذخیره می‌شود، `mksession` یک فایل Session (`Session.vim`) را در دایرکتوری فعلی ذخیره می‌کند. اگر کنجکاو هستید، فایل را بررسی کنید که چه چیزی درون آن است.

اگر می‌خواهید فایل Session را در جای دیگری ذخیره کنید، می‌توانید یک آرگومان به `mksession` بدهید:

```shell
:mksession ~/some/where/else.vim
```

اگر می‌خواهید فایل Session موجود را بازنویسی کنید، دستور را با یک `!` صدا بزنید (`:mksession! ~/some/where/else.vim`).

### بارگذاری یک Session

برای بارگذاری یک Session، اجرا کنید:

```shell
:source Session.vim
```

حالا Vim درست به شکلی که شما آن را ترک کرده‌اید، به نظر می‌رسد، شامل پنجره‌های تقسیم شده! به طور جایگزین، می‌توانید یک فایل Session را از ترمینال بارگذاری کنید:

```shell
vim -S Session.vim
```

### پیکربندی ویژگی‌های Session

شما می‌توانید ویژگی‌هایی که Session ذخیره می‌کند را پیکربندی کنید. برای دیدن اینکه چه چیزی در حال حاضر ذخیره می‌شود، اجرا کنید:

```shell
:set sessionoptions?
```

مال من می‌گوید:

```shell
blank,buffers,curdir,folds,help,tabpages,winsize,terminal
```

اگر نمی‌خواهید `terminal` را هنگام ذخیره یک Session ذخیره کنید، آن را از گزینه‌های Session حذف کنید. اجرا کنید:

```shell
:set sessionoptions-=terminal
```

اگر می‌خواهید یک `options` را هنگام ذخیره یک Session اضافه کنید، اجرا کنید:

```shell
:set sessionoptions+=options
```

در اینجا برخی از ویژگی‌هایی که `sessionoptions` می‌تواند ذخیره کند وجود دارد:
- `blank` پنجره‌های خالی را ذخیره می‌کند
- `buffers` بافرها را ذخیره می‌کند
- `folds` تاخوردگی‌ها را ذخیره می‌کند
- `globals` متغیرهای جهانی را ذخیره می‌کند (باید با یک حرف بزرگ شروع شود و حداقل یک حرف کوچک داشته باشد)
- `options` گزینه‌ها و نقشه‌ها را ذخیره می‌کند
- `resize` خطوط و ستون‌های پنجره را ذخیره می‌کند
- `winpos` موقعیت پنجره را ذخیره می‌کند
- `winsize` اندازه‌های پنجره را ذخیره می‌کند
- `tabpages` زبانه‌ها را ذخیره می‌کند
- `unix` فایل‌ها را در فرمت یونیکس ذخیره می‌کند

برای لیست کامل به `:h 'sessionoptions'` مراجعه کنید.

Session یک ابزار مفید برای حفظ ویژگی‌های خارجی پروژه شما است. با این حال، برخی از ویژگی‌های داخلی توسط Session ذخیره نمی‌شوند، مانند نشانه‌های محلی، ثبت‌ها، تاریخچه‌ها و غیره. برای ذخیره آن‌ها، باید از Viminfo استفاده کنید!

## Viminfo

اگر متوجه شده‌اید، بعد از کپی کردن یک کلمه به ثبت a و خروج از Vim، دفعه بعد که Vim را باز می‌کنید، هنوز آن متن در ثبت a ذخیره شده است. این در واقع کار Viminfo است. بدون آن، Vim پس از بستن آن، ثبت را به خاطر نخواهد سپرد.

اگر از Vim 8 یا بالاتر استفاده می‌کنید، Vim به طور پیش‌فرض Viminfo را فعال می‌کند، بنابراین ممکن است شما تمام این مدت از Viminfo استفاده کرده باشید بدون اینکه بدانید!

شاید بپرسید: "Viminfo چه چیزی را ذخیره می‌کند؟ چگونه با Session متفاوت است؟"

برای استفاده از Viminfo، ابتدا باید ویژگی `+viminfo` در دسترس باشد (`:version`). Viminfo ذخیره می‌کند:
- تاریخچه خط فرمان.
- تاریخچه رشته جستجو.
- تاریخچه خط ورودی.
- محتویات ثبت‌های غیر خالی.
- نشانه‌ها برای چندین فایل.
- نشانه‌های فایل، که به مکان‌هایی در فایل‌ها اشاره می‌کند.
- الگوی آخرین جستجو / جایگزینی (برای 'n' و '&').
- لیست بافر.
- متغیرهای جهانی.

به طور کلی، Session ویژگی‌های "خارجی" را ذخیره می‌کند و Viminfo ویژگی‌های "داخلی" را.

برخلاف Session که می‌توانید یک فایل Session برای هر پروژه داشته باشید، معمولاً از یک فایل Viminfo برای هر کامپیوتر استفاده می‌کنید. Viminfo مستقل از پروژه است.

محل پیش‌فرض Viminfo برای یونیکس `$HOME/.viminfo` (`~/.viminfo`) است. اگر از سیستم‌عامل متفاوتی استفاده می‌کنید، محل Viminfo شما ممکن است متفاوت باشد. به `:h viminfo-file-name` مراجعه کنید. هر بار که تغییرات "داخلی" ایجاد می‌کنید، مانند کپی کردن متنی به یک ثبت، Vim به طور خودکار فایل Viminfo را به‌روزرسانی می‌کند.

*اطمینان حاصل کنید که گزینه `nocompatible` تنظیم شده است (`set nocompatible`)، در غیر این صورت Viminfo شما کار نخواهد کرد.*

### نوشتن و خواندن Viminfo

اگرچه شما فقط از یک فایل Viminfo استفاده خواهید کرد، می‌توانید چندین فایل Viminfo ایجاد کنید. برای نوشتن یک فایل Viminfo، از دستور `:wviminfo` استفاده کنید (`:wv` برای کوتاه).

```shell
:wv ~/.viminfo_extra
```

برای بازنویسی یک فایل Viminfo موجود، یک علامت تعجب به دستور `wv` اضافه کنید:

```shell
:wv! ~/.viminfo_extra
```

به طور پیش‌فرض Vim از فایل `~/.viminfo` می‌خواند. برای خواندن از یک فایل Viminfo متفاوت، اجرا کنید `:rviminfo`، یا `:rv` برای کوتاه:

```shell
:rv ~/.viminfo_extra
```

برای شروع Vim با یک فایل Viminfo متفاوت از ترمینال، از پرچم `i` استفاده کنید:

```shell
vim -i viminfo_extra
```

اگر از Vim برای وظایف مختلف، مانند کدنویسی و نوشتن استفاده می‌کنید، می‌توانید یک Viminfo بهینه‌شده برای نوشتن و دیگری برای کدنویسی ایجاد کنید.

```shell
vim -i viminfo_writing

vim -i viminfo_coding
```

### شروع Vim بدون Viminfo

برای شروع Vim بدون Viminfo، می‌توانید از ترمینال اجرا کنید:

```shell
vim -i NONE
```

برای دائمی کردن آن، می‌توانید این را در فایل vimrc خود اضافه کنید:

```shell
set viminfo="NONE"
```

### پیکربندی ویژگی‌های Viminfo

مشابه `viewoptions` و `sessionoptions`، می‌توانید به Vim بگویید که چه ویژگی‌هایی را با گزینه `viminfo` ذخیره کند. اجرا کنید:

```shell
:set viminfo?
```

شما خواهید دید:

```shell
!,'100,<50,s10,h
```

این به نظر رمزآلود می‌آید. بیایید آن را تجزیه کنیم:
- `!` متغیرهای جهانی که با یک حرف بزرگ شروع می‌شوند و حروف کوچک ندارند را ذخیره می‌کند. به یاد داشته باشید که `g:` نشان‌دهنده یک متغیر جهانی است. به عنوان مثال، اگر در یک نقطه شما انتساب `let g:FOO = "foo"` را نوشتید، Viminfo متغیر جهانی `FOO` را ذخیره می‌کند. اما اگر شما `let g:Foo = "foo"` را انجام دهید، Viminfo این متغیر جهانی را ذخیره نخواهد کرد زیرا حروف کوچک دارد. بدون `!`، Vim آن متغیرهای جهانی را ذخیره نخواهد کرد.
- `'100` نشانه‌ها را نشان می‌دهد. در این مورد، Viminfo نشانه‌های محلی (a-z) آخرین 100 فایل را ذخیره می‌کند. به یاد داشته باشید که اگر به Viminfo بگویید که فایل‌های زیادی را ذخیره کند، Vim ممکن است شروع به کند شدن کند. 1000 عدد خوبی برای داشتن است.
- `<50` به Viminfo می‌گوید که حداکثر چند خط برای هر ثبت ذخیره شود (در این مورد 50). اگر من 100 خط متن را به ثبت a کپی کنم (`"ay99j`) و Vim را ببندم، دفعه بعد که Vim را باز می‌کنم و از ثبت a چسباندن می‌کنم (`"ap`)، Vim حداکثر 50 خط را چسباندن خواهد کرد. اگر حداکثر تعداد خط را ندهید، *همه* خطوط ذخیره خواهند شد. اگر 0 بدهید، هیچ چیزی ذخیره نخواهد شد.
- `s10` یک حد اندازه (به کیلوبایت) برای یک ثبت تنظیم می‌کند. در این مورد، هر ثبت بزرگتر از 10 کیلوبایت اندازه، مستثنی خواهد شد.
- `h` هایلایت کردن (از `hlsearch`) را هنگام شروع Vim غیرفعال می‌کند.

گزینه‌های دیگری نیز وجود دارد که می‌توانید بدهید. برای یادگیری بیشتر، به `:h 'viminfo'` مراجعه کنید.
## استفاده هوشمندانه از Views، Sessions و Viminfo

Vim دارای View، Session و Viminfo است تا از محیط Vim شما در سطوح مختلف عکس‌برداری کند. برای پروژه‌های کوچک، از Views استفاده کنید. برای پروژه‌های بزرگ‌تر، از Sessions استفاده کنید. باید وقت بگذارید تا تمام گزینه‌هایی که View، Session و Viminfo ارائه می‌دهند را بررسی کنید.

View، Session و Viminfo خود را برای سبک ویرایش خود ایجاد کنید. اگر هرگز نیاز به استفاده از Vim در خارج از کامپیوتر خود داشتید، می‌توانید به سادگی تنظیمات خود را بارگذاری کنید و بلافاصله احساس راحتی خواهید کرد!