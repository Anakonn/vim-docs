---
description: این سند به شما آموزش می‌دهد که چگونه با استفاده از دستورات خارجی در ویم،
  کارایی و امکانات ویرایشگر را افزایش دهید.
title: Ch14. External Commands
---

داخل سیستم یونیکس، شما با بسیاری از دستورات کوچک و فوق‌تخصصی روبرو خواهید شد که یک کار را انجام می‌دهند (و آن را به خوبی انجام می‌دهند). شما می‌توانید این دستورات را به هم زنجیر کنید تا با هم کار کنند و یک مشکل پیچیده را حل کنند. آیا خوب نیست که بتوانید این دستورات را از داخل Vim استفاده کنید؟

قطعا. در این فصل، شما یاد خواهید گرفت که چگونه Vim را برای کار بدون درز با دستورات خارجی گسترش دهید.

## دستور Bang

Vim یک دستور bang (`!`) دارد که می‌تواند سه کار انجام دهد:

1. خواندن STDOUT یک دستور خارجی به بافر فعلی.
2. نوشتن محتوای بافر شما به عنوان STDIN به یک دستور خارجی.
3. اجرای یک دستور خارجی از داخل Vim.

بیایید هر یک از آن‌ها را بررسی کنیم.

## خواندن STDOUT یک دستور به Vim

نحو خواندن STDOUT یک دستور خارجی به بافر فعلی به این صورت است:

```shell
:r !cmd
```

`:r` دستور خواندن Vim است. اگر از آن بدون `!` استفاده کنید، می‌توانید از آن برای دریافت محتوای یک فایل استفاده کنید. اگر یک فایل `file1.txt` در دایرکتوری فعلی داشته باشید و اجرا کنید:

```shell
:r file1.txt
```

Vim محتوای `file1.txt` را به بافر فعلی وارد می‌کند.

اگر دستور `:r` را با یک `!` و یک دستور خارجی دنبال کنید، خروجی آن دستور به بافر فعلی وارد خواهد شد. برای دریافت نتیجه دستور `ls`، اجرا کنید:

```shell
:r !ls
```

این چیزی شبیه به این برمی‌گرداند:

```shell
file1.txt
file2.txt
file3.txt
```

شما می‌توانید داده‌ها را از دستور `curl` بخوانید:

```shell
:r !curl -s 'https://jsonplaceholder.typicode.com/todos/1'
```

دستور `r` همچنین یک آدرس را می‌پذیرد:

```shell
:10r !cat file1.txt
```

اکنون STDOUT از اجرای `cat file1.txt` بعد از خط 10 وارد خواهد شد.

## نوشتن محتوای بافر به یک دستور خارجی

دستور `:w`، علاوه بر ذخیره یک فایل، می‌تواند برای ارسال متن در بافر فعلی به عنوان STDIN به یک دستور خارجی استفاده شود. نحو آن به این صورت است:

```shell
:w !cmd
```

اگر این عبارات را داشته باشید:

```shell
console.log("Hello Vim");
console.log("Vim is awesome");
```

اطمینان حاصل کنید که [node](https://nodejs.org/en/) در دستگاه شما نصب شده است، سپس اجرا کنید:

```shell
:w !node
```

Vim از `node` برای اجرای عبارات جاوااسکریپت به منظور چاپ "Hello Vim" و "Vim is awesome" استفاده خواهد کرد.

هنگام استفاده از دستور `:w`، Vim از تمام متون در بافر فعلی استفاده می‌کند، مشابه دستور جهانی (بیشتر دستورات خط فرمان، اگر به آن یک محدوده ندهید، تنها دستور را در برابر خط فعلی اجرا می‌کنند). اگر به `:w` یک آدرس خاص بدهید:

```shell
:2w !node
```

Vim تنها از متن خط دوم به مفسر `node` استفاده می‌کند.

تفاوت ظریف اما قابل توجهی بین `:w !node` و `:w! node` وجود دارد. با `:w !node`، شما متن در بافر فعلی را به دستور خارجی `node` "می‌نویسید". با `:w! node`، شما یک فایل را به زور ذخیره کرده و نام فایل را "node" می‌گذارید.

## اجرای یک دستور خارجی

شما می‌توانید یک دستور خارجی را از داخل Vim با دستور bang اجرا کنید. نحو آن به این صورت است:

```shell
:!cmd
```

برای دیدن محتوای دایرکتوری فعلی در فرمت طولانی، اجرا کنید:

```shell
:!ls -ls
```

برای کشتن یک فرآیند که در PID 3456 در حال اجرا است، می‌توانید اجرا کنید:

```shell
:!kill -9 3456
```

شما می‌توانید هر دستور خارجی را بدون ترک Vim اجرا کنید تا بتوانید بر روی کار خود متمرکز بمانید.

## فیلتر کردن متون

اگر به `!` یک محدوده بدهید، می‌تواند برای فیلتر کردن متون استفاده شود. فرض کنید شما متون زیر را دارید:

```shell
hello vim
hello vim
```

بیایید خط فعلی را با استفاده از دستور `tr` (ترجمه) به حروف بزرگ تبدیل کنیم. اجرا کنید:

```shell
:.!tr '[:lower:]' '[:upper:]'
```

نتیجه:

```shell
HELLO VIM
hello vim
```

تجزیه و تحلیل:
- `.!` دستور فیلتر را بر روی خط فعلی اجرا می‌کند.
- `tr '[:lower:]' '[:upper:]'` دستور `tr` را برای جایگزینی تمام حروف کوچک با حروف بزرگ فراخوانی می‌کند.

ضروری است که یک محدوده را برای اجرای دستور خارجی به عنوان فیلتر ارسال کنید. اگر سعی کنید دستور بالا را بدون `.` (`:!tr '[:lower:]' '[:upper:]'`) اجرا کنید، با خطا مواجه خواهید شد.

بیایید فرض کنیم که شما نیاز دارید ستون دوم را در هر دو خط با دستور `awk` حذف کنید:

```shell
:%!awk "{print $1}"
```

نتیجه:

```shell
hello
hello
```

تجزیه و تحلیل:
- `:%!` دستور فیلتر را بر روی تمام خطوط (`%`) اجرا می‌کند.
- `awk "{print $1}"` تنها ستون اول مطابقت را چاپ می‌کند.

شما می‌توانید چندین دستور را با اپراتور زنجیره‌ای (`|`) درست مانند ترمینال زنجیره کنید. فرض کنید شما فایلی با این اقلام خوشمزه صبحانه دارید:

```shell
name price
chocolate pancake 10
buttermilk pancake 9
blueberry pancake 12
```

اگر نیاز دارید آن‌ها را بر اساس قیمت مرتب کنید و تنها منو را با فاصله‌های یکنواخت نمایش دهید، می‌توانید اجرا کنید:

```shell
:%!awk 'NR > 1' | sort -nk 3 | column -t
```

نتیجه:
```shell
buttermilk pancake 9
chocolate pancake 10
blueberry pancake 12
```

تجزیه و تحلیل:
- `:%!` فیلتر را بر روی تمام خطوط (`%`) اعمال می‌کند.
- `awk 'NR > 1'` تنها متون را از ردیف شماره دو به بعد نمایش می‌دهد.
- `|` دستور بعدی را زنجیره می‌کند.
- `sort -nk 3` به صورت عددی (`n`) با استفاده از مقادیر ستون 3 (`k 3`) مرتب می‌کند.
- `column -t` متن را با فاصله‌های یکنواخت سازماندهی می‌کند.

## دستور حالت عادی

Vim یک اپراتور فیلتر (`!`) در حالت عادی دارد. اگر شما سلام‌های زیر را داشته باشید:

```shell
hello vim
hola vim
bonjour vim
salve vim
```

برای تبدیل خط فعلی و خط زیرین به حروف بزرگ، می‌توانید اجرا کنید:
```shell
!jtr '[a-z]' '[A-Z]'
```

تجزیه و تحلیل:
- `!j` اپراتور فیلتر دستور عادی (`!`) را بر روی خط فعلی و خط زیرین اجرا می‌کند. به یاد داشته باشید که از آنجا که این یک اپراتور حالت عادی است، قاعده گرامری `فعل + اسم` اعمال می‌شود. `!` فعل و `j` اسم است.
- `tr '[a-z]' '[A-Z]'` حروف کوچک را با حروف بزرگ جایگزین می‌کند.

دستور فیلتر عادی تنها بر روی حرکات / اشیاء متنی که حداقل یک خط یا بیشتر هستند کار می‌کند. اگر سعی کنید `!iwtr '[a-z]' '[A-Z]'` (اجرا کردن `tr` بر روی کلمه داخلی) را اجرا کنید، خواهید دید که دستور `tr` بر روی کل خط اعمال می‌شود، نه کلمه‌ای که نشانگر شما بر روی آن است.

## یادگیری دستورات خارجی به روش هوشمند

Vim یک IDE نیست. این یک ویرایشگر مدال سبک است که به طور طبیعی بسیار قابل گسترش است. به خاطر این قابلیت گسترش، شما به راحتی به هر دستور خارجی در سیستم خود دسترسی دارید. با این دستورات خارجی، Vim یک قدم به تبدیل شدن به یک IDE نزدیک‌تر می‌شود. کسی گفته است که سیستم یونیکس اولین IDE تاریخ است.

دستور bang به اندازه‌ای مفید است که شما چقدر با دستورات خارجی آشنا هستید. نگران نباشید اگر دانش شما در مورد دستورات خارجی محدود است. من هم هنوز چیزهای زیادی برای یادگیری دارم. این را به عنوان یک انگیزه برای یادگیری مداوم در نظر بگیرید. هر زمان که نیاز به ویرایش متنی داشتید، ببینید آیا دستوری خارجی وجود دارد که بتواند مشکل شما را حل کند. نگران تسلط بر همه چیز نباشید، فقط آن‌هایی را یاد بگیرید که برای تکمیل کار فعلی نیاز دارید.