---
description: این سند به بررسی دستور جهانی در ویم می‌پردازد که به شما امکان می‌دهد
  دستورات خط فرمان را بر روی چندین خط به‌طور همزمان اجرا کنید.
title: Ch13. the Global Command
---

تا به حال یاد گرفته‌اید که چگونه آخرین تغییر را با دستور نقطه (`.`) تکرار کنید، چگونه اقدام‌ها را با ماکروها (`q`) دوباره پخش کنید و چگونه متن‌ها را در ثبت‌ها (`"`) ذخیره کنید.

در این فصل، یاد خواهید گرفت که چگونه یک دستور خط فرمان را با دستور جهانی تکرار کنید.

## مرور کلی دستور جهانی

دستور جهانی Vim برای اجرای یک دستور خط فرمان بر روی چندین خط به طور همزمان استفاده می‌شود.

به هر حال، ممکن است قبلاً با اصطلاح "دستورات Ex" آشنا شده باشید. در این راهنما، من آن‌ها را به عنوان دستورات خط فرمان ارجاع می‌دهم. هر دو دستور Ex و دستورات خط فرمان یکسان هستند. آن‌ها دستورات هستند که با یک دو نقطه (`:`) شروع می‌شوند. دستور جایگزینی در فصل گذشته نمونه‌ای از یک دستور Ex بود. آن‌ها Ex نامیده می‌شوند زیرا در اصل از ویرایشگر متن Ex آمده‌اند. من در این راهنما به آن‌ها به عنوان دستورات خط فرمان اشاره خواهم کرد. برای مشاهده فهرست کامل دستورات Ex، به `:h ex-cmd-index` مراجعه کنید.

دستور جهانی دارای نحو زیر است:

```shell
:g/pattern/command
```

`pattern` تمام خطوطی را که شامل آن الگو هستند، مطابقت می‌دهد، مشابه الگو در دستور جایگزینی. `command` می‌تواند هر دستور خط فرمانی باشد. دستور جهانی با اجرای `command` بر روی هر خطی که با `pattern` مطابقت دارد، کار می‌کند.

اگر عبارات زیر را داشته باشید:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

برای حذف تمام خطوطی که شامل "console" هستند، می‌توانید اجرا کنید:

```shell
:g/console/d
```

نتیجه:

```shell
const one = 1;

const two = 2;

const three = 3;
```

دستور جهانی دستور حذف (`d`) را بر روی تمام خطوطی که با الگوی "console" مطابقت دارند، اجرا می‌کند.

هنگام اجرای دستور `g`، Vim دو بار فایل را اسکن می‌کند. در اولین بار، هر خط را اسکن می‌کند و خطی را که با الگوی `/console/` مطابقت دارد، علامت‌گذاری می‌کند. پس از علامت‌گذاری تمام خطوط مطابقت یافته، بار دیگر می‌رود و دستور `d` را بر روی خطوط علامت‌گذاری شده اجرا می‌کند.

اگر می‌خواهید به جای آن تمام خطوطی که شامل "const" هستند را حذف کنید، اجرا کنید:

```shell
:g/const/d
```

نتیجه:

```shell
console.log("one: ", one);

console.log("two: ", two);

console.log("three: ", three);
```

## تطابق معکوس

برای اجرای دستور جهانی بر روی خطوط غیر مطابقت یافته، می‌توانید اجرا کنید:

```shell
:g!/pattern/command
```

یا

```shell
:v/pattern/command
```

اگر `:v/console/d` را اجرا کنید، تمام خطوطی که *شامل* "console" نیستند را حذف خواهد کرد.

## الگو

دستور جهانی از همان سیستم الگو به عنوان دستور جایگزینی استفاده می‌کند، بنابراین این بخش به عنوان یادآوری عمل خواهد کرد. می‌توانید به بخش بعدی بروید یا ادامه دهید!

اگر این عبارات را داشته باشید:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

برای حذف خطوطی که شامل "one" یا "two" هستند، اجرا کنید:

```shell
:g/one\|two/d
```

برای حذف خطوطی که شامل هر رقم تکی هستند، می‌توانید یکی از موارد زیر را اجرا کنید:

```shell
:g/[0-9]/d
```

یا

```shell
:g/\d/d
```

اگر عبارت زیر را داشته باشید:

```shell
const oneMillion = 1000000;
const oneThousand = 1000;
const one = 1;
```

برای مطابقت با خطوطی که بین سه تا شش صفر دارند، اجرا کنید:

```shell
:g/0\{3,6\}/d
```

## ارسال یک بازه

شما می‌توانید یک بازه قبل از دستور `g` ارسال کنید. در اینجا چند روش برای انجام این کار وجود دارد:
- `:1,5g/console/d`  رشته "console" را بین خطوط 1 و 5 مطابقت می‌دهد و آن‌ها را حذف می‌کند.
- `:,5g/console/d` اگر قبل از ویرگول هیچ آدرسی وجود نداشته باشد، از خط فعلی شروع می‌شود. به دنبال رشته "console" بین خط فعلی و خط 5 می‌گردد و آن‌ها را حذف می‌کند.
- `:3,g/console/d` اگر بعد از ویرگول هیچ آدرسی وجود نداشته باشد، در خط فعلی پایان می‌یابد. به دنبال رشته "console" بین خط 3 و خط فعلی می‌گردد و آن‌ها را حذف می‌کند.
- `:3g/console/d` اگر فقط یک آدرس بدون ویرگول ارسال کنید، دستور فقط بر روی خط 3 اجرا می‌شود. به خط 3 نگاه می‌کند و اگر رشته "console" را داشته باشد، آن را حذف می‌کند.

علاوه بر اعداد، می‌توانید از این نمادها به عنوان بازه استفاده کنید:
- `.` به معنای خط فعلی است. یک بازه `.,3` به معنای بین خط فعلی و خط 3 است.
- `$` به معنای آخرین خط در فایل است. بازه `3,$` به معنای بین خط 3 و آخرین خط است.
- `+n` به معنای n خط بعد از خط فعلی است. می‌توانید از آن با `.` یا بدون آن استفاده کنید. `3,+1` یا `3,.+1` به معنای بین خط 3 و خط بعد از خط فعلی است.

اگر هیچ بازه‌ای به آن ندهید، به طور پیش‌فرض بر روی کل فایل تأثیر می‌گذارد. این در واقع غیرمعمول است. بیشتر دستورات خط فرمان Vim تنها بر روی خط فعلی اجرا می‌شوند اگر هیچ بازه‌ای به آن ندهید. دو استثنای قابل توجه، دستورات جهانی (`:g`) و ذخیره (`:w`) هستند.

## دستور نرمال

شما می‌توانید یک دستور نرمال را با دستور جهانی با دستور خط فرمان `:normal` اجرا کنید.

اگر این متن را داشته باشید:
```shell
const one = 1
console.log("one: ", one)

const two = 2
console.log("two: ", two)

const three = 3
console.log("three: ", three)
```

برای افزودن یک ";" به انتهای هر خط، اجرا کنید:

```shell
:g/./normal A;
```

بیایید آن را تجزیه و تحلیل کنیم:
- `:g` دستور جهانی است.
- `/./` یک الگو برای "خطوط غیر خالی" است. این خطوطی را که حداقل یک کاراکتر دارند مطابقت می‌دهد، بنابراین خطوطی که شامل "const" و "console" هستند را مطابقت می‌دهد و خطوط خالی را مطابقت نمی‌دهد.
- `normal A;` دستور `:normal` را اجرا می‌کند. `A;` دستور حالت نرمال برای وارد کردن یک ";" در انتهای خط است.

## اجرای یک ماکرو

شما همچنین می‌توانید یک ماکرو را با دستور جهانی اجرا کنید. یک ماکرو می‌تواند با دستور `normal` اجرا شود. اگر عبارات زیر را داشته باشید:

```shell
const one = 1
console.log("one: ", one);

const two = 2
console.log("two: ", two);

const three = 3
console.log("three: ", three);
```

توجه داشته باشید که خطوطی که شامل "const" هستند، نقطه‌ویرگول ندارند. بیایید یک ماکرو بسازیم تا یک کاما به انتهای آن خطوط در ثبت a اضافه کنیم:

```shell
qaA;<Esc>q
```

اگر به یادآوری نیاز دارید، به فصل مربوط به ماکرو مراجعه کنید. حالا اجرا کنید:

```shell
:g/const/normal @a
```

حالا تمام خطوطی که شامل "const" هستند، یک ";" در انتها خواهند داشت.

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

اگر این مراحل را مرحله به مرحله دنبال کرده‌اید، دو نقطه‌ویرگول در خط اول خواهید داشت. برای جلوگیری از این، دستور جهانی را از خط دوم به بعد اجرا کنید، `:2,$g/const/normal @a`.

## دستور جهانی بازگشتی

دستور جهانی خود یک نوع دستور خط فرمان است، بنابراین به طور تکنیکی می‌توانید دستور جهانی را در داخل یک دستور جهانی اجرا کنید.

با توجه به عبارات زیر، اگر بخواهید دستور `console.log` دوم را حذف کنید:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

اگر اجرا کنید:

```shell
:g/console/g/two/d
```

اول، `g` به دنبال خطوطی می‌گردد که شامل الگوی "console" هستند و 3 مطابقت پیدا می‌کند. سپس `g` دوم به دنبال خطی می‌گردد که شامل الگوی "two" از آن سه مطابقت باشد. در نهایت، آن مطابقت را حذف می‌کند.

شما همچنین می‌توانید `g` را با `v` ترکیب کنید تا الگوهای مثبت و منفی را پیدا کنید. به عنوان مثال:

```shell
:g/console/v/two/d
```

به جای جستجوی خطی که شامل الگوی "two" است، به دنبال خطوطی می‌گردد که *شامل* الگوی "two" نیستند.

## تغییر جداکننده

شما می‌توانید جداکننده دستور جهانی را مانند دستور جایگزینی تغییر دهید. قوانین یکسان هستند: می‌توانید از هر کاراکتر بایت تکی به جز حروف الفبا، اعداد، `"`, `|` و `\` استفاده کنید.

برای حذف خطوطی که شامل "console" هستند:

```shell
:g@console@d
```

اگر از دستور جایگزینی با دستور جهانی استفاده می‌کنید، می‌توانید دو جداکننده مختلف داشته باشید:

```shell
g@one@s+const+let+g
```

در اینجا دستور جهانی به دنبال تمام خطوطی می‌گردد که شامل "one" هستند. دستور جایگزینی از آن مطابقت‌ها، رشته "const" را با "let" جایگزین می‌کند.

## دستور پیش‌فرض

چه اتفاقی می‌افتد اگر هیچ دستور خط فرمانی در دستور جهانی مشخص نکنید؟

دستور جهانی از دستور چاپ (`:p`) برای چاپ متن خط فعلی استفاده می‌کند. اگر اجرا کنید:

```shell
:g/console
```

تمام خطوطی که شامل "console" هستند را در پایین صفحه چاپ خواهد کرد.

به هر حال، در اینجا یک واقعیت جالب وجود دارد. زیرا دستور پیش‌فرض استفاده شده توسط دستور جهانی `p` است، این باعث می‌شود که نحو `g` به صورت زیر باشد:

```shell
:g/re/p
```

- `g` = دستور جهانی
- `re` = الگوی regex
- `p` = دستور چاپ

این به معنای *"grep"* است، همان `grep` از خط فرمان. این **تصادفی** نیست. دستور `g/re/p` در اصل از ویرایشگر Ed آمده است، یکی از ویرایشگرهای متنی خطی اصلی. دستور `grep` نام خود را از Ed گرفته است.

کامپیوتر شما احتمالاً هنوز ویرایشگر Ed را دارد. از ترمینال `ed` را اجرا کنید (نکته: برای خروج، `q` را تایپ کنید).

## معکوس کردن کل بافر

برای معکوس کردن کل فایل، اجرا کنید:

```shell
:g/^/m 0
```

`^` یک الگو برای شروع یک خط است. از `^` برای مطابقت با تمام خطوط، از جمله خطوط خالی استفاده کنید.

اگر نیاز دارید فقط چند خط را معکوس کنید، یک بازه به آن بدهید. برای معکوس کردن خطوط بین خط پنج تا خط ده، اجرا کنید:

```shell
:5,10g/^/m 0
```

برای یادگیری بیشتر در مورد دستور حرکت، به `:h :move` مراجعه کنید.

## جمع‌آوری تمام TODOها

هنگام کدنویسی، گاهی اوقات من TODOها را در فایلی که ویرایش می‌کنم می‌نویسم:

```shell
const one = 1;
console.log("one: ", one);
// TODO: feed the puppy

const two = 2;
// TODO: feed the puppy automatically
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
// TODO: create a startup selling an automatic puppy feeder
```

پیگیری تمام TODOهای ایجاد شده می‌تواند دشوار باشد. Vim یک روش `:t` (کپی) برای کپی کردن تمام مطابقت‌ها به یک آدرس دارد. برای یادگیری بیشتر در مورد روش کپی، به `:h :copy` مراجعه کنید.

برای کپی کردن تمام TODOها به انتهای فایل برای بررسی آسان‌تر، اجرا کنید:

```shell
:g/TODO/t $
```

نتیجه:

```shell
const one = 1;
console.log("one: ", one);
// TODO: feed the puppy

const two = 2;
// TODO: feed the puppy automatically
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
// TODO: create a startup selling an automatic puppy feeder

// TODO: feed the puppy
// TODO: feed the puppy automatically
// TODO: create a startup selling an automatic puppy feeder
```

حالا می‌توانم تمام TODOهایی که ایجاد کرده‌ام را مرور کنم، زمانی برای انجام آن‌ها پیدا کنم یا به شخص دیگری واگذار کنم و به کار بر روی وظیفه بعدی خود ادامه دهم.

اگر به جای کپی کردن آن‌ها می‌خواهید تمام TODOها را به انتها منتقل کنید، از دستور حرکت، `:m` استفاده کنید:

```shell
:g/TODO/m $
```

نتیجه:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);

// TODO: feed the puppy
// TODO: feed the puppy automatically
// TODO: create a startup selling an automatic puppy feeder
```

## حذف سیاه‌چاله

از فصل ثبت یادآوری کنید که متون حذف شده در ثبت‌های شماره‌گذاری شده ذخیره می‌شوند (به شرطی که به اندازه کافی بزرگ باشند). هر بار که `:g/console/d` را اجرا می‌کنید، Vim خطوط حذف شده را در ثبت‌های شماره‌گذاری شده ذخیره می‌کند. اگر خطوط زیادی را حذف کنید، می‌توانید به سرعت تمام ثبت‌های شماره‌گذاری شده را پر کنید. برای جلوگیری از این، می‌توانید همیشه از ثبت سیاه‌چاله (`"_`) استفاده کنید تا *متن‌های حذف شده خود را در ثبت‌ها ذخیره نکنید*. اجرا کنید:

```shell
:g/console/d_
```

با ارسال `_` بعد از `d`، Vim از ثبت‌های موقتی شما استفاده نخواهد کرد.
## کاهش چندین خط خالی به یک خط خالی

اگر متنی با چندین خط خالی دارید:

```shell
const one = 1;
console.log("one: ", one);


const two = 2;
console.log("two: ", two);





const three = 3;
console.log("three: ", three);
```

شما می‌توانید به سرعت خطوط خالی را به یک خط خالی کاهش دهید با:

```shell
:g/^$/,/./-1j
```

نتیجه:

```shell
const one = 1;
console.log("one: ", one);

const two = 2;
console.log("two: ", two);

const three = 3;
console.log("three: ", three);
```

به طور معمول، دستور جهانی فرم زیر را می‌پذیرد: `:g/pattern/command`. با این حال، شما همچنین می‌توانید دستور جهانی را با فرم زیر اجرا کنید: `:g/pattern1/,/pattern2/command`. با این کار، Vim دستور `command` را درون `pattern1` و `pattern2` اعمال می‌کند.

با این در نظر، بیایید دستور `:g/^$/,/./-1j` را طبق `:g/pattern1/,/pattern2/command` تجزیه کنیم:
- `/pattern1/` برابر با `/^$/` است. این نمایانگر یک خط خالی (خطی با صفر کاراکتر) است.
- `/pattern2/` برابر با `/./` با اصلاح‌کننده خط `-1` است. `/./` نمایانگر یک خط غیر خالی (خطی با حداقل یک کاراکتر) است. `-1` به معنی خط بالای آن است.
- `command` برابر با `j`، دستور پیوستن (`:j`) است. در این زمینه، این دستور جهانی تمام خطوط داده شده را پیوند می‌دهد.

به هر حال، اگر می‌خواهید چندین خط خالی را به هیچ خطی کاهش دهید، این را اجرا کنید:

```shell
:g/^$/,/./j
```

یک جایگزین ساده‌تر:

```shell
:g/^$/-j
```

متن شما اکنون به این شکل کاهش یافته است:

```shell
const one = 1;
console.log("one: ", one);
const two = 2;
console.log("two: ", two);
const three = 3;
console.log("three: ", three);
```

## مرتب‌سازی پیشرفته

Vim دارای دستور `:sort` برای مرتب‌سازی خطوط درون یک بازه است. به عنوان مثال:

```shell
d
b
a
e
c
```

شما می‌توانید با اجرای `:sort` آن‌ها را مرتب کنید. اگر یک بازه به آن بدهید، فقط خطوط درون آن بازه را مرتب می‌کند. به عنوان مثال، `:3,5sort` فقط خطوط سه و پنج را مرتب می‌کند.

اگر عبارات زیر را داشته باشید:

```shell
const arrayB = [
  "i",
  "g",
  "h",
  "b",
  "f",
  "d",
  "e",
  "c",
  "a",
]

const arrayA = [
  "h",
  "b",
  "f",
  "d",
  "e",
  "a",
  "c",
]
```

اگر نیاز دارید که عناصر داخل آرایه‌ها را مرتب کنید، اما خود آرایه‌ها را نه، می‌توانید این را اجرا کنید:

```shell
:g/\[/+1,/\]/-1sort
```

نتیجه:

```shell
const arrayB = [
  "a",
  "b",
  "c",
  "d",
  "e",
  "f",
  "g",
  "h",
  "i",
]

const arrayA = [
  "a"
  "b",
  "c",
  "d",
  "e",
  "f",
  "h",
]
```

این عالی است! اما دستور به نظر پیچیده می‌رسد. بیایید آن را تجزیه کنیم. این دستور نیز فرم `:g/pattern1/,/pattern2/command` را دنبال می‌کند.

- `:g` الگوی دستور جهانی است.
- `/\[/+1` الگوی اول است. این یک براکت چپ "[" را مطابقت می‌دهد. `+1` به خط زیر آن اشاره دارد.
- `/\]/-1` الگوی دوم است. این یک براکت راست "]" را مطابقت می‌دهد. `-1` به خط بالای آن اشاره دارد.
- `/\[/+1,/\]/-1` سپس به هر خطی بین "[" و "]" اشاره دارد.
- `sort` یک دستور خط فرمان برای مرتب‌سازی است.

## یادگیری دستور جهانی به روش هوشمند

دستور جهانی دستور خط فرمان را در برابر تمام خطوط مطابقت داده اجرا می‌کند. با آن، شما فقط نیاز دارید یک بار یک دستور را اجرا کنید و Vim بقیه را برای شما انجام می‌دهد. برای تسلط بر دستور جهانی، دو چیز لازم است: یک واژگان خوب از دستورات خط فرمان و دانشی از عبارات منظم. با گذراندن زمان بیشتر با Vim، به طور طبیعی دستورات بیشتری از خط فرمان یاد خواهید گرفت. دانشی از عبارات منظم نیاز به رویکردی فعال‌تر دارد. اما وقتی با عبارات منظم راحت شدید، از بسیاری جلوتر خواهید بود.

برخی از مثال‌های اینجا پیچیده هستند. از آن نترسید. واقعاً زمان بگذارید تا آن‌ها را درک کنید. یاد بگیرید که الگوها را بخوانید. تسلیم نشوید.

هر زمان که نیاز به اجرای چندین دستور دارید، توقف کنید و ببینید آیا می‌توانید از دستور `g` استفاده کنید. بهترین دستور برای کار را شناسایی کنید و یک الگو برای هدف قرار دادن هر چه بیشتر چیزها در یک بار بنویسید.

حالا که می‌دانید دستور جهانی چقدر قدرتمند است، بیایید یاد بگیریم چگونه از دستورات خارجی برای افزایش ابزارهای خود استفاده کنیم.