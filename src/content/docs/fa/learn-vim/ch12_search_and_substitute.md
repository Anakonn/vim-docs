---
description: این فصل به جستجو و جایگزینی در ویم می‌پردازد و نحوه استفاده از عبارات
  منظم برای جستجوی سریع متن‌ها را آموزش می‌دهد.
title: Ch12. Search and Substitute
---

این فصل دو مفهوم جدا اما مرتبط را پوشش می‌دهد: جستجو و جایگزینی. اغلب هنگام ویرایش، نیاز دارید که چندین متن را بر اساس الگوهای کمترین مشترک آن‌ها جستجو کنید. با یادگیری نحوه استفاده از عبارات منظم در جستجو و جایگزینی به جای رشته‌های حرفی، قادر خواهید بود هر متنی را به سرعت هدف قرار دهید.

به عنوان یک نکته جانبی، در این فصل، من از `/` هنگام صحبت درباره جستجو استفاده می‌کنم. هر چیزی که می‌توانید با `/` انجام دهید، می‌تواند با `?` نیز انجام شود.

## حساسیت به حروف بزرگ و کوچک هوشمند

سعی در مطابقت با حروف بزرگ و کوچک در عبارت جستجو می‌تواند دشوار باشد. اگر به دنبال متن "Learn Vim" باشید، به راحتی ممکن است حروف یک حرف را اشتباه تایپ کنید و نتیجه جستجوی نادرست بگیرید. آیا راحت‌تر و ایمن‌تر نیست که بتوانید هر نوع حروفی را مطابقت دهید؟ اینجاست که گزینه `ignorecase` درخشش خود را نشان می‌دهد. فقط کافیست `set ignorecase` را در vimrc خود اضافه کنید و تمام عبارات جستجوی شما غیرحساس به حروف بزرگ و کوچک می‌شوند. حالا دیگر نیازی به نوشتن `/Learn Vim` ندارید، `/learn vim` کار خواهد کرد.

با این حال، گاهی اوقات نیاز دارید که به دنبال یک عبارت خاص با حروف بزرگ و کوچک باشید. یکی از راه‌ها برای انجام این کار، خاموش کردن گزینه `ignorecase` با اجرای `set noignorecase` است، اما این کار هر بار که نیاز به جستجوی یک عبارت حساس به حروف بزرگ و کوچک دارید، کار زیادی است.

برای جلوگیری از تغییر مکرر `ignorecase`، Vim گزینه `smartcase` را دارد تا به جستجوی رشته‌های غیرحساس به حروف بزرگ و کوچک بپردازد اگر الگوی جستجو *حداقل یک حرف بزرگ* داشته باشد. می‌توانید هر دو `ignorecase` و `smartcase` را ترکیب کنید تا جستجوی غیرحساس به حروف بزرگ و کوچک را زمانی که تمام حروف کوچک را وارد می‌کنید و جستجوی حساس به حروف بزرگ و کوچک را زمانی که یک یا چند حرف بزرگ وارد می‌کنید، انجام دهید.

در vimrc خود، اضافه کنید:

```shell
set ignorecase smartcase
```

اگر این متون را داشته باشید:

```shell
hello
HELLO
Hello
```

- `/hello` با "hello"، "HELLO" و "Hello" مطابقت دارد.
- `/HELLO` فقط با "HELLO" مطابقت دارد.
- `/Hello` فقط با "Hello" مطابقت دارد.

یک نقطه ضعف وجود دارد. اگر نیاز داشته باشید که فقط یک رشته کوچک را جستجو کنید چه؟ وقتی `/hello` را انجام می‌دهید، Vim اکنون جستجوی غیرحساس به حروف بزرگ و کوچک را انجام می‌دهد. می‌توانید از الگوی `\C` در هر جایی از عبارت جستجوی خود استفاده کنید تا به Vim بگویید که عبارت جستجوی بعدی حساس به حروف بزرگ و کوچک خواهد بود. اگر `/\Chello` را انجام دهید، به طور دقیق با "hello" مطابقت خواهد داشت، نه "HELLO" یا "Hello".

## اولین و آخرین کاراکتر در یک خط

می‌توانید از `^` برای مطابقت با اولین کاراکتر در یک خط و `$` برای مطابقت با آخرین کاراکتر در یک خط استفاده کنید.

اگر این متن را داشته باشید:

```shell
hello hello
```

می‌توانید با `/^hello` به اولین "hello" هدف بزنید. کاراکتری که پس از `^` می‌آید باید اولین کاراکتر در یک خط باشد. برای هدف قرار دادن آخرین "hello"، `/hello$` را اجرا کنید. کاراکتری که قبل از `$` می‌آید باید آخرین کاراکتر در یک خط باشد.

اگر این متن را داشته باشید:

```shell
hello hello friend
```

اجرای `/hello$` هیچ چیزی را مطابقت نخواهد داد زیرا "friend" آخرین عبارت در آن خط است، نه "hello".

## جستجوی تکراری

می‌توانید جستجوی قبلی را با `//` تکرار کنید. اگر به تازگی برای `/hello` جستجو کرده‌اید، اجرای `//` معادل اجرای `/hello` است. این میانبر می‌تواند به شما در صرفه‌جویی در تعداد کلیدها کمک کند به ویژه اگر به تازگی برای یک رشته طولانی جستجو کرده‌اید. همچنین به یاد داشته باشید که می‌توانید از `n` و `N` برای تکرار آخرین جستجو با همان جهت و جهت مخالف استفاده کنید.

اگر بخواهید به سرعت *n* عبارت جستجوی آخر را به یاد بیاورید چه؟ می‌توانید به سرعت تاریخچه جستجو را با فشار دادن `/` و سپس کلیدهای پیکان `up`/`down` (یا `Ctrl-N`/`Ctrl-P`) پیمایش کنید تا زمانی که عبارت جستجوی مورد نیاز خود را پیدا کنید. برای دیدن تمام تاریخچه جستجوی خود، می‌توانید `:history /` را اجرا کنید.

زمانی که به انتهای یک فایل در حین جستجو می‌رسید، Vim یک خطا می‌دهد: `"Search hit the BOTTOM without match for: {your-search}"`. گاهی اوقات این می‌تواند یک محافظ خوب در برابر جستجوی بیش از حد باشد، اما در موارد دیگر می‌خواهید جستجو را دوباره به بالا بچرخانید. می‌توانید از گزینه `set wrapscan` استفاده کنید تا Vim در هنگام رسیدن به انتهای فایل، دوباره از بالای فایل جستجو کند. برای خاموش کردن این ویژگی، `set nowrapscan` را انجام دهید.

## جستجوی کلمات جایگزین

جستجوی چندین کلمه به طور همزمان رایج است. اگر نیاز دارید که به دنبال *یا* "hello vim" یا "hola vim" باشید، اما نه "salve vim" یا "bonjour vim"، می‌توانید از الگوی `|` استفاده کنید.

با توجه به این متن:

```shell
hello vim
hola vim
salve vim
bonjour vim
```

برای مطابقت با هر دو "hello" و "hola"، می‌توانید `/hello\|hola` را انجام دهید. باید `\` را برای اپراتور یا (`|`) فرار کنید، در غیر این صورت Vim به طور حرفی به دنبال رشته "|" خواهد بود.

اگر نمی‌خواهید هر بار `\|` را تایپ کنید، می‌توانید از نحو `magic` (`\v`) در ابتدای جستجو استفاده کنید: `/\vhello|hola`. من در این راهنما به `magic` نمی‌پردازم، اما با `\v`، دیگر نیازی به فرار کردن از کاراکترهای خاص ندارید. برای یادگیری بیشتر در مورد `\v`، می‌توانید به `:h \v` مراجعه کنید.

## تنظیم شروع و پایان یک مطابقت

شاید نیاز داشته باشید که به دنبال متنی باشید که بخشی از یک کلمه مرکب است. اگر این متون را داشته باشید:

```shell
11vim22
vim22
11vim
vim
```

اگر نیاز دارید "vim" را انتخاب کنید اما فقط زمانی که با "11" شروع و با "22" پایان می‌یابد، می‌توانید از اپراتورهای `\zs` (شروع مطابقت) و `\ze` (پایان مطابقت) استفاده کنید. اجرا کنید:

```shell
/11\zsvim\ze22
```

Vim هنوز باید الگوی کامل "11vim22" را مطابقت دهد، اما فقط الگوی محصور شده بین `\zs` و `\ze` را هایلایت می‌کند. مثال دیگر:

```shell
foobar
foobaz
```

اگر نیاز دارید "foo" را در "foobaz" مطابقت دهید اما نه در "foobar"، اجرا کنید:

```shell
/foo\zebaz
```

## جستجوی دامنه‌های کاراکتری

تمام عبارات جستجوی شما تا این نقطه یک جستجوی کلمه حرفی بوده است. در زندگی واقعی، ممکن است نیاز داشته باشید که از یک الگوی عمومی برای پیدا کردن متن خود استفاده کنید. ساده‌ترین الگو دامنه کاراکتر، `[ ]` است.

اگر نیاز دارید به دنبال هر عددی باشید، احتمالاً نمی‌خواهید هر بار `/0\|1\|2\|3\|4\|5\|6\|7\|8\|9\|0` را تایپ کنید. به جای آن، از `/[0-9]` برای مطابقت با یک عدد واحد استفاده کنید. عبارت `0-9` نمایانگر دامنه اعداد 0-9 است که Vim سعی خواهد کرد مطابقت دهد، بنابراین اگر به دنبال اعداد بین 1 تا 5 هستید، از `/[1-5]` استفاده کنید.

اعداد تنها نوع داده‌ای نیستند که Vim می‌تواند جستجو کند. همچنین می‌توانید از `/[a-z]` برای جستجوی حروف کوچک و از `/[A-Z]` برای جستجوی حروف بزرگ استفاده کنید.

می‌توانید این دامنه‌ها را با هم ترکیب کنید. اگر نیاز دارید به دنبال اعداد 0-9 و هر دو حروف کوچک و بزرگ از "a" تا "f" (مانند یک هگز) باشید، می‌توانید از `/[0-9a-fA-F]` استفاده کنید.

برای انجام یک جستجوی منفی، می‌توانید `^` را داخل براکت‌های دامنه اضافه کنید. برای جستجوی یک غیرعدد، اجرا کنید `/[^0-9]`. Vim هر کاراکتری را مطابقت می‌دهد به شرطی که عدد نباشد. مراقب باشید که کاراکتر caret (`^`) داخل براکت‌های دامنه با کاراکتر caret در ابتدای خط متفاوت است (به عنوان مثال: `/^hello`). اگر یک caret خارج از یک جفت براکت باشد و اولین کاراکتر در عبارت جستجو باشد، به معنای "اولین کاراکتر در یک خط" است. اگر یک caret داخل یک جفت براکت باشد و اولین کاراکتر داخل براکت‌ها باشد، به معنای یک اپراتور جستجوی منفی است. `/^abc` اولین "abc" در یک خط را مطابقت می‌دهد و `/[^abc]` هر کاراکتری به جز "a"، "b" یا "c" را مطابقت می‌دهد.

## جستجوی کاراکترهای تکراری

اگر نیاز دارید به دنبال اعداد دو رقمی در این متن باشید:

```shell
1aa
11a
111
```

می‌توانید از `/[0-9][0-9]` برای مطابقت با یک کاراکتر دو رقمی استفاده کنید، اما این روش مقیاس‌پذیر نیست. اگر نیاز دارید بیست عدد را مطابقت دهید چه؟ تایپ کردن `[0-9]` بیست بار تجربه خوشایندی نیست. به همین دلیل به یک آرگومان `count` نیاز دارید.

می‌توانید `count` را به جستجوی خود اضافه کنید. این دارای نحو زیر است:

```shell
{n,m}
```

به هر حال، این براکت‌های `count` هنگام استفاده در Vim باید فرار شوند. اپراتور `count` پس از یک کاراکتر واحد که می‌خواهید افزایش دهید قرار می‌گیرد.

در اینجا چهار نوع مختلف نحو `count` وجود دارد:
- `{n}` یک مطابقت دقیق است. `/[0-9]\{2\}` اعداد دو رقمی: "11" و "11" در "111" را مطابقت می‌دهد.
- `{n,m}` یک مطابقت دامنه است. `/[0-9]\{2,3\}` بین 2 و 3 عدد را مطابقت می‌دهد: "11" و "111".
- `{,m}` یک مطابقت حداکثر است. `/[0-9]\{,3\}` حداکثر 3 عدد را مطابقت می‌دهد: "1"، "11" و "111".
- `{n,}` یک مطابقت حداقل است. `/[0-9]\{2,\}` حداقل 2 یا بیشتر عدد را مطابقت می‌دهد: "11" و "111".

آرگومان‌های شمارش `\{0,\}` (صفر یا بیشتر) و `\{1,\}` (یک یا بیشتر) الگوهای جستجوی رایج هستند و Vim اپراتورهای خاصی برای آن‌ها دارد: `*` و `+` (`+` نیاز به فرار دارد در حالی که `*` بدون فرار کار می‌کند). اگر `/[0-9]*` را انجام دهید، معادل `/[0-9]\{0,\}` است. این به دنبال صفر یا بیشتر عدد می‌گردد. این با "", "1"، "123" مطابقت خواهد داشت. به هر حال، همچنین با غیرعددها مانند "a" مطابقت خواهد داشت، زیرا به طور فنی صفر عدد در حرف "a" وجود دارد. قبل از استفاده از `*` به دقت فکر کنید. اگر `/[0-9]\+` را انجام دهید، معادل `/[0-9]\{1,\}` است. این به دنبال یک یا بیشتر عدد می‌گردد. این با "1" و "12" مطابقت خواهد داشت.

## دامنه‌های کاراکتری از پیش تعریف شده

Vim دامنه‌های از پیش تعریف شده‌ای برای کاراکترهای رایج مانند اعداد و حروف دارد. من به همه آن‌ها در اینجا نمی‌پردازم، اما می‌توانید لیست کامل را در داخل `:h /character-classes` پیدا کنید. در اینجا موارد مفید وجود دارد:

```shell
\d    Digit [0-9]
\D    Non-digit [^0-9]
\s    Whitespace character (space and tab)
\S    Non-whitespace character (everything except space and tab)
\w    Word character [0-9A-Za-z_]
\l    Lowercase alphas [a-z]
\u    Uppercase character [A-Z]
```

می‌توانید از آن‌ها مانند دامنه‌های کاراکتری استفاده کنید. برای جستجوی هر عدد واحد، به جای استفاده از `/[0-9]`، می‌توانید از `/\d` برای نحو مختصرتر استفاده کنید.

## مثال جستجو: ضبط یک متن بین یک جفت کاراکتر مشابه

اگر می‌خواهید به دنبال عبارتی باشید که توسط یک جفت علامت نقل قول دوتایی احاطه شده است:

```shell
"Vim is awesome!"
```

این را اجرا کنید:

```shell
/"[^"]\+"
```

بیایید آن را تجزیه و تحلیل کنیم:
- `"` یک علامت نقل قول دوتایی است. این با اولین علامت نقل قول دوتایی مطابقت دارد.
- `[^"]` به معنای هر کاراکتری به جز یک علامت نقل قول دوتایی است. این با هر کاراکتر الفبایی و فاصله مطابقت دارد به شرطی که یک علامت نقل قول دوتایی نباشد.
- `\+` به معنای یک یا بیشتر است. از آنجا که قبل از `[^"]` قرار دارد، Vim به دنبال یک یا بیشتر کاراکتر است که علامت نقل قول دوتایی نباشد.
- `"` یک علامت نقل قول دوتایی است. این با علامت نقل قول دوتایی پایانی مطابقت دارد.

زمانی که Vim اولین `"` را می‌بیند، ضبط الگو را آغاز می‌کند. به محض اینکه علامت نقل قول دوتایی دوم را در یک خط ببیند، با الگوی دوم `"` مطابقت می‌دهد و ضبط الگو را متوقف می‌کند. در این حین، تمام کاراکترهای غیر علامت نقل قول دوتایی در بین توسط الگوی `[^"]\+` ضبط می‌شوند، در این مورد، عبارت `Vim is awesome!`. این یک الگوی رایج برای ضبط یک عبارت احاطه شده توسط یک جفت جداکننده مشابه است.

- برای ضبط یک عبارت احاطه شده توسط علامت‌های نقل قول دوتایی، می‌توانید از `/'[^']\+'` استفاده کنید.
- برای ضبط یک عبارت احاطه شده توسط صفرها، می‌توانید از `/0[^0]\+0` استفاده کنید.

## مثال جستجو: ضبط یک شماره تلفن

اگر می‌خواهید شماره تلفن ایالات متحده را که با یک خط تیره (`-`) جدا شده است، مانند `123-456-7890` مطابقت دهید، می‌توانید از:

```shell
/\d\{3\}-\d\{3\}-\d\{4\}
```

شماره تلفن ایالات متحده شامل یک مجموعه از سه عدد، به دنبال سه عدد دیگر و در نهایت چهار عدد است. بیایید آن را تجزیه و تحلیل کنیم:
- `\d\{3\}` یک عدد را که دقیقاً سه بار تکرار شده است، مطابقت می‌دهد.
- `-` یک خط تیره حرفی است.

می‌توانید از تایپ فرار با `\v` اجتناب کنید:

```shell
/\v\d{3}-\d{3}-\d{4}
```

این الگو همچنین برای ضبط هر عدد تکراری، مانند آدرس‌های IP و کدهای پستی مفید است.

این بخش جستجو را در این فصل پوشش می‌دهد. حالا بیایید به جایگزینی برویم.

## جایگزینی پایه

دستور جایگزینی Vim یک دستور مفید برای پیدا کردن و جایگزینی سریع هر الگو است. نحو جایگزینی به صورت زیر است:

```shell
:s/{old-pattern}/{new-pattern}/
```

بیایید با یک استفاده پایه شروع کنیم. اگر این متن را داشته باشید:

```shell
vim is good
```

بیایید "good" را با "awesome" جایگزین کنیم زیرا Vim عالی است. `:s/good/awesome/` را اجرا کنید. باید ببینید:

```shell
vim is awesome
```
## تکرار آخرین جایگزینی

شما می‌توانید آخرین دستور جایگزینی را با استفاده از دستور معمول `&` یا با اجرای `:s` تکرار کنید. اگر شما به تازگی `:s/good/awesome/` را اجرا کرده‌اید، اجرای `&` یا `:s` آن را تکرار خواهد کرد.

همچنین، در اوایل این فصل اشاره کردم که می‌توانید از `//` برای تکرار الگوی جستجوی قبلی استفاده کنید. این ترفند با دستور جایگزینی کار می‌کند. اگر `/good` به تازگی انجام شده باشد و شما آرگومان الگوی جایگزینی اول را خالی بگذارید، مانند `:s//awesome/`، این همانند اجرای `:s/good/awesome/` عمل می‌کند.

## دامنه جایگزینی

دقیقاً مانند بسیاری از دستورات Ex، شما می‌توانید یک آرگومان دامنه به دستور جایگزینی منتقل کنید. نحو آن به صورت زیر است:

```shell
:[range]s/old/new/
```

اگر این عبارات را داشته باشید:

```shell
let one = 1;
let two = 2;
let three = 3;
let four = 4;
let five = 5;
```

برای جایگزینی "let" با "const" در خطوط سه تا پنج، می‌توانید این کار را انجام دهید:

```shell
:3,5s/let/const/
```

در اینجا چند نوع دامنه که می‌توانید منتقل کنید:

- `:,3s/let/const/` - اگر هیچ چیزی قبل از کاما داده نشود، نمایانگر خط فعلی است. جایگزینی از خط فعلی تا خط 3.
- `:1,s/let/const/` - اگر هیچ چیزی بعد از کاما داده نشود، همچنین نمایانگر خط فعلی است. جایگزینی از خط 1 تا خط فعلی.
- `:3s/let/const/` - اگر فقط یک مقدار به عنوان دامنه داده شود (بدون کاما)، فقط بر روی آن خط جایگزینی انجام می‌دهد.

در Vim، `%` معمولاً به معنای کل فایل است. اگر شما `:%s/let/const/` را اجرا کنید، جایگزینی بر روی تمام خطوط انجام خواهد شد. به این نحو دامنه توجه داشته باشید. بسیاری از دستورات خط فرمان که در فصل‌های آینده خواهید آموخت، از این فرم پیروی خواهند کرد.

## تطابق الگو

بخش‌های بعدی به بررسی عبارات منظم پایه خواهند پرداخت. دانش قوی از الگوها برای تسلط بر دستور جایگزینی ضروری است.

اگر عبارات زیر را داشته باشید:

```shell
let one = 1;
let two = 2;
let three = 3;
let four = 4;
let five = 5;
```

برای اضافه کردن یک جفت علامت نقل قول دوگانه در اطراف اعداد:

```shell
:%s/\d/"\0"/
```

نتیجه:

```shell
let one = "1";
let two = "2";
let three = "3";
let four = "4";
let five = "5";
```

بیایید دستور را تجزیه و تحلیل کنیم:
- `:%s` کل فایل را هدف قرار می‌دهد تا جایگزینی انجام دهد.
- `\d` دامنه از پیش تعریف شده Vim برای اعداد است (مشابه استفاده از `[0-9]`).
- `"\0"` در اینجا علامت‌های نقل قول دوگانه، علامت‌های نقل قول واقعی هستند. `\0` یک کاراکتر خاص است که نمایانگر "الگوی مطابقت کامل" است. الگوی مطابقت در اینجا یک عدد یک رقمی، `\d` است.

به طور متناوب، `&` همچنین نمایانگر الگوی مطابقت کامل مانند `\0` است. `:s/\d/"&"/` نیز کار می‌کرد.

بیایید یک مثال دیگر را در نظر بگیریم. با توجه به این عبارات و نیاز به تعویض تمام "let" با نام متغیرها.

```shell
one let = "1";
two let = "2";
three let = "3";
four let = "4";
five let = "5";
```

برای انجام این کار، اجرا کنید:

```shell
:%s/\(\w\+\) \(\w\+\)/\2 \1/
```

دستور بالا شامل تعداد زیادی بک‌اسلش است و خواندن آن دشوار است. در این مورد، استفاده از عملگر `\v` راحت‌تر است:

```shell
:%s/\v(\w+) (\w+)/\2 \1/
```

نتیجه:

```shell
let one = "1";
let two = "2";
let three = "3";
let four = "4";
let five = "5";
```

عالی! بیایید آن دستور را تجزیه و تحلیل کنیم:
- `:%s` تمام خطوط فایل را هدف قرار می‌دهد تا جایگزینی انجام دهد.
- `(\w+) (\w+)` یک تطابق گروهی است. `\w` یکی از دامنه‌های از پیش تعریف شده Vim برای یک کاراکتر کلمه (`[0-9A-Za-z_]`) است. `( )` اطراف آن یک تطابق کاراکتر کلمه را در یک گروه ذخیره می‌کند. توجه داشته باشید که فضای بین دو گروه وجود دارد. `(\w+) (\w+)` دو گروه را ذخیره می‌کند. گروه اول "one" و گروه دوم "two" را ذخیره می‌کند.
- `\2 \1` گروه‌های ذخیره شده را به ترتیب معکوس برمی‌گرداند. `\2` شامل رشته ذخیره شده "let" و `\1` رشته "one" است. داشتن `\2 \1` رشته "let one" را برمی‌گرداند.

به خاطر داشته باشید که `\0` نمایانگر الگوی مطابقت کامل است. شما می‌توانید رشته مطابقت را به گروه‌های کوچکتر با `( )` تقسیم کنید. هر گروه با `\1`، `\2`، `\3` و غیره نمایانگر می‌شود.

بیایید یک مثال دیگر انجام دهیم تا این مفهوم تطابق گروهی را تقویت کنیم. اگر این اعداد را داشته باشید:

```shell
123
456
789
```

برای معکوس کردن ترتیب، اجرا کنید:

```shell
:%s/\v(\d)(\d)(\d)/\3\2\1/
```

نتیجه:

```shell
321
654
987
```

هر `(\d)` هر عدد را تطابق می‌دهد و یک گروه ایجاد می‌کند. در خط اول، اولین `(\d)` مقداری برابر با 1 دارد، دومین `(\d)` مقداری برابر با 2 دارد و سومین `(\d)` مقداری برابر با 3 دارد. آنها در متغیرهای `\1`، `\2` و `\3` ذخیره می‌شوند. در نیمه دوم جایگزینی شما، الگوی جدید `\3\2\1` نتیجه "321" را در خط اول به دست می‌آورد.

اگر به جای آن این را اجرا کرده بودید:

```shell
:%s/\v(\d\d)(\d)/\2\1/
```
شما نتیجه متفاوتی می‌گرفتید:

```shell
312
645
978
```

این به این دلیل است که اکنون فقط دو گروه دارید. گروه اول، که توسط `(\d\d)` ذخیره می‌شود، در `\1` قرار دارد و مقداری برابر با 12 دارد. گروه دوم، که توسط `(\d)` ذخیره می‌شود، در `\2` قرار دارد و مقداری برابر با 3 دارد. `\2\1` سپس، 312 را برمی‌گرداند.

## پرچم‌های جایگزینی

اگر جمله زیر را داشته باشید:

```shell
چاکلت پنکیک، پنکیک توت‌فرنگی، پنکیک بلوبری
```

برای جایگزینی همه پنکیک‌ها با دونات، نمی‌توانید فقط اجرا کنید:

```shell
:s/pancake/donut
```

دستور بالا فقط اولین تطابق را جایگزین می‌کند و به شما می‌دهد:

```shell
چاکلت دونات، پنکیک توت‌فرنگی، پنکیک بلوبری
```

دو راه برای حل این مشکل وجود دارد. شما می‌توانید یا دستور جایگزینی را دو بار دیگر اجرا کنید یا می‌توانید یک پرچم جهانی (`g`) به آن بدهید تا همه تطابق‌ها در یک خط جایگزین شوند.

بیایید درباره پرچم جهانی صحبت کنیم. اجرا کنید:

```shell
:s/pancake/donut/g
```

Vim همه پنکیک‌ها را با دونات‌ها در یک دستور سریع جایگزین می‌کند. دستور جهانی یکی از چندین پرچم است که دستور جایگزینی می‌پذیرد. شما پرچم‌ها را در انتهای دستور جایگزینی منتقل می‌کنید. در اینجا فهرستی از پرچم‌های مفید است:

```shell
&    استفاده مجدد از پرچم‌ها از دستور جایگزینی قبلی.
g    جایگزینی همه تطابق‌ها در خط.
c    درخواست تأیید برای جایگزینی.
e    جلوگیری از نمایش پیام خطا هنگام شکست جایگزینی.
i    انجام جایگزینی بدون حساسیت به حروف بزرگ و کوچک.
I    انجام جایگزینی با حساسیت به حروف بزرگ و کوچک.
```

پرچم‌های بیشتری وجود دارد که در بالا فهرست نکرده‌ام. برای خواندن درباره همه پرچم‌ها، به `:h s_flags` مراجعه کنید.

به هر حال، دستورات تکرار جایگزینی (`&` و `:s`) پرچم‌ها را حفظ نمی‌کنند. اجرای `&` فقط `:s/pancake/donut/` را بدون `g` تکرار خواهد کرد. برای تکرار سریع آخرین دستور جایگزینی با همه پرچم‌ها، اجرا کنید `:&&`.

## تغییر جداکننده

اگر نیاز دارید یک URL را با یک مسیر طولانی جایگزین کنید:

```shell
https://mysite.com/a/b/c/d/e
```

برای جایگزینی آن با کلمه "hello"، اجرا کنید:

```shell
:s/https:\/\/mysite.com\/a\/b\/c\/d\/e/hello/
```

با این حال، تشخیص اینکه کدام اسلش‌های رو به جلو (`/`) بخشی از الگوی جایگزینی هستند و کدام‌ها جداکننده‌ها هستند، دشوار است. شما می‌توانید جداکننده را با هر کاراکتر تک بایتی (به جز حروف الفبا، اعداد، یا `"`, `|` و `\`) تغییر دهید. بیایید آنها را با `+` جایگزین کنیم. دستور جایگزینی بالا سپس می‌تواند به صورت زیر نوشته شود:

```shell
:s+https:\/\/mysite.com\/a\/b\/c\/d\/e+hello+
```

اکنون راحت‌تر می‌توان دید که جداکننده‌ها کجا هستند.

## جایگزینی ویژه

شما همچنین می‌توانید حالت متن را که جایگزین می‌کنید، تغییر دهید. با توجه به عبارات زیر و وظیفه شما این است که متغیرهای "one"، "two"، "three" و غیره را به حروف بزرگ تبدیل کنید.

```shell
let one = "1";
let two = "2";
let three = "3";
let four = "4";
let five = "5";
```

اجرا کنید:

```shell
:%s/\v(\w+) (\w+)/\1 \U\2/
```

شما خواهید گرفت:

```shell
let ONE = "1";
let TWO = "2";
let THREE = "3";
let FOUR = "4";
let FIVE = "5";
```

تجزیه و تحلیل:
- `(\w+) (\w+)` دو گروه تطابق یافته اول را ذخیره می‌کند، مانند "let" و "one".
- `\1` مقدار گروه اول، "let" را برمی‌گرداند.
- `\U\2` گروه دوم (`\2`) را به حروف بزرگ تبدیل می‌کند.

حقه این دستور عبارت `\U\2` است. `\U` به کاراکتر بعدی دستور می‌دهد که به حروف بزرگ تبدیل شود.

بیایید یک مثال دیگر انجام دهیم. فرض کنید شما در حال نوشتن یک راهنمای Vim هستید و نیاز دارید که حرف اول هر کلمه در یک خط را بزرگ کنید.

```shell
vim is the greatest text editor in the whole galaxy
```

شما می‌توانید اجرا کنید:

```shell
:s/\<./\U&/g
```

نتیجه:

```shell
Vim Is The Greatest Text Editor In The Whole Galaxy
```

تجزیه و تحلیل:
- `:s` جایگزینی را در خط فعلی انجام می‌دهد.
- `\<.` از دو بخش تشکیل شده است: `\<` برای تطابق شروع یک کلمه و `.` برای تطابق هر کاراکتر. عملگر `\<` کاراکتر بعدی را به عنوان اولین کاراکتر یک کلمه تطابق می‌دهد. از آنجا که `.` کاراکتر بعدی است، اولین کاراکتر هر کلمه را تطابق می‌دهد.
- `\U&` کاراکتر بعدی، `&` را به حروف بزرگ تبدیل می‌کند. به یاد داشته باشید که `&` (یا `\0`) نمایانگر کل تطابق است. این تطابق اولین کاراکتر هر کلمه را تطابق می‌دهد.
- `g` پرچم جهانی. بدون آن، این دستور فقط اولین تطابق را جایگزین می‌کند. شما نیاز دارید که هر تطابق را در این خط جایگزین کنید.

برای یادگیری بیشتر درباره نمادهای ویژه جایگزینی مانند `\U`، به `:h sub-replace-special` مراجعه کنید.

## الگوهای جایگزینی جایگزین

گاهی اوقات شما نیاز دارید که چندین الگو را به طور همزمان تطابق دهید. اگر این سلام‌ها را داشته باشید:

```shell
hello vim
hola vim
salve vim
bonjour vim
```

شما نیاز دارید که کلمه "vim" را با "friend" جایگزین کنید اما فقط در خطوطی که شامل کلمه "hello" یا "hola" هستند. به یاد داشته باشید که از قبل در این فصل، می‌توانید از `|` برای چندین الگوی جایگزین استفاده کنید.

```shell
:%s/\v(hello|hola) vim/\1 friend/g
```

نتیجه:

```shell
hello friend
hola friend
salve vim
bonjour vim
```

تجزیه و تحلیل:
- `%s` دستور جایگزینی را بر روی هر خط در یک فایل اجرا می‌کند.
- `(hello|hola)` *یا* "hello" یا "hola" را تطابق می‌دهد و آن را به عنوان یک گروه در نظر می‌گیرد.
- `vim` کلمه واقعی "vim" است.
- `\1` گروه اول، که یا متن "hello" یا "hola" است، را برمی‌گرداند.
- `friend` کلمه واقعی "friend" است.

## جایگزینی شروع و پایان یک الگو

به یاد داشته باشید که می‌توانید از `\zs` و `\ze` برای تعریف شروع و پایان یک تطابق استفاده کنید. این تکنیک همچنین در جایگزینی کار می‌کند. اگر شما داشته باشید:

```shell
چاکلت پنکیک
پنکیک توت‌فرنگی
پنکیک بلوبری
```

برای جایگزینی "cake" در "hotcake" با "dog" برای به دست آوردن یک "hotdog":

```shell
:%s/hot\zscake/dog/g
```

نتیجه:

```shell
چاکلت پنکیک
پنکیک توت‌فرنگی
پنکیک بلوبری
blueberry hotdog
```
## حریص و غیر حریص

شما می‌توانید با این ترفند، جایگزینی nth در یک خط انجام دهید:

```shell
One Mississippi, two Mississippi, three Mississippi, four Mississippi, five Mississippi.
```

برای جایگزینی سومین "Mississippi" با "Arkansas"، اجرا کنید:

```shell
:s/\v(.{-}\zsMississippi){3}/Arkansas/g
```

تجزیه و تحلیل:
- `:s/` دستور جایگزینی است.
- `\v` کلمه جادویی است تا نیازی به فرار از کلمات کلیدی خاص نباشد.
- `.` هر کاراکتر تکی را مطابقت می‌دهد.
- `{-}` مطابقت غیر حریص از 0 یا بیشتر از اتم قبلی را انجام می‌دهد.
- `\zsMississippi` "Mississippi" را به عنوان شروع مطابقت قرار می‌دهد.
- `(...){3}` به دنبال سومین مطابقت می‌گردد.

شما قبلاً نحو `{3}` را در این فصل دیده‌اید. در این مورد، `{3}` دقیقاً سومین مطابقت را پیدا می‌کند. ترفند جدید در اینجا `{-}` است. این یک مطابقت غیر حریص است. این کوتاه‌ترین مطابقت الگوی داده شده را پیدا می‌کند. در این مورد، `(.{-}Mississippi)` کمترین مقدار "Mississippi" را که توسط هر کاراکتری پیش می‌آید، مطابقت می‌دهد. این را با `(.*Mississippi)` مقایسه کنید که طولانی‌ترین مطابقت الگوی داده شده را پیدا می‌کند.

اگر از `(.{-}Mississippi)` استفاده کنید، پنج مطابقت خواهید داشت: "One Mississippi"، "Two Mississippi" و غیره. اگر از `(.*Mississippi)` استفاده کنید، یک مطابقت خواهید داشت: آخرین "Mississippi". `*` یک مطابقت حریص و `{-}` یک مطابقت غیر حریص است. برای یادگیری بیشتر به `:h /\{-` و `:h non-greedy` مراجعه کنید.

بیایید یک مثال ساده‌تر انجام دهیم. اگر رشته‌ای داشته باشید:

```shell
abc1de1
```

می‌توانید "abc1de1" (حریص) را با:

```shell
/a.*1
```

مطابقت دهید.

می‌توانید "abc1" (غیر حریص) را با:

```shell
/a.\{-}1
```

مطابقت دهید.

بنابراین اگر نیاز دارید تا طولانی‌ترین مطابقت (حریص) را به حروف بزرگ تبدیل کنید، اجرا کنید:

```shell
:s/a.*1/\U&/g
```

تا به دست آورید:

```shell
ABC1DEFG1
```

اگر نیاز دارید تا کوتاه‌ترین مطابقت (غیر حریص) را به حروف بزرگ تبدیل کنید، اجرا کنید:

```shell
:s/a.\{-}1/\U&/g
```

تا به دست آورید:

```shell
ABC1defg1
```

اگر شما تازه با مفهوم حریص و غیر حریص آشنا شده‌اید، ممکن است درک آن سخت باشد. با ترکیب‌های مختلف آزمایش کنید تا آن را درک کنید.

## جایگزینی در چندین فایل

در نهایت، بیایید یاد بگیریم چگونه عبارات را در چندین فایل جایگزین کنیم. برای این بخش، فرض کنید که دو فایل دارید: `food.txt` و `animal.txt`.

درون `food.txt`:

```shell
corndog
hotdog
chilidog
```

درون `animal.txt`:

```shell
large dog
medium dog
small dog
```

فرض کنید ساختار دایرکتوری شما به این شکل است:

```shell
- food.txt
- animal.txt
```

اول، هر دو `food.txt` و `animal.txt` را درون `:args` ذخیره کنید. از فصل‌های قبلی به یاد داشته باشید که `:args` می‌تواند برای ایجاد یک لیست از نام‌های فایل استفاده شود. چندین راه برای انجام این کار از داخل Vim وجود دارد، یکی از آن‌ها اجرای این دستور از داخل Vim است:

```shell
:args *.txt                  captures all txt files in current location
```

برای آزمایش، وقتی `:args` را اجرا می‌کنید، باید ببینید:

```shell
[food.txt] animal.txt
```

حالا که همه فایل‌های مربوطه در لیست آرگومان‌ها ذخیره شده‌اند، می‌توانید با دستور `:argdo` یک جایگزینی چند فایل انجام دهید. اجرا کنید:

```shell
:argdo %s/dog/chicken/
```

این جایگزینی را در تمام فایل‌های داخل لیست `:args` انجام می‌دهد. در نهایت، فایل‌های تغییر یافته را با:

```shell
:argdo update
```

ذخیره کنید.

`:args` و `:argdo` ابزارهای مفیدی برای اعمال دستورات خط فرمان در چندین فایل هستند. با دستورات دیگر نیز امتحان کنید!

## جایگزینی در چندین فایل با ماکروها

به طور متناوب، می‌توانید همچنین دستور جایگزینی را در چندین فایل با ماکروها اجرا کنید. اجرا کنید:

```shell
:args *.txt
qq
:%s/dog/chicken/g
:wnext
q
99@q
```

تجزیه و تحلیل:
- `:args *.txt` تمام فایل‌های متنی را به لیست `:args` اضافه می‌کند.
- `qq` ماکرو را در رجیستر "q" شروع می‌کند.
- `:%s/dog/chicken/g` "dog" را با "chicken" در تمام خطوط فایل جاری جایگزین می‌کند.
- `:wnext` فایل را ذخیره کرده و سپس به فایل بعدی در لیست `args` می‌رود.
- `q` ضبط ماکرو را متوقف می‌کند.
- `99@q` ماکرو را نود و نه بار اجرا می‌کند. Vim پس از برخورد با اولین خطا، اجرای ماکرو را متوقف می‌کند، بنابراین Vim واقعاً ماکرو را نود و نه بار اجرا نخواهد کرد.

## یادگیری جستجو و جایگزینی به روش هوشمند

توانایی جستجو به خوبی یک مهارت ضروری در ویرایش است. تسلط بر جستجو به شما این امکان را می‌دهد که از انعطاف‌پذیری عبارات منظم برای جستجوی هر الگو در یک فایل استفاده کنید. زمان بگذارید تا این‌ها را یاد بگیرید. برای بهتر شدن با عبارات منظم، باید به طور فعال از عبارات منظم استفاده کنید. من یک بار کتابی درباره عبارات منظم خواندم بدون اینکه واقعاً آن را انجام دهم و تقریباً همه چیزهایی که خوانده بودم را فراموش کردم. کدنویسی فعال بهترین راه برای تسلط بر هر مهارتی است.

یک روش خوب برای بهبود مهارت مطابقت الگو این است که هر زمان که نیاز به جستجوی یک الگو دارید (مانند "hello 123")، به جای جستجوی اصطلاح جستجوی دقیق (`/hello 123`)، سعی کنید یک الگو برای آن پیدا کنید (چیزی شبیه به `/\v(\l+) (\d+)`). بسیاری از این مفاهیم عبارات منظم همچنین در برنامه‌نویسی عمومی قابل استفاده هستند، نه تنها هنگام استفاده از Vim.

حالا که درباره جستجوی پیشرفته و جایگزینی در Vim یاد گرفتید، بیایید یکی از چندمنظوره‌ترین دستورات، دستور جهانی را یاد بگیریم.