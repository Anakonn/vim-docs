---
description: 이 문서는 Vim의 되돌리기 기능에 대해 설명하며, 기본적인 되돌리기, 다시 실행, 되돌리기 브랜치 탐색 및 시간 여행 방법을
  배울 수 있습니다.
title: Ch10. Undo
---

우리는 모두 다양한 타이핑 실수를 합니다. 그래서 실행 취소는 모든 현대 소프트웨어에서 필수 기능입니다. Vim의 실행 취소 시스템은 단순한 실수를 실행 취소하고 다시 실행하는 것뿐만 아니라, 다양한 텍스트 상태에 접근할 수 있어, 당신이 지금까지 입력한 모든 텍스트를 제어할 수 있게 해줍니다. 이 장에서는 실행 취소, 다시 실행, 실행 취소 분기 탐색, 실행 취소 지속, 그리고 시간 여행하는 방법을 배웁니다.

## 실행 취소, 다시 실행, 그리고 UNDO

기본적인 실행 취소를 수행하려면 `u`를 사용하거나 `:undo`를 실행하면 됩니다.

이 텍스트가 있다고 가정해 보겠습니다(아래 "one"의 빈 줄에 주목하세요):

```shell
one

```

그런 다음 또 다른 텍스트를 추가합니다:

```shell
one
two
```

`u`를 누르면 Vim은 "two"라는 텍스트를 실행 취소합니다.

Vim은 얼마나 많은 것을 실행 취소해야 하는지 어떻게 알까요? Vim은 한 번에 단일 "변경"만 실행 취소하며, 이는 점 명령의 변경과 유사합니다(점 명령과 달리 명령줄 명령도 변경으로 간주됩니다).

마지막 변경을 다시 실행하려면 `Ctrl-R`을 누르거나 `:redo`를 실행합니다. 위의 텍스트에서 "two"를 제거하기 위해 실행 취소한 후, `Ctrl-R`을 실행하면 제거된 텍스트가 다시 나타납니다.

Vim에는 `U`로 실행할 수 있는 UNDO도 있습니다. 이는 최신 변경 사항을 모두 실행 취소합니다.

`U`는 `u`와 어떻게 다를까요? 첫째, `U`는 최신 변경된 줄의 *모든* 변경 사항을 제거하는 반면, `u`는 한 번에 하나의 변경 사항만 제거합니다. 둘째, `u`를 수행하는 것은 변경 사항으로 간주되지 않지만, `U`를 수행하는 것은 변경 사항으로 간주됩니다.

이 예제로 돌아가 보겠습니다:

```shell
one
two
```

두 번째 줄을 "three"로 변경합니다:

```shell
one
three
```

두 번째 줄을 다시 변경하고 "four"로 대체합니다:

```shell
one
four
```

`u`를 누르면 "three"가 보입니다. `u`를 다시 누르면 "two"가 보입니다. 만약 여전히 "four"라는 텍스트가 있을 때 `u` 대신 `U`를 눌렀다면, 다음과 같이 보일 것입니다:

```shell
one

```

`U`는 모든 중간 변경 사항을 우회하고 시작할 때의 원래 상태(빈 줄)로 돌아갑니다. 또한, UNDO는 실제로 Vim에서 새로운 변경 사항을 생성하므로, 당신은 실행 취소한 것을 다시 실행 취소할 수 있습니다. `U` 다음에 `U`를 누르면 자신을 실행 취소합니다. `U`, `U`, `U` 등을 누를 수 있으며, 같은 두 텍스트 상태가 서로 전환되는 것을 볼 수 있습니다.

저는 개인적으로 `U`를 사용하지 않습니다. 원래 상태를 기억하기 어렵기 때문입니다(거의 필요하지 않습니다).

Vim은 `undolevels` 옵션 변수에서 실행 취소할 수 있는 최대 횟수를 설정합니다. `:echo &undolevels`로 확인할 수 있습니다. 저는 1000으로 설정해 두었습니다. 당신의 설정을 1000으로 변경하려면 `:set undolevels=1000`을 실행하세요. 원하는 숫자로 설정해도 좋습니다.

## 블록 나누기

앞서 언급했듯이 `u`는 점 명령의 변경과 유사하게 단일 "변경"을 실행 취소합니다: 삽입 모드에 들어가서 나올 때까지 입력된 텍스트는 변경으로 간주됩니다.

`ione two three<Esc>`를 입력한 후 `u`를 누르면, Vim은 전체 "one two three" 텍스트를 제거합니다. 전체가 변경으로 간주되기 때문입니다. 짧은 텍스트를 작성했다면 큰 문제가 되지 않지만, 삽입 모드 세션에서 여러 단락을 작성한 후 실수를 깨달았다면 어떻게 될까요? `u`를 누르면 작성한 모든 것이 제거됩니다. 텍스트의 일부만 제거하기 위해 `u`를 누를 수 있다면 유용하지 않을까요?

다행히도 실행 취소 블록을 나눌 수 있습니다. 삽입 모드에서 입력할 때 `Ctrl-G u`를 누르면 실행 취소 중단점을 생성합니다. 예를 들어, `ione <Ctrl-G u>two <Ctrl-G u>three<Esc>`를 입력한 후 `u`를 누르면 "three" 텍스트만 잃게 됩니다(한 번 더 `u`를 눌러 "two"를 제거할 수 있습니다). 긴 텍스트를 작성할 때는 `Ctrl-G u`를 전략적으로 사용하세요. 각 문장의 끝, 두 단락 사이, 또는 코드의 각 줄 뒤는 실수를 쉽게 실행 취소할 수 있도록 실행 취소 중단점을 추가하기에 좋은 위치입니다.

삽입 모드에서 `Ctrl-W`(커서 앞의 단어 삭제) 및 `Ctrl-U`(커서 앞의 모든 텍스트 삭제)로 덩어리를 삭제할 때 실행 취소 중단점을 만드는 것도 유용합니다. 친구가 다음과 같은 매핑을 사용하라고 제안했습니다:

```shell
inoremap <c-u> <c-g>u<c-u>
inoremap <c-w> <c-g>u<c-w>
```

이 매핑을 사용하면 삭제된 텍스트를 쉽게 복구할 수 있습니다.

## 실행 취소 트리

Vim은 작성된 모든 변경 사항을 실행 취소 트리에 저장합니다. 새 빈 파일을 시작합니다. 그런 다음 새 텍스트를 추가합니다:

```shell
one

```

새 텍스트를 추가합니다:

```shell
one
two
```

한 번 실행 취소합니다:

```shell
one

```

다른 텍스트를 추가합니다:

```shell
one
three
```

다시 실행 취소합니다:

```shell
one

```

그리고 또 다른 다른 텍스트를 추가합니다:

```shell
one
four
```

이제 실행 취소하면 방금 추가한 "four" 텍스트를 잃게 됩니다:

```shell
one

```

한 번 더 실행 취소하면:

```shell

```

"one" 텍스트를 잃게 됩니다. 대부분의 텍스트 편집기에서는 "two"와 "three" 텍스트를 되찾는 것이 불가능했겠지만, Vim에서는 가능합니다! `g+`를 누르면 "one" 텍스트를 다시 얻을 수 있습니다:

```shell
one

```

`g+`를 다시 입력하면 옛 친구를 보게 됩니다:

```shell
one
two
```

계속 진행합시다. `g+`를 다시 누릅니다:

```shell
one
three
```

`g+`를 한 번 더 누릅니다:

```shell
one
four
```

Vim에서는 `u`를 누르고 다른 변경을 하면, Vim은 이전 상태의 텍스트를 "실행 취소 분기"를 생성하여 저장합니다. 이 예제에서 "two"를 입력한 후 `u`를 누르고 "three"를 입력하면, "two"라는 텍스트를 포함하는 상태를 저장하는 리프 분기가 생성됩니다. 그 순간, 실행 취소 트리는 최소한 두 개의 리프 노드를 포함합니다: 가장 최근의 텍스트 "three"를 포함하는 주 노드와 텍스트 "two"를 포함하는 실행 취소 분기 노드. 만약 또 다른 실행 취소를 하고 "four"라는 텍스트를 입력했다면, 세 개의 노드가 생깁니다: 텍스트 "four"를 포함하는 주 노드와 텍스트 "three"와 "two"를 포함하는 두 개의 노드.

각 실행 취소 트리 노드를 탐색하려면 `g+`를 사용하여 더 새로운 상태로 이동하고 `g-`를 사용하여 더 오래된 상태로 이동할 수 있습니다. `u`, `Ctrl-R`, `g+`, `g-`의 차이점은 `u`와 `Ctrl-R`은 실행 취소 트리의 *주* 노드만 탐색하는 반면, `g+`와 `g-`는 실행 취소 트리의 *모든* 노드를 탐색한다는 것입니다.

실행 취소 트리는 시각화하기 쉽지 않습니다. 저는 [vim-mundo](https://github.com/simnalamburt/vim-mundo) 플러그인이 Vim의 실행 취소 트리를 시각화하는 데 매우 유용하다고 생각합니다. 시간을 내어 이 플러그인으로 놀아보세요.

## 지속적인 실행 취소

Vim을 시작하고 파일을 열고 즉시 `u`를 누르면, Vim은 아마도 "*Already at oldest change*" 경고를 표시할 것입니다. 변경 사항을 만들지 않았기 때문에 실행 취소할 것이 없습니다.

마지막 편집 세션의 실행 취소 기록을 롤오버하려면, Vim은 `:wundo`로 실행 취소 파일을 통해 실행 취소 기록을 보존할 수 있습니다.

`mynumbers.txt`라는 파일을 만듭니다. 다음을 입력합니다:

```shell
one
```

그런 다음 또 다른 줄을 입력합니다(각 줄이 변경으로 간주되도록):

```shell
one
two
```

또 다른 줄을 입력합니다:

```shell
one
two
three
```

이제 `:wundo {my-undo-file}`로 실행 취소 파일을 만듭니다. 기존 실행 취소 파일을 덮어쓰려면 `wundo` 뒤에 `!`를 추가할 수 있습니다.

```shell
:wundo! mynumbers.undo
```

그런 다음 Vim을 종료합니다.

이제 `mynumbers.txt`와 `mynumbers.undo` 파일이 디렉토리에 있어야 합니다. 다시 `mynumbers.txt`를 열고 `u`를 눌러 보세요. 할 수 없습니다. 파일을 연 이후로 변경 사항을 만들지 않았기 때문입니다. 이제 `:rundo`로 실행 취소 파일을 읽어 실행 취소 기록을 불러옵니다:

```shell
:rundo mynumbers.undo
```

이제 `u`를 누르면 Vim이 "three"를 제거합니다. 다시 `u`를 눌러 "two"를 제거합니다. 마치 Vim을 닫지 않은 것처럼 보입니다!

자동 실행 취소 지속성을 원한다면, vimrc에 다음을 추가하는 방법이 있습니다:

```shell
set undodir=~/.vim/undo_dir
set undofile
```

위 설정은 모든 실행 취소 파일을 하나의 중앙 디렉토리인 `~/.vim` 디렉토리에 저장합니다. `undo_dir`이라는 이름은 임의입니다. `set undofile`은 Vim에게 기본적으로 꺼져 있는 `undofile` 기능을 켜라고 지시합니다. 이제 저장할 때마다 Vim은 자동으로 `undo_dir` 디렉토리 내의 관련 파일을 생성하고 업데이트합니다(이 작업을 수행하기 전에 `~/.vim` 디렉토리 내에 실제 `undo_dir` 디렉토리를 생성해야 합니다).

## 시간 여행

시간 여행이 존재하지 않는다고 누가 말했나요? Vim은 `:earlier` 명령줄 명령으로 과거의 텍스트 상태로 여행할 수 있습니다.

이 텍스트가 있다고 가정해 보겠습니다:

```shell
one

```
그런 다음 나중에 추가합니다:

```shell
one
two
```

"two"를 입력한 지 10초가 되지 않았다면, 다음과 같이 10초 전 "two"가 존재하지 않았던 상태로 돌아갈 수 있습니다:

```shell
:earlier 10s
```

`:undolist`를 사용하여 마지막 변경이 언제 이루어졌는지 확인할 수 있습니다. `:earlier`는 다양한 인수도 허용합니다:

```shell
:earlier 10s    10초 전 상태로 이동
:earlier 10m    10분 전 상태로 이동
:earlier 10h    10시간 전 상태로 이동
:earlier 10d    10일 전 상태로 이동
```

또한, Vim에게 `count` 횟수만큼 더 오래된 상태로 가라고 지시하는 일반 `count` 인수도 허용합니다. 예를 들어, `:earlier 2`를 입력하면 Vim은 두 번의 변경 전의 오래된 텍스트 상태로 돌아갑니다. 이는 `g-`를 두 번 누르는 것과 같습니다. 또한 `:earlier 10f`를 사용하여 10번의 저장 전 상태로 돌아갈 수 있습니다.

동일한 인수 집합은 `:later`의 대응 명령에도 적용됩니다:

```shell
:later 10s    10초 후 상태로 이동
:later 10m    10분 후 상태로 이동
:later 10h    10시간 후 상태로 이동
:later 10d    10일 후 상태로 이동
:later 10     더 새로운 상태로 10번 이동
:later 10f    10번 저장 후 상태로 이동
```

## 스마트하게 실행 취소 배우기

`u`와 `Ctrl-R`은 실수를 수정하는 데 필수적인 두 가지 Vim 명령입니다. 먼저 이들을 배우세요. 다음으로, 시간 인수를 사용하여 `:earlier`와 `:later`를 사용하는 방법을 배우세요. 그 후, 실행 취소 트리를 이해하는 데 시간을 투자하세요. [vim-mundo](https://github.com/simnalamburt/vim-mundo) 플러그인이 많은 도움이 되었습니다. 이 장의 텍스트를 따라 입력하고 각 변경을 할 때 실행 취소 트리를 확인하세요. 이를 이해하면 실행 취소 시스템을 더 이상 같은 시각으로 보지 않게 될 것입니다.

이 장 이전에 프로젝트 공간에서 텍스트를 찾는 방법을 배웠다면, 이제는 시간 차원에서 텍스트를 찾을 수 있습니다. 이제 작성된 위치와 시간에 따라 텍스트를 검색할 수 있습니다. 당신은 Vim-전지전능을 달성했습니다.