---
description: Изучение регистров Vim поможет вам эффективно управлять текстом, избегая
  повторного ввода. Узнайте о 10 типах регистров и их использовании.
title: Ch08. Registers
---

Изучение регистров Vim похоже на изучение алгебры в первый раз. Вы не думали, что это вам нужно, пока это не понадобилось.

Вы, вероятно, использовали регистры Vim, когда вы вырезали или удаляли текст, а затем вставляли его с помощью `p` или `P`. Однако вы знали, что у Vim есть 10 различных типов регистров? При правильном использовании регистры Vim могут избавить вас от повторяющегося ввода.

В этой главе я расскажу о всех типах регистров Vim и о том, как эффективно их использовать.

## Десять типов регистров

Вот 10 типов регистров Vim:

1. Неназванный регистр (`""`).
2. Нумерованные регистры (`"0-9`).
3. Малый регистр для удаления (`"-`).
4. Именованные регистры (`"a-z`).
5. Регистры только для чтения (`":`, `".`, и `"%`).
6. Регистр альтернативного файла (`"#`).
7. Регистр выражений (`"=`).
8. Регистры выделения (`"*` и `"+`).
9. Регистр черной дыры (`"_`).
10. Регистр последнего шаблона поиска (`"/`).

## Операторы регистров

Чтобы использовать регистры, вам сначала нужно сохранить их с помощью операторов. Вот некоторые операторы, которые сохраняют значения в регистрах:

```shell
y    Вырезать (копировать)
c    Удалить текст и начать режим вставки
d    Удалить текст
```

Есть и другие операторы (например, `s` или `x`), но вышеуказанные являются полезными. Общее правило: если оператор может удалить текст, он, вероятно, сохраняет текст в регистрах.

Чтобы вставить текст из регистров, вы можете использовать:

```shell
p    Вставить текст после курсора
P    Вставить текст перед курсором
```

Оба `p` и `P` принимают количество и символ регистра в качестве аргументов. Например, чтобы вставить десять раз, выполните `10p`. Чтобы вставить текст из регистра a, выполните `"ap`. Чтобы вставить текст из регистра a десять раз, выполните `10"ap`. Кстати, `p` на самом деле технически означает "поместить", а не "вставить", но я думаю, что "вставить" — более привычное слово.

Общая синтаксис для получения содержимого из конкретного регистра — это `"a`, где `a` — символ регистра.

## Вызов регистров из режима вставки

Все, что вы изучите в этой главе, также можно выполнить в режиме вставки. Чтобы получить текст из регистра a, обычно вы делаете `"ap`. Но если вы находитесь в режиме вставки, выполните `Ctrl-R a`. Синтаксис для вызова регистров из режима вставки:

```shell
Ctrl-R a
```

Где `a` — символ регистра. Теперь, когда вы знаете, как сохранять и извлекать регистры, давайте углубимся!

## Неназванный регистр

Чтобы получить текст из неназванного регистра, выполните `""p`. Он хранит последний текст, который вы вырезали, изменили или удалили. Если вы выполните другой вырез, изменение или удаление, Vim автоматически заменит старый текст. Неназванный регистр похож на стандартную операцию копирования / вставки компьютера.

По умолчанию `p` (или `P`) связан с неназванным регистром (с этого момента я буду ссылаться на неназванный регистр как `p`, а не `""p`).

## Нумерованные регистры

Нумерованные регистры автоматически заполняются в порядке возрастания. Существует 2 различных нумерованных регистра: регистр вырезанного текста (`0`) и нумерованные регистры (`1-9`). Давайте сначала обсудим регистр вырезанного текста.

### Регистр вырезанного текста

Если вы вырезаете всю строку текста (`yy`), Vim на самом деле сохраняет этот текст в двух регистрах:

1. Неназванный регистр (`p`).
2. Регистр вырезанного текста (`"0p`).

Когда вы вырезаете другой текст, Vim обновляет как регистр вырезанного текста, так и неназванный регистр. Любые другие операции (например, удаление) не будут сохранены в регистре 0. Это можно использовать в своих интересах, потому что, если вы не выполните другой вырез, вырезанный текст всегда будет там, независимо от того, сколько изменений и удалений вы сделаете.

Например, если вы:
1. Вырезаете строку (`yy`)
2. Удаляете строку (`dd`)
3. Удаляете другую строку (`dd`)

Регистр вырезанного текста будет содержать текст из первого шага.

Если вы:
1. Вырезаете строку (`yy`)
2. Удаляете строку (`dd`)
3. Вырезаете другую строку (`yy`)

Регистр вырезанного текста будет содержать текст из третьего шага.

Последний совет: находясь в режиме вставки, вы можете быстро вставить текст, который вы только что вырезали, используя `Ctrl-R 0`.

### Ненулевые нумерованные регистры

Когда вы изменяете или удаляете текст, который занимает хотя бы одну строку, этот текст будет сохранен в нумерованных регистрах 1-9, отсортированных по последнему.

Например, если у вас есть следующие строки:

```shell
line three
line two
line one
```

С курсором на "line three", удалите их по одной с помощью `dd`. Как только все строки будут удалены, регистр 1 должен содержать "line one" (самый последний), регистр два "line two" (второй по последнему), и регистр три "line three" (самый старый). Чтобы получить содержимое из регистра один, выполните `"1p`.

Кстати, эти нумерованные регистры автоматически увеличиваются при использовании команды точки. Если ваш нумерованный регистр один (`"1`) содержит "line one", регистр два (`"2`) "line two", и регистр три (`"3`) "line three", вы можете вставлять их последовательно с помощью этого трюка:
- Выполните `"1P`, чтобы вставить содержимое из нумерованного регистра один ("1).
- Выполните `.` чтобы вставить содержимое из нумерованного регистра два ("2).
- Выполните `.` чтобы вставить содержимое из нумерованного регистра три ("3).

Этот трюк работает с любым нумерованным регистром. Если вы начали с `"5P`, `.` будет делать `"6P`, `.` снова будет делать `"7P`, и так далее.

Небольшие удаления, такие как удаление слова (`dw`) или изменение слова (`cw`), не сохраняются в нумерованных регистрах. Они сохраняются в малом регистре для удаления (`"-`), который я обсудю далее.

## Малый регистр для удаления

Изменения или удаления менее одной строки не сохраняются в нумерованных регистрах 0-9, а в малом регистре для удаления (`"-`).

Например:
1. Удалите слово (`diw`)
2. Удалите строку (`dd`)
3. Удалите строку (`dd`)

`"-p` даст вам удаленное слово из первого шага.

Другой пример:
1. Я удаляю слово (`diw`)
2. Я удаляю строку (`dd`)
3. Я удаляю слово (`diw`)

`"-p` даст вам удаленное слово из третьего шага. `"1p` даст вам удаленную строку из второго шага. К сожалению, нет способа вернуть удаленное слово из первого шага, потому что малый регистр для удаления хранит только один элемент. Однако, если вы хотите сохранить текст из первого шага, вы можете сделать это с помощью именованных регистров.

## Именованный регистр

Именованные регистры — это самые универсальные регистры Vim. Они могут хранить вырезанные, измененные и удаленные тексты в регистрах a-z. В отличие от предыдущих 3 типов регистров, которые автоматически сохраняют тексты в регистрах, вам нужно явно указать Vim использовать именованный регистр, что дает вам полный контроль.

Чтобы вырезать слово в регистр a, вы можете сделать это с помощью `"ayiw`.
- `"a` говорит Vim, что следующее действие (удаление / изменение / вырезание) будет сохранено в регистре a.
- `yiw` вырезает слово.

Чтобы получить текст из регистра a, выполните `"ap`. Вы можете использовать все двадцать шесть буквенных символов для хранения двадцати шести различных текстов с именованными регистрами.

Иногда вы можете захотеть добавить к вашему существующему именованному регистру. В этом случае вы можете добавить свой текст, а не начинать все сначала. Для этого вы можете использовать заглавную версию этого регистра. Например, предположим, что у вас уже есть слово "Hello " в регистре a. Если вы хотите добавить "world" в регистр a, вы можете найти текст "world" и вырезать его, используя регистр A (`"Ayiw`).

## Регистры только для чтения

У Vim есть три регистра только для чтения: `.`, `:`, и `%`. Их довольно просто использовать:

```shell
.    Сохраняет последний вставленный текст
:    Сохраняет последнюю выполненную команду
%    Сохраняет имя текущего файла
```

Если последний текст, который вы написали, был "Hello Vim", выполнение `".p` выведет текст "Hello Vim". Если вы хотите получить имя текущего файла, выполните `"%p`. Если вы выполните команду `:s/foo/bar/g`, выполнение `":p` выведет буквальный текст "s/foo/bar/g".

## Регистр альтернативного файла

В Vim `#` обычно представляет альтернативный файл. Альтернативный файл — это последний открытый вами файл. Чтобы вставить имя альтернативного файла, вы можете использовать `"#p`.

## Регистр выражений

У Vim есть регистр выражений, `"=`, для оценки выражений.

Чтобы оценить математическое выражение `1 + 1`, выполните:

```shell
"=1+1<Enter>p
```

Здесь вы говорите Vim, что используете регистр выражений с `"=`. Ваше выражение — это (`1 + 1`). Вам нужно ввести `p`, чтобы получить результат. Как уже упоминалось, вы также можете получить доступ к регистру из режима вставки. Чтобы оценить математическое выражение из режима вставки, вы можете сделать:

```shell
Ctrl-R =1+1
```

Вы также можете получить значения из любого регистра через регистр выражений, добавив `@`. Если вы хотите получить текст из регистра a:

```shell
"=@a
```

Затем нажмите `<Enter>`, затем `p`. Аналогично, чтобы получить значения из регистра a, находясь в режиме вставки:

```shell
Ctrl-r =@a
```

Выражения — это обширная тема в Vim, поэтому я здесь только затрону основы. Я рассмотрю выражения более подробно в следующих главах по Vimscript.

## Регистры выделения

Разве вам не хотелось бы иногда скопировать текст из внешних программ и вставить его локально в Vim, и наоборот? С регистрами выделения Vim вы можете это сделать. У Vim есть два регистра выделения: `quotestar` (`"*`) и `quoteplus` (`"+`). Вы можете использовать их для доступа к скопированному тексту из внешних программ.

Если вы находитесь в внешней программе (например, в браузере Chrome) и копируете блок текста с помощью `Ctrl-C` (или `Cmd-C`, в зависимости от вашей ОС), обычно вы не сможете использовать `p`, чтобы вставить текст в Vim. Однако оба регистра Vim `"+` и `"*` связаны с вашим буфером обмена, так что вы можете на самом деле вставить текст с помощью `"+p` или `"*p`. Напротив, если вы вырезаете слово из Vim с помощью `"+yiw` или `"*yiw`, вы можете вставить этот текст в внешней программе с помощью `Ctrl-V` (или `Cmd-V`). Обратите внимание, что это работает только в том случае, если ваша программа Vim имеет опцию `+clipboard` (чтобы проверить это, выполните `:version`).

Вы можете задаться вопросом, если `"*` и `"+` делают одно и то же, почему у Vim есть два разных регистра? Некоторые машины используют оконную систему X11. Эта система имеет 3 типа выделений: первичное, вторичное и буфер обмена. Если ваша машина использует X11, Vim использует *первичное* выделение X11 с регистром `quotestar` (`"*`) и *буфер обмена* X11 с регистром `quoteplus` (`"+`). Это применимо только в том случае, если у вас есть опция `+xterm_clipboard` в вашей сборке Vim. Если у вашего Vim нет `xterm_clipboard`, это не проблема. Это просто означает, что оба `quotestar` и `quoteplus` взаимозаменяемы (у меня тоже нет).

Мне кажется, что делать `=*p` или `=+p` (или `"*p` или `"+p`) неудобно. Чтобы заставить Vim вставлять скопированный текст из внешней программы с помощью только `p`, вы можете добавить это в ваш vimrc:

```shell
set clipboard=unnamed
```

Теперь, когда я копирую текст из внешней программы, я могу вставить его с помощью неназванного регистра, `p`. Я также могу скопировать текст из Vim и вставить его в внешнюю программу. Если у вас есть `+xterm_clipboard`, вы можете использовать как опции `unnamed`, так и `unnamedplus`.

## Регистр черной дыры

Каждый раз, когда вы удаляете или изменяете текст, этот текст автоматически сохраняется в регистре Vim. Будут случаи, когда вы не хотите ничего сохранять в регистре. Как вы можете это сделать?

Вы можете использовать регистр черной дыры (`"_`). Чтобы удалить строку и не позволить Vim сохранить удаленную строку в любом регистре, используйте `"_dd`.

Регистр черной дыры похож на `/dev/null` регистров.

## Регистр последнего шаблона поиска

Чтобы вставить ваш последний поиск (`/` или `?`), вы можете использовать регистр последнего шаблона поиска (`"/`). Чтобы вставить последний поисковый термин, используйте `"/p`.

## Просмотр регистров

Чтобы просмотреть все ваши регистры, используйте команду `:register`. Чтобы просмотреть только регистры "a, "1, и "-, используйте `:register a 1 -`.

Существует плагин под названием [vim-peekaboo](https://github.com/junegunn/vim-peekaboo), который позволяет вам заглянуть в содержимое регистров, когда вы нажимаете `"` или `@` в нормальном режиме и `Ctrl-R` в режиме вставки. Я нахожу этот плагин очень полезным, потому что чаще всего я не могу вспомнить содержимое своих регистров. Попробуйте!

## Выполнение регистра

Именованные регистры предназначены не только для хранения текстов. Они также могут выполнять макросы с помощью `@`. Я расскажу о макросах в следующей главе.

Имейте в виду, что поскольку макросы хранятся внутри регистров Vim, вы можете случайно перезаписать сохраненный текст макросами. Если вы сохранили текст "Hello Vim" в регистре a и позже запишите макрос в том же регистре (`qa{macro-sequence}q`), этот макрос перезапишет ваш текст "Hello Vim", сохраненный ранее.
## Очистка регистра

Технически, нет необходимости очищать какой-либо регистр, потому что следующий текст, который вы сохраните под тем же именем регистра, перезапишет его. Однако вы можете быстро очистить любой именованный регистр, записав пустую макрос. Например, если вы выполните `qaq`, Vim запишет пустой макрос в регистре a.

Еще один вариант — выполнить команду `:call setreg('a', 'hello register a')`, где a — это регистр a, а "hello register a" — это текст, который вы хотите сохранить.

Еще один способ очистить регистр — установить содержимое регистра "a" в пустую строку с помощью выражения `:let @a = ''`.

## Вставка содержимого регистра

Вы можете использовать команду `:put`, чтобы вставить содержимое любого регистра. Например, если вы выполните `:put a`, Vim выведет содержимое регистра a ниже текущей строки. Это работает аналогично `"ap`, с той разницей, что команда нормального режима `p` вставляет содержимое регистра после курсора, а команда `:put` вставляет содержимое регистра на новой строке.

Поскольку `:put` является командой командной строки, вы можете передать ей адрес. `:10put a` вставит текст из регистра a ниже строки 10.

Одним из интересных трюков является использование `:put` с регистром черной дыры (`"_`). Поскольку регистр черной дыры не сохраняет текст, `:put _` вставит пустую строку вместо этого. Вы можете комбинировать это с глобальной командой, чтобы вставить несколько пустых строк. Например, чтобы вставить пустые строки ниже всех строк, содержащих текст "end", выполните `:g/end/put _`. Вы узнаете о глобальной команде позже.

## Изучение регистров умным способом

Вы дошли до конца. Поздравляю! Если вы чувствуете себя перегруженным из-за обилия информации, вы не одиноки. Когда я впервые начал изучать регистры Vim, информации было слишком много, чтобы воспринять ее сразу.

Я не думаю, что вам следует запоминать все регистры сразу. Чтобы стать продуктивным, вы можете начать с использования только этих 3 регистров:
1. Неназванный регистр (`""`).
2. Именованные регистры (`"a-z`).
3. Нумерованные регистры (`"0-9`).

Поскольку неназванный регистр по умолчанию соответствует `p` и `P`, вам нужно запомнить только два регистра: именованные регистры и нумерованные регистры. Постепенно изучайте больше регистров, когда они вам понадобятся. Не спешите.

Средний человек имеет ограниченную емкость кратковременной памяти, около 5 - 7 элементов за раз. Вот почему в своей повседневной работе я использую только около 5 - 7 именованных регистров. Я не могу запомнить все двадцать шесть в своей голове. Обычно я начинаю с регистра a, затем b, поднимаясь по алфавитному порядку. Попробуйте это и экспериментируйте, чтобы увидеть, какая техника работает лучше для вас.

Регистры Vim мощные. Используемые стратегически, они могут спасти вас от набора бесчисленных повторяющихся текстов. Далее давайте узнаем о макросах.