---
description: В этом разделе вы узнаете, как эффективно использовать визуальный режим
  в Vim для выделения и изменения текста с помощью трех типов визуальных режимов.
title: Ch11. Visual Mode
---

Выделение и применение изменений к тексту — это общая функция во многих текстовых редакторах и текстовых процессорах. Vim может делать это с помощью визуального режима. В этой главе вы узнаете, как использовать визуальный режим для эффективной работы с текстами.

## Три типа визуальных режимов

У Vim есть три разных визуальных режима. Они следующие:

```shell
v         Символьный визуальный режим
V         Строковый визуальный режим
Ctrl-V    Блочный визуальный режим
```

Если у вас есть текст:

```shell
one
two
three
```

Символьный визуальный режим работает с отдельными символами. Нажмите `v` на первом символе. Затем перейдите на следующую строку с помощью `j`. Это выделяет весь текст от "one" до вашего положения курсора. Если вы нажмете `gU`, Vim сделает заглавными выделенные символы.

Строковый визуальный режим работает со строками. Нажмите `V` и посмотрите, как Vim выделяет всю строку, на которой находится ваш курсор. Так же, как и в символьном визуальном режиме, если вы выполните `gU`, Vim сделает заглавными выделенные символы.

Блочный визуальный режим работает с рядами и столбцами. Он дает вам больше свободы передвижения, чем два других режима. Если вы нажмете `Ctrl-V`, Vim выделит символ под курсором, как в символьном визуальном режиме, за исключением того, что вместо выделения каждого символа до конца строки перед переходом на следующую строку, он переходит на следующую строку с минимальным выделением. Попробуйте перемещаться с помощью `h/j/k/l` и посмотрите, как движется курсор.

В нижнем левом углу вашего окна Vim вы увидите либо `-- VISUAL --`, `-- VISUAL LINE --`, либо `-- VISUAL BLOCK --`, чтобы указать, в каком визуальном режиме вы находитесь.

Находясь в визуальном режиме, вы можете переключиться на другой визуальный режим, нажав `v`, `V` или `Ctrl-V`. Например, если вы находитесь в строковом визуальном режиме и хотите переключиться на блочный визуальный режим, выполните `Ctrl-V`. Попробуйте это!

Существует три способа выйти из визуального режима: `<Esc>`, `Ctrl-C` и та же клавиша, что и ваш текущий визуальный режим. Это означает, что если вы сейчас находитесь в строковом визуальном режиме (`V`), вы можете выйти из него, нажав `V` снова. Если вы находитесь в символьном визуальном режиме, вы можете выйти из него, нажав `v`.

На самом деле есть еще один способ войти в визуальный режим:

```shell
gv    Вернуться в предыдущий визуальный режим
```

Это начнет тот же визуальный режим на том же выделенном текстовом блоке, что и в последний раз.

## Навигация в визуальном режиме

Находясь в визуальном режиме, вы можете расширять выделенный текстовый блок с помощью движений Vim.

Давайте используем тот же текст, что и раньше:

```shell
one
two
three
```

На этот раз начнем со строки "two". Нажмите `v`, чтобы перейти в символьный визуальный режим (здесь квадратные скобки `[]` представляют выделенные символы):

```shell
one
[t]wo
three
```

Нажмите `j`, и Vim выделит весь текст от строки "two" до первого символа строки "three".

```shell
one
[two
t]hree
```

Предположим, что с этой позиции вы хотите добавить строку "one" тоже. Если вы нажмете `k`, к вашему разочарованию, выделение переместится от строки "three".

```shell
one
[t]wo
three
```

Есть ли способ свободно расширять визуальный выбор, чтобы двигаться в любом направлении? Определенно. Давайте немного вернемся к тому моменту, когда у вас выделены строки "two" и "three".

```shell
one
[two
t]hree    <-- курсор
```

Визуальное выделение следует за движением курсора. Если вы хотите расширить его вверх до строки "one", вам нужно переместить курсор вверх к строке "two". В данный момент курсор находится на строке "three". Вы можете переключить положение курсора с помощью `o` или `O`.

```shell
one
[two     <-- курсор
t]hree
```

Теперь, когда вы нажмете `k`, это больше не уменьшит выделение, а расширит его вверх.

```shell
[one
two
t]hree
```

С помощью `o` или `O` в визуальном режиме курсор прыгает от начала до конца выделенного блока, позволяя вам расширить область выделения.

## Грамматика визуального режима

Визуальный режим разделяет многие операции с нормальным режимом.

Например, если у вас есть следующий текст и вы хотите удалить первые две строки из визуального режима:

```shell
one
two
three
```

Выделите строки "one" и "two" с помощью строкового визуального режима (`V`):

```shell
[one
two]
three
```

Нажатие `d` удалит выделение, аналогично нормальному режиму. Обратите внимание, что грамматическое правило из нормального режима, глагол + существительное, не применяется. Тот же глагол все еще там (`d`), но в визуальном режиме нет существительного. Грамматическое правило в визуальном режиме — это существительное + глагол, где существительное — это выделенный текст. Сначала выберите текстовый блок, затем следует команда.

В нормальном режиме есть некоторые команды, которые не требуют движения, такие как `x` для удаления одного символа под курсором и `r` для замены символа под курсором (`rx` заменяет символ под курсором на "x"). В визуальном режиме эти команды теперь применяются ко всему выделенному тексту вместо одного символа. Вернемся к выделенному тексту:

```shell
[one
two]
three
```

Выполнение `x` удаляет весь выделенный текст.

Вы можете использовать это поведение, чтобы быстро создать заголовок в тексте markdown. Предположим, вам нужно быстро превратить следующий текст в заголовок первого уровня markdown ("==="):

```shell
Глава Первая
```

Сначала скопируйте текст с помощью `yy`, затем вставьте его с помощью `p`:

```shell
Глава Первая
Глава Первая
```

Теперь перейдите ко второй строке и выделите ее с помощью строкового визуального режима:

```shell
Глава Первая
[Глава Первая]
```

Заголовок первого уровня — это серия "=" под текстом. Выполните `r=`, вуаля! Это избавляет вас от необходимости вручную набирать "=".

```shell
Глава Первая
===========
```

Чтобы узнать больше об операторах в визуальном режиме, ознакомьтесь с `:h visual-operators`.

## Визуальный режим и команды командной строки

Вы можете выборочно применять команды командной строки к выделенному текстовому блоку. Если у вас есть эти операторы и вы хотите заменить "const" на "let" только в первых двух строках:

```shell
const one = "one";
const two = "two";
const three = "three";
```

Выделите первые две строки с помощью *любого* визуального режима и выполните команду замены `:s/const/let/g`:

```shell
let one = "one";
let two = "two";
const three = "three";
```

Обратите внимание, что я сказал, что вы можете сделать это с *любым* визуальным режимом. Вам не нужно выделять всю строку, чтобы выполнить команду на этой строке. Главное, чтобы вы выбрали хотя бы один символ в каждой строке, команда будет применена.

## Добавление текста в нескольких строках

Вы можете добавлять текст в нескольких строках в Vim, используя блочный визуальный режим. Если вам нужно добавить точку с запятой в конце каждой строки:

```shell
const one = "one"
const two = "two"
const three = "three"
```

С курсором на первой строке:
- Запустите блочный визуальный режим и перейдите вниз на две строки (`Ctrl-V jj`).
- Выделите до конца строки (`$`).
- Добавьте (`A`), затем введите ";".
- Выйдите из визуального режима (`<Esc>`).

Теперь вы должны увидеть добавленную ";" в конце каждой строки. Довольно круто! Существует два способа войти в режим вставки из блочного визуального режима: `A`, чтобы ввести текст после курсора, или `I`, чтобы ввести текст перед курсором. Не путайте их с `A` (добавить текст в конец строки) и `I` (вставить текст перед первой непустой строкой) из нормального режима.

Кроме того, вы также можете использовать команду `:normal`, чтобы добавить текст в нескольких строках:
- Выделите все 3 строки (`vjj`).
- Введите `:normal! A;`.

Помните, что команда `:normal` выполняет команды нормального режима. Вы можете указать ей выполнить `A;`, чтобы добавить текст ";" в конец строки.

## Увеличение чисел

В Vim есть команды `Ctrl-X` и `Ctrl-A` для уменьшения и увеличения чисел. При использовании с визуальным режимом вы можете увеличивать числа в нескольких строках.

Если у вас есть эти HTML-элементы:

```shell
<div id="app-1"></div>
<div id="app-1"></div>
<div id="app-1"></div>
<div id="app-1"></div>
<div id="app-1"></div>
```

Плохо иметь несколько идентификаторов с одинаковым именем, поэтому давайте увеличим их, чтобы сделать уникальными:
- Переместите курсор на "1" во второй строке.
- Запустите блочный визуальный режим и перейдите вниз на 3 строки (`Ctrl-V 3j`). Это выделит оставшиеся "1". Теперь все "1" должны быть выделены (кроме первой строки).
- Выполните `g Ctrl-A`.

Вы должны увидеть следующий результат:

```shell
<div id="app-1"></div>
<div id="app-2"></div>
<div id="app-3"></div>
<div id="app-4"></div>
<div id="app-5"></div>
```

`g Ctrl-A` увеличивает числа в нескольких строках. `Ctrl-X/Ctrl-A` также может увеличивать буквы, с опцией форматов чисел:

```shell
set nrformats+=alpha
```

Опция `nrformats` инструктирует Vim, какие основания считаются "числами" для `Ctrl-A` и `Ctrl-X`, чтобы увеличивать и уменьшать. Добавив `alpha`, буквенный символ теперь считается числом. Если у вас есть следующие HTML-элементы:

```shell
<div id="app-a"></div>
<div id="app-a"></div>
<div id="app-a"></div>
<div id="app-a"></div>
<div id="app-a"></div>
```

Поставьте курсор на второй "app-a". Используйте ту же технику, что и выше (`Ctrl-V 3j`, затем `g Ctrl-A`), чтобы увеличить идентификаторы.

```shell
<div id="app-a"></div>
<div id="app-b"></div>
<div id="app-c"></div>
<div id="app-d"></div>
<div id="app-e"></div>
```

## Выбор последней области визуального режима

Ранее в этой главе я упоминал, что `gv` может быстро выделить последнее выделение визуального режима. Вы также можете перейти к местоположению начала и конца последнего визуального режима с помощью этих двух специальных меток:

```shell
`<    Перейти к первому месту предыдущего выделения визуального режима
`>    Перейти к последнему месту предыдущего выделения визуального режима
```

Ранее я также упоминал, что вы можете выборочно выполнять команды командной строки на выделенном тексте, такие как `:s/const/let/g`. Когда вы это делали, вы видели следующее:

```shell
:`<,`>s/const/let/g
```

На самом деле вы выполняли *диапазонную* команду `s/const/let/g` (с двумя метками в качестве адресов). Интересно!

Вы всегда можете редактировать эти метки в любое время. Если вместо этого вам нужно заменить текст с начала выделенного текста до конца файла, просто измените команду на:

```shell
:`<,$s/const/let/g
```

## Вход в визуальный режим из режима вставки

Вы также можете войти в визуальный режим из режима вставки. Чтобы перейти в символьный визуальный режим, находясь в режиме вставки:

```shell
Ctrl-O v
```

Напомню, что выполнение `Ctrl-O` в режиме вставки позволяет вам выполнить команду нормального режима. Находясь в этом режиме ожидания команды нормального режима, выполните `v`, чтобы войти в символьный визуальный режим. Обратите внимание, что в нижнем левом углу экрана написано `--(insert) VISUAL--`. Этот трюк работает с любым оператором визуального режима: `v`, `V` и `Ctrl-V`.

## Режим выбора

У Vim есть режим, похожий на визуальный режим, называемый режимом выбора. Как и визуальный режим, он также имеет три разных режима:

```shell
gh         Символьный режим выбора
gH         Строковый режим выбора
gCtrl-h    Блочный режим выбора
```

Режим выбора имитирует поведение выделения текста обычного редактора ближе, чем визуальный режим Vim.

В обычном редакторе, после того как вы выделили текстовый блок и ввели букву, скажем, букву "y", он удалит выделенный текст и вставит букву "y". Если вы выделите строку с помощью строкового режима выбора (`gH`) и введете "y", он удалит выделенный текст и вставит букву "y".

Сравните этот режим выбора с визуальным режимом: если вы выделите строку текста с помощью строкового визуального режима (`V`) и введете "y", выделенный текст не будет удален и заменен на буквальную букву "y", он будет скопирован. Вы не можете выполнять команды нормального режима на выделенном тексте в режиме выбора.

Лично я никогда не использовал режим выбора, но хорошо знать, что он существует.

## Учите визуальный режим умным способом

Визуальный режим — это представление Vim процедуры выделения текста.

Если вы обнаружите, что используете операции визуального режима гораздо чаще, чем операции нормального режима, будьте осторожны. Это антипаттерн. Для выполнения операции визуального режима требуется больше нажатий клавиш, чем ее аналог в нормальном режиме. Например, если вам нужно удалить внутреннее слово, зачем использовать четыре нажатия клавиш, `viwd` (визуально выделить внутреннее слово, а затем удалить), если вы можете сделать это всего за три нажатия клавиш (`diw`)? Последний вариант более прямой и лаконичный. Конечно, будут случаи, когда визуальные режимы уместны, но в общем, предпочтите более прямой подход.