---
description: В этом документе рассматривается, как использовать внешние команды Unix
  внутри Vim с помощью команды bang, позволяя эффективно работать с данными.
title: Ch14. External Commands
---

Внутри системы Unix вы найдете множество маленьких, гиперспециализированных команд, которые выполняют одну задачу (и делают это хорошо). Вы можете связывать эти команды, чтобы они работали вместе для решения сложной проблемы. Разве не было бы здорово, если бы вы могли использовать эти команды изнутри Vim?

Определенно. В этой главе вы узнаете, как расширить Vim для бесшовной работы с внешними командами.

## Команда Bang

Vim имеет команду bang (`!`), которая может делать три вещи:

1. Чтение STDOUT внешней команды в текущий буфер.
2. Запись содержимого вашего буфера как STDIN для внешней команды.
3. Выполнение внешней команды изнутри Vim.

Давайте рассмотрим каждую из них.

## Чтение STDOUT команды в Vim

Синтаксис для чтения STDOUT внешней команды в текущий буфер:

```shell
:r !cmd
```

`:r` — это команда чтения в Vim. Если вы используете ее без `!`, вы можете использовать ее для получения содержимого файла. Если у вас есть файл `file1.txt` в текущем каталоге и вы выполните:

```shell
:r file1.txt
```

Vim вставит содержимое `file1.txt` в текущий буфер.

Если вы выполните команду `:r`, за которой следует `!` и внешняя команда, вывод этой команды будет вставлен в текущий буфер. Чтобы получить результат команды `ls`, выполните:

```shell
:r !ls
```

Это вернет что-то вроде:

```shell
file1.txt
file2.txt
file3.txt
```

Вы можете прочитать данные из команды `curl`:

```shell
:r !curl -s 'https://jsonplaceholder.typicode.com/todos/1'
```

Команда `r` также принимает адрес:

```shell
:10r !cat file1.txt
```

Теперь STDOUT от выполнения `cat file1.txt` будет вставлен после 10-й строки.

## Запись содержимого буфера в внешнюю команду

Команда `:w`, помимо сохранения файла, может быть использована для передачи текста из текущего буфера как STDIN для внешней команды. Синтаксис:

```shell
:w !cmd
```

Если у вас есть следующие выражения:

```shell
console.log("Hello Vim");
console.log("Vim is awesome");
```

Убедитесь, что у вас установлен [node](https://nodejs.org/en/) на вашем компьютере, затем выполните:

```shell
:w !node
```

Vim использует `node` для выполнения JavaScript-выражений, чтобы напечатать "Hello Vim" и "Vim is awesome".

При использовании команды `:w` Vim использует весь текст в текущем буфере, аналогично глобальной команде (большинство команд командной строки, если вы не передаете диапазон, выполняют команду только для текущей строки). Если вы передаете `:w` конкретный адрес:

```shell
:2w !node
```

Vim использует только текст со второй строки в интерпретаторе `node`.

Существует тонкое, но значительное различие между `:w !node` и `:w! node`. С помощью `:w !node` вы "записываете" текст в текущем буфере во внешнюю команду `node`. С помощью `:w! node` вы принудительно сохраняете файл и называете файл "node".

## Выполнение внешней команды

Вы можете выполнить внешнюю команду изнутри Vim с помощью команды bang. Синтаксис:

```shell
:!cmd
```

Чтобы увидеть содержимое текущего каталога в длинном формате, выполните:

```shell
:!ls -ls
```

Чтобы завершить процесс, который работает на PID 3456, вы можете выполнить:

```shell
:!kill -9 3456
```

Вы можете выполнять любые внешние команды, не покидая Vim, чтобы оставаться сосредоточенным на вашей задаче.

## Фильтрация текстов

Если вы передаете `!` диапазон, его можно использовать для фильтрации текстов. Предположим, у вас есть следующие тексты:

```shell
hello vim
hello vim
```

Давайте сделаем текущую строку заглавной с помощью команды `tr` (перевод). Выполните:

```shell
:.!tr '[:lower:]' '[:upper:]'
```

Результат:

```shell
HELLO VIM
hello vim
```

Разбор:
- `.!` выполняет команду фильтра на текущей строке.
- `tr '[:lower:]' '[:upper:]'` вызывает команду `tr`, чтобы заменить все строчные символы на заглавные.

Важно передать диапазон, чтобы запустить внешнюю команду как фильтр. Если вы попытаетесь выполнить команду выше без `.` (`:!tr '[:lower:]' '[:upper:]'`), вы увидите ошибку.

Предположим, вам нужно удалить второй столбец на обеих строках с помощью команды `awk`:

```shell
:%!awk "{print $1}"
```

Результат:

```shell
hello
hello
```

Разбор:
- `:%!` выполняет команду фильтра на всех строках (`%`).
- `awk "{print $1}"` выводит только первый столбец совпадения.

Вы можете связывать несколько команд с помощью оператора цепочки (`|`), как в терминале. Предположим, у вас есть файл с этими вкусными блюдами на завтрак:

```shell
name price
chocolate pancake 10
buttermilk pancake 9
blueberry pancake 12
```

Если вам нужно отсортировать их по цене и отобразить только меню с равномерным интервалом, вы можете выполнить:

```shell
:%!awk 'NR > 1' | sort -nk 3 | column -t
```

Результат:
```shell
buttermilk pancake 9
chocolate pancake 10
blueberry pancake 12
```

Разбор:
- `:%!` применяет фильтр ко всем строкам (`%`).
- `awk 'NR > 1'` отображает тексты только с номера строки два и далее.
- `|` связывает следующую команду.
- `sort -nk 3` сортирует численно (`n`), используя значения из 3-го столбца (`k 3`).
- `column -t` организует текст с равномерным интервалом.

## Команда нормального режима

Vim имеет оператор фильтра (`!`) в нормальном режиме. Если у вас есть следующие приветствия:

```shell
hello vim
hola vim
bonjour vim
salve vim
```

Чтобы сделать текущую строку и строку ниже заглавными, вы можете выполнить:
```shell
!jtr '[a-z]' '[A-Z]'
```

Разбор:
- `!j` выполняет оператор фильтра нормальной команды (`!`), нацеливаясь на текущую строку и строку ниже. Помните, что поскольку это оператор нормального режима, применяется грамматическое правило `глагол + существительное`. `!` — это глагол, а `j` — существительное.
- `tr '[a-z]' '[A-Z]'` заменяет строчные буквы на заглавные.

Команда фильтра нормального режима работает только на движениях / текстовых объектах, которые составляют хотя бы одну строку или длиннее. Если бы вы попытались выполнить `!iwtr '[a-z]' '[A-Z]'` (выполнить `tr` на внутреннем слове), вы бы обнаружили, что команда `tr` применяется ко всей строке, а не к слову, на котором находится ваш курсор.

## Учите внешние команды умным способом

Vim не является IDE. Это легкий модальный редактор, который по своей природе очень расширяем. Благодаря этой расширяемости у вас есть легкий доступ к любой внешней команде в вашей системе. Вооружившись этими внешними командами, Vim становится на шаг ближе к тому, чтобы стать IDE. Кто-то сказал, что система Unix — это первая IDE в истории.

Команда bang так же полезна, как и количество внешних команд, которые вы знаете. Не беспокойтесь, если ваши знания внешних команд ограничены. Я тоже еще многому учиться. Рассматривайте это как мотивацию для непрерывного обучения. Каждый раз, когда вам нужно изменить текст, посмотрите, есть ли внешняя команда, которая может решить вашу проблему. Не беспокойтесь о том, чтобы овладеть всем, просто изучайте те, которые вам нужны для выполнения текущей задачи.