---
description: В этой главе вы узнаете, как использовать встроенный менеджер плагинов
  Vim для установки плагинов с помощью пакетов и их автоматической загрузки.
title: Ch23. Vim Packages
---

В предыдущей главе я упоминал о использовании внешнего менеджера плагинов для установки плагинов. Начиная с версии 8, Vim поставляется с собственным встроенным менеджером плагинов под названием *packages*. В этой главе вы узнаете, как использовать пакеты Vim для установки плагинов.

Чтобы проверить, имеет ли ваша сборка Vim возможность использовать пакеты, выполните команду `:version` и найдите атрибут `+packages`. В качестве альтернативы вы также можете выполнить `:echo has('packages')` (если вернется 1, значит, возможность пакетов есть).

## Директория пакетов

Проверьте, есть ли у вас директория `~/.vim/` в корневом пути. Если нет, создайте ее. Внутри создайте директорию под названием `pack` (`~/.vim/pack/`). Vim автоматически знает, что нужно искать пакеты внутри этой директории.

## Два типа загрузки

Пакет Vim имеет два механизма загрузки: автоматическую и ручную загрузку.

### Автоматическая загрузка

Чтобы загружать плагины автоматически при запуске Vim, вам нужно поместить их в директорию `start/`. Путь выглядит так:

```shell
~/.vim/pack/*/start/
```

Теперь вы можете спросить: "Что такое `*` между `pack/` и `start/`?" `*` — это произвольное имя и может быть любым, что вы хотите. Давайте назовем его `packdemo/`:

```shell
~/.vim/pack/packdemo/start/
```

Имейте в виду, что если вы пропустите это и сделаете что-то вроде этого:

```shell
~/.vim/pack/start/
```

Система пакетов не будет работать. Обязательно нужно поставить имя между `pack/` и `start/`.

Для этого демо давайте попробуем установить плагин [NERDTree](https://github.com/preservim/nerdtree). Перейдите в директорию `start/` (`cd ~/.vim/pack/packdemo/start/`) и клонируйте репозиторий NERDTree:

```shell
git clone https://github.com/preservim/nerdtree.git
```

Вот и все! Теперь вы готовы. В следующий раз, когда вы запустите Vim, вы сможете сразу выполнять команды NERDTree, такие как `:NERDTreeToggle`.

Вы можете клонировать столько репозиториев плагинов, сколько захотите, внутри пути `~/.vim/pack/*/start/`. Vim автоматически загрузит каждый из них. Если вы удалите клонированный репозиторий (`rm -rf nerdtree/`), этот плагин больше не будет доступен.

### Ручная загрузка

Чтобы загружать плагины вручную при запуске Vim, вам нужно поместить их в директорию `opt/`. Аналогично автоматической загрузке, путь выглядит так:

```shell
~/.vim/pack/*/opt/
```

Давайте используем ту же директорию `packdemo/`, что и раньше:

```shell
~/.vim/pack/packdemo/opt/
```

На этот раз давайте установим игру [killersheep](https://github.com/vim/killersheep) (это требует Vim 8.2). Перейдите в директорию `opt/` (`cd ~/.vim/pack/packdemo/opt/`) и клонируйте репозиторий:

```shell
git clone https://github.com/vim/killersheep.git
```

Запустите Vim. Команда для выполнения игры — `:KillKillKill`. Попробуйте запустить ее. Vim будет жаловаться, что это не действительная команда редактора. Вам нужно сначала *вручную* загрузить плагин. Давайте сделаем это:

```shell
:packadd killersheep
```

Теперь попробуйте снова запустить команду `:KillKillKill`. Команда должна заработать.

Вы можете задаться вопросом: "Почему мне когда-либо нужно загружать пакеты вручную? Разве не лучше автоматически загружать все при старте?"

Отличный вопрос. Иногда есть плагины, которые вы не будете использовать все время, как, например, игра KillerSheep. Вам, вероятно, не нужно загружать 10 разных игр и замедлять время запуска Vim. Однако время от времени, когда вам скучно, вы можете захотеть поиграть в несколько игр. Используйте ручную загрузку для несущественных плагинов.

Вы также можете использовать это для условного добавления плагинов. Возможно, вы используете как Neovim, так и Vim, и есть плагины, оптимизированные для Neovim. Вы можете добавить что-то вроде этого в ваш vimrc:

```shell
if has('nvim')
  packadd! neovim-only-plugin
else
  packadd! generic-vim-plugin
endif
```

## Организация пакетов

Напомню, что требование для использования системы пакетов Vim — это наличие либо:

```shell
~/.vim/pack/*/start/
```

Либо:

```shell
~/.vim/pack/*/opt/
```

Тот факт, что `*` может быть *любым* именем, можно использовать для организации ваших пакетов. Предположим, вы хотите сгруппировать свои плагины по категориям (цвета, синтаксис и игры):

```shell
~/.vim/pack/colors/
~/.vim/pack/syntax/
~/.vim/pack/games/
```

Вы все равно можете использовать `start/` и `opt/` внутри каждой из директорий.

```shell
~/.vim/pack/colors/start/
~/.vim/pack/colors/opt/

~/.vim/pack/syntax/start/
~/.vim/pack/syntax/opt/

~/.vim/pack/games/start/
~/.vim/pack/games/opt/
```

## Добавление пакетов умным способом

Вы можете задаться вопросом, сделает ли пакет Vim популярные менеджеры плагинов, такие как vim-pathogen, vundle.vim, dein.vim и vim-plug, устаревшими.

Ответ, как всегда, "это зависит".

Я все еще использую vim-plug, потому что он упрощает добавление, удаление или обновление плагинов. Если вы используете много плагинов, может быть удобнее использовать менеджеры плагинов, потому что легко обновлять много одновременно. Некоторые менеджеры плагинов также предлагают асинхронные функции.

Если вы минималист, попробуйте пакеты Vim. Если вы активный пользователь плагинов, вам может быть стоит рассмотреть использование менеджера плагинов.