---
description: В этой главе вы узнаете основные правила грамматики команд Vim, чтобы
  уверенно использовать язык Vim и улучшить свои навыки работы с редактором.
title: Ch04. Vim Grammar
---

Легко испугаться сложности команд Vim. Если вы видите пользователя Vim, выполняющего `gUfV` или `1GdG`, вы можете не сразу понять, что делают эти команды. В этой главе я разложу общую структуру команд Vim на простое грамматическое правило.

Это самая важная глава во всем руководстве. Как только вы поймете основную грамматическую структуру, вы сможете "говорить" с Vim. Кстати, когда я говорю о *языке Vim* в этой главе, я не имею в виду язык Vimscript (встроенный язык программирования Vim, вы узнаете об этом в следующих главах).

## Как выучить язык

Я не носитель английского языка. Я выучил английский, когда мне было 13, когда я переехал в США. Есть три вещи, которые вам нужно сделать, чтобы научиться говорить на новом языке:

1. Изучить грамматические правила.
2. Увеличить словарный запас.
3. Практиковаться, практиковаться, практиковаться.

Аналогично, чтобы говорить на языке Vim, вам нужно выучить грамматические правила, увеличить словарный запас и практиковаться, пока вы не сможете выполнять команды, не задумываясь.

## Грамматическое правило

В языке Vim есть только одно грамматическое правило:

```shell
глагол + существительное
```

Вот и все!

Это похоже на такие английские фразы:

- *"Съесть (глагол) пончик (существительное)"*
- *"Ударить (глагол) мяч (существительное)"*
- *"Выучить (глагол) редактор Vim (существительное)"*

Теперь вам нужно пополнить свой словарный запас основными глаголами и существительными Vim.

## Существительные (Движения)

Существительные — это движения Vim. Движения используются для перемещения по Vim. Ниже приведен список некоторых движений Vim:

```shell
h    Влево
j    Вниз
k    Вверх
l    Вправо
w    Перейти к началу следующего слова
}    Перейти к следующему абзацу
$    Перейти в конец строки
```

Вы узнаете больше о движениях в следующей главе, так что не беспокойтесь слишком сильно, если не понимаете некоторые из них.

## Глаголы (Операторы)

Согласно `:h operator`, в Vim есть 16 операторов. Однако, по моему опыту, изучение этих 3 операторов достаточно для 80% моих потребностей в редактировании:

```shell
y    Копировать текст (копировать)
d    Удалить текст и сохранить в регистре
c    Удалить текст, сохранить в регистре и начать режим вставки
```

Кстати, после того как вы скопируете текст, вы можете вставить его с помощью `p` (после курсора) или `P` (перед курсором).

## Глагол и Существительное

Теперь, когда вы знаете основные существительные и глаголы, давайте применим грамматическое правило, глагол + существительное! Предположим, у вас есть это выражение:

```javascript
const learn = "vim";
```

- Чтобы скопировать все от вашего текущего местоположения до конца строки: `y$`.
- Чтобы удалить от вашего текущего местоположения до начала следующего слова: `dw`.
- Чтобы изменить от вашего текущего местоположения до конца текущего абзаца, скажем, `c}`.

Движения также принимают числовые аргументы (я обсудю это в следующей главе). Если вам нужно подняться на 3 строки, вместо того чтобы нажимать `k` 3 раза, вы можете сделать `3k`. Число работает с грамматикой Vim.
- Чтобы скопировать два символа влево: `y2h`.
- Чтобы удалить следующие два слова: `d2w`.
- Чтобы изменить следующие две строки: `c2j`.

Сейчас вам, возможно, придется долго и упорно думать, чтобы выполнить даже простую команду. Вы не одиноки. Когда я только начинал, у меня были похожие трудности, но со временем я стал быстрее. Так же будет и с вами. Повторение, повторение, повторение.

Кстати, операции по строкам (операции, затрагивающие всю строку) являются обычными операциями в текстовом редактировании. В общем, вводя команду оператора дважды, Vim выполняет операцию по строке для этого действия. Например, `dd`, `yy` и `cc` выполняют **удаление**, **копирование** и **изменение** на всей строке. Попробуйте это с другими операторами!

Это действительно круто. Я вижу здесь закономерность. Но я еще не закончил. У Vim есть еще один тип существительного: текстовые объекты.

## Еще Существительные (Текстовые Объекты)

Представьте, что вы находитесь внутри пары скобок, например `(hello Vim)`, и вам нужно удалить всю фразу внутри скобок. Как вы можете быстро это сделать? Есть ли способ удалить "группу", внутри которой вы находитесь?

Ответ — да. Тексты часто имеют структуру. Они часто содержат скобки, кавычки, квадратные скобки, фигурные скобки и многое другое. У Vim есть способ захватить эту структуру с помощью текстовых объектов.

Текстовые объекты используются с операторами. Существуют два типа текстовых объектов: внутренние и внешние текстовые объекты.

```shell
i + объект    Внутренний текстовый объект
a + объект    Внешний текстовый объект
```

Внутренний текстовый объект выбирает объект внутри *без* пробелов или окружающих объектов. Внешний текстовый объект выбирает объект внутри *включая* пробелы или окружающие объекты. В общем, внешний текстовый объект всегда выбирает больше текста, чем внутренний текстовый объект. Если ваш курсор находится где-то внутри скобок в выражении `(hello Vim)`:
- Чтобы удалить текст внутри скобок, не удаляя сами скобки: `di(`.
- Чтобы удалить скобки и текст внутри: `da(`.

Давайте рассмотрим другой пример. Предположим, у вас есть эта функция на Javascript, и ваш курсор находится на "H" в "Hello":

```javascript
const hello = function() {
  console.log("Hello Vim");
  return true;
}
```

- Чтобы удалить всю "Hello Vim": `di(`.
- Чтобы удалить содержимое функции (окруженное `{}`): `di{`.
- Чтобы удалить строку "Hello": `diw`.

Текстовые объекты мощны, потому что вы можете нацеливаться на разные объекты из одного местоположения. Вы можете удалить объекты внутри скобок, блок функции или текущее слово. Мнемонически, когда вы видите `di(`, `di{` и `diw`, вы получаете довольно хорошее представление о том, какие текстовые объекты они представляют: пара скобок, пара фигурных скобок и слово.

Давайте рассмотрим еще один последний пример. Предположим, у вас есть эти HTML-теги:

```html
<div>
  <h1>Header1</h1>
  <p>Paragraph1</p>
  <p>Paragraph2</p>
</div>
```

Если ваш курсор находится на тексте "Header1":
- Чтобы удалить "Header1": `dit`.
- Чтобы удалить `<h1>Header1</h1>`: `dat`.

Если ваш курсор находится на "div":
- Чтобы удалить `h1` и обе строки `p`: `dit`.
- Чтобы удалить все: `dat`.
- Чтобы удалить "div": `di<`.

Ниже приведен список общих текстовых объектов:

```shell
w         Слово
p         Абзац
s         Предложение
( или )  Пара ( )
{ или }  Пара { }
[ или ]  Пара [ ]
< или >  Пара < >
t         XML теги
"         Пара " "
'         Пара ' '
`         Пара ` `
```

Чтобы узнать больше, ознакомьтесь с `:h text-objects`.

## Составляемость и Грамматика

Грамматика Vim является подмножеством функции составляемости Vim. Давайте обсудим составляемость в Vim и почему это отличная функция для текстового редактора.

Составляемость означает наличие набора общих команд, которые можно комбинировать (составлять) для выполнения более сложных команд. Так же, как в программировании, где вы можете создавать более сложные абстракции из более простых абстракций, в Vim вы можете выполнять сложные команды из более простых команд. Грамматика Vim — это проявление составляемой природы Vim.

Истинная сила составляемости Vim проявляется, когда она интегрируется с внешними программами. У Vim есть оператор фильтрации (`!`), чтобы использовать внешние программы в качестве фильтров для наших текстов. Предположим, у вас есть этот неаккуратный текст ниже, и вы хотите сделать его табличным:

```shell
Id|Name|Cuteness
01|Puppy|Very
02|Kitten|Ok
03|Bunny|Ok
```

Это нельзя легко сделать с помощью команд Vim, но вы можете быстро это сделать с помощью команды терминала `column` (при условии, что в вашем терминале есть команда `column`). С курсором на "Id", выполните `!}column -t -s "|"`. Вот и все! Теперь у вас есть эти красивые табличные данные всего с одной быстрой командой.

```shell
Id  Name    Cuteness
01  Puppy   Very
02  Kitten  Ok
03  Bunny   Ok
```

Давайте разберем команду. Глаголом был `!` (оператор фильтрации), а существительным было `}` (перейти к следующему абзацу). Оператор фильтрации `!` принял другой аргумент, команду терминала, поэтому я дал ему `column -t -s "|"`. Я не буду объяснять, как работает `column`, но в результате он табличизировал текст.

Предположим, вы хотите не только табличизировать свой текст, но и отобразить только строки с "Ok". Вы знаете, что `awk` может легко справиться с этой задачей. Вы можете сделать это вместо этого:

```shell
!}column -t -s "|" | awk 'NR > 1 && /Ok/ {print $0}'
```

Результат:

```shell
02  Kitten  Ok
03  Bunny   Ok
```

Отлично! Оператор внешней команды также может использовать конвейер (`|`).

Это сила составляемости Vim. Чем больше вы знаете свои операторы, движения и команды терминала, тем больше ваша способность составлять сложные действия *умножается*.

Предположим, вы знаете только четыре движения: `w, $, }, G` и только один оператор: `d`. Вы можете выполнять 8 действий: *перемещаться* 4 разными способами (`w, $, }, G`) и *удалять* 4 разных объекта (`dw, d$, d}, dG`). Затем однажды вы узнаете о верхнем регистре (`gU`). Вы добавили не просто одну новую способность в свой инструмент Vim, а *четыре*: `gUw, gU$, gU}, gUG`. Это делает 12 инструментов в вашем арсенале Vim. Каждое новое знание — это множитель ваших текущих способностей. Если вы знаете 10 движений и 5 операторов, у вас есть 60 движений (50 операций + 10 движений) в вашем арсенале. У Vim есть движение по номеру строки (`nG`), которое дает вам `n` движений, где `n` — это количество строк в вашем файле (чтобы перейти к строке 5, выполните `5G`). Движение поиска (`/`) фактически дает вам почти неограниченное количество движений, потому что вы можете искать что угодно. Оператор внешней команды (`!`) дает вам столько инструментов фильтрации, сколько команд терминала вы знаете. Используя составляемый инструмент, такой как Vim, все, что вы знаете, можно связать вместе для выполнения операций с возрастающей сложностью. Чем больше вы знаете, тем более мощным вы становитесь.

Это составляемое поведение перекликается с философией Unix: *делай одну вещь хорошо*. У оператора есть одна задача: сделать Y. У движения есть одна задача: перейти к X. Сочетая оператор с движением, вы предсказуемо получаете YX: сделать Y на X.

Движения и операторы расширяемы. Вы можете создавать пользовательские движения и операторы, чтобы добавить их в свой инструмент Vim. Плагин [`vim-textobj-user`](https://github.com/kana/vim-textobj-user) позволяет вам создавать свои собственные текстовые объекты. Он также содержит [список](https://github.com/kana/vim-textobj-user/wiki) пользовательских текстовых объектов.

## Учите грамматику Vim умным способом

Вы только что узнали о правиле грамматики Vim: `глагол + существительное`. Один из моих самых больших моментов "AHA!" в Vim был, когда я только что узнал о верхнем регистре (`gU`) и хотел сделать текущую слово заглавным, я *инстинктивно* выполнил `gUiw`, и это сработало! Слово было написано заглавными буквами. В тот момент я наконец начал понимать Vim. Я надеюсь, что у вас скоро будет свой собственный момент "AHA!", если его еще нет.

Цель этой главы — показать вам шаблон `глагол + существительное` в Vim, чтобы вы подходили к изучению Vim, как к изучению нового языка, а не запоминали каждую комбинацию команд.

Изучите шаблон и поймите его последствия. Это умный способ обучения.