---
description: В этом документе представлены советы и приемы для работы в командном
  режиме Vim, включая ввод, выход и различные команды.
title: Ch15. Command-line Mode
---

В последних трех главах вы узнали, как использовать команды поиска (`/`, `?`), команду замены (`:s`), глобальную команду (`:g`) и внешнюю команду (`!`). Это примеры команд в режиме командной строки.

В этой главе вы узнаете различные советы и приемы для режима командной строки.

## Вход и выход из режима командной строки

Режим командной строки — это режим сам по себе, так же как нормальный режим, режим вставки и визуальный режим. Когда вы находитесь в этом режиме, курсор перемещается в нижнюю часть экрана, где вы можете вводить различные команды.

Существует 4 различных команды, которые вы можете использовать для входа в режим командной строки:
- Шаблоны поиска (`/`, `?`)
- Команды командной строки (`:`)
- Внешние команды (`!`)

Вы можете войти в режим командной строки из нормального режима или визуального режима.

Чтобы выйти из режима командной строки, вы можете использовать `<Esc>`, `Ctrl-C` или `Ctrl-[`.

*В других литературных источниках "Команду командной строки" могут называть "Командой Ex", а "Внешнюю команду" — "Командой фильтра" или "Оператором bang".*

## Повторение предыдущей команды

Вы можете повторить предыдущую команду командной строки или внешнюю команду с помощью `@:`.

Если вы только что выполнили `:s/foo/bar/g`, выполнение `@:` повторяет эту замену. Если вы только что выполнили `:.!tr '[a-z]' '[A-Z]'`, выполнение `@:` повторяет последний фильтр внешней команды перевода.

## Сочетания клавиш в режиме командной строки

Находясь в режиме командной строки, вы можете перемещаться влево или вправо, по одному символу за раз, с помощью стрелок `Left` или `Right`.

Если вам нужно перемещаться по словам, используйте `Shift-Left` или `Shift-Right` (в некоторых ОС вам может понадобиться использовать `Ctrl` вместо `Shift`).

Чтобы перейти в начало строки, используйте `Ctrl-B`. Чтобы перейти в конец строки, используйте `Ctrl-E`.

Аналогично режиму вставки, в режиме командной строки у вас есть три способа удалить символы:

```shell
Ctrl-H    Удалить один символ
Ctrl-W    Удалить одно слово
Ctrl-U    Удалить всю строку
```
Наконец, если вы хотите редактировать команду, как обычный текстовый файл, используйте `Ctrl-F`.

Это также позволяет вам просматривать предыдущие команды, редактировать их и повторно выполнять, нажав `<Enter>` в "нормальном режиме редактирования командной строки".

## Регистры и автозаполнение

Находясь в режиме командной строки, вы можете вставлять тексты из регистра Vim с помощью `Ctrl-R`, так же как в режиме вставки. Если у вас есть строка "foo", сохраненная в регистре a, вы можете вставить ее, выполнив `Ctrl-R a`. Все, что вы можете получить из регистра в режиме вставки, вы можете сделать то же самое в режиме командной строки.

Кроме того, вы также можете получить слово под курсором с помощью `Ctrl-R Ctrl-W` (`Ctrl-R Ctrl-A` для WORD под курсором). Чтобы получить строку под курсором, используйте `Ctrl-R Ctrl-L`. Чтобы получить имя файла под курсором, используйте `Ctrl-R Ctrl-F`.

Вы также можете автозаполнять существующие команды. Чтобы автозаполнить команду `echo`, находясь в режиме командной строки, введите "ec", затем нажмите `<Tab>`. Вы должны увидеть в нижнем левом углу команды Vim, начинающиеся с "ec" (пример: `echo echoerr echohl echomsg econ`). Чтобы перейти к следующему варианту, нажмите либо `<Tab>`, либо `Ctrl-N`. Чтобы вернуться к предыдущему варианту, нажмите либо `<Shift-Tab>`, либо `Ctrl-P`.

Некоторые команды командной строки принимают имена файлов в качестве аргументов. Один из примеров — `edit`. Вы можете автозаполнить и здесь. После ввода команды `:e ` (не забудьте пробел), нажмите `<Tab>`. Vim перечислит все соответствующие имена файлов, из которых вы можете выбрать, чтобы вам не пришлось вводить их с нуля.

## Окно истории и окно командной строки

Вы можете просмотреть историю команд командной строки и поисковых запросов (это требует функции `+cmdline_hist`).

Чтобы открыть историю командной строки, выполните `:his :`. Вы должны увидеть что-то вроде следующего:

```shell
## Cmd history
2  e file1.txt
3  g/foo/d
4  s/foo/bar/g
```

Vim перечисляет историю всех команд `:` которые вы выполняли. По умолчанию Vim хранит последние 50 команд. Чтобы изменить количество записей, которые Vim запоминает, на 100, выполните `set history=100`.

Более полезное использование истории командной строки — через окно командной строки, `q:`. Это откроет окно истории, которое можно искать и редактировать. Предположим, у вас есть эти выражения в истории, когда вы нажимаете `q:`:

```shell
51  s/verylongsubstitutionpattern/pancake/g
52  his :
53  wq
```

Если ваша текущая задача — выполнить `s/verylongsubstitutionpattern/donut/g`, вместо того чтобы вводить команду с нуля, почему бы не использовать `s/verylongsubstitutionpattern/pancake/g`? В конце концов, единственное, что отличается, — это слово замены: "donut" против "pancake". Все остальное остается прежним.

После того как вы выполнили `q:`, найдите `s/verylongsubstitutionpattern/pancake/g` в истории (вы можете использовать навигацию Vim в этой среде) и редактируйте его напрямую! Измените "pancake" на "donut" в окне истории, затем нажмите `<Enter>`. Бум! Vim выполнит `s/verylongsubstitutionpattern/donut/g` за вас. Супер удобно!

Аналогично, чтобы просмотреть историю поиска, выполните `:his /` или `:his ?`. Чтобы открыть окно истории поиска, где вы можете искать и редактировать прошлую историю, выполните `q/` или `q?`.

Чтобы выйти из этого окна, нажмите `Ctrl-C`, `Ctrl-W C` или введите `:quit`.

## Больше команд командной строки

Vim имеет сотни встроенных команд. Чтобы увидеть все команды, которые есть в Vim, посмотрите `:h ex-cmd-index` или `:h :index`.

## Учите режим командной строки умным способом

По сравнению с другими тремя режимами, режим командной строки — это как швейцарский армейский нож текстового редактирования. Вы можете редактировать текст, изменять файлы и выполнять команды, чтобы назвать лишь некоторые. Эта глава представляет собой сборник мелочей режима командной строки. Она также завершает изучение режимов Vim. Теперь, когда вы знаете, как использовать нормальный, вставочный, визуальный и командный режимы, вы можете редактировать текст в Vim быстрее, чем когда-либо.

Пришло время уйти от режимов Vim и узнать, как делать еще более быструю навигацию с помощью тегов Vim.