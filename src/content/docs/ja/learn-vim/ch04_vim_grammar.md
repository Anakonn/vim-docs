---
description: Vimのコマンドの文法構造を理解し、Vim言語を話すための基本を学ぶためのガイドです。練習を通じてスキルを向上させましょう。
title: Ch04. Vim Grammar
---

Vim コマンドの複雑さに intimidate されるのは簡単です。もしあなたが `gUfV` や `1GdG` を実行している Vim ユーザーを見たら、これらのコマンドが何をするのかすぐにはわからないかもしれません。この章では、Vim コマンドの一般的な構造をシンプルな文法ルールに分解します。

これはガイド全体で最も重要な章です。基本的な文法構造を理解すれば、Vim に「話しかける」ことができるようになります。ところで、この章で *Vim 言語* というとき、私は Vimscript 言語（Vim の組み込みプログラミング言語、これは後の章で学びます）について話しているわけではありません。

## 言語を学ぶ方法

私は英語を母国語としない話者です。13歳のときにアメリカに引っ越して英語を学びました。新しい言語を話すためには、次の3つのことをする必要があります：

1. 文法ルールを学ぶ。
2. 語彙を増やす。
3. 練習、練習、練習。

同様に、Vim 言語を話すためには、文法ルールを学び、語彙を増やし、考えずにコマンドを実行できるまで練習する必要があります。

## 文法ルール

Vim 言語には1つの文法ルールしかありません：

```shell
動詞 + 名詞
```

それだけです！

これは次の英語のフレーズを言うようなものです：

- *"ドーナツ (名詞) を食べる (動詞)"*
- *"ボール (名詞) を蹴る (動詞)"*
- *"Vim エディタ (名詞) を学ぶ (動詞)"*

今、あなたは基本的な Vim の動詞と名詞を使って語彙を増やす必要があります。

## 名詞 (モーション)

名詞は Vim のモーションです。モーションは Vim 内で移動するために使用されます。以下は Vim のモーションのいくつかのリストです：

```shell
h    左
j    下
k    上
l    右
w    次の単語の先頭へ移動
}    次の段落へジャンプ
$    行の末尾へ移動
```

次の章でモーションについてもっと学びますので、いくつか理解できなくても心配しないでください。

## 動詞 (オペレーター)

`:h operator` によると、Vim には16のオペレーターがあります。しかし、私の経験では、これらの3つのオペレーターを学ぶだけで、80%の編集ニーズを満たすことができます：

```shell
y    テキストをヤンク（コピー）
d    テキストを削除し、レジスタに保存
c    テキストを削除し、レジスタに保存し、挿入モードを開始
```

ちなみに、テキストをヤンクした後は、`p`（カーソルの後ろ）または `P`（カーソルの前）でペーストできます。

## 動詞と名詞

基本的な名詞と動詞を知ったので、文法ルール、動詞 + 名詞を適用してみましょう！次の式があるとします：

```javascript
const learn = "vim";
```

- 現在の位置から行の末尾まで全てをヤンクする： `y$`。
- 現在の位置から次の単語の先頭まで削除する： `dw`。
- 現在の位置から現在の段落の末尾まで変更する： `c}`。

モーションはカウント番号を引数として受け取ることもできます（これについては次の章で説明します）。3行上に移動する必要がある場合、`k` を3回押す代わりに `3k` を実行できます。カウントは Vim の文法で機能します。
- 左に2文字ヤンクする： `y2h`。
- 次の2単語を削除する： `d2w`。
- 次の2行を変更する： `c2j`。

今は、単純なコマンドを実行するために長い間考えなければならないかもしれません。あなたは一人ではありません。私が最初に始めたとき、同じような苦労をしましたが、時間が経つにつれて速くなりました。あなたもそうなるでしょう。繰り返し、繰り返し、繰り返し。

ちなみに、行単位の操作（行全体に影響を与える操作）はテキスト編集で一般的な操作です。一般的に、オペレーターコマンドを2回入力することで、Vim はそのアクションに対して行単位の操作を実行します。たとえば、`dd`、`yy`、`cc` は行全体に対して **削除**、**ヤンク**、**変更** を行います。他のオペレーターでも試してみてください！

これは本当にクールです。ここにパターンが見えます。しかし、まだ終わっていません。Vim にはもう1つの名詞のタイプがあります：テキストオブジェクトです。

## さらなる名詞 (テキストオブジェクト)

例えば、あなたが `(hello Vim)` のような括弧の中にいて、括弧内のフレーズ全体を削除する必要があるとします。どうすれば迅速にそれを行うことができますか？あなたがいる「グループ」を削除する方法はありますか？

答えは「はい」です。テキストはしばしば構造化されています。括弧、引用符、ブラケット、波括弧などを含むことがよくあります。Vim にはテキストオブジェクトを使ってこの構造を捉える方法があります。

テキストオブジェクトはオペレーターと一緒に使用されます。テキストオブジェクトには2つのタイプがあります：内側のテキストオブジェクトと外側のテキストオブジェクトです。

```shell
i + object    内側のテキストオブジェクト
a + object    外側のテキストオブジェクト
```

内側のテキストオブジェクトは、ホワイトスペースや周囲のオブジェクトを含まないオブジェクトを選択します。外側のテキストオブジェクトは、ホワイトスペースや周囲のオブジェクトを含むオブジェクトを選択します。一般的に、外側のテキストオブジェクトは内側のテキストオブジェクトよりも常に多くのテキストを選択します。もしカーソルが `(hello Vim)` の括弧の中にある場合：
- 括弧を削除せずに括弧内のテキストを削除する： `di(`。
- 括弧とその中のテキストを削除する： `da(`。

別の例を見てみましょう。次の Javascript 関数があり、カーソルが "H" の位置にあるとします：

```javascript
const hello = function() {
  console.log("Hello Vim");
  return true;
}
```

- "Hello Vim" 全体を削除する： `di(`。
- 関数の内容（`{}` で囲まれた部分）を削除する： `di{`。
- "Hello" という文字列を削除する： `diw`。

テキストオブジェクトは強力です。なぜなら、1つの位置から異なるオブジェクトをターゲットにできるからです。括弧内のオブジェクト、関数ブロック、または現在の単語を削除できます。記憶に残るように、`di(`、`di{`、`diw` を見ると、それぞれがどのテキストオブジェクトを表しているかがよくわかります：括弧のペア、波括弧のペア、単語です。

最後の例を見てみましょう。次の HTML タグがあります：

```html
<div>
  <h1>Header1</h1>
  <p>Paragraph1</p>
  <p>Paragraph2</p>
</div>
```

もしカーソルが "Header1" のテキストにある場合：
- "Header1" を削除する： `dit`。
- `<h1>Header1</h1>` を削除する： `dat`。

もしカーソルが "div" にある場合：
- `h1` と両方の `p` 行を削除する： `dit`。
- すべてを削除する： `dat`。
- "div" を削除する： `di<`。

以下は一般的なテキストオブジェクトのリストです：

```shell
w         単語
p         段落
s         文
( or )    括弧のペア
{ or }    波括弧のペア
[ or ]    ブラケットのペア
< or >    山括弧のペア
t         XML タグ
"         引用符のペア
'         シングルクォートのペア
`         バッククォートのペア
```

詳細を学ぶには、`:h text-objects` を確認してください。

## 合成性と文法

Vim の文法は、Vim の合成性機能のサブセットです。Vim における合成性と、なぜこれがテキストエディタにおいて素晴らしい機能であるかについて話しましょう。

合成性とは、より複雑なコマンドを実行するために組み合わせることができる一般的なコマンドのセットを持つことを意味します。プログラミングにおいて、よりシンプルな抽象からより複雑な抽象を作成できるように、Vim ではシンプルなコマンドから複雑なコマンドを実行できます。Vim の文法は、Vim の合成的な性質の現れです。

Vim の合成性の真の力は、外部プログラムと統合されるときに発揮されます。Vim には、外部プログラムをテキストのフィルターとして使用するためのフィルターオペレーター（`!`）があります。次のような乱雑なテキストがあり、それを表形式にしたいとします：

```shell
Id|Name|Cuteness
01|Puppy|Very
02|Kitten|Ok
03|Bunny|Ok
```

これは Vim コマンドでは簡単に行えませんが、`column` ターミナルコマンドを使えば迅速に行えます（ターミナルに `column` コマンドがあると仮定します）。カーソルが "Id" の上にあるとき、`!}column -t -s "|"` を実行します。さあ、これで素敵な表形式のデータが得られました！

```shell
Id  Name    Cuteness
01  Puppy   Very
02  Kitten  Ok
03  Bunny   Ok
```

コマンドを分解してみましょう。動詞は `!`（フィルターオペレーター）で、名詞は `}`（次の段落に移動）でした。フィルターオペレーター `!` は別の引数、ターミナルコマンドを受け入れたので、`column -t -s "|"` を与えました。`column` がどのように機能したかは説明しませんが、実際にはテキストを表形式にしました。

もし、テキストを表形式にするだけでなく、「Ok」を含む行だけを表示したい場合、`awk` がその仕事を簡単にこなせることを知っています。次のようにできます：

```shell
!}column -t -s "|" | awk 'NR > 1 && /Ok/ {print $0}'
```

結果：

```shell
02  Kitten  Ok
03  Bunny   Ok
```

素晴らしい！外部コマンドオペレーターはパイプ（`|`）も使用できます。

これが Vim の合成性の力です。オペレーター、モーション、ターミナルコマンドを知れば知るほど、複雑なアクションを組み合わせる能力が *倍増* します。

もしあなたが4つのモーション `w, $, }, G` と1つのオペレーター `d` しか知らなければ、8つのアクションができます：4つの異なる方法で移動し（`w, $, }, G`）、4つの異なるターゲットを削除します（`dw, d$, d}, dG`）。そしてある日、あなたが大文字のオペレーター（`gU`）について学ぶと、Vim ツールベルトに新しい能力を1つではなく *4つ* 追加したことになります：`gUw, gU$, gU}, gUG`。これで、Vim ツールベルトに12のツールが揃いました。新しい知識は現在の能力に対する乗数です。もし10のモーションと5つのオペレーターを知っていれば、あなたの arsenal には60の動き（50の操作 + 10のモーション）があることになります。Vim には行番号モーション（`nG`）があり、ファイル内の行数に応じて `n` モーションを提供します（行5に移動するには `5G` を実行します）。検索モーション（`/`）は実質的に無限のモーションを提供します。外部コマンドオペレーター（`!`）は、知っているターミナルコマンドの数だけフィルタリングツールを提供します。Vim のような合成可能なツールを使用すると、知っているすべてをリンクして、複雑さが増す操作を行うことができます。知識が増えれば増えるほど、あなたは強力になります。

この合成的な振る舞いは Unix の哲学を反映しています：*一つのことをうまくやる*。オペレーターには1つの仕事があります：Y を実行する。モーションには1つの仕事があります：X に移動する。オペレーターとモーションを組み合わせることで、予測可能に YX を得ることができます：X に対して Y を実行する。

モーションとオペレーターは拡張可能です。カスタムモーションやオペレーターを作成して、Vim ツールベルトに追加できます。[`vim-textobj-user`](https://github.com/kana/vim-textobj-user) プラグインを使用すると、自分のテキストオブジェクトを作成できます。また、ユーザーが作成したカスタムテキストオブジェクトの[リスト](https://github.com/kana/vim-textobj-user/wiki)も含まれています。

## スマートに Vim 文法を学ぶ

あなたはすでに Vim の文法ルール `動詞 + 名詞` について学びました。私の最大の Vim の「AHA！」の瞬間の1つは、大文字のオペレーター（`gU`）について学んだときに、現在の単語を大文字にしたいと思い、*本能的に* `gUiw` を実行したときに、それが機能したことです！単語が大文字になりました。その瞬間、私はついに Vim を理解し始めました。私の希望は、あなたがすぐに自分の「AHA！」の瞬間を持つことです。

この章の目標は、Vim における `動詞 + 名詞` パターンを示すことです。これにより、Vim を新しい言語を学ぶようにアプローチし、すべてのコマンドの組み合わせを暗記するのではなく、学ぶことができます。

パターンを学び、その意味を理解してください。それがスマートな学び方です。