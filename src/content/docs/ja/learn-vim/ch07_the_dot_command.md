---
description: このドキュメントでは、Vimのドットコマンドを使用して、直前の変更を簡単に繰り返す方法を学びます。効率的な操作を実現します。
title: Ch07. the Dot Command
---

一般的に、可能な限り、あなたがしたことを再度行うことは避けるべきです。この章では、ドットコマンドを使用して前回の変更を簡単にやり直す方法を学びます。これは、単純な繰り返しを減らすための多用途なコマンドです。

## 使用法

名前の通り、ドットコマンドはドットキー（`.`）を押すことで使用できます。

例えば、次の式で「let」を「const」に置き換えたい場合：

```shell
let one = "1";
let two = "2";
let three = "3";
```

- `/let`で検索して一致する箇所に移動します。
- `cwconst<Esc>`で「let」を「const」に置き換えます。
- `n`で前回の検索を使用して次の一致を見つけます。
- ドットコマンド（`.`）で先ほど行ったことを繰り返します。
- すべての単語を置き換えるまで`n . n .`を押し続けます。

ここで、ドットコマンドは`cwconst<Esc>`のシーケンスを繰り返しました。これにより、8回のキー入力を1回に減らすことができました。

## 変更とは何か？

ドットコマンドの定義（`:h .`）を見ると、ドットコマンドは最後の変更を繰り返すと書かれています。変更とは何でしょうか？

現在のバッファの内容を更新（追加、修正、削除）するたびに、あなたは変更を行っています。例外として、コマンドラインコマンド（`:`で始まるコマンド）による更新は変更としてカウントされません。

最初の例では、`cwconst<Esc>`が変更でした。さて、次のテキストがあると仮定しましょう：

```shell
pancake, potatoes, fruit-juice,
```

行の先頭から次のカンマまでのテキストを削除するには、まずカンマまで削除し、次に`df,..`で2回繰り返します。

別の例を試してみましょう：

```shell
pancake, potatoes, fruit-juice,
```

今回は、朝食のアイテムではなくカンマを削除するのがあなたの仕事です。カーソルを行の先頭に置き、最初のカンマに移動して削除し、次に`f,x..`で2回繰り返します。簡単ですよね？ちょっと待って、うまくいかなかった！なぜ？

変更は動作を除外します。なぜなら、それはバッファの内容を更新しないからです。コマンド`f,x`は2つのアクションから成り立っています：カーソルを「,」に移動するコマンド`f,`と文字を削除する`x`です。変更を引き起こしたのは後者の`x`だけです。以前の例の`df,`と対比してください。ここでは、`f,`は削除オペレーター`d`への指示であり、カーソルを移動する動作ではありません。`df,`の`f,`と`f,x`は非常に異なる役割を持っています。

最後のタスクを終わらせましょう。`f,`の後に`x`を実行したら、次のカンマに`；`で移動して最新の`f`を繰り返します。最後に、カーソルの下の文字を削除するために`.`を使用します。すべてが削除されるまで`； . ； .`を繰り返します。完全なコマンドは`f,x;.;.`です。

もう一つ試してみましょう：

```shell
pancake
potatoes
fruit-juice
```

各行の末尾にカンマを追加しましょう。最初の行から始めて、`A,<Esc>j`を行います。今や、`j`は変更を引き起こさないことに気づくでしょう。ここでの変更は`A,`だけです。移動して変更を繰り返すには`j . j .`を使用します。完全なコマンドは`A,<Esc>j.j.`です。

挿入コマンドオペレーター（`A`）を押してから挿入コマンドを終了する（`<Esc>`）までのすべてのアクションは変更と見なされます。

## 複数行の繰り返し

次のテキストがあるとしましょう：

```shell
let one = "1";
let two = "2";
let three = "3";
const foo = "bar';
let four = "4";
let five = "5";
let six = "6";
let seven = "7";
let eight = "8";
let nine = "9";
```

あなたの目標は「foo」行を除くすべての行を削除することです。まず、`d2j`で最初の3行を削除し、「foo」行の下の行に移動します。次の行で、ドットコマンドを2回使用します。完全なコマンドは`d2jj..`です。

ここでの変更は`d2j`でした。この文脈では、`2j`は動作ではなく、削除オペレーターの一部でした。

別の例を見てみましょう：

```shell
zlet zzone = "1";
zlet zztwo = "2";
zlet zzthree = "3";
let four = "4";
```

すべてのzを削除しましょう。最初の行の最初の文字から始めて、ブロック視覚モード（`Ctrl-Vjj`）を使用して最初の3行から最初のzだけを視覚的に選択します。ブロック視覚モードに不慣れな場合は、後の章で取り上げます。3つのzを視覚的に選択したら、削除オペレーター（`d`）で削除します。次に、次のzに移動するために次の単語（`w`）に移動します。変更をさらに2回繰り返します（`..`）。完全なコマンドは`Ctrl-vjjdw..`です。

3つのzの列を削除したとき（`Ctrl-vjjd`）、それは変更としてカウントされました。視覚モードの操作は、変更の一部として複数行をターゲットにするために使用できます。

## 変更に動作を含める

この章の最初の例に戻りましょう。コマンド`/letcwconst<Esc>`の後に`n . n .`を実行すると、次の式で「let」をすべて「const」に置き換えました：

```shell
let one = "1";
let two = "2";
let three = "3";
```

これを達成するためのより速い方法があります。`/let`を検索した後、`cgnconst<Esc>`を実行し、次に`.`を2回押します。

`gn`は、最後の検索パターン（この場合は`/let`）を前方に検索し、自動的に視覚的にハイライトします。次の出現を置き換えるために、もはや移動して変更を繰り返す必要はなく（`n . n .`）、ただ繰り返すだけで済みます（`. .`）。次の一致を検索することは、もはや動作ではなく変更の一部です！

編集しているときは、可能な限り`gn`のように一度に複数のことを行うことができる動作を常に探してください。

## スマートな方法でドットコマンドを学ぶ

ドットコマンドの力は、いくつかのキー入力を1つに置き換えることから来ています。`x`のような単一キー操作にドットコマンドを使用することは、あまり利益のある交換ではないでしょう。最後の変更が`cgnconst<Esc>`のような複雑な操作を必要とする場合、ドットコマンドは9回のキー入力を1回に減らし、非常に利益のあるトレードオフとなります。

編集するときは、繰り返し可能性について考えてください。例えば、次の3つの単語を削除する必要がある場合、`d3w`を使用する方が経済的ですか、それとも`dw`を行ってから`.`を2回行う方が経済的ですか？再度単語を削除することになりますか？そうであれば、`d3w`よりも`dw`を使用して何度も繰り返す方が理にかなっています。なぜなら、`dw`は`d3w`よりも再利用可能だからです。

ドットコマンドは、単一の変更を自動化するための多用途なコマンドです。後の章では、Vimマクロを使用してより複雑なアクションを自動化する方法を学びます。しかしまず、テキストを保存して取得するためのレジスタについて学びましょう。