---
description: Vimで複数ファイルを編集する方法を学び、コマンドを実行するための8つの異なる手段を紹介します。
title: Ch21. Multiple File Operations
---

複数のファイルを更新できることは、便利な編集ツールの一つです。以前、`cfdo`を使って複数のテキストを更新する方法を学びました。この章では、Vimで複数のファイルを編集するさまざまな方法を学びます。

## 複数ファイルでコマンドを実行する異なる方法

Vimには、複数のファイルにコマンドを実行するための8つの方法があります：
- 引数リスト（`argdo`）
- バッファリスト（`bufdo`）
- ウィンドウリスト（`windo`）
- タブリスト（`tabdo`）
- クイックフィックスリスト（`cdo`）
- クイックフィックスリスト（ファイル単位）（`cfdo`）
- ロケーションリスト（`ldo`）
- ロケーションリスト（ファイル単位）（`lfdo`）

実際には、ほとんどの場合、1つか2つの方法しか使用しないでしょう（私自身は他の方法よりも`cdo`と`argdo`を多く使用します）が、利用可能なすべてのオプションについて学ぶことは良いことです。自分の編集スタイルに合ったものを使いましょう。

8つのコマンドを学ぶのは daunting に聞こえるかもしれません。しかし、実際にはこれらのコマンドは似たように機能します。一つを学んだ後は、残りを学ぶのが容易になります。彼らはすべて同じ大きなアイデアを共有しています：それぞれのカテゴリのリストを作成し、実行したいコマンドを渡すことです。

## 引数リスト

引数リストは最も基本的なリストです。ファイルのリストを作成します。file1、file2、file3のリストを作成するには、次のコマンドを実行します：

```shell
:args file1 file2 file3
```

ワイルドカード（`*`）を渡すこともできます。現在のディレクトリ内のすべての`.js`ファイルのリストを作成したい場合は、次のコマンドを実行します：

```shell
:args *.js
```

現在のディレクトリ内で「a」で始まるすべてのJavascriptファイルのリストを作成したい場合は、次のコマンドを実行します：

```shell
:args a*.js
```

ワイルドカードは、現在のディレクトリ内の任意のファイル名文字の1つ以上に一致しますが、任意のディレクトリ内で再帰的に検索する必要がある場合はどうでしょうか？ダブルワイルドカード（`**`）を使用できます。現在の場所内のディレクトリ内のすべてのJavascriptファイルを取得するには、次のコマンドを実行します：

```shell
:args **/*.js
```

`args`コマンドを実行すると、現在のバッファはリストの最初のアイテムに切り替わります。作成したファイルのリストを表示するには、`:args`を実行します。リストを作成したら、それらを移動できます。`:first`はリストの最初のアイテムに移動します。`:last`はリストの最後のアイテムに移動します。リストを1ファイルずつ前に進めるには、`:next`を実行します。リストを1ファイルずつ後ろに戻すには、`:prev`を実行します。1ファイルずつ前後に移動し、変更を保存するには、`:wnext`と`:wprev`を実行します。ナビゲーションコマンドは他にもたくさんあります。詳細は`:h arglist`を確認してください。

引数リストは、特定のタイプのファイルやいくつかのファイルをターゲットにする必要がある場合に便利です。たとえば、すべての`yml`ファイル内の「donut」を「pancake」に更新する必要がある場合、次のように実行できます：

```shell
:args **/*.yml
:argdo %s/donut/pancake/g | update
```

`args`コマンドを再度実行すると、以前のリストが置き換えられます。たとえば、以前に次のように実行した場合：

```shell
:args file1 file2 file3
```

これらのファイルが存在すると仮定すると、`file1`、`file2`、`file3`のリストがあります。次に、次のように実行します：

```shell
:args file4 file5
```

最初のリスト`file1`、`file2`、`file3`は`file4`と`file5`で置き換えられます。引数リストに`file1`、`file2`、`file3`があり、最初のファイルリストに`file4`と`file5`を*追加*したい場合は、`:arga`コマンドを使用します。次のように実行します：

```shell
:arga file4 file5
```

これで、引数リストに`file1`、`file2`、`file3`、`file4`、`file5`が含まれています。

引数なしで`:arga`を実行すると、Vimは現在のバッファを現在の引数リストに追加します。すでに引数リストに`file1`、`file2`、`file3`があり、現在のバッファが`file5`にある場合、`:arga`を実行すると`file5`がリストに追加されます。

リストができたら、任意のコマンドラインコマンドで渡すことができます。置換（`:argdo %s/donut/pancake/g`）で行われるのを見たことがあります。他のいくつかの例：
- 引数リスト内の「dessert」を含むすべての行を削除するには、`:argdo g/dessert/d`を実行します。
- 引数リスト内でマクロa（マクロaに何かを記録していると仮定）を実行するには、`:argdo norm @a`を実行します。
- 最初の行にファイル名の前に「hello」を書き込むには、`:argdo 0put='hello ' .. @:`を実行します。

完了したら、`:update`で保存するのを忘れないでください。

時々、引数リストの最初のnアイテムのみにコマンドを実行する必要があります。その場合は、`argdo`コマンドにアドレスを渡すだけです。たとえば、リストの最初の3アイテムのみに置換コマンドを実行するには、`:1,3argdo %s/donut/pancake/g`を実行します。

## バッファリスト

バッファリストは、新しいファイルを編集するときに有機的に作成されます。新しいファイルを作成または開くたびに、Vimはそれをバッファに保存します（明示的に削除しない限り）。したがって、すでに3つのファイルを開いている場合：`file1.rb file2.rb file3.rb`、バッファリストにはすでに3つのアイテムがあります。バッファリストを表示するには、`:buffers`（または`:ls`や`:files`）を実行します。前後に移動するには、`:bnext`と`:bprev`を使用します。リストの最初と最後のバッファに移動するには、`:bfirst`と`:blast`を使用します（楽しんでいますか？ :D）。

ところで、この章とは関係のないクールなバッファトリックがあります：バッファリストにアイテムがいくつかある場合、`:ball`（すべてのバッファ）でそれらをすべて表示できます。`ball`コマンドは、すべてのバッファを水平に表示します。垂直に表示するには、`:vertical ball`を実行します。

話を戻すと、すべてのバッファで操作を実行するメカニズムは引数リストと似ています。バッファリストを作成したら、実行したいコマンドの前に`:bufdo`を付けるだけです。したがって、すべてのバッファで「donut」を「pancake」に置換し、変更を保存するには、`:bufdo %s/donut/pancake/g | update`を実行します。

## ウィンドウとタブリスト

ウィンドウとタブのリストも、引数リストやバッファリストと似ています。唯一の違いは、そのコンテキストと構文です。

ウィンドウ操作は、各オープンウィンドウで実行され、`:windo`で実行されます。タブ操作は、開いている各タブで実行され、`:tabdo`で実行されます。詳細については、`:h list-repeat`、`:h :windo`、および`:h :tabdo`を確認してください。

たとえば、3つのウィンドウが開いている場合（新しいウィンドウは`Ctrl-W v`で垂直ウィンドウを、`Ctrl-W s`で水平ウィンドウを開くことができます）で、`:windo 0put ='hello' . @%`を実行すると、Vimはすべてのオープンウィンドウに「hello」+ファイル名を出力します。

## クイックフィックスリスト

前の章（Ch3およびCh19）で、クイックフィックスについて話しました。クイックフィックスには多くの用途があります。多くの人気プラグインがクイックフィックスを使用しているため、理解するためにもっと時間をかけることは良いことです。

Vimに不慣れな場合、クイックフィックスは新しい概念かもしれません。昔、実際にコードを明示的にコンパイルする必要があった頃、コンパイルフェーズ中にエラーに遭遇しました。これらのエラーを表示するには、特別なウィンドウが必要です。これがクイックフィックスの出番です。コードをコンパイルすると、Vimはクイックフィックスウィンドウにエラーメッセージを表示し、後で修正できるようにします。多くの現代言語では、もはや明示的なコンパイルは必要ありませんが、それでもクイックフィックスは廃れません。現在、人々はクイックフィックスをさまざまな目的で使用しています。たとえば、仮想端末の出力を表示したり、検索結果を保存したりするためです。後者、つまり検索結果の保存に焦点を当てましょう。

コンパイルコマンドに加えて、特定のVimコマンドはクイックフィックスインターフェースに依存しています。クイックフィックスを多く使用するコマンドの一種は、検索コマンドです。`:vimgrep`と`:grep`の両方は、デフォルトでクイックフィックスを使用します。

たとえば、すべてのJavascriptファイル内で「donut」を再帰的に検索する必要がある場合、次のコマンドを実行できます：

```shell
:vimgrep /donut/ **/*.js
```

「donut」検索の結果は、クイックフィックスウィンドウに保存されます。これらの一致結果のクイックフィックスウィンドウを見るには、次のコマンドを実行します：

```shell
:copen
```

閉じるには、次のコマンドを実行します：

```shell
:cclose
```

クイックフィックスリストを前後に移動するには、次のコマンドを実行します：

```shell
:cnext
:cprev
```

一致の最初と最後のアイテムに移動するには、次のコマンドを実行します：

```shell
:cfirst
:clast
```

以前、2つのクイックフィックスコマンドがあると述べました：`cdo`と`cfdo`。彼らはどのように異なるのでしょうか？`cdo`はクイックフィックスリスト内の各アイテムに対してコマンドを実行し、`cfdo`はクイックフィックスリスト内の各*ファイル*に対してコマンドを実行します。

明確にしましょう。上記の`vimgrep`コマンドを実行した後、次のように見つけたとします：
- `file1.js`に1件の結果
- `file2.js`に10件の結果

`:cfdo %s/donut/pancake/g`を実行すると、これは実際に`file1.js`で`%s/donut/pancake/g`を1回、`file2.js`で1回実行します。これは、一致するファイルの数だけ実行されます。結果に2つのファイルがあるため、Vimは`file1.js`で置換コマンドを1回、`file2.js`でさらに1回実行しますが、2番目のファイルには10件の一致があります。`cfdo`は、クイックフィックスリスト内のファイルの総数にのみ関心があります。

`:cdo %s/donut/pancake/g`を実行すると、これは実際に`file1.js`で`%s/donut/pancake/g`を1回、`file2.js`で*10回*実行します。これは、クイックフィックスリスト内の実際のアイテムの数だけ実行されます。`file1.js`で1件の一致が見つかり、`file2.js`で10件の一致が見つかったため、合計で11回実行されます。

`%s/donut/pancake/g`を実行したので、`cfdo`を使用するのが理にかなっています。`cdo`を使用するのは理にかなりませんでした。なぜなら、`file2.js`で`%s/donut/pancake/g`を10回実行するからです（`%s`はファイル全体の置換です）。ファイルごとに`%s`を1回実行するだけで十分です。`cdo`を使用する場合は、`s/donut/pancake/g`を渡す方が理にかなります。

`cfdo`または`cdo`を使用するかどうかを決定する際には、渡しているコマンドのスコープを考えてください。これはファイル全体のコマンド（`:%s`や`:g`のような）ですか、それとも行単位のコマンド（`:s`や`:!`のような）ですか？

## ロケーションリスト

ロケーションリストは、Vimがメッセージを表示するために特別なウィンドウを使用する点でクイックフィックスリストに似ています。クイックフィックスリストとロケーションリストの違いは、いつでも1つのクイックフィックスリストしか持てないのに対し、ウィンドウの数だけロケーションリストを持つことができることです。

たとえば、2つのウィンドウが開いていて、1つのウィンドウが`food.txt`を表示し、もう1つのウィンドウが`drinks.txt`を表示しているとします。`food.txt`の中から、ロケーションリスト検索コマンド`:lvimgrep`（`:vimgrep`コマンドのロケーションバリアント）を実行します：

```shell
:lvim /bagel/ **/*.md
```

Vimはその`food.txt`*ウィンドウ*のすべてのベーグル検索一致のロケーションリストを作成します。ロケーションリストを見るには、`:lopen`を実行します。次に、別のウィンドウ`drinks.txt`に移動し、次のコマンドを実行します：

```shell
:lvimgrep /milk/ **/*.md
```

Vimはその`drinks.txt`*ウィンドウ*のすべてのミルク検索結果の*別の*ロケーションリストを作成します。

各ウィンドウで実行するロケーションコマンドごとに、Vimは異なるロケーションリストを作成します。10個の異なるウィンドウがある場合、最大10個の異なるロケーションリストを持つことができます。これに対して、クイックフィックスリストは、いつでも1つしか持てません。10個の異なるウィンドウがある場合でも、クイックフィックスリストは1つだけです。

ロケーションリストコマンドのほとんどは、クイックフィックスコマンドと似ていますが、`
## Vimでの複数ファイル操作の実行

複数ファイル操作を行う方法を知っていることは、編集において便利なスキルです。複数のファイルで変数名を変更する必要があるときは、一度に実行したいものです。Vimにはこれを行うための8つの異なる方法があります。

実際のところ、8つすべてを同じように使うことはないでしょう。1つか2つに引き寄せられるはずです。始めたばかりのときは、1つ選んで（個人的にはargリスト `:argdo` から始めることをお勧めします）それをマスターしてください。1つに慣れたら、次のものを学びましょう。2つ目、3つ目、4つ目を学ぶのが簡単になっていくことに気づくでしょう。創造的になり、さまざまな組み合わせで使ってみてください。考えずに楽にできるようになるまで練習を続けてください。それを筋肉の記憶の一部にしましょう。

そう言うわけで、あなたはVim編集をマスターしました。おめでとうございます！