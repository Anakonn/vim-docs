---
description: このドキュメントでは、Vimのコマンドラインモードの使い方や、検索、置換、外部コマンドの実行方法について学びます。
title: Ch15. Command-line Mode
---

最後の3章では、検索コマンド（`/`、`?`）、置換コマンド（`:s`）、グローバルコマンド（`:g`）、および外部コマンド（`!`）の使い方を学びました。これらはコマンドラインモードのコマンドの例です。

この章では、コマンドラインモードのさまざまなヒントとコツを学びます。

## コマンドラインモードへの入出力

コマンドラインモードは、通常モード、挿入モード、ビジュアルモードと同様に、独自のモードです。このモードにいるとき、カーソルは画面の下部に移動し、さまざまなコマンドを入力できます。

コマンドラインモードに入るために使用できるコマンドは4つあります：
- 検索パターン（`/`、`?`）
- コマンドラインコマンド（`:`）
- 外部コマンド（`!`）

通常モードまたはビジュアルモードからコマンドラインモードに入ることができます。

コマンドラインモードを終了するには、`<Esc>`、`Ctrl-C`、または `Ctrl-[` を使用できます。

*他の文献では「コマンドラインコマンド」を「Exコマンド」と呼び、「外部コマンド」を「フィルターコマンド」または「バン操作子」と呼ぶことがあります。*

## 前のコマンドを繰り返す

`@:`を使用して、前のコマンドラインコマンドまたは外部コマンドを繰り返すことができます。

もし `:s/foo/bar/g` を実行したばかりであれば、`@:` を実行するとその置換が繰り返されます。もし `:.!tr '[a-z]' '[A-Z]'` を実行したばかりであれば、`@:` を実行すると最後の外部コマンドの翻訳フィルターが繰り返されます。

## コマンドラインモードのショートカット

コマンドラインモードにいるとき、`Left` または `Right` 矢印を使って、1文字ずつ左または右に移動できます。

単語単位で移動する必要がある場合は、`Shift-Left` または `Shift-Right` を使用します（一部のOSでは、`Shift` の代わりに `Ctrl` を使用する必要があるかもしれません）。

行の先頭に移動するには、`Ctrl-B` を使用します。行の末尾に移動するには、`Ctrl-E` を使用します。

挿入モードと同様に、コマンドラインモード内で文字を削除する方法は3つあります：

```shell
Ctrl-H    1文字削除
Ctrl-W    1単語削除
Ctrl-U    行全体削除
```
最後に、通常のテキストファイルのようにコマンドを編集したい場合は、`Ctrl-F` を使用します。

これにより、以前のコマンドを検索し、編集し、"コマンドライン編集通常モード" で `<Enter>` を押すことで再実行できます。

## レジスタとオートコンプリート

コマンドラインモードにいるとき、挿入モードと同様に `Ctrl-R` を使ってVimレジスタからテキストを挿入できます。レジスタaに "foo" という文字列が保存されている場合、`Ctrl-R a` を実行することで挿入できます。挿入モードでレジスタから取得できるすべてのことは、コマンドラインモードでも同様に行えます。

さらに、カーソル下の単語を `Ctrl-R Ctrl-W` で取得できます（カーソル下のWORDには `Ctrl-R Ctrl-A` を使用）。カーソル下の行を取得するには、`Ctrl-R Ctrl-L` を使用します。カーソル下のファイル名を取得するには、`Ctrl-R Ctrl-F` を使用します。

既存のコマンドをオートコンプリートすることもできます。コマンドラインモードで `echo` コマンドをオートコンプリートするには、「ec」と入力し、次に `<Tab>` を押します。左下に "ec" で始まるVimコマンドが表示されるはずです（例：`echo echoerr echohl echomsg econ`）。次のオプションに移動するには、`<Tab>` または `Ctrl-N` を押します。前のオプションに移動するには、`<Shift-Tab>` または `Ctrl-P` を押します。

一部のコマンドラインコマンドは、引数としてファイル名を受け入れます。例えば `edit` があります。ここでもオートコンプリートできます。コマンド `:e `（スペースを忘れずに）を入力した後、`<Tab>` を押します。Vimは選択できる関連ファイル名をリストアップしますので、最初から入力する必要はありません。

## 履歴ウィンドウとコマンドラインウィンドウ

コマンドラインコマンドと検索用語の履歴を表示できます（これには `+cmdline_hist` 機能が必要です）。

コマンドライン履歴を開くには、`:his :` を実行します。次のような内容が表示されるはずです：

```shell
## Cmd history
2  e file1.txt
3  g/foo/d
4  s/foo/bar/g
```

Vimは実行したすべての `:` コマンドの履歴をリストします。デフォルトでは、Vimは最後の50コマンドを保存します。Vimが記憶するエントリの数を100に変更するには、`set history=100` を実行します。

コマンドライン履歴のより便利な使い方は、コマンドラインウィンドウ `q:` を通じて行います。これにより、検索可能で編集可能な履歴ウィンドウが開きます。`q:` を押したときに履歴に次のような式があるとします：

```shell
51  s/verylongsubstitutionpattern/pancake/g
52  his :
53  wq
```

現在のタスクが `s/verylongsubstitutionpattern/donut/g` を行うことであれば、コマンドを最初から入力するのではなく、`s/verylongsubstitutionpattern/pancake/g` を再利用してみてはいかがでしょうか？結局のところ、異なるのは単語の置換だけで、「donut」と「pancake」です。他はすべて同じです。

`q:` を実行した後、履歴の中から `s/verylongsubstitutionpattern/pancake/g` を見つけ（この環境でVimのナビゲーションを使用できます）、直接編集します！履歴ウィンドウ内で「pancake」を「donut」に変更し、次に `<Enter>` を押します。すると、Vimは `s/verylongsubstitutionpattern/donut/g` を実行します。非常に便利です！

同様に、検索履歴を表示するには、`:his /` または `:his ?` を実行します。過去の履歴を検索し編集できる検索履歴ウィンドウを開くには、`q/` または `q?` を実行します。

このウィンドウを終了するには、`Ctrl-C`、`Ctrl-W C`、または `:quit` と入力します。

## さらなるコマンドラインコマンド

Vimには数百の組み込みコマンドがあります。Vimのすべてのコマンドを確認するには、`:h ex-cmd-index` または `:h :index` をチェックしてください。

## スマートな方法でコマンドラインモードを学ぶ

他の3つのモードと比較して、コマンドラインモードはテキスト編集のスイスアーミーナイフのようです。テキストを編集したり、ファイルを修正したり、コマンドを実行したりすることができます。この章はコマンドラインモードのさまざまな要素の集まりです。また、Vimのモードを締めくくります。通常モード、挿入モード、ビジュアルモード、コマンドラインモードの使い方を知ったので、Vimでテキストをこれまで以上に速く編集できるようになります。

Vimのモードから離れ、Vimタグを使ってさらに速いナビゲーションを学ぶ時が来ました。